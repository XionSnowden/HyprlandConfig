import{a as Ki,b as bs,c as Ji,d as Zi,e as Qi,f as Le}from"./chunk/chunk-ZH7EPW57.js";import{a as Zs}from"./chunk/chunk-ZERDIXIU.js";import"./chunk/chunk-GHZKJDSA.js";import{a as Ht}from"./chunk/chunk-POEL6JG4.js";import"./chunk/chunk-VJ7NKQ6C.js";import{a as is,b as Gt,d as ml,e as bl,f as tn,g as sn}from"./chunk/chunk-BLUX6CJK.js";import{c as Tt}from"./chunk/chunk-4YBGNFWQ.js";import{C as nn,D as on,E as $e,a as el,b as ue,o as wl,w as xl,x as rn,y as Cl,z as Il}from"./chunk/chunk-LYSQIBIX.js";import{a as yl,c as Qs,h as Sl}from"./chunk/chunk-SI5R733D.js";import"./chunk/chunk-MKPVND6D.js";import"./chunk/chunk-HK4AF347.js";import{a as fl,b as gl,c as vl}from"./chunk/chunk-5W2VRENG.js";import"./chunk/chunk-6DEVOV36.js";import{a as ne,b as ns}from"./chunk/chunk-KN5R6GSV.js";import"./chunk/chunk-UJ3CAIKP.js";import{a as Wr}from"./chunk/chunk-G7LRX6NT.js";import{a as Ya}from"./chunk/chunk-Z6SXIBNK.js";import"./chunk/chunk-5GHRE4BP.js";import"./chunk/chunk-ESW4O4YS.js";import{a as Se}from"./chunk/chunk-JWPGNWQB.js";import"./chunk/chunk-IBBROPNX.js";import"./chunk/chunk-BZBFFOH5.js";import{a as Nr}from"./chunk/chunk-QYSCVIGP.js";import{b as rl,d as al,e as ll}from"./chunk/chunk-OOYYGJTO.js";import{a as Yi,b as cl,c as $r}from"./chunk/chunk-J6L6J5R7.js";import{b as ja}from"./chunk/chunk-DQXOKHFD.js";import{a as _e}from"./chunk/chunk-YJ5KKARE.js";import{a as Ct,c as en}from"./chunk/chunk-NNBWZ6HI.js";import{a as nl}from"./chunk/chunk-KBTFUBYZ.js";import"./chunk/chunk-QTI25AH7.js";import"./chunk/chunk-A7ZJ67EZ.js";import"./chunk/chunk-SEYYHBSH.js";import{a as ol}from"./chunk/chunk-HOPQVMFY.js";import{a as il,c as Oe}from"./chunk/chunk-TWAD4QJO.js";import{d as St,e as Ut,f as Wa,g as Xi,k as Ua,o as qa,v as Ga,w as Ha,z as wt}from"./chunk/chunk-IMQHRNK4.js";import{a as tl}from"./chunk/chunk-MGJOXMXS.js";import{a as jr,d as dl,f as ul,g as hl}from"./chunk/chunk-6PXAOD22.js";import"./chunk/chunk-374UYNGS.js";import{e as pl}from"./chunk/chunk-H5EO627A.js";import"./chunk/chunk-AMQF2NRG.js";import"./chunk/chunk-4OSIXHXT.js";import"./chunk/chunk-V4FTYK2W.js";import"./chunk/chunk-3YSPJCIY.js";import{a as et}from"./chunk/chunk-KFWGEN4K.js";import"./chunk/chunk-HTT347OR.js";import{a as rs}from"./chunk/chunk-PTKZDLN6.js";import{a as Br}from"./chunk/chunk-PL6DDC6Q.js";import{a as ye,b as Js,d as fe,e as Re,f as qt,h as Za,i as Fr,j as lt,k as Qa}from"./chunk/chunk-SSPC3AL5.js";import{E as sl}from"./chunk/chunk-TB2MSUH5.js";import"./chunk/chunk-MUB3DQUZ.js";import{c as xs}from"./chunk/chunk-CRHRJPRJ.js";import"./chunk/chunk-CWRGSBHN.js";import{a as Ss}from"./chunk/chunk-PIPETCCX.js";import"./chunk/chunk-XJAAGGJ2.js";import{a as ws}from"./chunk/chunk-OTWO5H3C.js";import{b as Te,c as ie,h as xt}from"./chunk/chunk-BVG7RORO.js";import"./chunk/chunk-VAJOC7YO.js";import{a as Va,b as za,c as Ka,d as Xa,e as Ja}from"./chunk/chunk-5VSBIKDK.js";import{a as ys}from"./chunk/chunk-MM5FGF5D.js";import{b as mt}from"./chunk/chunk-WFJOWCXF.js";import{a as Wt,c as M,d as Na,e as $a}from"./chunk/chunk-LI3RKPGW.js";import"./chunk/chunk-3AUSJ54I.js";import{a as P,b as de,c as Xs,e as Ba,f as zi,h as le}from"./chunk/chunk-CM6X6NVN.js";var ln=zi((Ur,Ys)=>{(function(){"use strict";var n={function:!0,object:!0},e=n[typeof window]&&window||this,t=e,s=n[typeof Ur]&&Ur,r=n[typeof Ys]&&Ys&&!Ys.nodeType&&Ys,i=s&&r&&typeof global=="object"&&global;i&&(i.global===i||i.window===i||i.self===i)&&(e=i);var o=Math.pow(2,53)-1,l=/\bOpera/,c=this,u=Object.prototype,p=u.hasOwnProperty,m=u.toString;function v(I){return I=String(I),I.charAt(0).toUpperCase()+I.slice(1)}function b(I,O,R){var H={"10.0":"10","6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return O&&R&&/^Win/i.test(I)&&!/^Windows Phone /i.test(I)&&(H=H[/[\d.]+$/.exec(I)])&&(I="Windows "+H),I=String(I),O&&R&&(I=I.replace(RegExp(O,"i"),R)),I=w(I.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0]),I}function y(I,O){var R=-1,H=I?I.length:0;if(typeof H=="number"&&H>-1&&H<=o)for(;++R<H;)O(I[R],R,I);else _(I,O)}function w(I){return I=ee(I),/^(?:webOS|i(?:OS|P))/.test(I)?I:v(I)}function _(I,O){for(var R in I)p.call(I,R)&&O(I[R],R,I)}function T(I){return I==null?v(I):m.call(I).slice(8,-1)}function A(I,O){var R=I!=null?typeof I[O]:"number";return!/^(?:boolean|number|string|undefined)$/.test(R)&&(R=="object"?!!I[O]:!0)}function W(I){return String(I).replace(/([ -])(?!$)/g,"$1?")}function Z(I,O){var R=null;return y(I,function(H,he){R=O(R,H,he,I)}),R}function ee(I){return String(I).replace(/^ +| +$/g,"")}function ge(I){var O=e,R=I&&typeof I=="object"&&T(I)!="String";R&&(O=I,I=null);var H=O.navigator||{},he=H.userAgent||"";I||(I=he);var E=R||c==t,oe=R?!!H.likeChrome:/\bChrome\b/.test(I)&&!/internal|\n/i.test(m.toString()),te="Object",Ce=R?te:"ScriptBridgingProxyObject",Ge=R?te:"Environment",be=R&&O.java?"JavaPackage":T(O.java),Me=R?te:"RuntimeObject",Ie=/\bJava/.test(be)&&O.java,ae=Ie&&T(O.environment)==Ge,Ee=Ie?"a":"\u03B1",Je=Ie?"b":"\u03B2",Ze=O.document||{},C=O.operamini||O.opera,He=l.test(He=R&&C?C["[[Class]]"]:T(C))?He:C=null,x,ut=I,Y=[],ht=null,Qe=I==he,U=Qe&&C&&typeof C.version=="function"&&C.version(),Qt,J=nt([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),k=Ot(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),Q=_t([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),xe=Lt({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),B=re(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function nt(L){return Z(L,function(q,K){return q||RegExp("\\b"+(K.pattern||W(K))+"\\b","i").exec(I)&&(K.label||K)})}function Lt(L){return Z(L,function(q,K,F){return q||(K[Q]||K[/^[a-z]+(?: +[a-z]+\b)*/i.exec(Q)]||RegExp("\\b"+W(F)+"(?:\\b|\\w*\\d)","i").exec(I))&&F})}function Ot(L){return Z(L,function(q,K){return q||RegExp("\\b"+(K.pattern||W(K))+"\\b","i").exec(I)&&(K.label||K)})}function re(L){return Z(L,function(q,K){var F=K.pattern||W(K);return!q&&(q=RegExp("\\b"+F+"(?:/[\\d.]+|[ \\w.]*)","i").exec(I))&&(q=b(q,F,K.label||K)),q})}function _t(L){return Z(L,function(q,K){var F=K.pattern||W(K);return!q&&(q=RegExp("\\b"+F+" *\\d+[.\\w_]*","i").exec(I)||RegExp("\\b"+F+" *\\w+-[\\w]*","i").exec(I)||RegExp("\\b"+F+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(I))&&((q=String(K.label&&!RegExp(F,"i").test(K.label)?K.label:q).split("/"))[1]&&!/[\d.]+/.test(q[0])&&(q[0]+=" "+q[1]),K=K.label||K,q=w(q[0].replace(RegExp(F,"i"),K).replace(RegExp("; *(?:"+K+"[_-])?","i")," ").replace(RegExp("("+K+")[-_.]?(\\w)","i"),"$1 $2"))),q})}function Ye(L){return Z(L,function(q,K){return q||(RegExp(K+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(I)||0)[1]||null})}function V(){return this.description||""}if(J&&(J=[J]),/\bAndroid\b/.test(B)&&!Q&&(x=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(I))&&(Q=ee(x[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),xe&&!Q?Q=_t([xe]):xe&&Q&&(Q=Q.replace(RegExp("^("+W(xe)+")[-_.\\s]","i"),xe+" ").replace(RegExp("^("+W(xe)+")[-_.]?(\\w)","i"),xe+" $2")),(x=/\bGoogle TV\b/.exec(Q))&&(Q=x[0]),/\bSimulator\b/i.test(I)&&(Q=(Q?Q+" ":"")+"Simulator"),k=="Opera Mini"&&/\bOPiOS\b/.test(I)&&Y.push("running in Turbo/Uncompressed mode"),k=="IE"&&/\blike iPhone OS\b/.test(I)?(x=ge(I.replace(/like iPhone OS/,"")),xe=x.manufacturer,Q=x.product):/^iP/.test(Q)?(k||(k="Safari"),B="iOS"+((x=/ OS ([\d_]+)/i.exec(I))?" "+x[1].replace(/_/g,"."):"")):k=="Konqueror"&&/^Linux\b/i.test(B)?B="Kubuntu":xe&&xe!="Google"&&(/Chrome/.test(k)&&!/\bMobile Safari\b/i.test(I)||/\bVita\b/.test(Q))||/\bAndroid\b/.test(B)&&/^Chrome/.test(k)&&/\bVersion\//i.test(I)?(k="Android Browser",B=/\bAndroid\b/.test(B)?B:"Android"):k=="Silk"?(/\bMobi/i.test(I)||(B="Android",Y.unshift("desktop mode")),/Accelerated *= *true/i.test(I)&&Y.unshift("accelerated")):k=="UC Browser"&&/\bUCWEB\b/.test(I)?Y.push("speed mode"):k=="PaleMoon"&&(x=/\bFirefox\/([\d.]+)\b/.exec(I))?Y.push("identifying as Firefox "+x[1]):k=="Firefox"&&(x=/\b(Mobile|Tablet|TV)\b/i.exec(I))?(B||(B="Firefox OS"),Q||(Q=x[1])):!k||(x=!/\bMinefield\b/i.test(I)&&/\b(?:Firefox|Safari)\b/.exec(k))?(k&&!Q&&/[\/,]|^[^(]+?\)/.test(I.slice(I.indexOf(x+"/")+8))&&(k=null),(x=Q||xe||B)&&(Q||xe||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(B))&&(k=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(B)?B:x)+" Browser")):k=="Electron"&&(x=(/\bChrome\/([\d.]+)\b/.exec(I)||0)[1])&&Y.push("Chromium "+x),U||(U=Ye(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",W(k),"(?:Firefox|Minefield|NetFront)"])),(x=J=="iCab"&&parseFloat(U)>3&&"WebKit"||/\bOpera\b/.test(k)&&(/\bOPR\b/.test(I)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(I)&&!/^(?:Trident|EdgeHTML)$/.test(J)&&"WebKit"||!J&&/\bMSIE\b/i.test(I)&&(B=="Mac OS"?"Tasman":"Trident")||J=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(k)&&"NetFront")&&(J=[x]),k=="IE"&&(x=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(I)||0)[1])?(k+=" Mobile",B="Windows Phone "+(/\+$/.test(x)?x:x+".x"),Y.unshift("desktop mode")):/\bWPDesktop\b/i.test(I)?(k="IE Mobile",B="Windows Phone 8.x",Y.unshift("desktop mode"),U||(U=(/\brv:([\d.]+)/.exec(I)||0)[1])):k!="IE"&&J=="Trident"&&(x=/\brv:([\d.]+)/.exec(I))&&(k&&Y.push("identifying as "+k+(U?" "+U:"")),k="IE",U=x[1]),Qe){if(A(O,"global"))if(Ie&&(x=Ie.lang.System,ut=x.getProperty("os.arch"),B=B||x.getProperty("os.name")+" "+x.getProperty("os.version")),ae){try{U=O.require("ringo/engine").version.join("."),k="RingoJS"}catch(L){(x=O.system)&&x.global.system==O.system&&(k="Narwhal",B||(B=x[0].os||null))}k||(k="Rhino")}else typeof O.process=="object"&&!O.process.browser&&(x=O.process)&&(typeof x.versions=="object"&&(typeof x.versions.electron=="string"?(Y.push("Node "+x.versions.node),k="Electron",U=x.versions.electron):typeof x.versions.nw=="string"&&(Y.push("Chromium "+U,"Node "+x.versions.node),k="NW.js",U=x.versions.nw)),k||(k="Node.js",ut=x.arch,B=x.platform,U=/[\d.]+/.exec(x.version),U=U?U[0]:null));else T(x=O.runtime)==Ce?(k="Adobe AIR",B=x.flash.system.Capabilities.os):T(x=O.phantom)==Me?(k="PhantomJS",U=(x=x.version||null)&&x.major+"."+x.minor+"."+x.patch):typeof Ze.documentMode=="number"&&(x=/\bTrident\/(\d+)/i.exec(I))?(U=[U,Ze.documentMode],(x=+x[1]+4)!=U[1]&&(Y.push("IE "+U[1]+" mode"),J&&(J[1]=""),U[1]=x),U=k=="IE"?String(U[1].toFixed(1)):U[0]):typeof Ze.documentMode=="number"&&/^(?:Chrome|Firefox)\b/.test(k)&&(Y.push("masking as "+k+" "+U),k="IE",U="11.0",J=["Trident"],B="Windows");B=B&&w(B)}if(U&&(x=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(U)||/(?:alpha|beta)(?: ?\d)?/i.exec(I+";"+(Qe&&H.appMinorVersion))||/\bMinefield\b/i.test(I)&&"a")&&(ht=/b/i.test(x)?"beta":"alpha",U=U.replace(RegExp(x+"\\+?$"),"")+(ht=="beta"?Je:Ee)+(/\d+\+?/.exec(x)||"")),k=="Fennec"||k=="Firefox"&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(B))k="Firefox Mobile";else if(k=="Maxthon"&&U)U=U.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(Q))Q=="Xbox 360"&&(B=null),Q=="Xbox 360"&&/\bIEMobile\b/.test(I)&&Y.unshift("mobile mode");else if((/^(?:Chrome|IE|Opera)$/.test(k)||k&&!Q&&!/Browser|Mobi/.test(k))&&(B=="Windows CE"||/Mobi/i.test(I)))k+=" Mobile";else if(k=="IE"&&Qe)try{O.external===null&&Y.unshift("platform preview")}catch(L){Y.unshift("embedded")}else(/\bBlackBerry\b/.test(Q)||/\bBB10\b/.test(I))&&(x=(RegExp(Q.replace(/ +/g," *")+"/([.\\d]+)","i").exec(I)||0)[1]||U)?(x=[x,/BB10/.test(I)],B=(x[1]?(Q=null,xe="BlackBerry"):"Device Software")+" "+x[0],U=null):this!=_&&Q!="Wii"&&(Qe&&C||/Opera/.test(k)&&/\b(?:MSIE|Firefox)\b/i.test(I)||k=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(B)||k=="IE"&&(B&&!/^Win/.test(B)&&U>5.5||/\bWindows XP\b/.test(B)&&U>8||U==8&&!/\bTrident\b/.test(I)))&&!l.test(x=ge.call(_,I.replace(l,"")+";"))&&x.name&&(x="ing as "+x.name+((x=x.version)?" "+x:""),l.test(k)?(/\bIE\b/.test(x)&&B=="Mac OS"&&(B=null),x="identify"+x):(x="mask"+x,He?k=w(He.replace(/([a-z])([A-Z])/g,"$1 $2")):k="Opera",/\bIE\b/.test(x)&&(B=null),Qe||(U=null)),J=["Presto"],Y.push(x));(x=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(I)||0)[1])&&(x=[parseFloat(x.replace(/\.(\d)$/,".0$1")),x],k=="Safari"&&x[1].slice(-1)=="+"?(k="WebKit Nightly",ht="alpha",U=x[1].slice(0,-1)):(U==x[1]||U==(x[2]=(/\bSafari\/([\d.]+\+?)/i.exec(I)||0)[1]))&&(U=null),x[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(I)||0)[1],x[0]==537.36&&x[2]==537.36&&parseFloat(x[1])>=28&&J=="WebKit"&&(J=["Blink"]),!Qe||!oe&&!x[1]?(J&&(J[1]="like Safari"),x=(x=x[0],x<400?1:x<500?2:x<526?3:x<533?4:x<534?"4+":x<535?5:x<537?6:x<538?7:x<601?8:x<602?9:x<604?10:x<606?11:x<608?12:"12")):(J&&(J[1]="like Chrome"),x=x[1]||(x=x[0],x<530?1:x<532?2:x<532.05?3:x<533?4:x<534.03?5:x<534.07?6:x<534.1?7:x<534.13?8:x<534.16?9:x<534.24?10:x<534.3?11:x<535.01?12:x<535.02?"13+":x<535.07?15:x<535.11?16:x<535.19?17:x<536.05?18:x<536.1?19:x<537.01?20:x<537.11?"21+":x<537.13?23:x<537.18?24:x<537.24?25:x<537.36?26:J!="Blink"?"27":"28")),J&&(J[1]+=" "+(x+=typeof x=="number"?".x":/[.+]/.test(x)?"":"+")),k=="Safari"&&(!U||parseInt(U)>45)?U=x:k=="Chrome"&&/\bHeadlessChrome/i.test(I)&&Y.unshift("headless")),k=="Opera"&&(x=/\bzbov|zvav$/.exec(B))?(k+=" ",Y.unshift("desktop mode"),x=="zvav"?(k+="Mini",U=null):k+="Mobile",B=B.replace(RegExp(" *"+x+"$"),"")):k=="Safari"&&/\bChrome\b/.exec(J&&J[1])?(Y.unshift("desktop mode"),k="Chrome Mobile",U=null,/\bOS X\b/.test(B)?(xe="Apple",B="iOS 4.3+"):B=null):/\bSRWare Iron\b/.test(k)&&!U&&(U=Ye("Chrome")),U&&U.indexOf(x=/[\d.]+$/.exec(B))==0&&I.indexOf("/"+x+"-")>-1&&(B=ee(B.replace(x,""))),B&&B.indexOf(k)!=-1&&!RegExp(k+" OS").test(B)&&(B=B.replace(RegExp(" *"+W(k)+" *"),"")),J&&!/\b(?:Avant|Nook)\b/.test(k)&&(/Browser|Lunascape|Maxthon/.test(k)||k!="Safari"&&/^iOS/.test(B)&&/\bSafari\b/.test(J[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(k)&&J[1])&&(x=J[J.length-1])&&Y.push(x),Y.length&&(Y=["("+Y.join("; ")+")"]),xe&&Q&&Q.indexOf(xe)<0&&Y.push("on "+xe),Q&&Y.push((/^on /.test(Y[Y.length-1])?"":"on ")+Q),B&&(x=/ ([\d.+]+)$/.exec(B),Qt=x&&B.charAt(B.length-x[0].length-1)=="/",B={architecture:32,family:x&&!Qt?B.replace(x[0],""):B,version:x?x[1]:null,toString:function(){var L=this.version;return this.family+(L&&!Qt?" "+L:"")+(this.architecture==64?" 64-bit":"")}}),(x=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(ut))&&!/\bi686\b/i.test(ut)?(B&&(B.architecture=64,B.family=B.family.replace(RegExp(" *"+x),"")),k&&(/\bWOW64\b/i.test(I)||Qe&&/\w(?:86|32)$/.test(H.cpuClass||H.platform)&&!/\bWin64; x64\b/i.test(I))&&Y.unshift("32-bit")):B&&/^OS X/.test(B.family)&&k=="Chrome"&&parseFloat(U)>=39&&(B.architecture=64),I||(I=null);var z={};return z.description=I,z.layout=J&&J[0],z.manufacturer=xe,z.name=k,z.prerelease=ht,z.product=Q,z.ua=I,z.version=k&&U,z.os=B||{architecture:null,family:null,version:null,toString:function(){return"null"}},z.parse=ge,z.toString=V,z.version&&Y.unshift(U),z.name&&Y.unshift(k),B&&k&&!(B==String(B).split(" ")[0]&&(B==k.split(" ")[0]||Q))&&Y.push(Q?"("+B+")":"on "+B),Y.length&&(z.description=Y.join(" ")),z}var ce=ge();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(e.platform=ce,define(function(){return ce})):s&&r?_(ce,function(I,O){s[O]=I}):e.platform=ce}).call(Ur)});var Bn=zi((mc,Fn)=>{(function(n){if(typeof mc=="object"&&typeof Fn!="undefined")Fn.exports=n();else if(typeof define=="function"&&define.amd)define([],n);else{var e;e=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:this,e.ally=n()}})(function(){var n;return function e(t,s,r){function i(c,u){if(!s[c]){if(!t[c]){var p=typeof Xs=="function"&&Xs;if(!u&&p)return p(c,!0);if(o)return o(c,!0);var m=new Error("Cannot find module '"+c+"'");throw m.code="MODULE_NOT_FOUND",m}var v=s[c]={exports:{}};t[c][0].call(v.exports,function(b){var y=t[c][1][b];return i(y||b)},v,v.exports,e,t,s,r)}return s[c].exports}for(var o=typeof Xs=="function"&&Xs,l=0;l<r.length;l++)i(r[l]);return i}({1:[function(e,t){"use strict";function s(a,d){if(!(a instanceof d))throw new TypeError("Cannot call a class as a function")}function r(a){return a&&(typeof a=="undefined"?"undefined":ea(a))==="object"&&"default"in a?a.default:a}function i(){var a={activeElement:document.activeElement,windowScrollTop:window.scrollTop,windowScrollLeft:window.scrollLeft,bodyScrollTop:document.body.scrollTop,bodyScrollLeft:document.body.scrollLeft},d=document.createElement("iframe");d.setAttribute("style","position:absolute; position:fixed; top:0; left:-2px; width:1px; height:1px; overflow:hidden;"),d.setAttribute("aria-live","off"),d.setAttribute("aria-busy","true"),d.setAttribute("aria-hidden","true"),document.body.appendChild(d);var h=d.contentWindow,f=h.document;f.open(),f.close();var g=f.createElement("div");return f.body.appendChild(g),a.iframe=d,a.wrapper=g,a.window=h,a.document=f,a}function o(a,d){a.wrapper.innerHTML="";var h=typeof d.element=="string"?a.document.createElement(d.element):d.element(a.wrapper,a.document),f=d.mutate&&d.mutate(h,a.wrapper,a.document);return f||f===!1||(f=h),!h.parentNode&&a.wrapper.appendChild(h),f&&f.focus&&f.focus(),d.validate?d.validate(h,f,a.document):a.document.activeElement===f}function l(a){a.activeElement===document.body?(document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),j.is.IE10&&document.body.focus()):a.activeElement&&a.activeElement.focus&&a.activeElement.focus(),document.body.removeChild(a.iframe),window.scrollTop=a.windowScrollTop,window.scrollLeft=a.windowScrollLeft,document.body.scrollTop=a.bodyScrollTop,document.body.scrollLeft=a.bodyScrollLeft}function c(a){var d=void 0;try{d=window.localStorage&&window.localStorage.getItem(a),d=d?JSON.parse(d):{}}catch(h){d={}}return d}function u(a,d){if(document.hasFocus())try{window.localStorage&&window.localStorage.setItem(a,JSON.stringify(d))}catch(h){}else try{window.localStorage&&window.localStorage.removeItem(a)}catch(h){}}function p(){var a=document.createElement("div");return a.innerHTML=`<svg><foreignObject width="30" height="30">
      <input type="text"/>
  </foreignObject></svg>`,a.firstChild.firstChild}function m(a){return'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+a+"</svg>"}function v(a){if(!a.focus)try{HTMLElement.prototype.focus.call(a)}catch(d){oa(a)}}function b(a,d,h){return v(d),h.activeElement===d}function y(){var a=Nu(_h);return Object.keys(aa).forEach(function(d){a[d]=aa[d]()}),a}function w(){Rh.warn("trying to focus inert element",this)}function _(a,d){if(d){var h=vt(a);us({element:a,attribute:"tabindex",temporaryValue:"-1",saveValue:h!==null?h:""})}else us({element:a,attribute:"tabindex"})}function T(a,d){da({element:a,attribute:"controls",remove:d})}function A(a,d){us({element:a,attribute:"focusable",temporaryValue:d?"false":void 0})}function W(a,d){da({element:a,attribute:"xlink:href",remove:d})}function Z(a,d){us({element:a,attribute:"aria-disabled",temporaryValue:d?"true":void 0})}function ee(a,d){d?a.focus=w:delete a.focus}function ge(a,d){if(d){var h=a.style.pointerEvents||"";a.setAttribute("data-inert-pointer-events",h),a.style.pointerEvents="none"}else{var f=a.getAttribute("data-inert-pointer-events");a.removeAttribute("data-inert-pointer-events"),a.style.pointerEvents=f}}function ce(a,d){Z(a,d),_(a,d),ee(a,d),ge(a,d);var h=a.nodeName.toLowerCase();(h==="video"||h==="audio")&&T(a,d),(h==="svg"||a.ownerSVGElement)&&(Dr.focusSvgFocusableAttribute?A(a,d):Dr.focusSvgTabindexAttribute||h!=="a"||W(a,d)),d?a.setAttribute("data-ally-disabled","true"):a.removeAttribute("data-ally-disabled")}function I(a){Ah.some(function(d){return a[d]?(wi=d,!0):!1})}function O(a,d){return wi||I(a),a[wi](d)}function R(a){var d=a.webkitUserModify||"";return Boolean(d&&d.indexOf("write")!==-1)}function H(a){return[a.getPropertyValue("overflow"),a.getPropertyValue("overflow-x"),a.getPropertyValue("overflow-y")].some(function(d){return d==="auto"||d==="scroll"})}function he(a){return a.display.indexOf("flex")>-1}function E(a,d,h,f){return d!=="div"&&d!=="span"||h&&h!=="div"&&h!=="span"&&!H(f)?!1:a.offsetHeight<a.scrollHeight||a.offsetWidth<a.scrollWidth}function oe(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.except,f=h===void 0?{flexbox:!1,scrollable:!1,shadow:!1}:h;me||(me=at());var g=ve({label:"is/focus-relevant",resolveDocument:!0,context:d});if(!f.shadow&&g.shadowRoot)return!0;var S=g.nodeName.toLowerCase();if(S==="input"&&g.type==="hidden")return!1;if(S==="input"||S==="select"||S==="button"||S==="textarea"||S==="legend"&&me.focusRedirectLegend||S==="label"||S==="area"||S==="a"&&g.hasAttribute("href"))return!0;if(S==="object"&&g.hasAttribute("usemap"))return!1;if(S==="object"){var D=g.getAttribute("type");if(!me.focusObjectSvg&&D==="image/svg+xml"||!me.focusObjectSwf&&D==="application/x-shockwave-flash")return!1}if(S==="iframe"||S==="object"||S==="embed"||S==="keygen"||g.hasAttribute("contenteditable")||S==="audio"&&(me.focusAudioWithoutControls||g.hasAttribute("controls"))||S==="video"&&(me.focusVideoWithoutControls||g.hasAttribute("controls"))||me.focusSummary&&S==="summary")return!0;var N=Er(g);if(S==="img"&&g.hasAttribute("usemap"))return N&&me.focusImgUsemapTabindex||me.focusRedirectImgUsemap;if(me.focusTable&&(S==="table"||S==="td")||me.focusFieldset&&S==="fieldset")return!0;var $=S==="svg",X=g.ownerSVGElement,De=g.getAttribute("focusable"),ke=vt(g);if(S==="use"&&ke!==null&&!me.focusSvgUseTabindex)return!1;if(S==="foreignobject")return ke!==null&&me.focusSvgForeignobjectTabindex;if(O(g,"svg a")&&g.hasAttribute("xlink:href"))return!0;if(($||X)&&g.focus&&!me.focusSvgNegativeTabindexAttribute&&0>ke)return!1;if($)return N||me.focusSvg||me.focusSvgInIframe||Boolean(me.focusSvgFocusableAttribute&&De&&De==="true");if(X){if(me.focusSvgTabindexAttribute&&N)return!0;if(me.focusSvgFocusableAttribute)return De==="true"}if(N)return!0;var yt=window.getComputedStyle(g,null);if(R(yt))return!0;if(me.focusImgIsmap&&S==="img"&&g.hasAttribute("ismap")){var ss=bt({context:g}).some(function(Ks){return Ks.nodeName.toLowerCase()==="a"&&Ks.hasAttribute("href")});if(ss)return!0}if(!f.scrollable&&me.focusScrollContainer){if(me.focusScrollContainerWithoutOverflow){if(E(g,S))return!0}else if(H(yt))return!0}if(!f.flexbox&&me.focusFlexboxContainer&&he(yt))return!0;var vs=g.parentElement;if(!f.scrollable&&vs){var Vi=vs.nodeName.toLowerCase(),zs=window.getComputedStyle(vs,null);if(me.focusScrollBody&&E(vs,S,Vi,zs)||me.focusChildrenOfFocusableFlexbox&&he(zs))return!0}return!1}function te(a,d){if(a.findIndex)return a.findIndex(d);var h=a.length;if(h===0)return-1;for(var f=0;h>f;f++)if(d(a[f],f,a))return f;return-1}function Ce(a){if(Ci||(Ci=xi("object, iframe")),a._frameElement!==void 0)return a._frameElement;a._frameElement=null;var d=a.parent.document.querySelectorAll(Ci);return[].some.call(d,function(h){var f=Ph(h);return f!==a.document?!1:(a._frameElement=h,!0)}),a._frameElement}function Ge(a){var d=vi(a);if(!d.parent||d.parent===d)return null;try{return d.frameElement||Ce(d)}catch(h){return null}}function be(a,d){return window.getComputedStyle(a,null).getPropertyValue(d)}function Me(a){return a.some(function(d){return be(d,"display")==="none"})}function Ie(a){var d=te(a,function(f){var g=be(f,"visibility");return g==="hidden"||g==="collapse"});if(d===-1)return!1;var h=te(a,function(f){return be(f,"visibility")==="visible"});return h===-1?!0:h>d}function ae(a){var d=1;return a[0].nodeName.toLowerCase()==="summary"&&(d=2),a.slice(d).some(function(h){return h.nodeName.toLowerCase()==="details"&&h.open===!1})}function Ee(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.except,f=h===void 0?{notRendered:!1,cssDisplay:!1,cssVisibility:!1,detailsElement:!1,browsingContext:!1}:h,g=ve({label:"is/visible",resolveDocument:!0,context:d}),S=g.nodeName.toLowerCase();if(!f.notRendered&&kh.test(S))return!0;var D=bt({context:g}),N=S==="audio"&&!g.hasAttribute("controls");if(!f.cssDisplay&&Me(N?D.slice(1):D)||!f.cssVisibility&&Ie(D)||!f.detailsElement&&ae(D))return!1;if(!f.browsingContext){var $=Ge(g),X=Ee.except(f);if($&&!X($))return!1}return!0}function Je(a,d){var h=d.querySelector('map[name="'+ta(a)+'"]');return h||null}function Ze(a){var d=a.getAttribute("usemap");if(!d)return null;var h=pt(a);return Je(d.slice(1),h)}function C(a){var d=a.parentElement;if(!d.name||d.nodeName.toLowerCase()!=="map")return null;var h=pt(a);return h.querySelector('img[usemap="#'+ta(d.name)+'"]')||null}function He(a){var d=a.nodeName.toLowerCase();return d==="fieldset"&&a.disabled}function x(a){var d=a.nodeName.toLowerCase();return d==="form"&&a.disabled}function ut(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.except,f=h===void 0?{onlyFocusableBrowsingContext:!1,visible:!1}:h,g=ve({label:"is/only-tabbable",resolveDocument:!0,context:d});if(!f.visible&&!hs(g))return!1;if(!f.onlyFocusableBrowsingContext&&(j.is.GECKO||j.is.TRIDENT||j.is.EDGE)){var S=Ge(g);if(S&&vt(S)<0)return!1}var D=g.nodeName.toLowerCase(),N=vt(g);return D==="label"&&j.is.GECKO?N!==null&&N>=0:!!(j.is.GECKO&&g.ownerSVGElement&&!g.focus&&D==="a"&&g.hasAttribute("xlink:href")&&j.is.GECKO)}function Y(a){var d=a.nodeName.toLowerCase();if(d==="embed"||d==="keygen")return!0;var h=vt(a);if(a.shadowRoot&&h===null)return!0;if(d==="label")return!Mt.focusLabelTabindex||h===null;if(d==="legend")return h===null;if(Mt.focusSvgFocusableAttribute&&(a.ownerSVGElement||d==="svg")){var f=a.getAttribute("focusable");return f&&f==="false"}return d==="img"&&a.hasAttribute("usemap")?h===null||!Mt.focusImgUsemapTabindex:d==="area"?!ua(a):!1}function ht(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.except,f=h===void 0?{disabled:!1,visible:!1,onlyTabbable:!1}:h;Mt||(Mt=at());var g=pa.rules.except({onlyFocusableBrowsingContext:!0,visible:f.visible}),S=ve({label:"is/focusable",resolveDocument:!0,context:d}),D=Bs.rules({context:S,except:f});if(!D||Y(S)||!f.disabled&&ha(S)||!f.onlyTabbable&&g(S))return!1;if(!f.visible){var N={context:S,except:{}};if(Mt.focusInHiddenIframe&&(N.except.browsingContext=!0),Mt.focusObjectSvgHidden){var $=S.nodeName.toLowerCase();$==="object"&&(N.except.cssVisibility=!0)}if(!hs.rules(N))return!1}var X=Ge(S);if(X){var De=X.nodeName.toLowerCase();if(!(De!=="object"||Mt.focusInZeroDimensionObject||X.offsetWidth&&X.offsetHeight))return!1}var ke=S.nodeName.toLowerCase();return!(ke==="svg"&&Mt.focusSvgInIframe&&!X&&S.getAttribute("tabindex")===null)}function Qe(a){var d=function(h){return h.shadowRoot||a(h)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP};return d.acceptNode=d,d}function U(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.includeContext,f=a.includeOnlyTabbable,g=a.strategy;d||(d=document.documentElement);for(var S=$t.rules.except({onlyTabbable:f}),D=pt(d),N=D.createTreeWalker(d,NodeFilter.SHOW_ELEMENT,g==="all"?Lh:Qe(S),!1),$=[];N.nextNode();)N.currentNode.shadowRoot?(S(N.currentNode)&&$.push(N.currentNode),$=$.concat(U({context:N.currentNode.shadowRoot,includeOnlyTabbable:f,strategy:g}))):$.push(N.currentNode);return h&&(g==="all"?Bs(d)&&$.unshift(d):S(d)&&$.unshift(d)),$}function Qt(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.includeContext,f=a.includeOnlyTabbable,g=Oh(),S=d.querySelectorAll(g),D=$t.rules.except({onlyTabbable:f}),N=[].filter.call(S,D);return h&&D(d)&&N.unshift(d),N}function J(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.except,f=h===void 0?{flexbox:!1,scrollable:!1,shadow:!1,visible:!1,onlyTabbable:!1}:h;ps||(ps=at());var g=ve({label:"is/tabbable",resolveDocument:!0,context:d});if(j.is.BLINK&&j.is.ANDROID&&j.majorVersion>42)return!1;var S=Ge(g);if(S){if(j.is.WEBKIT&&j.is.IOS||vt(S)<0||!f.visible&&(j.is.BLINK||j.is.WEBKIT)&&!hs(S))return!1;var D=S.nodeName.toLowerCase();if(D==="object"){var N=j.name==="Chrome"&&j.majorVersion>=54||j.name==="Opera"&&j.majorVersion>=41;if(j.is.WEBKIT||j.is.BLINK&&!N)return!1}}var $=g.nodeName.toLowerCase(),X=vt(g),De=X===null?null:X>=0;if(j.is.EDGE&&j.majorVersion>=14&&S&&g.ownerSVGElement&&0>X)return!0;var ke=De!==!1,yt=X!==null&&X>=0;if(g.hasAttribute("contenteditable"))return ke;if(Fh.test($)&&De!==!0)return!1;if(j.is.WEBKIT&&j.is.IOS){var ss=$==="input"&&g.type==="text"||g.type==="password"||$==="select"||$==="textarea"||g.hasAttribute("contenteditable");if(!ss){var vs=window.getComputedStyle(g,null);ss=R(vs)}if(!ss)return!1}if($==="use"&&X!==null&&(j.is.BLINK||j.is.WEBKIT&&j.majorVersion===9)||O(g,"svg a")&&g.hasAttribute("xlink:href")&&(ke||g.focus&&!ps.focusSvgNegativeTabindexAttribute)||$==="svg"&&ps.focusSvgInIframe&&ke)return!0;if(j.is.TRIDENT||j.is.EDGE){if($==="svg")return ps.focusSvg?!0:g.hasAttribute("focusable")||yt;if(g.ownerSVGElement)return ps.focusSvgTabindexAttribute&&yt?!0:g.hasAttribute("focusable")}if(g.tabIndex===void 0)return Boolean(f.onlyTabbable);if($==="audio"){if(!g.hasAttribute("controls"))return!1;if(j.is.BLINK)return!0}if($==="video"){if(g.hasAttribute("controls")){if(j.is.BLINK||j.is.GECKO)return!0}else if(j.is.TRIDENT||j.is.EDGE)return!1}if($==="object"&&(j.is.BLINK||j.is.WEBKIT)||$==="iframe")return!1;if(!f.scrollable&&j.is.GECKO){var Vi=window.getComputedStyle(g,null);if(H(Vi))return ke}if(j.is.TRIDENT||j.is.EDGE){if($==="area"){var zs=C(g);if(zs&&vt(zs)<0)return!1}var Ks=window.getComputedStyle(g,null);if(R(Ks))return g.tabIndex>=0;if(!f.flexbox&&he(Ks))return X!==null?yt:Bh(g)&&Nh(g);if(E(g,$))return!1;var Or=g.parentElement;if(Or){var Pp=Or.nodeName.toLowerCase(),Fa=window.getComputedStyle(Or,null);if(E(Or,$,Pp,Fa))return!1;if(he(Fa))return yt}}return g.tabIndex>=0}function k(a,d){return a.compareDocumentPosition(d)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1}function Q(a,d){return te(a,function(h){return d.compareDocumentPosition(h)&Node.DOCUMENT_POSITION_FOLLOWING})}function xe(a,d,h){var f=[];return d.forEach(function(g){var S=!0,D=a.indexOf(g);D===-1&&(D=Q(a,g),S=!1),D===-1&&(D=a.length);var N=Ne(h?h(g):g);N.length&&f.push({offset:D,replace:S,elements:N})}),f}function B(a,d){var h=0;d.sort(function(f,g){return f.offset-g.offset}),d.forEach(function(f){var g=f.replace?1:0,S=[f.offset+h,g].concat(f.elements);a.splice.apply(a,S),h+=f.elements.length-g})}function nt(a){var d=a.nodeName.toLowerCase();return d==="input"||d==="textarea"||d==="select"||d==="button"}function Lt(a,d){var h=a.getAttribute("for");return h?d.getElementById(h):a.querySelector("input, select, textarea")}function Ot(a){var d=a.parentNode,h=js({context:d,strategy:"strict"});return h.filter(nt)[0]||null}function re(a,d){var h=Ws({context:d.body,strategy:"strict"});if(!h.length)return null;var f=Us({list:h,elements:[a]}),g=f.indexOf(a);return g===f.length-1?null:f[g+1]}function _t(a,d){if(!qs.focusRedirectLegend)return null;var h=a.parentNode;return h.nodeName.toLowerCase()!=="fieldset"?null:qs.focusRedirectLegend==="tabbable"?re(a,d):Ot(a,d)}function Ye(a){if(!qs.focusRedirectImgUsemap)return null;var d=Ze(a);return d&&d.querySelector("area")||null}function V(a){var d=bt({context:a}),h=d.slice(1).map(function(f){return{element:f,scrollTop:f.scrollTop,scrollLeft:f.scrollLeft}});return function(){h.forEach(function(f){f.element.scrollTop=f.scrollTop,f.element.scrollLeft=f.scrollLeft})}}function z(a){if(a.focus)return a.focus(),Bt(a)?a:null;var d=vi(a);try{return d.HTMLElement.prototype.focus.call(a),Bt(a)?a:null}catch(f){var h=oa(a);return h&&Bt(a)?a:null}}function L(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.force;d?this.instances=0:this.instances--,this.instances||(this.disengage(),this._result=null)}function q(){return this.instances?(this.instances++,this._result):(this.instances++,this._result=this.engage()||{},this._result.disengage=L.bind(this),this._result)}function K(){}function F(){if(document.activeElement){if(document.activeElement!==Rr){var a=new Uh("active-element",{bubbles:!1,cancelable:!1,detail:{focus:document.activeElement,blur:Rr}});document.dispatchEvent(a),Rr=document.activeElement}}else document.body.focus();Hs!==!1&&(Hs=requestAnimationFrame(F))}function Ae(){Hs=!0,Rr=document.activeElement,F()}function Pe(){cancelAnimationFrame(Hs),Hs=!1}function pe(){for(var a=[document.activeElement];a[0]&&a[0].shadowRoot;)a.unshift(a[0].shadowRoot.activeElement);return a}function se(){var a=ba({context:document.activeElement});return[document.activeElement].concat(a)}function ot(){this.context&&(this.context.forEach(this.disengage),this.context=null,this.engage=null,this.disengage=null)}function eu(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context;return this.context=Ne(d||document),this.context.forEach(this.engage),{disengage:ot.bind(this)}}function $o(){}function ks(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.parent,h=a.element,f=a.includeSelf;if(d)return function(g){return Boolean(f&&g===d||d.compareDocumentPosition(g)&Node.DOCUMENT_POSITION_CONTAINED_BY)};if(h)return function(g){return Boolean(f&&h===g||g.compareDocumentPosition(h)&Node.DOCUMENT_POSITION_CONTAINED_BY)};throw new TypeError("util/compare-position#getParentComparator required either options.parent or options.element")}function tu(a){var d=a.context,h=a.filter,f=function($){var X=ks({parent:$});return h.some(X)},g=[],S=function($){return h.some(function(X){return $===X})?NodeFilter.FILTER_REJECT:f($)?NodeFilter.FILTER_ACCEPT:(g.push($),NodeFilter.FILTER_REJECT)};S.acceptNode=S;for(var D=pt(d),N=D.createTreeWalker(d,NodeFilter.SHOW_ELEMENT,S,!1);N.nextNode(););return g}function Sr(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=ve({label:"query/shadow-hosts",resolveDocument:!0,defaultToDocument:!0,context:d}),f=pt(d),g=f.createTreeWalker(h,NodeFilter.SHOW_ELEMENT,ki,!1),S=[];for(h.shadowRoot&&(S.push(h),S=S.concat(Sr({context:h.shadowRoot})));g.nextNode();)S.push(g.currentNode),S=S.concat(Sr({context:g.currentNode.shadowRoot}));return S}function su(a){return Mr(a,!0)}function jo(a){return Mr(a,!1)}function Wo(a){us({element:a,attribute:"aria-hidden",temporaryValue:"true"})}function ru(a){us({element:a,attribute:"aria-hidden"})}function iu(a,d){var h=a.indexOf(d);if(h>0){var f=a.splice(h,1);return f.concat(a)}return a}function Uo(a,d){return Li.tabsequenceAreaAtImgPosition&&(a=dp(a,d)),a=pp(a)}function nu(a){var d=a?null:!1;return{altKey:d,ctrlKey:d,metaKey:d,shiftKey:d}}function ou(a){var d=a.indexOf("*")!==-1,h=nu(d);return a.forEach(function(f){if(f!=="*"){var g=!0,S=f.slice(0,1);S==="?"?g=null:S==="!"&&(g=!1),g!==!0&&(f=f.slice(1));var D=Bi[f];if(!D)throw new TypeError('Unknown modifier "'+f+'"');h[D]=g}}),h}function au(a){var d=jt[a]||parseInt(a,10);if(!d||typeof d!="number"||isNaN(d))throw new TypeError('Unknown key "'+a+'"');return[d].concat(jt._alias[d]||[])}function lu(a,d){return!fp.some(function(h){return typeof a[h]=="boolean"&&Boolean(d[h])!==a[h]})}function qo(){ts=0,gs=0}function Go(a){a.isPrimary!==!1&&ts++}function Ho(a){return a.isPrimary!==!1?a.touches?void(ts=a.touches.length):void(window.setImmediate||window.setTimeout)(function(){ts=Math.max(ts-1,0)}):void 0}function Vo(a){switch(a.keyCode||a.which){case 16:case 17:case 18:case 91:case 93:return}gs++}function zo(a){switch(a.keyCode||a.which){case 16:case 17:case 18:case 91:case 93:return}(window.setImmediate||window.setTimeout)(function(){gs=Math.max(gs-1,0)})}function cu(){return{pointer:Boolean(ts),key:Boolean(gs)}}function du(){ts=gs=0,window.removeEventListener("blur",qo,!1),document.documentElement.removeEventListener("keydown",Vo,!0),document.documentElement.removeEventListener("keyup",zo,!0),Ma.forEach(function(a){document.documentElement.removeEventListener(a,Go,!0)}),Ta.forEach(function(a){document.documentElement.removeEventListener(a,Ho,!0)})}function uu(){return window.addEventListener("blur",qo,!1),document.documentElement.addEventListener("keydown",Vo,!0),document.documentElement.addEventListener("keyup",zo,!0),Ma.forEach(function(a){document.documentElement.addEventListener(a,Go,!0)}),Ta.forEach(function(a){document.documentElement.addEventListener(a,Ho,!0)}),{get:cu}}function hu(a){return a.hasAttribute("autofocus")}function pu(a){return a.tabIndex<=0}function mu(a){var d=a.getAttribute&&a.getAttribute("class")||"";return d===""?[]:d.split(" ")}function Ko(a,d,h){var f=mu(a),g=f.indexOf(d),S=g!==-1,D=h!==void 0?h:!S;D!==S&&(D||f.splice(g,1),D&&f.push(d),a.setAttribute("class",f.join(" ")))}function fi(a,d){return Ko(a,d,!1)}function Xo(a,d){return Ko(a,d,!0)}function Ft(a){var d="";if(a.type===Ni||a.type==="shadow-focus"){var h=$i.get();d=kr||h.pointer&&"pointer"||h.key&&"key"||"script"}else a.type==="initial"&&(d="initial");document.documentElement.setAttribute("data-focus-source",d),a.type!==Pr&&(Vs[d]||Xo(document.documentElement,"focus-source-"+d),Vs[d]=!0,Wi=d)}function fu(){return Wi}function gu(a){return Vs[a]}function vu(a){kr=a}function bu(){kr=!1}function yu(){Ft({type:Pr}),Wi=kr=null,Object.keys(Vs).forEach(function(a){fi(document.documentElement,"focus-source-"+a),Vs[a]=!1}),$i.disengage(),ji&&ji.disengage(),document.removeEventListener("shadow-focus",Ft,!0),document.documentElement.removeEventListener(Ni,Ft,!0),document.documentElement.removeEventListener(Pr,Ft,!0),document.documentElement.removeAttribute("data-focus-source")}function Su(){return ji=Mi(),document.addEventListener("shadow-focus",Ft,!0),document.documentElement.addEventListener(Ni,Ft,!0),document.documentElement.addEventListener(Pr,Ft,!0),$i=Ra(),Ft({type:"initial"}),{used:gu,current:fu,lock:vu,unlock:bu}}function wr(a){var d=a||Ei();Ui.cssShadowPiercingDeepCombinator||(d=d.slice(-1));var h=[].slice.call(document.querySelectorAll(qi),0),f=d.map(function(g){return bt({context:g})}).reduce(function(g,S){return S.concat(g)},[]);h.forEach(function(g){f.indexOf(g)===-1&&fi(g,Lr)}),f.forEach(function(g){h.indexOf(g)===-1&&Xo(g,Lr)})}function Jo(){Gi=(window.setImmediate||window.setTimeout)(function(){wr()})}function Zo(){(window.clearImmediate||window.clearTimeout)(Gi),wr()}function Qo(a){wr(a.detail.elements)}function wu(){Hi&&Hi.disengage(),(window.clearImmediate||window.clearTimeout)(Gi),document.removeEventListener(La,Jo,!0),document.removeEventListener(ka,Zo,!0),document.removeEventListener("shadow-focus",Qo,!0),[].forEach.call(document.querySelectorAll(qi),function(a){fi(a,Lr)})}function xu(){Ui||(Ui=at(),qi=xi("."+Lr)),Hi=Mi(),document.addEventListener(La,Jo,!0),document.addEventListener(ka,Zo,!0),document.addEventListener("shadow-focus",Qo,!0),wr()}function gi(a,d){var h=Math.max(a.top,d.top),f=Math.max(a.left,d.left),g=Math.max(Math.min(a.right,d.right),f),S=Math.max(Math.min(a.bottom,d.bottom),h);return{top:h,right:g,bottom:S,left:f,width:g-f,height:S-h}}function Cu(){var a=window.innerWidth||document.documentElement.clientWidth,d=window.innerHeight||document.documentElement.clientHeight;return{top:0,right:a,bottom:d,left:0,width:a,height:d}}function Yo(a){var d=a.getBoundingClientRect(),h=a.offsetWidth-a.clientWidth,f=a.offsetHeight-a.clientHeight,g={top:d.top,left:d.left,right:d.right-h,bottom:d.bottom-f,width:d.width-h,height:d.height-f,area:0};return g.area=g.width*g.height,g}function Iu(a){var d=window.getComputedStyle(a,null),h="visible";return d.getPropertyValue("overflow-x")!==h&&d.getPropertyValue("overflow-y")!==h}function Eu(a){return Iu(a)?a.offsetHeight<a.scrollHeight||a.offsetWidth<a.scrollWidth:!1}function _u(a){var d=bt({context:a}).slice(1).filter(Eu);return d.length?d.reduce(function(h,f){var g=Yo(f),S=gi(g,h);return S.area=Math.min(g.area,h.area),S},Yo(d[0])):null}var Ls=function(){function a(d,h){for(var f=0;f<h.length;f++){var g=h[f];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(d,g.key,g)}}return function(d,h,f){return h&&a(d.prototype,h),f&&a(d,f),d}}(),ea=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Du=r(e("platform")),ta=r(e("css.escape")),Ne=function(a){if(!a)return[];if(Array.isArray(a))return a;if(a.nodeType!==void 0)return[a];if(typeof a=="string"&&(a=document.querySelectorAll(a)),a.length!==void 0)return[].slice.call(a,0);throw new TypeError("unexpected input "+String(a))},ve=function(a){var d=a.context,h=a.label,f=h===void 0?"context-to-element":h,g=a.resolveDocument,S=a.defaultToDocument,D=Ne(d)[0];if(g&&D&&D.nodeType===Node.DOCUMENT_NODE&&(D=D.documentElement),!D&&S)return document.documentElement;if(!D)throw new TypeError(f+" requires valid options.context");if(D.nodeType!==Node.ELEMENT_NODE&&D.nodeType!==Node.DOCUMENT_FRAGMENT_NODE)throw new TypeError(f+" requires options.context to be an Element");return D},cs=function(){for(var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=ve({label:"get/shadow-host",context:d}),f=null;h;)f=h,h=h.parentNode;return f.nodeType===f.DOCUMENT_FRAGMENT_NODE&&f.host?f.host:null},pt=function(a){return a?a.nodeType===Node.DOCUMENT_NODE?a:a.ownerDocument||document:document},Bt=function(a){var d=ve({label:"is/active-element",resolveDocument:!0,context:a}),h=pt(d);if(h.activeElement===d)return!0;var f=cs({context:d});return!!(f&&f.shadowRoot.activeElement===d)},vi=function(a){var d=pt(a);return d.defaultView||window},Mu=function(a){var d=ve({label:"element/blur",context:a});if(!Bt(d))return null;var h=d.nodeName.toLowerCase();if(h==="body")return null;if(d.blur)return d.blur(),document.activeElement;var f=vi(d);try{f.HTMLElement.prototype.blur.call(d)}catch(D){var g=f.document&&f.document.body;if(!g)return null;var S=g.getAttribute("tabindex");g.setAttribute("tabindex","-1"),g.focus(),S?g.setAttribute("tabindex",S):g.removeAttribute("tabindex")}return f.document.activeElement},j=JSON.parse(JSON.stringify(Du)),xr=j.os.family||"",Tu=xr==="Android",Ru=xr.slice(0,7)==="Windows",Au=xr==="OS X",Pu=xr==="iOS",ku=j.layout==="Blink",Lu=j.layout==="Gecko",Cr=j.layout==="Trident",Ou=j.layout==="EdgeHTML",Fu=j.layout==="WebKit",Bu=parseFloat(j.version),Ir=Math.floor(Bu);j.majorVersion=Ir,j.is={ANDROID:Tu,WINDOWS:Ru,OSX:Au,IOS:Pu,BLINK:ku,GECKO:Lu,TRIDENT:Cr,EDGE:Ou,WEBKIT:Fu,IE9:Cr&&Ir===9,IE10:Cr&&Ir===10,IE11:Cr&&Ir===11};var Nu=function(a){var d=i(),h={};return Object.keys(a).map(function(f){h[f]=o(d,a[f])}),l(d),h},bi="1.4.1",sa=typeof window!="undefined"&&window.navigator.userAgent||"",ra="ally-supports-cache",Dt=c(ra);(Dt.userAgent!==sa||Dt.version!==bi)&&(Dt={}),Dt.userAgent=sa,Dt.version=bi;var yi={get:function(){return Dt},set:function(a){Object.keys(a).forEach(function(d){Dt[d]=a[d]}),Dt.time=new Date().toISOString(),u(ra,Dt)}},ia=function(){var a=void 0;try{document.querySelector("html >>> :first-child"),a=">>>"}catch(d){try{document.querySelector("html /deep/ :first-child"),a="/deep/"}catch(h){a=""}}return a},Nt="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",$u={element:"div",mutate:function(a){return a.innerHTML='<map name="image-map-tabindex-test"><area shape="rect" coords="63,19,144,45"></map><img usemap="#image-map-tabindex-test" tabindex="-1" alt="" src="'+Nt+'">',a.querySelector("area")}},ju={element:"div",mutate:function(a){return a.innerHTML='<map name="image-map-tabindex-test"><area href="#void" tabindex="-1" shape="rect" coords="63,19,144,45"></map><img usemap="#image-map-tabindex-test" alt="" src="'+Nt+'">',!1},validate:function(a,d,h){if(j.is.GECKO)return!0;var f=a.querySelector("area");return f.focus(),h.activeElement===f}},Wu={element:"div",mutate:function(a){return a.innerHTML='<map name="image-map-area-href-test"><area shape="rect" coords="63,19,144,45"></map><img usemap="#image-map-area-href-test" alt="" src="'+Nt+'">',a.querySelector("area")},validate:function(a,d,h){return j.is.GECKO?!0:h.activeElement===d}},Uu={name:"can-focus-audio-without-controls",element:"audio",mutate:function(a){try{a.setAttribute("src",Nt)}catch(d){}}},qu="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ",Gu={element:"div",mutate:function(a){return a.innerHTML='<map name="broken-image-map-test"><area href="#void" shape="rect" coords="63,19,144,45"></map><img usemap="#broken-image-map-test" alt="" src="'+qu+'">',a.querySelector("area")}},Hu={element:"div",mutate:function(a){return a.setAttribute("tabindex","-1"),a.setAttribute("style","display: -webkit-flex; display: -ms-flexbox; display: flex;"),a.innerHTML='<span style="display: block;">hello</span>',a.querySelector("span")}},Vu={element:"fieldset",mutate:function(a){a.setAttribute("tabindex",0),a.setAttribute("disabled","disabled")}},zu={element:"fieldset",mutate:function(a){a.innerHTML="<legend>legend</legend><p>content</p>"}},Ku={element:"span",mutate:function(a){a.setAttribute("style","display: -webkit-flex; display: -ms-flexbox; display: flex;"),a.innerHTML='<span style="display: block;">hello</span>'}},Xu={element:"form",mutate:function(a){a.setAttribute("tabindex",0),a.setAttribute("disabled","disabled")}},Ju={element:"a",mutate:function(a){return a.href="#void",a.innerHTML='<img ismap src="'+Nt+'" alt="">',a.querySelector("img")}},Zu={element:"div",mutate:function(a){return a.innerHTML='<map name="image-map-tabindex-test"><area href="#void" shape="rect" coords="63,19,144,45"></map><img usemap="#image-map-tabindex-test" tabindex="-1" alt="" src="'+Nt+'">',a.querySelector("img")}},Qu={element:function(a,d){var h=d.createElement("iframe");a.appendChild(h);var f=h.contentWindow.document;return f.open(),f.close(),h},mutate:function(a){a.style.visibility="hidden";var d=a.contentWindow.document,h=d.createElement("input");return d.body.appendChild(h),h},validate:function(a){var d=a.contentWindow.document,h=d.querySelector("input");return d.activeElement===h}},Yu=!j.is.WEBKIT,eh=function(){return Yu},th={element:"div",mutate:function(a){a.setAttribute("tabindex","invalid-value")}},sh={element:"label",mutate:function(a){a.setAttribute("tabindex","-1")},validate:function(a,d,h){return a.offsetHeight,a.focus(),h.activeElement===a}},na="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBpZD0ic3ZnIj48dGV4dCB4PSIxMCIgeT0iMjAiIGlkPSJzdmctbGluay10ZXh0Ij50ZXh0PC90ZXh0Pjwvc3ZnPg==",rh={element:"object",mutate:function(a){a.setAttribute("type","image/svg+xml"),a.setAttribute("data",na),a.setAttribute("width","200"),a.setAttribute("height","50"),a.style.visibility="hidden"}},ih={name:"can-focus-object-svg",element:"object",mutate:function(a){a.setAttribute("type","image/svg+xml"),a.setAttribute("data",na),a.setAttribute("width","200"),a.setAttribute("height","50")},validate:function(a,d,h){return j.is.GECKO?!0:h.activeElement===a}},nh=!j.is.IE9,oh=function(){return nh},ah={element:"div",mutate:function(a){return a.innerHTML='<map name="focus-redirect-img-usemap"><area href="#void" shape="rect" coords="63,19,144,45"></map><img usemap="#focus-redirect-img-usemap" alt="" src="'+Nt+'">',a.querySelector("img")},validate:function(a,d,h){var f=a.querySelector("area");return h.activeElement===f}},lh={element:"fieldset",mutate:function(a){return a.innerHTML='<legend>legend</legend><input tabindex="-1"><input tabindex="0">',!1},validate:function(a,d,h){var f=a.querySelector('input[tabindex="-1"]'),g=a.querySelector('input[tabindex="0"]');return a.focus(),a.querySelector("legend").focus(),h.activeElement===f&&"focusable"||h.activeElement===g&&"tabbable"||""}},ch={element:"div",mutate:function(a){return a.setAttribute("style","width: 100px; height: 50px; overflow: auto;"),a.innerHTML='<div style="width: 500px; height: 40px;">scrollable content</div>',a.querySelector("div")}},dh={element:"div",mutate:function(a){a.setAttribute("style","width: 100px; height: 50px;"),a.innerHTML='<div style="width: 500px; height: 40px;">scrollable content</div>'}},uh={element:"div",mutate:function(a){a.setAttribute("style","width: 100px; height: 50px; overflow: auto;"),a.innerHTML='<div style="width: 500px; height: 40px;">scrollable content</div>'}},hh={element:"details",mutate:function(a){return a.innerHTML="<summary>foo</summary><p>content</p>",a.firstElementChild}},oa=function(a){var d=a.ownerSVGElement||a.nodeName.toLowerCase()==="svg";if(!d)return!1;var h=p();a.appendChild(h);var f=h.querySelector("input");return f.focus(),f.disabled=!0,a.removeChild(h),!0},ph={element:"div",mutate:function(a){return a.innerHTML=m('<text focusable="true">a</text>'),a.querySelector("text")},validate:b},mh={element:"div",mutate:function(a){return a.innerHTML=m('<text tabindex="0">a</text>'),a.querySelector("text")},validate:b},fh={element:"div",mutate:function(a){return a.innerHTML=m('<text tabindex="-1">a</text>'),a.querySelector("text")},validate:b},gh={element:"div",mutate:function(a){return a.innerHTML=m(['<g id="ally-test-target"><a xlink:href="#void"><text>link</text></a></g>','<use xlink:href="#ally-test-target" x="0" y="0" tabindex="-1" />'].join("")),a.querySelector("use")},validate:b},vh={element:"div",mutate:function(a){return a.innerHTML=m('<foreignObject tabindex="-1"><input type="text" /></foreignObject>'),a.querySelector("foreignObject")||a.getElementsByTagName("foreignObject")[0]},validate:b},bh=Boolean(j.is.GECKO&&typeof SVGElement!="undefined"&&SVGElement.prototype.focus),yh=function(){return bh},Sh={element:"div",mutate:function(a){return a.innerHTML=m(""),a.firstChild},validate:b},wh={element:"div",mutate:function(a){a.setAttribute("tabindex","3x")}},xh={element:"table",mutate:function(a,d,h){var f=h.createDocumentFragment();f.innerHTML="<tr><td>cell</td></tr>",a.appendChild(f)}},Ch={element:"video",mutate:function(a){try{a.setAttribute("src",Nt)}catch(d){}}},Ih=j.is.GECKO||j.is.TRIDENT||j.is.EDGE,Eh=function(){return Ih},aa={cssShadowPiercingDeepCombinator:ia,focusInZeroDimensionObject:eh,focusObjectSwf:oh,focusSvgInIframe:yh,tabsequenceAreaAtImgPosition:Eh},_h={focusAreaImgTabindex:$u,focusAreaTabindex:ju,focusAreaWithoutHref:Wu,focusAudioWithoutControls:Uu,focusBrokenImageMap:Gu,focusChildrenOfFocusableFlexbox:Hu,focusFieldsetDisabled:Vu,focusFieldset:zu,focusFlexboxContainer:Ku,focusFormDisabled:Xu,focusImgIsmap:Ju,focusImgUsemapTabindex:Zu,focusInHiddenIframe:Qu,focusInvalidTabindex:th,focusLabelTabindex:sh,focusObjectSvg:ih,focusObjectSvgHidden:rh,focusRedirectImgUsemap:ah,focusRedirectLegend:lh,focusScrollBody:ch,focusScrollContainerWithoutOverflow:dh,focusScrollContainer:uh,focusSummary:hh,focusSvgFocusableAttribute:ph,focusSvgTabindexAttribute:mh,focusSvgNegativeTabindexAttribute:fh,focusSvgUseTabindex:gh,focusSvgForeignobjectTabindex:vh,focusSvg:Sh,focusTabindexTrailingCharacters:wh,focusTable:xh,focusVideoWithoutControls:Ch},ds=null,at=function(){return ds||(ds=yi.get(),ds.time||(yi.set(y()),ds=yi.get()),ds)},Os=void 0,Dh=/^\s*(-|\+)?[0-9]+\s*$/,Mh=/^\s*(-|\+)?[0-9]+.*$/,Er=function(a){Os||(Os=at());var d=Os.focusTabindexTrailingCharacters?Mh:Dh,h=ve({label:"is/valid-tabindex",resolveDocument:!0,context:a}),f=h.hasAttribute("tabindex"),g=h.hasAttribute("tabIndex");if(!f&&!g)return!1;var S=h.ownerSVGElement||h.nodeName.toLowerCase()==="svg";if(S&&!Os.focusSvgTabindexAttribute)return!1;if(Os.focusInvalidTabindex)return!0;var D=h.getAttribute(f?"tabindex":"tabIndex");return D==="-32768"?!1:Boolean(D&&d.test(D))},vt=function(a){if(!Er(a))return null;var d=a.hasAttribute("tabindex"),h=d?"tabindex":"tabIndex",f=parseInt(a.getAttribute(h),10);return isNaN(f)?-1:f},_r=void 0,la=void 0,Si={input:!0,select:!0,textarea:!0,button:!0,fieldset:!0,form:!0},ca=function(a){_r||(_r=at(),_r.focusFieldsetDisabled&&delete Si.fieldset,_r.focusFormDisabled&&delete Si.form,la=new RegExp("^("+Object.keys(Si).join("|")+")$"));var d=ve({label:"is/native-disabled-supported",context:a}),h=d.nodeName.toLowerCase();return Boolean(la.test(h))},da=function(a){var d=a.element,h=a.attribute,f="data-cached-"+h,g=d.getAttribute(f);if(g===null){var S=d.getAttribute(h);if(S===null)return;d.setAttribute(f,S||""),d.removeAttribute(h)}else{var D=d.getAttribute(f);d.removeAttribute(f),d.setAttribute(h,D)}},us=function(a){var d=a.element,h=a.attribute,f=a.temporaryValue,g=a.saveValue,S="data-cached-"+h;if(f!==void 0){var D=g||d.getAttribute(h);d.setAttribute(S,D||""),d.setAttribute(h,f)}else{var N=d.getAttribute(S);d.removeAttribute(S),N===""?d.removeAttribute(h):d.setAttribute(h,N)}},Fs=function(){},Th={log:Fs,debug:Fs,info:Fs,warn:Fs,error:Fs},Rh=typeof console!="undefined"?console:Th,Dr=void 0,Mr=function(a,d){Dr||(Dr=at());var h=ve({label:"element/disabled",context:a});d=Boolean(d);var f=h.hasAttribute("data-ally-disabled"),g=arguments.length===1;return ca(h)?g?h.disabled:(h.disabled=d,h):g?f:(f===d||ce(h,d),h)},bt=function(){for(var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=[],f=ve({label:"get/parents",context:d});f;)h.push(f),f=f.parentNode,f&&f.nodeType!==Node.ELEMENT_NODE&&(f=null);return h},Ah=["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector"],wi=null,me=void 0;oe.except=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=function(h){return oe({context:h,except:a})};return d.rules=oe,d};var Bs=oe.except({}),Ph=function(a){try{return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.getSVGDocument&&a.getSVGDocument()||null}catch(d){return null}},Ns=void 0,xi=function(a){if(typeof Ns!="string"){var d=ia();d&&(Ns=", html "+d+" ")}return Ns?a+Ns+a.replace(/\s*,\s*/g,",").split(",").join(Ns):a},Ci=void 0,kh=/^(area)$/;Ee.except=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=function(h){return Ee({context:h,except:a})};return d.rules=Ee,d};var hs=Ee.except({}),Yt=void 0,ua=function(a){Yt||(Yt=at());var d=ve({label:"is/valid-area",context:a}),h=d.nodeName.toLowerCase();if(h!=="area")return!1;var f=d.hasAttribute("tabindex");if(!Yt.focusAreaTabindex&&f)return!1;var g=C(d);if(!g||!hs(g)||!Yt.focusBrokenImageMap&&(!g.complete||!g.naturalHeight||g.offsetWidth<=0||g.offsetHeight<=0))return!1;if(!Yt.focusAreaWithoutHref&&!d.href)return Yt.focusAreaTabindex&&f||Yt.focusAreaImgTabindex&&g.hasAttribute("tabindex");var S=bt({context:g}).slice(1).some(function(D){var N=D.nodeName.toLowerCase();return N==="button"||N==="a"});return!S},Ii=void 0,ha=function(a){Ii||(Ii=at());var d=ve({label:"is/disabled",context:a});if(d.hasAttribute("data-ally-disabled"))return!0;if(!ca(d))return!1;if(d.disabled)return!0;var h=bt({context:d});return h.some(He)?!0:!!(!Ii.focusFormDisabled&&h.some(x))};ut.except=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=function(h){return ut({context:h,except:a})};return d.rules=ut,d};var pa=ut.except({}),Mt=void 0;ht.except=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=function(h){return ht({context:h,except:a})};return d.rules=ht,d};var $t=ht.except({}),Lh=Qe(Bs),es=void 0,$s=void 0,Oh=function(){return es||(es=at()),typeof $s=="string"?$s:($s=""+(es.focusTable?"table, td,":"")+(es.focusFieldset?"fieldset,":"")+"svg a,a[href],area[href],input, select, textarea, button,iframe, object, embed,keygen,"+(es.focusAudioWithoutControls?"audio,":"audio[controls],")+(es.focusVideoWithoutControls?"video,":"video[controls],")+(es.focusSummary?"summary,":"")+"[tabindex],[contenteditable]",$s=xi($s))},js=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.includeContext,f=a.includeOnlyTabbable,g=a.strategy,S=g===void 0?"quick":g,D=ve({label:"query/focusable",resolveDocument:!0,defaultToDocument:!0,context:d}),N={context:D,includeContext:h,includeOnlyTabbable:f,strategy:S};if(S==="quick")return Qt(N);if(S==="strict"||S==="all")return U(N);throw new TypeError('query/focusable requires option.strategy to be one of ["quick", "strict", "all"]')},ps=void 0,Fh=/^(fieldset|table|td|body)$/;J.except=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=function(h){return J({context:h,except:a})};return d.rules=J,d};var Bh=Bs.rules.except({flexbox:!0}),Nh=J.except({flexbox:!0}),ma=J.except({}),Ws=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.includeContext,f=a.includeOnlyTabbable,g=a.strategy,S=ma.rules.except({onlyTabbable:f});return js({context:d,includeContext:h,includeOnlyTabbable:f,strategy:g}).filter(S)},$h=function(a){return a.sort(k)},Us=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.list,h=a.elements,f=a.resolveElement,g=d.slice(0),S=Ne(h).slice(0);$h(S);var D=xe(g,S,f);return B(g,D),g},qs=void 0,fa=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.skipFocusable;qs||(qs=at());var f=ve({label:"get/focus-redirect-target",context:d});if(!h&&$t(f))return null;var g=f.nodeName.toLowerCase(),S=pt(f);return g==="label"?Lt(f,S):g==="legend"?_t(f,S):g==="img"?Ye(f,S):null},ms=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.except,f=ve({label:"get/focus-target",context:d}),g=null,S=function(D){var N=$t.rules({context:D,except:h});return N?(g=D,!0):(g=fa({context:D,skipFocusable:!0}),Boolean(g))};return S(f)||bt({context:f}).slice(1).some(S),g},ga={flexbox:!0,scrollable:!0,onlyTabbable:!0},jh=function(a){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=d.defaultToAncestor,f=d.undoScrolling,g=ve({label:"element/focus",context:a}),S=$t.rules({context:g,except:ga});if(!h&&!S)return null;var D=ms({context:g,except:ga});if(!D)return null;if(Bt(D))return D;var N=void 0;f&&(N=V(D));var $=z(D);return N&&N(),$},Wh={blur:Mu,disabled:Mr,focus:jh};typeof window!="undefined"&&function(){for(var a=0,d=["ms","moz","webkit","o"],h="",f="",g=0,S=d.length;S>g;++g)h=window[d[g]+"RequestAnimationFrame"],f=window[d[g]+"CancelAnimationFrame"]||window[d[g]+"CancelRequestAnimationFrame"];typeof window.requestAnimationFrame!="function"&&(window.requestAnimationFrame=window[h]||function(D){var N=new Date().getTime(),$=Math.max(0,16-(N-a)),X=window.setTimeout(function(){D(N+$)},$);return a=N+$,X}),typeof window.cancelAnimationFrame!="function"&&(window.cancelAnimationFrame=window[f]||function(D){clearTimeout(D)})}();var Tr=typeof window!="undefined"&&window.CustomEvent||function(){};typeof Tr!="function"&&(Tr=function(a,d){var h=document.createEvent("CustomEvent");return!d&&(d={bubbles:!1,cancelable:!1,detail:void 0}),h.initCustomEvent(a,d.bubbles,d.cancelable,d.detail),h},Tr.prototype=window.Event.prototype);var Uh=Tr,Gs=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.engage,h=a.disengage,f={engage:d||K,disengage:h||K,instances:0,_result:null};return q.bind(f)},Rr=void 0,Hs=void 0,qh=Gs({engage:Ae,disengage:Pe}),va=function(a){var d=ve({label:"is/shadowed",resolveDocument:!0,context:a});return Boolean(cs({context:d}))},ba=function(){for(var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=[],f=ve({label:"get/shadow-host-parents",context:d});f&&(f=cs({context:f}));)h.push(f);return h},Ei=function(){return document.activeElement===null&&document.body.focus(),va(document.activeElement)?se():pe()},_i=void 0,Di=void 0;typeof document!="undefined"&&document.documentElement.createShadowRoot?function(){var a=void 0,d=void 0,h=function(){g(),(window.clearImmediate||window.clearTimeout)(a),a=(window.setImmediate||window.setTimeout)(function(){S()})},f=function(N){N.addEventListener("blur",h,!0),d=N},g=function(){d&&d.removeEventListener("blur",h,!0),d=null},S=function(){var N=Ei();if(N.length===1)return void g();f(N[0]);var $=new CustomEvent("shadow-focus",{bubbles:!1,cancelable:!1,detail:{elements:N,active:N[0],hosts:N.slice(1)}});document.dispatchEvent($)},D=function(){(window.clearImmediate||window.clearTimeout)(a),S()};_i=function(){document.addEventListener("focus",D,!0)},Di=function(){(window.clearImmediate||window.clearTimeout)(a),d&&d.removeEventListener("blur",h,!0),document.removeEventListener("focus",D,!0)}}():_i=Di=function(){};var Mi=Gs({engage:_i,disengage:Di}),Gh={activeElement:qh,shadowFocus:Mi},Ti=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.engage,h=a.disengage,f={engage:d||$o,disengage:h||$o,context:null};return eu.bind(f)},Ri=void 0,ya=void 0,Hh=j.is.TRIDENT&&(j.is.IE10||j.is.IE11);Hh?function(){var a=function(d){var h=ms({context:d.target,except:{flexbox:!0,scrollable:!0}});if(h&&h!==d.target){window.setImmediate(function(){h.focus()});var f=[].map.call(h.children,function(g){var S=g.style.visibility||"",D=g.style.transition||"";return g.style.visibility="hidden",g.style.transition="none",[g,S,D]});window.setImmediate(function(){f.forEach(function(g){g[0].style.visibility=g[1],g[0].style.transition=g[2]})})}};Ri=function(d){d.addEventListener("mousedown",a,!0)},ya=function(d){d.removeEventListener("mousedown",a,!0)}}():Ri=function(){};var Vh=Ti({engage:Ri,disengage:ya}),Ai=void 0,Sa=void 0,zh=j.is.OSX&&(j.is.GECKO||j.is.WEBKIT);zh?function(){var a=function(h){if(!h.defaultPrevented&&O(h.target,"input, button, button *")){var f=ms({context:h.target});(window.setImmediate||window.setTimeout)(function(){f.focus()})}},d=function(h){if(!h.defaultPrevented&&O(h.target,"label, label *")){var f=ms({context:h.target});f&&f.focus()}};Ai=function(h){h.addEventListener("mousedown",a,!1),h.addEventListener("mouseup",d,!1)},Sa=function(h){h.removeEventListener("mousedown",a,!1),h.removeEventListener("mouseup",d,!1)}}():Ai=function(){};var Kh=Ti({engage:Ai,disengage:Sa}),Pi=void 0,wa=void 0,Xh=j.is.WEBKIT;Xh?function(){var a=function(d){var h=ms({context:d.target});!h||h.hasAttribute("tabindex")&&Er(h)||(h.setAttribute("tabindex",0),(window.setImmediate||window.setTimeout)(function(){h.removeAttribute("tabindex")},0))};Pi=function(d){d.addEventListener("mousedown",a,!0),d.addEventListener("touchstart",a,!0)},wa=function(d){d.removeEventListener("mousedown",a,!0),d.removeEventListener("touchstart",a,!0)}}():Pi=function(){};var Jh=Ti({engage:Pi,disengage:wa}),Zh={pointerFocusChildren:Vh,pointerFocusInput:Kh,pointerFocusParent:Jh},Qh=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=pt(d),f=void 0;try{f=h.activeElement}catch(g){}return f&&f.nodeType||(f=h.body||h.documentElement),f},xa=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.filter;if(d=ve({label:"get/insignificant-branches",defaultToDocument:!0,context:d}),h=Ne(h),!h.length)throw new TypeError("get/insignificant-branches requires valid options.filter");return tu({context:d,filter:h})},Yh={activeElement:Qh,activeElements:Ei,focusRedirectTarget:fa,focusTarget:ms,insignificantBranches:xa,parents:bt,shadowHostParents:ba,shadowHost:cs},ep={activeElement:Bt,disabled:ha,focusRelevant:Bs,focusable:$t,onlyTabbable:pa,shadowed:va,tabbable:ma,validArea:ua,validTabindex:Er,visible:hs},ki=function(a){return a.shadowRoot?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP};ki.acceptNode=ki;for(var tp={childList:!0,subtree:!0},sp=function(){function a(){var d=this,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=h.context,g=h.callback,S=h.config;s(this,a),this.config=S,this.disengage=this.disengage.bind(this),this.clientObserver=new MutationObserver(g),this.hostObserver=new MutationObserver(function(D){return D.forEach(d.handleHostMutation,d)}),this.observeContext(f),this.observeShadowHosts(f)}return Ls(a,[{key:"disengage",value:function(){this.clientObserver&&this.clientObserver.disconnect(),this.clientObserver=null,this.hostObserver&&this.hostObserver.disconnect(),this.hostObserver=null}},{key:"observeShadowHosts",value:function(d){var h=this,f=Sr({context:d});f.forEach(function(g){return h.observeContext(g.shadowRoot)})}},{key:"observeContext",value:function(d){this.clientObserver.observe(d,this.config),this.hostObserver.observe(d,tp)}},{key:"handleHostMutation",value:function(d){if(d.type==="childList"){var h=Ne(d.addedNodes).filter(function(f){return f.nodeType===Node.ELEMENT_NODE});h.forEach(this.observeShadowHosts,this)}}}]),a}(),Ca=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.callback,f=a.config;if(typeof h!="function")throw new TypeError("observe/shadow-mutations requires options.callback to be a function");if((typeof f=="undefined"?"undefined":ea(f))!=="object")throw new TypeError("observe/shadow-mutations requires options.config to be an object");if(!window.MutationObserver)return{disengage:function(){}};var g=ve({label:"observe/shadow-mutations",resolveDocument:!0,defaultToDocument:!0,context:d}),S=new sp({context:g,callback:h,config:f});return{disengage:S.disengage}},rp={attributes:!0,childList:!0,subtree:!0,attributeFilter:["tabindex","disabled","data-ally-disabled"]},ip=function(){function a(){var d=this,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=h.context,g=h.filter;s(this,a),this._context=Ne(f||document.documentElement)[0],this._filter=Ne(g),this._inertElementCache=[],this.disengage=this.disengage.bind(this),this.handleMutation=this.handleMutation.bind(this),this.renderInert=this.renderInert.bind(this),this.filterElements=this.filterElements.bind(this),this.filterParentElements=this.filterParentElements.bind(this);var S=js({context:this._context,includeContext:!0,strategy:"all"});this.renderInert(S),this.shadowObserver=Ca({context:this._context,config:rp,callback:function(D){return D.forEach(d.handleMutation)}})}return Ls(a,[{key:"disengage",value:function(){this._context&&(jo(this._context),this._inertElementCache.forEach(function(d){return jo(d)}),this._inertElementCache=null,this._filter=null,this._context=null,this.shadowObserver&&this.shadowObserver.disengage(),this.shadowObserver=null)}},{key:"listQueryFocusable",value:function(d){return d.map(function(h){return js({context:h,includeContext:!0,strategy:"all"})}).reduce(function(h,f){return h.concat(f)},[])}},{key:"renderInert",value:function(d){var h=this,f=function(g){h._inertElementCache.push(g),su(g)};d.filter(this.filterElements).filter(this.filterParentElements).filter(function(g){return!Mr(g)}).forEach(f)}},{key:"filterElements",value:function(d){var h=ks({element:d,includeSelf:!0});return!this._filter.some(h)}},{key:"filterParentElements",value:function(d){var h=ks({parent:d});return!this._filter.some(h)}},{key:"handleMutation",value:function(d){if(d.type==="childList"){var h=Ne(d.addedNodes).filter(function(g){return g.nodeType===Node.ELEMENT_NODE});if(!h.length)return;var f=this.listQueryFocusable(h);this.renderInert(f)}else d.type==="attributes"&&this.renderInert([d.target])}}]),a}(),np=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.filter,f=new ip({context:d,filter:h});return{disengage:f.disengage}},op={attributes:!1,childList:!0,subtree:!0},ap=function(){function a(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=d.context,f=d.filter;s(this,a),this._context=Ne(h||document.documentElement)[0],this._filter=Ne(f),this.disengage=this.disengage.bind(this),this.handleMutation=this.handleMutation.bind(this),this.isInsignificantBranch=this.isInsignificantBranch.bind(this);var g=xa({context:this._context,filter:this._filter});g.forEach(Wo),this.startObserver()}return Ls(a,[{key:"disengage",value:function(){this._context&&([].forEach.call(this._context.querySelectorAll("[data-cached-aria-hidden]"),ru),this._context=null,this._filter=null,this._observer&&this._observer.disconnect(),this._observer=null)}},{key:"startObserver",value:function(){var d=this;window.MutationObserver&&(this._observer=new MutationObserver(function(h){return h.forEach(d.handleMutation)}),this._observer.observe(this._context,op))}},{key:"handleMutation",value:function(d){d.type==="childList"&&Ne(d.addedNodes).filter(function(h){return h.nodeType===Node.ELEMENT_NODE}).filter(this.isInsignificantBranch).forEach(Wo)}},{key:"isInsignificantBranch",value:function(d){var h=bt({context:d});if(h.some(function(g){return g.getAttribute("aria-hidden")==="true"}))return!1;var f=ks({element:d});return!this._filter.some(f)}}]),a}(),lp=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.filter,f=new ap({context:d,filter:h});return{disengage:f.disengage}},cp=function(){function a(d){s(this,a),this._document=pt(d),this.maps={}}return Ls(a,[{key:"getAreasFor",value:function(d){return this.maps[d]||this.addMapByName(d),this.maps[d]}},{key:"addMapByName",value:function(d){var h=Je(d,this._document);h&&(this.maps[h.name]=Ws({context:h}))}},{key:"extractAreasFromList",value:function(d){return d.filter(function(h){var f=h.nodeName.toLowerCase();if(f!=="area")return!0;var g=h.parentNode;return this.maps[g.name]||(this.maps[g.name]=[]),this.maps[g.name].push(h),!1},this)}}]),a}(),dp=function(a,d){var h=d.querySelectorAll("img[usemap]"),f=new cp(d),g=f.extractAreasFromList(a);return h.length?Us({list:g,elements:h,resolveElement:function(S){var D=S.getAttribute("usemap").slice(1);return f.getAreasFor(D)}}):g},up=function(){function a(d,h){s(this,a),this.context=d,this.sortElements=h,this.hostCounter=1,this.inHost={},this.inDocument=[],this.hosts={},this.elements={}}return Ls(a,[{key:"_registerHost",value:function(d){if(!d._sortingId){d._sortingId="shadow-"+this.hostCounter++,this.hosts[d._sortingId]=d;var h=cs({context:d});h?(this._registerHost(h),this._registerHostParent(d,h)):this.inDocument.push(d)}}},{key:"_registerHostParent",value:function(d,h){this.inHost[h._sortingId]||(this.inHost[h._sortingId]=[]),this.inHost[h._sortingId].push(d)}},{key:"_registerElement",value:function(d,h){this.elements[h._sortingId]||(this.elements[h._sortingId]=[]),this.elements[h._sortingId].push(d)}},{key:"extractElements",value:function(d){return d.filter(function(h){var f=cs({context:h});return f?(this._registerHost(f),this._registerElement(h,f),!1):!0},this)}},{key:"sort",value:function(d){var h=this._injectHosts(d);return h=this._replaceHosts(h),this._cleanup(),h}},{key:"_injectHosts",value:function(d){return Object.keys(this.hosts).forEach(function(h){var f=this.elements[h],g=this.inHost[h],S=this.hosts[h].shadowRoot;this.elements[h]=this._merge(f,g,S)},this),this._merge(d,this.inDocument,this.context)}},{key:"_merge",value:function(d,h,f){var g=Us({list:d,elements:h});return this.sortElements(g,f)}},{key:"_replaceHosts",value:function(d){return Us({list:d,elements:this.inDocument,resolveElement:this._resolveHostElement.bind(this)})}},{key:"_resolveHostElement",value:function(d){var h=Us({list:this.elements[d._sortingId],elements:this.inHost[d._sortingId],resolveElement:this._resolveHostElement.bind(this)}),f=vt(d);return f!==null&&f>-1?[d].concat(h):h}},{key:"_cleanup",value:function(){Object.keys(this.hosts).forEach(function(d){delete this.hosts[d]._sortingId},this)}}]),a}(),hp=function(a,d,h){var f=new up(d,h),g=f.extractElements(a);return g.length===a.length?h(a):f.sort(g)},pp=function(a){var d={},h=[],f=a.filter(function(S){var D=S.tabIndex;return D===void 0&&(D=vt(S)),0>=D||D===null||D===void 0?!0:(d[D]||(d[D]=[],h.push(D)),d[D].push(S),!1)}),g=h.sort().map(function(S){return d[S]}).reduceRight(function(S,D){return D.concat(S)},f);return g},Li=void 0,Oi=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.includeContext,f=a.includeOnlyTabbable,g=a.strategy;Li||(Li=at());var S=Ne(d)[0]||document.documentElement,D=Ws({context:S,includeContext:h,includeOnlyTabbable:f,strategy:g});return D=document.body.createShadowRoot&&j.is.BLINK?hp(D,S,Uo):Uo(D,S),h&&(D=iu(D,S)),D},jt={tab:9,left:37,up:38,right:39,down:40,pageUp:33,"page-up":33,pageDown:34,"page-down":34,end:35,home:36,enter:13,escape:27,space:32,shift:16,capsLock:20,"caps-lock":20,ctrl:17,alt:18,meta:91,pause:19,insert:45,delete:46,backspace:8,_alias:{91:[92,93,224]}},Ar=1;26>Ar;Ar++)jt["f"+Ar]=Ar+111;for(var fs=0;10>fs;fs++){var Ia=fs+48,Ea=fs+96;jt[fs]=Ia,jt["num-"+fs]=Ea,jt._alias[Ia]=[Ea]}for(var Fi=0;26>Fi;Fi++){var _a=Fi+65,mp=String.fromCharCode(_a).toLowerCase();jt[mp]=_a}var Bi={alt:"altKey",ctrl:"ctrlKey",meta:"metaKey",shift:"shiftKey"},fp=Object.keys(Bi).map(function(a){return Bi[a]}),gp=function(a){return a.split(/\s+/).map(function(d){var h=d.split("+"),f=ou(h.slice(0,-1)),g=au(h.slice(-1));return{keyCodes:g,modifiers:f,matchModifiers:lu.bind(null,f)}})},Da=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d={},h=Ne(a.context)[0]||document.documentElement;delete a.context;var f=Ne(a.filter);delete a.filter;var g=Object.keys(a);if(!g.length)throw new TypeError("when/key requires at least one option key");var S=function($){$.keyCodes.forEach(function(X){d[X]||(d[X]=[]),d[X].push($)})};g.forEach(function($){if(typeof a[$]!="function")throw new TypeError('when/key requires option["'+$+'"] to be a function');var X=function(De){return De.callback=a[$],De};gp($).map(X).forEach(S)});var D=function($){if(!$.defaultPrevented){if(f.length){var X=ks({element:$.target,includeSelf:!0});if(f.some(X))return}var De=$.keyCode||$.which;d[De]&&d[De].forEach(function(ke){ke.matchModifiers($)&&ke.callback.call(h,$,N)})}};h.addEventListener("keydown",D,!1);var N=function(){h.removeEventListener("keydown",D,!1)};return{disengage:N}},vp=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context;return d||(d=document.documentElement),Oi(),Da({"?alt+?shift+tab":function(h){h.preventDefault();var f=Oi({context:d}),g=h.shiftKey,S=f[0],D=f[f.length-1],N=g?S:D,$=g?D:S;if(Bt(N))return void $.focus();var X=void 0,De=f.some(function(yt,ss){return Bt(yt)?(X=ss,!0):!1});if(!De)return void S.focus();var ke=g?-1:1;f[X+ke].focus()}})},bp={disabled:np,hidden:lp,tabFocus:vp},yp={"aria-busy":{default:"false",values:["true","false"]},"aria-checked":{default:void 0,values:["true","false","mixed",void 0]},"aria-disabled":{default:"false",values:["true","false"]},"aria-expanded":{default:void 0,values:["true","false",void 0]},"aria-grabbed":{default:void 0,values:["true","false",void 0]},"aria-hidden":{default:"false",values:["true","false"]},"aria-invalid":{default:"false",values:["true","false","grammar","spelling"]},"aria-pressed":{default:void 0,values:["true","false","mixed",void 0]},"aria-selected":{default:void 0,values:["true","false",void 0]},"aria-atomic":{default:"false",values:["true","false"]},"aria-autocomplete":{default:"none",values:["inline","list","both","none"]},"aria-dropeffect":{default:"none",multiple:!0,values:["copy","move","link","execute","popup","none"]},"aria-haspopup":{default:"false",values:["true","false"]},"aria-live":{default:"off",values:["off","polite","assertive"]},"aria-multiline":{default:"false",values:["true","false"]},"aria-multiselectable":{default:"false",values:["true","false"]},"aria-orientation":{default:"horizontal",values:["vertical","horizontal"]},"aria-readonly":{default:"false",values:["true","false"]},"aria-relevant":{default:"additions text",multiple:!0,values:["additions","removals","text","all"]},"aria-required":{default:"false",values:["true","false"]},"aria-sort":{default:"none",other:!0,values:["ascending","descending","none"]}},Sp={attribute:yp,keycode:jt},ts=0,gs=0,Ma=["touchstart","pointerdown","MSPointerDown","mousedown"],Ta=["touchend","touchcancel","pointerup","MSPointerUp","pointercancel","MSPointerCancel","mouseup"],Ra=Gs({engage:uu,disengage:du}),wp={interactionType:Ra,shadowMutations:Ca},xp=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.sequence,f=a.strategy,g=a.ignoreAutofocus,S=a.defaultToContext,D=a.includeOnlyTabbable,N=-1;h||(d=Ne(d||document.body)[0],h=Ws({context:d,includeOnlyTabbable:D,strategy:f})),h.length&&!g&&(N=te(h,hu)),h.length&&N===-1&&(N=te(h,pu));var $=$t.rules.except({onlyTabbable:D});return N===-1&&S&&d&&$(d)?d:h[N]||null},Cp={firstTabbable:xp,focusable:js,shadowHosts:Sr,tabbable:Ws,tabsequence:Oi},Aa=typeof document!="undefined"&&"onfocusin"in document,Ni=Aa?"focusin":"focus",Pr=Aa?"focusout":"blur",$i=void 0,ji=void 0,Wi=null,kr=null,Vs={pointer:!1,key:!1,script:!1,initial:!1},Ip=Gs({engage:Su,disengage:yu}),Ui=void 0,Pa=typeof document!="undefined"&&"onfocusin"in document,ka=Pa?"focusin":"focus",La=Pa?"focusout":"blur",Lr="ally-focus-within",qi=void 0,Gi=void 0,Hi=void 0,Ep=Gs({engage:xu,disengage:wu}),_p={focusSource:Ip,focusWithin:Ep},Dp=function(d){var h=d.getBoundingClientRect(),f=Cu();f.area=f.width*f.height;var g=f,S=_u(d);if(S){if(!S.width||!S.height)return 0;g=gi(S,f),g.area=S.area}var D=gi(h,g);if(!D.width||!D.height)return 0;var N=h.width*h.height,$=Math.min(N,g.area),X=Math.round(D.width)*Math.round(D.height)/$,De=1e4,ke=Math.round(X*De)/De;return Math.min(ke,1)},Oa=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.callback,f=a.area;if(typeof h!="function")throw new TypeError("when/visible-area requires options.callback to be a function");typeof f!="number"&&(f=1);var g=ve({label:"when/visible-area",context:d}),S=void 0,D=null,N=function(){S&&cancelAnimationFrame(S)},$=function(){return!hs(g)||Dp(g)<f||h(g)===!1},X=function(){return $()?void D():void N()};return D=function(){S=requestAnimationFrame(X)},D(),{disengage:N}},Mp=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.context,h=a.callback,f=a.area;if(typeof h!="function")throw new TypeError("when/focusable requires options.callback to be a function");var g=ve({label:"when/focusable",context:d}),S=function(X){return $t(X)?h(X):!1},D=pt(g),N=Oa({context:g,callback:S,area:f}),$=function X(){D.removeEventListener("focus",X,!0),N&&N.disengage()};return D.addEventListener("focus",$,!0),{disengage:$}},Tp={focusable:Mp,key:Da,visibleArea:Oa},Rp=typeof window!="undefined"&&window.ally,Ap={element:Wh,event:Gh,fix:Zh,get:Yh,is:ep,maintain:bp,map:Sp,observe:wp,query:Cp,style:_p,when:Tp,version:bi,noConflict:function(){return typeof window!="undefined"&&window.ally===this&&(window.ally=Rp),this}};t.exports=Ap},{"css.escape":2,platform:3}],2:[function(e,t,s){(function(r){(function(i,o){typeof s=="object"?t.exports=o(i):typeof n=="function"&&n.amd?n([],o.bind(i,i)):o(i)})(typeof r!="undefined"?r:this,function(i){if(i.CSS&&i.CSS.escape)return i.CSS.escape;var o=function(l){if(arguments.length==0)throw new TypeError("`CSS.escape` requires an argument.");for(var c,u=String(l),p=u.length,m=-1,v="",b=u.charCodeAt(0);++m<p;)c=u.charCodeAt(m),v+=c!=0?c>=1&&31>=c||c==127||m==0&&c>=48&&57>=c||m==1&&c>=48&&57>=c&&b==45?"\\"+c.toString(16)+" ":(m!=0||p!=1||c!=45)&&(c>=128||c==45||c==95||c>=48&&57>=c||c>=65&&90>=c||c>=97&&122>=c)?u.charAt(m):"\\"+u.charAt(m):"\uFFFD";return v};return i.CSS||(i.CSS={}),i.CSS.escape=o,o})}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],3:[function(e,t,s){(function(r){(function(){"use strict";function i(E){return E=String(E),E.charAt(0).toUpperCase()+E.slice(1)}function o(E,oe,te){var Ce={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return oe&&te&&/^Win/i.test(E)&&!/^Windows Phone /i.test(E)&&(Ce=Ce[/[\d.]+$/.exec(E)])&&(E="Windows "+Ce),E=String(E),oe&&te&&(E=E.replace(RegExp(oe,"i"),te)),E=c(E.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function l(E,oe){var te=-1,Ce=E?E.length:0;if(typeof Ce=="number"&&Ce>-1&&ge>=Ce)for(;++te<Ce;)oe(E[te],te,E);else u(E,oe)}function c(E){return E=y(E),/^(?:webOS|i(?:OS|P))/.test(E)?E:i(E)}function u(E,oe){for(var te in E)R.call(E,te)&&oe(E[te],te,E)}function p(E){return E==null?i(E):H.call(E).slice(8,-1)}function m(E,oe){var te=E!=null?typeof E[oe]:"number";return!/^(?:boolean|number|string|undefined)$/.test(te)&&(te=="object"?!!E[oe]:!0)}function v(E){return String(E).replace(/([ -])(?!$)/g,"$1?")}function b(E,oe){var te=null;return l(E,function(Ce,Ge){te=oe(te,Ce,Ge,E)}),te}function y(E){return String(E).replace(/^ +| +$/g,"")}function w(E){function oe(Pe){return b(Pe,function(pe,se){return pe||RegExp("\\b"+(se.pattern||v(se))+"\\b","i").exec(E)&&(se.label||se)})}function te(Pe){return b(Pe,function(pe,se,ot){return pe||(se[q]||se[/^[a-z]+(?: +[a-z]+\b)*/i.exec(q)]||RegExp("\\b"+v(ot)+"(?:\\b|\\w*\\d)","i").exec(E))&&ot})}function Ce(Pe){return b(Pe,function(pe,se){return pe||RegExp("\\b"+(se.pattern||v(se))+"\\b","i").exec(E)&&(se.label||se)})}function Ge(Pe){return b(Pe,function(pe,se){var ot=se.pattern||v(se);return!pe&&(pe=RegExp("\\b"+ot+"(?:/[\\d.]+|[ \\w.]*)","i").exec(E))&&(pe=o(pe,ot,se.label||se)),pe})}function be(Pe){return b(Pe,function(pe,se){var ot=se.pattern||v(se);return!pe&&(pe=RegExp("\\b"+ot+" *\\d+[.\\w_]*","i").exec(E)||RegExp("\\b"+ot+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(E))&&((pe=String(se.label&&!RegExp(ot,"i").test(se.label)?se.label:pe).split("/"))[1]&&!/[\d.]+/.test(pe[0])&&(pe[0]+=" "+pe[1]),se=se.label||se,pe=c(pe[0].replace(RegExp(ot,"i"),se).replace(RegExp("; *(?:"+se+"[_-])?","i")," ").replace(RegExp("("+se+")[-_.]?(\\w)","i"),"$1 $2"))),pe})}function Me(Pe){return b(Pe,function(pe,se){return pe||(RegExp(se+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(E)||0)[1]||null})}function Ie(){return this.description||""}var ae=T,Ee=E&&typeof E=="object"&&p(E)!="String";Ee&&(ae=E,E=null);var Je=ae.navigator||{},Ze=Je.userAgent||"";E||(E=Ze);var C,He,x=Ee||I==A,ut=Ee?!!Je.likeChrome:/\bChrome\b/.test(E)&&!/internal|\n/i.test(H.toString()),Y="Object",ht=Ee?Y:"ScriptBridgingProxyObject",Qe=Ee?Y:"Environment",U=Ee&&ae.java?"JavaPackage":p(ae.java),Qt=Ee?Y:"RuntimeObject",J=/\bJava/.test(U)&&ae.java,k=J&&p(ae.environment)==Qe,Q=J?"a":"\u03B1",xe=J?"b":"\u03B2",B=ae.document||{},nt=ae.operamini||ae.opera,Lt=ce.test(Lt=Ee&&nt?nt["[[Class]]"]:p(nt))?Lt:nt=null,Ot=E,re=[],_t=null,Ye=E==Ze,V=Ye&&nt&&typeof nt.version=="function"&&nt.version(),z=oe([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),L=Ce(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt","SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),q=be([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation 3","PlayStation 4","PlayStation Vita","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),K=te({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{"PlayStation 4":1,"PlayStation 3":1,"PlayStation Vita":1}}),F=Ge(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(z&&(z=[z]),K&&!q&&(q=be([K])),(C=/\bGoogle TV\b/.exec(q))&&(q=C[0]),/\bSimulator\b/i.test(E)&&(q=(q?q+" ":"")+"Simulator"),L=="Opera Mini"&&/\bOPiOS\b/.test(E)&&re.push("running in Turbo/Uncompressed mode"),L=="IE"&&/\blike iPhone OS\b/.test(E)?(C=w(E.replace(/like iPhone OS/,"")),K=C.manufacturer,q=C.product):/^iP/.test(q)?(L||(L="Safari"),F="iOS"+((C=/ OS ([\d_]+)/i.exec(E))?" "+C[1].replace(/_/g,"."):"")):L!="Konqueror"||/buntu/i.test(F)?K&&K!="Google"&&(/Chrome/.test(L)&&!/\bMobile Safari\b/i.test(E)||/\bVita\b/.test(q))||/\bAndroid\b/.test(F)&&/^Chrome/.test(L)&&/\bVersion\//i.test(E)?(L="Android Browser",F=/\bAndroid\b/.test(F)?F:"Android"):L=="Silk"?(/\bMobi/i.test(E)||(F="Android",re.unshift("desktop mode")),/Accelerated *= *true/i.test(E)&&re.unshift("accelerated")):L=="PaleMoon"&&(C=/\bFirefox\/([\d.]+)\b/.exec(E))?re.push("identifying as Firefox "+C[1]):L=="Firefox"&&(C=/\b(Mobile|Tablet|TV)\b/i.exec(E))?(F||(F="Firefox OS"),q||(q=C[1])):(!L||(C=!/\bMinefield\b/i.test(E)&&/\b(?:Firefox|Safari)\b/.exec(L)))&&(L&&!q&&/[\/,]|^[^(]+?\)/.test(E.slice(E.indexOf(C+"/")+8))&&(L=null),(C=q||K||F)&&(q||K||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(F))&&(L=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(F)?F:C)+" Browser")):F="Kubuntu",V||(V=Me(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|Silk(?!/[\\d.]+$))","Version",v(L),"(?:Firefox|Minefield|NetFront)"])),(C=z=="iCab"&&parseFloat(V)>3&&"WebKit"||/\bOpera\b/.test(L)&&(/\bOPR\b/.test(E)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(E)&&!/^(?:Trident|EdgeHTML)$/.test(z)&&"WebKit"||!z&&/\bMSIE\b/i.test(E)&&(F=="Mac OS"?"Tasman":"Trident")||z=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(L)&&"NetFront")&&(z=[C]),L=="IE"&&(C=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(E)||0)[1])?(L+=" Mobile",F="Windows Phone "+(/\+$/.test(C)?C:C+".x"),re.unshift("desktop mode")):/\bWPDesktop\b/i.test(E)?(L="IE Mobile",F="Windows Phone 8.x",re.unshift("desktop mode"),V||(V=(/\brv:([\d.]+)/.exec(E)||0)[1])):L!="IE"&&z=="Trident"&&(C=/\brv:([\d.]+)/.exec(E))&&(L&&re.push("identifying as "+L+(V?" "+V:"")),L="IE",V=C[1]),Ye){if(m(ae,"global"))if(J&&(C=J.lang.System,Ot=C.getProperty("os.arch"),F=F||C.getProperty("os.name")+" "+C.getProperty("os.version")),x&&m(ae,"system")&&(C=[ae.system])[0]){F||(F=C[0].os||null);try{C[1]=ae.require("ringo/engine").version,V=C[1].join("."),L="RingoJS"}catch(Pe){C[0].global.system==ae.system&&(L="Narwhal")}}else typeof ae.process=="object"&&!ae.process.browser&&(C=ae.process)?(L="Node.js",Ot=C.arch,F=C.platform,V=/[\d.]+/.exec(C.version)[0]):k&&(L="Rhino");else p(C=ae.runtime)==ht?(L="Adobe AIR",F=C.flash.system.Capabilities.os):p(C=ae.phantom)==Qt?(L="PhantomJS",V=(C=C.version||null)&&C.major+"."+C.minor+"."+C.patch):typeof B.documentMode=="number"&&(C=/\bTrident\/(\d+)/i.exec(E))&&(V=[V,B.documentMode],(C=+C[1]+4)!=V[1]&&(re.push("IE "+V[1]+" mode"),z&&(z[1]=""),V[1]=C),V=L=="IE"?String(V[1].toFixed(1)):V[0]);F=F&&c(F)}V&&(C=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(V)||/(?:alpha|beta)(?: ?\d)?/i.exec(E+";"+(Ye&&Je.appMinorVersion))||/\bMinefield\b/i.test(E)&&"a")&&(_t=/b/i.test(C)?"beta":"alpha",V=V.replace(RegExp(C+"\\+?$"),"")+(_t=="beta"?xe:Q)+(/\d+\+?/.exec(C)||"")),L=="Fennec"||L=="Firefox"&&/\b(?:Android|Firefox OS)\b/.test(F)?L="Firefox Mobile":L=="Maxthon"&&V?V=V.replace(/\.[\d.]+/,".x"):/\bXbox\b/i.test(q)?(F=null,q=="Xbox 360"&&/\bIEMobile\b/.test(E)&&re.unshift("mobile mode")):!/^(?:Chrome|IE|Opera)$/.test(L)&&(!L||q||/Browser|Mobi/.test(L))||F!="Windows CE"&&!/Mobi/i.test(E)?L=="IE"&&Ye&&ae.external===null?re.unshift("platform preview"):(/\bBlackBerry\b/.test(q)||/\bBB10\b/.test(E))&&(C=(RegExp(q.replace(/ +/g," *")+"/([.\\d]+)","i").exec(E)||0)[1]||V)?(C=[C,/BB10/.test(E)],F=(C[1]?(q=null,K="BlackBerry"):"Device Software")+" "+C[0],V=null):this!=u&&q!="Wii"&&(Ye&&nt||/Opera/.test(L)&&/\b(?:MSIE|Firefox)\b/i.test(E)||L=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(F)||L=="IE"&&(F&&!/^Win/.test(F)&&V>5.5||/\bWindows XP\b/.test(F)&&V>8||V==8&&!/\bTrident\b/.test(E)))&&!ce.test(C=w.call(u,E.replace(ce,"")+";"))&&C.name&&(C="ing as "+C.name+((C=C.version)?" "+C:""),ce.test(L)?(/\bIE\b/.test(C)&&F=="Mac OS"&&(F=null),C="identify"+C):(C="mask"+C,L=Lt?c(Lt.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(C)&&(F=null),Ye||(V=null)),z=["Presto"],re.push(C)):L+=" Mobile",(C=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(E)||0)[1])&&(C=[parseFloat(C.replace(/\.(\d)$/,".0$1")),C],L=="Safari"&&C[1].slice(-1)=="+"?(L="WebKit Nightly",_t="alpha",V=C[1].slice(0,-1)):(V==C[1]||V==(C[2]=(/\bSafari\/([\d.]+\+?)/i.exec(E)||0)[1]))&&(V=null),C[1]=(/\bChrome\/([\d.]+)/i.exec(E)||0)[1],C[0]==537.36&&C[2]==537.36&&parseFloat(C[1])>=28&&z=="WebKit"&&(z=["Blink"]),Ye&&(ut||C[1])?(z&&(z[1]="like Chrome"),C=C[1]||(C=C[0],530>C?1:532>C?2:532.05>C?3:533>C?4:534.03>C?5:534.07>C?6:534.1>C?7:534.13>C?8:534.16>C?9:534.24>C?10:534.3>C?11:535.01>C?12:535.02>C?"13+":535.07>C?15:535.11>C?16:535.19>C?17:536.05>C?18:536.1>C?19:537.01>C?20:537.11>C?"21+":537.13>C?23:537.18>C?24:537.24>C?25:537.36>C?26:z!="Blink"?"27":"28")):(z&&(z[1]="like Safari"),C=C[0],C=400>C?1:500>C?2:526>C?3:533>C?4:534>C?"4+":535>C?5:537>C?6:538>C?7:601>C?8:"8"),z&&(z[1]+=" "+(C+=typeof C=="number"?".x":/[.+]/.test(C)?"":"+")),L=="Safari"&&(!V||parseInt(V)>45)&&(V=C)),L=="Opera"&&(C=/\bzbov|zvav$/.exec(F))?(L+=" ",re.unshift("desktop mode"),C=="zvav"?(L+="Mini",V=null):L+="Mobile",F=F.replace(RegExp(" *"+C+"$"),"")):L=="Safari"&&/\bChrome\b/.exec(z&&z[1])&&(re.unshift("desktop mode"),L="Chrome Mobile",V=null,/\bOS X\b/.test(F)?(K="Apple",F="iOS 4.3+"):F=null),V&&V.indexOf(C=/[\d.]+$/.exec(F))==0&&E.indexOf("/"+C+"-")>-1&&(F=y(F.replace(C,""))),z&&!/\b(?:Avant|Nook)\b/.test(L)&&(/Browser|Lunascape|Maxthon/.test(L)||L!="Safari"&&/^iOS/.test(F)&&/\bSafari\b/.test(z[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Sleipnir|Web)/.test(L)&&z[1])&&(C=z[z.length-1])&&re.push(C),re.length&&(re=["("+re.join("; ")+")"]),K&&q&&q.indexOf(K)<0&&re.push("on "+K),q&&re.push((/^on /.test(re[re.length-1])?"":"on ")+q),F&&(C=/ ([\d.+]+)$/.exec(F),He=C&&F.charAt(F.length-C[0].length-1)=="/",F={architecture:32,family:C&&!He?F.replace(C[0],""):F,version:C?C[1]:null,toString:function(){var Pe=this.version;return this.family+(Pe&&!He?" "+Pe:"")+(this.architecture==64?" 64-bit":"")}}),(C=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(Ot))&&!/\bi686\b/i.test(Ot)?(F&&(F.architecture=64,F.family=F.family.replace(RegExp(" *"+C),"")),L&&(/\bWOW64\b/i.test(E)||Ye&&/\w(?:86|32)$/.test(Je.cpuClass||Je.platform)&&!/\bWin64; x64\b/i.test(E))&&re.unshift("32-bit")):F&&/^OS X/.test(F.family)&&L=="Chrome"&&parseFloat(V)>=39&&(F.architecture=64),E||(E=null);var Ae={};return Ae.description=E,Ae.layout=z&&z[0],Ae.manufacturer=K,Ae.name=L,Ae.prerelease=_t,Ae.product=q,Ae.ua=E,Ae.version=L&&V,Ae.os=F||{architecture:null,family:null,version:null,toString:function(){return"null"}},Ae.parse=w,Ae.toString=Ie,Ae.version&&re.unshift(V),Ae.name&&re.unshift(L),F&&L&&(F!=String(F).split(" ")[0]||F!=L.split(" ")[0]&&!q)&&re.push(q?"("+F+")":"on "+F),re.length&&(Ae.description=re.join(" ")),Ae}var _={function:!0,object:!0},T=_[typeof window]&&window||this,A=T,W=_[typeof s]&&s,Z=_[typeof t]&&t&&!t.nodeType&&t,ee=W&&Z&&typeof r=="object"&&r;!ee||ee.global!==ee&&ee.window!==ee&&ee.self!==ee||(T=ee);var ge=Math.pow(2,53)-1,ce=/\bOpera/,I=this,O=Object.prototype,R=O.hasOwnProperty,H=O.toString,he=w();typeof n=="function"&&typeof n.amd=="object"&&n.amd?(T.platform=he,n(function(){return he})):W&&Z?u(he,function(E,oe){W[oe]=E}):T.platform=he}).call(this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}]},{},[1])(1)})});var Mo=zi((qw,Do)=>{"use strict";var Xf=Object.prototype.hasOwnProperty,ze="~";function fr(){}Object.create&&(fr.prototype=Object.create(null),new fr().__proto__||(ze=!1));function Jf(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function Bd(n,e,t,s,r){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new Jf(t,s||n,r),o=ze?ze+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],i]:n._events[o].push(i):(n._events[o]=i,n._eventsCount++),n}function ui(n,e){--n._eventsCount==0?n._events=new fr:delete n._events[e]}function qe(){this._events=new fr,this._eventsCount=0}qe.prototype.eventNames=function(){var e=[],t,s;if(this._eventsCount===0)return e;for(s in t=this._events)Xf.call(t,s)&&e.push(ze?s.slice(1):s);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};qe.prototype.listeners=function(e){var t=ze?ze+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var r=0,i=s.length,o=new Array(i);r<i;r++)o[r]=s[r].fn;return o};qe.prototype.listenerCount=function(e){var t=ze?ze+e:e,s=this._events[t];return s?s.fn?1:s.length:0};qe.prototype.emit=function(e,t,s,r,i,o){var l=ze?ze+e:e;if(!this._events[l])return!1;var c=this._events[l],u=arguments.length,p,m;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,s),!0;case 4:return c.fn.call(c.context,t,s,r),!0;case 5:return c.fn.call(c.context,t,s,r,i),!0;case 6:return c.fn.call(c.context,t,s,r,i,o),!0}for(m=1,p=new Array(u-1);m<u;m++)p[m-1]=arguments[m];c.fn.apply(c.context,p)}else{var v=c.length,b;for(m=0;m<v;m++)switch(c[m].once&&this.removeListener(e,c[m].fn,void 0,!0),u){case 1:c[m].fn.call(c[m].context);break;case 2:c[m].fn.call(c[m].context,t);break;case 3:c[m].fn.call(c[m].context,t,s);break;case 4:c[m].fn.call(c[m].context,t,s,r);break;default:if(!p)for(b=1,p=new Array(u-1);b<u;b++)p[b-1]=arguments[b];c[m].fn.apply(c[m].context,p)}}return!0};qe.prototype.on=function(e,t,s){return Bd(this,e,t,s,!1)};qe.prototype.once=function(e,t,s){return Bd(this,e,t,s,!0)};qe.prototype.removeListener=function(e,t,s,r){var i=ze?ze+e:e;if(!this._events[i])return this;if(!t)return ui(this,i),this;var o=this._events[i];if(o.fn)o.fn===t&&(!r||o.once)&&(!s||o.context===s)&&ui(this,i);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||r&&!o[l].once||s&&o[l].context!==s)&&c.push(o[l]);c.length?this._events[i]=c.length===1?c[0]:c:ui(this,i)}return this};qe.prototype.removeAllListeners=function(e){var t;return e?(t=ze?ze+e:e,this._events[t]&&ui(this,t)):(this._events=new fr,this._eventsCount=0),this};qe.prototype.off=qe.prototype.removeListener;qe.prototype.addListener=qe.prototype.on;qe.prefixed=ze;qe.EventEmitter=qe;typeof Do!="undefined"&&(Do.exports=qe)});[].at||(Array.prototype.at=function(n){return this.slice(n,n!==-1?n+1:void 0)[0]});var El=class extends xt{createRenderRoot(){return this}render(){return ie`
      <style>
        .tooltip-wrapper {
          position: absolute;
          top: 0;
          right: 0;
          bottom: 0;
          left: 0;
          pointer-events: none;
          z-index: var(--vst-z-popover) + 1;
        }

        .tippy-popper {
          pointer-events: auto;
        }

        .tippy-tooltip.vst-ui-theme {
          font-family: var(--vst-font-family);
          font-size: var(--vst-font-size-xs);
          background-color: var(--vst-color-dark-300);
          color: var(--vst-color-light-100);
        }

        /* Error theme */
        .tippy-tooltip.vst-ui--error-theme {
          font-size: var(--vst-font-size-m);
          background-color: var(--vst-color-danger-bg);
          color: var(--vst-color-danger-dark);
        }

        .tippy-tooltip.vst-ui--error-theme[x-placement^='top'] .tippy-arrow {
          border-top-color: var(--vst-color-danger-bg);
        }

        .tippy-tooltip.vst-ui--error-theme[x-placement^='bottom'] .tippy-arrow {
          border-bottom-color: var(--vst-color-danger-bg);
        }

        /* Instructions theme */
        .tippy-tooltip.vst-ui--instructions-theme {
          font-size: var(--vst-font-size-m);
          background-color: var(--vst-color-info-bg);
          color: var(--vst-color-info);
        }

        .tippy-tooltip.vst-ui--instructions-theme[x-placement^='top'] .tippy-arrow {
          border-top-color: var(--vst-color-info-bg);
        }

        .tippy-tooltip.vst-ui--instructions-theme[x-placement^='bottom'] .tippy-arrow {
          border-bottom-color: var(--vst-color-info-bg);
        }
      </style>

      <div id="tooltip_wrapper" class="tooltip-wrapper"></div>
    `}};customElements.define("vst-ui-tooltip-wrapper",El);var an=class extends xt{constructor(){super();this.eventBinder=new Se;this._onBackButton=this._onBackButton.bind(this),this._handleQuit=this._handleQuit.bind(this),this.trySave=this.trySave.bind(this)}static get properties(){return{}}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("backbutton",this._onBackButton),document.removeEventListener("close-app",this._handleQuit),window.removeEventListener("beforeunload",this._handleQuit),this.eventBinder.unbindAll()}get appInfo(){return console.error("App instance must override appInfo() getter."),{appName:"",fileExtension:"",sampleExperimentAddress:""}}_handleQuit(e){this.$services.appLifecycle.closeWindow(!1,e)}_onBackButton(){let{popoverManager:e}=this.$services;return e.hasPopovers()?this.$services.appLifecycle.closeWindow():this.$services.popoverManager.closeLast()}initApp(){let{appLifecycle:e}=this.$services;e.onClose.addPromise(0,this.trySave),e.onClose.addBeforeClose(async()=>{await this.$services.dataCollection.uninit(),await this.onStopDataShare?.()}),document.addEventListener("backbutton",this._onBackButton),document.addEventListener("close-app",this._handleQuit),window.addEventListener("beforeunload",this._handleQuit),this.eventBinder.bindListeners({source:Zs,target:this,eventMap:{save:"onSaveFile","save-as":"onSaveFile",quit:"_handleQuit"}})}async trySave(){if(rs())return{};let{dataWorld:e}=this.$services,t=await e.checkForSave(),s=t.cancelled;if(t.save&&!this.__notifiedNewFile){let{promptForSave:r}=await import("./chunk/promptForSave-Z5QEMOIL.js"),{cancelled:i,save:o}=await r.call(this,this.experimentName);if(s=i,o)return this.onSaveFile({throwOnCancel:!0})}return s?Promise.reject({cancelled:!0,cancelClose:!0}):Promise.resolve({})}async onSaveFile(e={}){let{toast:t,fileIO:s,dataWorld:r}=this.$services,{fileExtension:i,sampleExperimentAddress:o}=this.appInfo,l=r.userFileMetaData.filepath&&!r.userFileMetaData.filepath.startsWith("content://")&&!r.userFileMetaData.filepath.endsWith(i);if((!r.userFileMetaData.filepath||l||r.userFileMetaData.filepath.includes(o)||e?.eventName==="save-as")&&(e.saveAs=!0,l)){let u=r.userFileMetaData.filepath.split(".");u.pop();let p=u.join(".");p.includes(":")&&(p=p.split(":").pop()),e.suggestedName=p}try{this.showWait?.(!0,{message:M("Saving")}),await s.saveFile(e)&&t.makeToast(M("File saved"))}catch(u){if(u&&(console.error(u),t.makeToast(M("Save failed"),{duration:1e4})),e?.throwOnCancel)throw{cancelClose:!0}}finally{this.showWait?.(!1)}}};var Zt=le(ln());var _l=n=>class extends n{constructor(){super();this._services=new Map,this.addEventListener("request-service",e=>{let{key:t}=e.detail;this._services.has(t)&&(e.detail.$service=this._services.get(t),e.stopPropagation())})}provideService(e,t){this._services.set(e,t)}provideServices(e={}){Object.keys(e).forEach(t=>this.provideService(t,e[t]))}};async function Dl(n){switch(n){case"vst-core-column-options":return(await import("./chunk/vst-core-column-options-TSE573KF.js")).template;case"vst-ui-message-box":return(await import("./chunk/vst-ui-message-box-ZIZY7LKS.js")).template;case"vst-core-export":return(await import("./chunk/vst-core-export-KXXYP2CC.js")).template;case"vst-ui-custom-expression-info":return(await import("./chunk/vst-ui-custom-expression-info-F5MRGMEW.js")).template;case"vst-ui-presentation":return(await import("./chunk/vst-ui-presentation-F5BDHP3Q.js")).template;case"vst-ui-prompt":return(await import("./chunk/vst-ui-prompt-3F77LPBQ.js")).template;case"vst-core-feature-flags":return(await import("./chunk/vst-core-feature-flags-EMAPAL6G.js")).template;case"vst-core-device-info":return(await import("./chunk/vst-core-device-info-NGSNRJWJ.js")).template;case"vst-core-device-manager":return(await import("./chunk/vst-core-device-manager-V3KJBBMC.js")).template;case"vst-core-fit-options":return(await import("./chunk/vst-core-fit-options-WSUADJR5.js")).template;case"vst-core-meter-select":return(await import("./chunk/vst-core-meter-select-4LJTOAFR.js")).template;default:return""}}var Ml=n=>class extends n{constructor(){super();this.isDialogMediator=!0,this.dialogs={templates:[],close:e=>{!this.dialogs[e]||(this.dialogs[e].show=!1,this.requestUpdate(),this.dialogs[e].onClose&&this.dialogs[e].onClose(),this.dialogs[e].element.hasAttribute("open")&&this.dialogs[e].element.toggleAttribute("open"))}},this.addEventListener("open-dialog",e=>{this.$services.popoverManager.hasDialogs()&&this.$services.popoverManager.closeAll(),e.stopPropagation();let{detail:{dialog:t,params:s,onClose:r}}=e;this.dialogs[t].show=!0,this.dialogs[t].params=s,this.dialogs[t].onClose=r,this.requestUpdate(),this.dialogs[t].element.hasAttribute("open")||this.dialogs[t].element.toggleAttribute("open")}),this.addEventListener("close-dialog",e=>{e.stopPropagation();let{detail:t}=e;this.dialogs.close(t)}),this.addEventListener("register-dialog",e=>{e.stopPropagation();let{detail:t}=e;this.dialogs[t.id]={show:!1,element:t},t.addEventListener("dialog-close",s=>{s.stopPropagation();let{detail:r}=s;r.id===t.id&&this.dialogs[t.id].show&&this.dialogs.close(t.id)})}),this.addEventListener("dispose-dialog",e=>{e.stopPropagation();let{detail:t}=e;delete this.dialogs[t.id]})}async registerDialogTemplate(e){return Array.isArray(e)?this.dialogs.templates.push(...await Promise.all(e.map(Dl))):this.dialogs.template.push(await Dl(e))}};var qr,kp=new Uint8Array(16);function cn(){if(!qr&&(qr=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!qr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return qr(kp)}var Tl=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Lp(n){return typeof n=="string"&&Tl.test(n)}var Rl=Lp;var Fe=[];for(var dn=0;dn<256;++dn)Fe.push((dn+256).toString(16).substr(1));function Op(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Fe[n[e+0]]+Fe[n[e+1]]+Fe[n[e+2]]+Fe[n[e+3]]+"-"+Fe[n[e+4]]+Fe[n[e+5]]+"-"+Fe[n[e+6]]+Fe[n[e+7]]+"-"+Fe[n[e+8]]+Fe[n[e+9]]+"-"+Fe[n[e+10]]+Fe[n[e+11]]+Fe[n[e+12]]+Fe[n[e+13]]+Fe[n[e+14]]+Fe[n[e+15]]).toLowerCase();if(!Rl(t))throw TypeError("Stringified UUID is invalid");return t}var Al=Op;function Fp(n,e,t){n=n||{};var s=n.random||(n.rng||cn)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){t=t||0;for(var r=0;r<16;++r)e[t+r]=s[r];return e}return Al(s)}var er=Fp;var Bp="KomJ9y25SPqMAqdylUlRQw",Np="G-MG8Y2B8V27",Pl="ga4-client-id",$p=`https://google-analytics.com/mp/collect?measurement_id=${Np}&api_secret=${Bp}`,Cs=class{constructor(){this.lastEventTime=null}static _getClientId(){let e=localStorage.getItem(Pl);return e||(e=er(),localStorage.setItem(Pl,e)),e}trackEvent(e,t){if(!Oe("ff-google-analytics"))return;console.assert(e.length<=40,"Event names must be 40 characters or fewer"),console.assert(Object.keys(t).length<=25,"Events can have a maximum of 25 parameters"),console.assert(Object.keys(t).every(i=>i.length<=40),"Parameter names must be 40 characters or fewer"),console.assert(Object.values(t).every(i=>i.length<=100),"Parameter values must be 100 character or fewer");let s=this.lastEventTime?Math.round(performance.now())-this.lastEventTime:0,r={client_id:Cs._getClientId(),events:[{name:e,params:de(P({},t),{engagement_time_msec:s,language:navigator.language,page_encoding:document.characterSet,screen_resolution:`${window.screen.width}x${window.screen.height}`})}]};fetch($p,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)}),this.lastEventTime=Math.round(performance.now())}trackPageView(e,t){this.trackEvent("page_view",{page_location:`https://graphicalanalysis.app${e}`,page_title:t||document.title})}};var Is=class{constructor(e,t){this.toast=e,this.enabledContent=t,this.popovers=[],this.anchoredPopovers=[],this._popoverWrapperEl=void 0;let s=()=>{for(let r=0;r<this.popovers.length;++r)Is.positionPopover(this.popovers[r])};window.addEventListener("resize",s),this.resizeObserver=new ResizeObserver(s)}async create(e,t={}){let{toast:s,enabledContent:r}=this;if(console.assert(e),!this._popoverWrapperEl){console.warn("no popover wrapper attached. Fallback to standard div");let p=document.querySelector("#app")||document.body,m=document.createElement("div");m.id="popover_wrapper",p.appendChild(m),this._popoverWrapperEl=m}let i=document.createElement(e);if(!customElements.get(i.tagName.toLowerCase()))throw Error(`Possible issue with childEl import verify spelling and that this ${e} component is being imported`);let o=t.popover||{};await import("./chunk/vst-core-popover-FRCEX2UR.js");let l=document.createElement("vst-core-popover");if(this.resizeObserver.observe(i),t.preventCancel&&(l.canClose=!1),t.preventCancelFromScreen&&(l.canCloseFromScreen=!1),t.properties){let{properties:p}=t;Object.keys(p).forEach(m=>{i[m]=p[m]})}l.setPopoverChild(i,o),this._popoverWrapperEl.appendChild(l),await l.updateComplete,l.shadowRoot.querySelector("#popover").style.visibility="hidden";let c=wt(),u={id:c,popoverEl:l,childEl:i,config:t,onRemove:()=>{},remove:()=>{u.onRemove(),l.remove(),this.resizeObserver.unobserve(i)}};return this.popovers.push(u),this._popoverWrapperEl.dispatchEvent(new CustomEvent("popover-creation",{bubbles:!0,composed:!0,detail:{id:c,title:t.popover.header?.title||e}})),requestAnimationFrame(()=>{setTimeout(()=>{Is.positionPopover(u),l.shadowRoot.querySelector("#popover").style.visibility="";let{outsideTapEvents:p={}}=t,m=typeof p.click=="string"?p.click:"click";if(t.popover.type!=="dialog"){let _=!1,T=()=>{_=!0,setTimeout(()=>{_=!1})};i.addEventListener(m,T,!0),l.bind(document.querySelector("#app"),m,()=>{!_&&!t.preventCancel&&(l.dispatchEvent(new CustomEvent("close")),i.removeEventListener(m,T,!0)),_=!1})}let v=[l,s.element],b=document.querySelector("vst-ui-chromebar");b&&v.push(b),document.querySelector("#app").shadowRoot.querySelectorAll("vst-ui-soft-alert").forEach(_=>{v.push(_)});let w=t.popover.type==="dialog"?r.restrict(e,v):r.extend(e,v);u.onRemove=()=>w()})}),l}present(e,{popover:t,preventCancel:s,preventCancelFromScreen:r,outsideTapEvents:i,properties:o,events:l}){let{anchoredPopovers:c}=this;return new Promise((u,p)=>{let m,v=A=>{let W=A;return(...Z)=>{W(...Z),W=()=>{}}},b=A=>A.anchor===t.anchor,y=v(()=>{m&&this.destroy(m);let A=c.findIndex(b);A!==-1&&c.splice(A,1)}),w=v(A=>{y(),p(A)}),_=v(A=>{y(),u(A)}),T=v(A=>_({cancelled:!0,reason:A,message:`${e} popover cancelled. Reason: ${A}.`}));try{(async()=>{if(t.type!=="dialog"&&t.anchor){let I=c.find(b);if(I){I.close(),T("toggle-existing-popover");return}let O={anchor:t.anchor,close:()=>{T("popover-toggled-close")}};c.push(O)}m=await this.create(e,{popover:t,preventCancel:s,preventCancelFromScreen:r,outsideTapEvents:i,properties:o},!1);let A=m.querySelector(e),ge={component:A,completeWorkflow:I=>{A.dispatchEvent(new CustomEvent("complete-workflow",{detail:I}))},cancelWorkflow:()=>{A.dispatchEvent(new CustomEvent("cancel-workflow"))},failWorkflow:I=>{A.dispatchEvent(new CustomEvent("fail-workflow",{detail:I}))}},ce=typeof l=="function"?l(ge):l;ce&&Object.keys(ce).forEach(I=>{m.bind(A,I,(...O)=>{ce[I](...O)})}),m.bind(A,"complete-workflow",I=>_(I.detail)),m.bind(A,"fail-workflow",I=>w(I.detail)),m.bind(A,"cancel-workflow",()=>T("workflow-cancelled")),m.bind("close",()=>T("popover-closed"))})()}catch(A){w(A)}})}destroy(e){try{let t=this.popovers.findIndex(i=>i.popoverEl===e),s=this.popovers.splice(t,1)[0],{id:r}=s;s.remove(),this._popoverWrapperEl.dispatchEvent(new CustomEvent("popover-removal",{bubbles:!0,composed:!0,detail:{id:r,title:s.config.popover.header?.title||s.childEl}}))}catch(t){console.warn(t)}}destroyAll(){this.popovers.map(e=>e.popoverEl).forEach(e=>e.close()),this.popovers=[]}popPopover(){let e=this.popovers.slice(-1)[0];return e?this.destroy(e.popoverEl):console.warn("no popovers to pop")}hasPopovers(){return this.popovers.length>0}hasDialogs(){let e=!1;return this.hasPopovers()&&this.popovers.forEach(t=>{t.config.popover.type==="dialog"&&(e=!0)}),e}getPopoverSelectorDebugInfo(){let{popoverSelector:e}=this;return e.getDebugInfo()}static positionPopover(e){let t=e.config.popover,{popoverEl:s}=e,{childEl:r}=e,i=t.type||"popover",o=e.popoverEl.shadowRoot.querySelector("#popover"),l="CENTER";if(i==="dialog")s.classList.add("dialog");else{o.classList.add(i),i==="contextmenu"&&e.popoverEl.addEventListener("contextmenu",ce=>{s.cancelClicked(),ce.preventDefault()}),t.orientation&&(l=t.orientation.toUpperCase());let c=document.documentElement.clientWidth,u=document.documentElement.clientHeight,m=(t.anchor||document.body).getBoundingClientRect(),v=m.width/2,b=m.height/2,y=r.getBoundingClientRect(),w=y.width/2,_=y.height/2,T=8,A,W=(ce,I)=>{let O={},R=0;switch(ce){case"TOP":O.x=m.left+v-w,O.y=m.top-y.height-(T+1);break;case"BOTTOM":O.x=m.left+v-w,O.y=m.bottom+T-1;break;case"RIGHT":O.x=m.right+T,O.y=m.top-_+b;break;case"LEFT":O.x=m.left-y.width-T,O.y=m.top-_+b;break;case"CENTER":O.x=c/2-w,O.y=u/2-_;break;default:console.warn("no popover orientation hint - use TOP, LEFT, RIGHT, BOTTOM, or CENTER");break}i==="contextmenu"&&(O.x=t.extras.x,O.y=t.extras.y),"visualViewport"in window&&(R=window.visualViewport.offsetTop),o.style.left=`${O.x}px`,o.style.top=`${O.y+R}px`,I||A()};A=()=>{y=r.getBoundingClientRect(),c<y.width?(l="CENTER",W(l,!0)):l==="LEFT"&&y.left<0?(c-m.right<y.width?l="CENTER":l="RIGHT",W(l,!0)):l==="RIGHT"&&y.right>=c&&(m.left<y.width?l="CENTER":l="LEFT",W(l,!0))},W(l),o.classList.add(l.toLowerCase());let Z=o.getBoundingClientRect(),ee=4;Z.top<=0&&(o.style.top=`${ee}px`),Z.right>=c&&(o.style.left=`${c-Z.width-ee}px`),Z.left<=0&&(o.style.left=`${ee}px`),Z.bottom>=u&&(o.style.top=`${u-Z.height-ee}px`);let ge=nl();parseFloat(o.style.left)<=ee+ge&&(o.style.left=`calc(${ge}px + ${o.style.left})`),c-Z.width-parseFloat(o.style.left)<=ee+ge&&(o.style.left=`calc(${c-Z.width-ee}px - ${ge}px)`)}}};function Gr(n){return new Promise(e=>e(n()))}var Rt=Symbol("priv"),un=class{constructor(e,t){this[Rt]={popoverManagerApi:new Is(e,t)}}attachWrapper(e){this[Rt].popoverManagerApi._popoverWrapperEl=e}presentPopover(e,{title:t,anchor:s,orientation:r,outsideTapEvents:i,properties:o,events:l,preventCancel:c}={}){return Gr(()=>{let{popoverManagerApi:u}=this[Rt],p=t===void 0?void 0:{title:t};return u.present(e,{popover:{anchor:s,orientation:r,header:p},outsideTapEvents:i,properties:o,events:l,preventCancel:c})})}presentPopoverList({title:e,anchor:t,orientation:s,items:r,direction:i}={}){return Gr(()=>{let o={},l=({id:y,title:w})=>{if(typeof y!="string"||y.length===0)throw Error("item options in PopoverManager.presentPopoverList() config must have a string id.");if(o[y])throw Error(`id '${y}' is duplicated in PopoverManager.presentPopoverList() config. Must be unique.`);if(o[y]=!0,typeof w!="string"||w.length===0)throw Error(`menu item option with id ${y} in PopoverManager.presentPopoverList() is either missing a title property, or the title needs a non empty string.`);return!0},c=y=>y.filter(w=>Array.isArray(w)||l(w)&&(w.include===void 0||w.include)).map(w=>Array.isArray(w)?c(w):w),u=(y,w)=>Array.isArray(w)?w.reduce(u,y):(y[w.id]=_=>typeof w.selectAction=="function"?w.selectAction():typeof w.checkedChanged=="function"?w.checkedChanged(_):typeof w.selectionChanged=="function"?w.selectionChanged(_):!1,y),p=y=>Array.isArray(y)?y.map(p):y,m=c(r),v=m.reduce(u,{}),b=m.map(p).filter(y=>Array.isArray(y)&&y.length>0||!Array.isArray(y));return import("./chunk/vst-ui-listbox-IEGHUEXO.js"),this.presentPopover("vst-ui-listbox",{anchor:t,orientation:s,properties:{direction:i,view:{heading:e,items:b,icons:!1}},events:({completeWorkflow:y})=>({"list-item-clicked":w=>{y(w.detail)},"list-switch-changed":w=>{let[_,T]=w.detail;v[_](T)},"list-item-option-selected":w=>{let[_,T]=w.detail;v[_](T)}})}).then(y=>y&&y.cancelled?y:v[y]())})}presentDialog(e,{title:t,preventCancel:s,preventCancelFromScreen:r,properties:i,events:o}={}){return Gr(()=>{let{popoverManagerApi:l}=this[Rt],c=t===void 0?void 0:{title:t};return l.present(e,{popover:{type:"dialog",header:c},preventCancel:s,preventCancelFromScreen:r,properties:i,events:o})})}closeAll(){let{popoverManagerApi:e}=this[Rt];e.destroyAll()}closeLast(){let{popoverManagerApi:e}=this[Rt];e.popPopover()}hasPopovers(){let{popoverManagerApi:e}=this[Rt];return e.hasPopovers()}hasDialogs(){let{popoverManagerApi:e}=this[Rt];return e.hasDialogs()}getPopoverSelectorDebugInfo(){let{popoverManagerApi:e}=this[Rt];return e.getPopoverSelectorDebugInfo()}};var At=class extends Error{constructor(e,...t){super(...t);Error.captureStackTrace&&Error.captureStackTrace(this,At),this.response=e,this.name=`VSTAnalysisError: ${e.errorCode}`}get errorCode(){return this.response.errorCode}},hn=class{constructor(e){this.api=e,this._useRadians=!0}_fixCosSquared(e){let s=e.coefficients[2],r=this._useRadians?Math.PI/2:90,i=this._useRadians?Math.PI:180;for(s<0&&(r=-r,i=-i);Math.abs(s)>Math.abs(r);)s-=i;e.coefficients[2]=s}async computeCurveFit(e,t,s,r,i,o){let l=await this.api.computeCurveFit(e,t,s,r,i,o);if(l?.errorCode)throw new At(l);return e===is.COSINE_SQUARED&&l.coefficients&&this._fixCosSquared(l),l}async calcFitValues(e,t,s,r=0){let i=await this.api.calcFitValues(e,t,s,r);if(i?.errorCode)throw new At(i);return i}async computeFFT(e,t,s,r){let i=await this.api.computeFFT(e,t,s,r);if(i?.errorCode)throw new At(i);return i}async computeHistogram(e,t,s){let r=await this.api.computeHistogram(e,t,s);if(r?.errorCode)throw new At(r);return r}parseEquation(e){return this.api.parseEquation(e)}releaseHandle(e){return this.api.releaseHandle(e)}setUseRadians(e){return this._useRadians=e,this.api.setUseRadians(e)}enableLogging(e){return this.api.enableLogging(e)}};var kl={NO_ERROR:0,TOO_FEW_POINTS:1,EXCEPTION:2,BAD_PARAMETER:3,BAD_CHARACTER:4,PARSE:5,MISSING_COEFFICIENT:6,MISSING_X:7,TOO_MANY_COEFFICIENTS:8,BAD_ARGUMENT:9,DELTA_ZERO:10,BAD_HANDLE:11,BAD_COEFFICIENT_INDEX:12};var jp=7,Wp=n=>{let{length:e}=n,t=[],s=new Float64Array(e),r=new Float64Array(e),i=1/0,o=-1/0;for(let l=0;l<e;++l)s[l]=n[l][0],r[l]=n[l][1],s[l]<i&&(i=s[l]),s[l]>o&&(o=s[l]);return t.push(o),{x:s,y:r,baseArray:new Float64Array(t)}},pn=(n,e)=>{let{length:t}=n,s=[];console.assert(n.length===e.length);for(let r=0;r<t;++r)s.push([n[r],e[r]]);return s},mn=(n,e,t,s)=>{let r=[];if(n.length>0&&e.length>0){let i=Math.min(n.length,e.length);for(let o=0;o<i;++o){let l=n[o],c=e[o];!Number.isNaN(l)&&!Number.isNaN(c)&&(l>t||Tt(l,t))&&(l<s||Tt(l,s))&&r.push([l,c])}}return Wp(r)},Pt=class{constructor({dataWorld:e,api:t}){this.dataWorld=e,this.vstAnalysis=new hn(t),this.tempCustomFitHandle=null,this.isHydrating=!1,this.curveFitStore=Gt,Gt._releaseHandle=async s=>this.vstAnalysis.releaseHandle(s),Gt._updateCustomFit=async(s,r)=>{if(!this.isHydrating)return this.dataWorld.setCustomCurveFit(s,r)}}async parseEquation(e,t){Number.isInteger(this.tempCustomFitHandle)&&(await this.vstAnalysis.releaseHandle(this.tempCustomFitHandle),this.tempCustomFitHandle=null);let s=await this.vstAnalysis.parseEquation(t);return s?.error||s.coefficients.length>jp&&(s.error="Too may parameters specified"),s?.error||(e?await Gt.updateFit({type:e,y:t,handle:s.handle,coefficients:s.coefficients}):this.tempCustomFitHandle=s.handle),de(P({},s),{type:e})}async hydrateCustomFits(e){this.isHydrating=!0;let t=Object.keys(e);for(let s of t){let r=e[s];await this.parseEquation(s,r)}this.isHydrating=!1}getSupportedFits(){return Gt.fits}async calculateFitByType(e,t,s,r){let i=this.getFit(e);return this.calculateFit(e,i.id,t,s,r,i.handle)}async calculateFit(e,t,s,r,i,o){let{dataWorld:l}=this,c=l.getColumnById(s),u=l.getColumnById(r),p=c?c.filteredValues:[],m=u?u.filteredValues:[],v=mn(p,m,i.min,i.max);try{let b=await this.vstAnalysis.computeCurveFit(t,v.x,v.y,null,null,o),y=b.correlation||b?.linear?.correlation||null,w=Gt.getFitInfo(e,de(P({},b),{correlation:y})),{coefficients:_,uncertainties:T}=b;return{type:e,fitInfo:w,coefficients:_,uncertainties:T}}catch(b){if(b instanceof At&&b.errorCode===kl.TOO_FEW_POINTS)return{error:M("Too few points")};throw console.error(b),b}}getFit(e){let t={type:"NONE",name:"none",coefficients:[],id:is.NONE},s=Gt.getFit(e);return!s&&e==="CUSTOM"&&(s={type:"CUSTOM",name:"",coefficients:[],id:is.CUSTOM,handle:this.tempCustomFitHandle}),s||t}async computeTraceByType(e,t,s,r){let i=this.getFit(e);return this.computeTrace(i.type,i.id,t,s,r,i.handle)}async computeTrace(e,t,s,r,i,o){function l(m,v){let b=Math.floor((m.max-m.min)/v),y=[],w=m.min;for(let _=0;_<b;++_)y.push(w),w+=v;return y.push(m.max),Float64Array.from(y)}let c=l(r,i),p=(await this.vstAnalysis.calcFitValues(t,s,c,o)).values;return{type:e,points:pn(c,p)}}async computeFFT(e,t,s,r,i){let{dataWorld:o}=this,l=o.getColumnById(e),c=o.getColumnById(t),u=Float64Array.from(l?l.filteredValues:[]),p=Float64Array.from(c?c.filteredValues:[]);return i&&({x:u,y:p}=mn(u,p,i.min,i.max)),await this.vstAnalysis.computeFFT(u,p,s,r)}async computeHistogram(e,t,s,r,i){let{dataWorld:o}=this,l=o.getColumnById(e),c=o.getColumnById(t),{y:u}=mn(l.filteredValues,c.filteredValues,i.min,i.max);return await this.vstAnalysis.computeHistogram(u,s,r)}_preprocessColumnData(e,t){let{dataWorld:s}=this,r=s.getColumnById(t),i=s.getColumnById(e),o=r?r.filteredValues:[],l=i?i.filteredValues:[],c=pn(l,o).filter(u=>Number.isFinite(u[0])&&Number.isFinite(u[1]));return{xData:c.map(u=>u[0]),yData:c.map(u=>u[1])}}static _indicesForRange(e,t){let s=e.xData.slice().reverse(),r=e.xData.findIndex(l=>Tt(l,t.min)||l>t.min),i=s.findIndex(l=>Tt(l,t.max)||l<t.max),o=e.xData.length-i-1;return r===-1||i===-1?{valid:!1}:{begin:r,end:o,valid:!0}}static _performIntregralCalculation(e,t){let s={integralValue:0,integralData:[],success:!1};if(!t.valid)return s;for(let r=t.begin;r<t.end;r++)s.integralValue+=(e.yData[r]+e.yData[r+1])*(e.xData[r+1]-e.xData[r])/2,s.integralData.push([e.xData[r],e.yData[r]]),s.success=!0;return s.integralData.push([e.xData[t.end],e.yData[t.end]]),s}calculateIntegralAndGetData(e,t,s){let r=this._preprocessColumnData(e,t),i=Pt._indicesForRange(r,s);return Pt._performIntregralCalculation(r,i)}calculatePeakIntegral(e,t,s,r){let i=this._preprocessColumnData(e,t),o=Pt._indicesForRange(i,s),l=Pt._indicesForRange(i,r),c=Pt._performIntregralCalculation(i,o);if(!c.success)return{success:!1};let{begin:u,end:p}=l,{xData:m,yData:v}=i,b=(v[p-1]-v[u])/(m[p-1]-m[u]),y=v[p-1]-b*m[p-1],w=0,_=-Number.MAX_VALUE,T=0,A=W=>{v[W]>_&&(_=v[W],T=m[W])};for(let W=o.begin;W<o.end;W++){let Z=b*m[W]+y,ee=b*m[W+1]+y;w+=(Z+ee)*(m[W+1]-m[W])/2,A(W)}return A(o.end),c.integralValue-=w,de(P({},c),{retentionTime:T,slope:b,intercept:y})}calculateStatistics(e,t,s,r){let{dataWorld:i}=this,o=i.getColumnById(e),l=i.getColumnById(t),c=_=>_===void 0?NaN:_,u=o?[...o.filteredValues].map(c):[],p=l?[...l.filteredValues].map(c):[],m=Math.min(u.length,p.length),v=!1,b={min:{x:1/0,y:1/0,index:0},max:{x:-1/0,y:-1/0,index:0},mean:0,stdDev:0,points:[]},y=(_,T,A)=>{v=!0,b.points.push([_,T]),b.mean+=T,T<b.min.y&&(b.min.x=_,b.min.y=T,b.min.index=A),T>b.max.y&&(b.max.x=_,b.max.y=T,b.max.index=A)},w=_=>typeof _=="number"?!Number.isNaN(_):!!_;if(r){let{min:_,max:T}=s;for(let A=_;A<=T&&A<m;A++){let W=u[A],Z=p[A];w(W)&&w(Z)&&y(W,Z,A)}}else for(let _=0;_<m;_++){let T=u[_],A=p[_];w(T)&&w(A)&&(T>s.min||Tt(T,s.min))&&(T<s.max||Tt(T,s.max))&&y(T,A,_)}return b.points.length>0&&(b.mean/=b.points.length,b.points.length>1&&(b.points.forEach(_=>{let A=_[1]-b.mean;b.stdDev+=A*A}),b.stdDev=Math.sqrt(b.stdDev/(b.points.length-1)))),{stats:b,success:v,error:v?void 0:new Error("Data points for stats calculation are invalid")}}computeTangentSlope(e,t,s){let{dataWorld:r}=this,i={success:!1,slope:0,error:null},l=(7-1)/2,c=(w=[],_=[])=>w[0]-_[0],u=r.getColumnById(t),p=r.getColumnById(e),m=u?u.filteredValues:[],v=p?p.filteredValues:[],b;b=pn(v,m).sort(c),b=b.filter(w=>Number.isFinite(w[0])&&Number.isFinite(w[1])),b=b.filter((w,_,T)=>_===0||w[0]!==T[--_][0]);let y=b.findIndex(w=>Tt(w[0],s));if(y!==-1&&b.length>=2){let w=0;for(let _=1;_<=l;_++){let T=Math.max(y-_,0),A=Math.min(y+_,b.length-1),W=b[T],Z=b[A],ee=l-(_-1),ge=Z[0]-W[0],ce=Z[1]-W[1];if(ge!==0){let I=ce/ge;i.slope+=ee*I,w+=ee}else return i.error=new Error("Cannot compute tangent with a delta-x of zero"),i}return w>=1?(i.slope/=w,i.success=!0,i):(i.error=new Error("Not enough data included for valid tangent slope calculation"),i)}return i.error=new Error("Unable to calculate tangent slope. Either unable to find correct base column point or insufficient data."),i}generateTangentTraceData(e,t,s,r,i,o){let{accessibilityScale:l,getAxis:c}=o,{dataWorld:u}=this,p=c("base"),m=c(i),v=u.getColumnById(t),b=u.getColumnById(e),y=v?v.filteredValues:[],_=(b?b.filteredValues:[]).findIndex(E=>Tt(E,s)),T=p.range,A=m.range,W=p.rangePx,Z=m.rangePx,[ee,ge]=[T,A].map(E=>E.max-E.min),[ce,I]=[W,Z].map(E=>E.max-E.min),O=I/ge,R=ce/ee,H=r*(O/R),he=Math.sqrt(ce**2+I**2);if(_!==-1&&ee>0&&ge>0&&!Number.isNaN(r)){let E=y[_],oe=p.p2c(s),te=m.p2c(E),Ce={shortLine:{lineWidthFactor:4,pxLength:42*l},longLine:{lineWidthFactor:1,pxLength:2*he}},Ge=Object.values(Ce).map(be=>{let Me=Math.atan(H),Ie=Math.cos(Me)*(be.pxLength/2),ae=Math.sin(Me)*(be.pxLength/2);return{data:[[oe-Ie,te-ae],[oe+Ie,te+ae]].map(Ze=>[p.c2p(Ze[0]),m.c2p(Ze[1])]),lineWidthFactor:be.lineWidthFactor}});return{axis:i,tangentLines:Ge}}return null}};var Jl=le(_e());var Ll=le(Yi());var Ke=class extends Ll.default{constructor({color:e="",visible:t=!1,id:s=0,name:r="",position:i=null,units:o="",value:l="",wavelength:c=0,size:u="medium",sensorAutoId:p=0,sensorName:m="",sensorId:v="",columnId:b="",experimentId:y=0}){super();this._id=s,this._color=e,this._groupId=void 0,this._name=r,this._position=i,this._sensorId=v,this._units=o,this._value=l,this._wavelength=c,this._visible=t,this.size=u,this.sensorAutoId=p,this.sensorName=m,this.columnId=b,this.sensorId=v,this.experimentId=y}udmExport(){return{id:this.id,columnId:this.columnId,sensorId:this.sensorId,visible:this.visible,sensorMatchAutoId:this.sensorAutoId,sensorMatchName:this.sensorName,size:this.size,index:this.position?this.position:-1}}importUdm({id:e,columnId:t,sensorId:s,visible:r,sensorMatchAutoId:i,sensorMatchName:o,size:l,index:c}){e!==void 0&&(this.id=e),t!==void 0&&(this.columnId=t),s!==void 0&&(this.sensorId=s),r!==void 0&&(this.visible=r),i!==void 0&&(this.sensorAutoId=i),o!==void 0&&(this.sensorName=o),l!==void 0&&(this.size=l),c!==void 0&&(this.position=c===-1?null:c)}addBinding(e){this._eventBinder||(this._eventBinder=new Se),e(this._eventBinder)}removeAllBindings(){this._eventBinder&&(this._eventBinder.unbindAll(),this._eventBinder=null)}get color(){return this._color}set color(e){this._color=e,this.emit("color-changed",e)}get visible(){return this._visible}set visible(e){this._visible=e,this.emit("visibility-changed")}get groupId(){return this._groupId}set groupId(e){this._groupId=e,this.emit("group-id-changed",e)}get name(){return this._name}set name(e){this._name=e,this.emit("name-changed",e)}get id(){return this._id}set id(e){this._id=e}get position(){return this._position}set position(e){this._position=e,this.emit("position-changed",e)}get sensorId(){return this._sensorId}set sensorId(e){this._sensorId=e,this.emit("sensor-id-changed",e)}get units(){return this._units}set units(e){this._units=e,this.emit("units-changed",e)}get value(){return this._value}set value(e){this._value=e,this.emit("value-changed",e)}};Ke.Rule=Object.freeze({DEFAULT:"default",USER:"user"});var Ol=le(Yi()),Up=0,fn=class extends Ol.default{constructor({baseColId:e=0,color:t="rgba(120,120,120,1)",dataSetId:s=0,id:r=`spectrum-${Up++}`,lineWeight:i=2,name:o="spectrum",points:l=[],position:c=0,traceColId:u=0,type:p="spectrum"}){super();this._baseColId=e,this._color=t,this._dataSetId=s,this._id=r,this._lineWeight=i,this._name=o,this._points=l,this._position=c,this._traceColId=u,this._type=p}get baseColId(){return this._baseColId}set baseColId(e){this._baseColId=e}get color(){return this._color}set color(e){this._color=e,this.emit("color-change",e)}get dataSetId(){return this._dataSetId}set dataSetId(e){this._dataSetId=e}get id(){return this._id}set id(e){this._id=e}get lineWeight(){return this._lineWeight}set lineWeight(e){this._lineWeight=e}get name(){return this._name}set name(e){this._name=e,this.emit("name-changed",e)}get points(){return this._points}set points(e){this._points=e,this.emit("points-changed",e)}get position(){return this._position}set position(e){this._position=e}get traceColId(){return this._traceColId}set traceColId(e){this._traceColId=e}get type(){return this._type}set type(e){this._type=e}};var kt={},gn={},os={},vn=n=>{let e={};for(let t=0;t<3;++t)e[`graph_${t+1}`]=t<=n.length-1;return e},qp=(n,e,t)=>n.createMeter({id:e.id,name:t.name,units:t.units,color:"red"}),Gp=(n,e,t,s)=>{let{connectLines:r,leftTraceColumnIds:i=[],rightTraceColumnIds:o=[]}=t,{drawLines:l,drawPoints:c,graphType:u="normal"}=t,p=i.map(y=>s.getColumnUdmId(y)),m=o.map(y=>s.getColumnUdmId(y));(!l||!c)&&(l=r,c=!r),gn[t.id]=t;let v={baseColumnId:s.getColumnUdmId(t.baseColumnId),leftUnits:[],leftColumnIds:p,rightColumnIds:m,options:{title:t.title,appearance:{lines:l,points:c,bars:u==="bar-chart"},baseRange:{min:t.baseMin,max:t.baseMax},leftRange:{min:t.leftTraceMin,max:t.leftTraceMax},rightRange:{min:t.rightTraceMin,max:t.rightTraceMax},graphType:u}},b=(y,w)=>{e.bind(t,`${y}-changed`,_=>{w(_),kt[t.id]=v;let T=Object.values(kt);n.emit("data-share-view-changed",{graphLayouts:T,appLayout:vn(T)})})};return b("title",y=>{v.options.title=y}),b("baseColumnId",y=>{let w=s.getColumnUdmId(y);w?v.baseColumnId=w:console.warn("baseColID changed to column without UDM backing")}),b("leftTraceColumnIds",y=>{let w=y.map(_=>s.getColumnUdmId(_));v.leftColumnIds=w}),b("right-trace-column-ids",y=>{v.rightColumnIds=y?.map(w=>s.getColumnUdmId(w))}),b("baseMin",y=>{v.options.baseRange.min=y}),b("baseMax",y=>{v.options.baseRange.max=y}),b("leftTraceMin",y=>{v.options.leftRange.min=y}),b("leftTraceMax",y=>{v.options.leftRange.max=y}),b("right-trace-min",y=>{v.options.rightRange.min=y}),b("right-trace-max",y=>{v.options.rightRange.max=y}),b("connectLines",y=>{v.options.appearance.lines=y,v.options.appearance.points=!y}),b("trace-drawing-style",y=>{v.options.appearance.lines=y.drawLines,v.options.appearance.points=y.drawPoints}),b("graphType",y=>{v.options.graphType=y,v.options.appearance.bars=y==="bar-chart"}),kt[t.id]=v,Object.values(kt)};var Fl=(n,e)=>{let t=new Se,s={};kt={},gn={},os={};let r=p=>{let m=s[p.meterColumnId],v=qp(n,p,m);os[p.id]={view:p,meterInstance:v},n.addMeter(v)},i=p=>{delete os[p.id],n.removeMeter(p.id)},o=p=>{let m=Gp(n,t,p,e);n.emit("data-share-view-changed",{graphLayouts:m,appLayout:vn(m)})},l=p=>{delete kt[p.id];let m=Object.values(kt);n.emit("data-share-view-changed",{graphLayouts:m,appLayout:vn(m)})},c=p=>{let m=null;return Object.keys(os).forEach(v=>{let b=os[v];m||b.view.meterColumnId===p&&(m=b)}),m},u={"column-added":p=>{s[p.id]=p,t.bind(p,"name-changed",m=>{let v=c(p.id);v&&(v.meterInstance.name=m)}),t.bind(p,"units-changed",m=>{let v=c(p.id);v&&(v.meterInstance.units=m)})},"column-removed":p=>{delete s[p.id]},"view-added":p=>{let{viewType:m}=p;m==="meter"?r(p):m==="graph"&&o(p),e.proc.refreshViews()},"view-removed":p=>{let{viewType:m}=p;m==="meter"?i(p):m==="graph"&&l(p)},"column-live-value-changed":(p,m)=>{let v=c(p.id);v&&(v.meterInstance.value=m)},"udm-column-added":p=>{Object.keys(kt).forEach(v=>{let b=kt[v];gn[v].baseColumnId===p.id&&(b.baseColumnId=e.getColumnUdmId(p.id))}),e.proc.refreshViews()}};return Object.keys(u).forEach(p=>{let m=u[p];t.bind(e,p,m)}),t.bind(n,"before-session-ended",()=>{Object.values(os).forEach(({meterInstance:p})=>n.removeMeter(p.id)),os={}}),t};var jl=le(_e());var Bl=le(_e()),Hp=0,bn=class extends Bl.default{constructor({apiId:e="",id:t=`${Hp++}`,name:s="Run",position:r=0,columnIds:i=[]}){super();this._apiId=e,this._id=t,this._name=s,this._position=r,this._columnIds=i,this._nativeId=""}update(e){Object.keys(e).forEach(t=>{this[t]!==e[t]&&(this[t]=e[t])})}get apiId(){return this._apiId}get id(){return this._id}get type(){return this._type}get name(){return this._name}set name(e){this._name=e,this.emit("name-changed",this.name)}get nativeId(){return this._nativeId}set nativeId(e){this._nativeId=e}get position(){return this._position}set position(e){this._position=e,this.emit("position-changed",e)}get columnIds(){return[...this._columnIds]}set columnIds(e){this._columnIds=e,this.emit("column-ids-changed",e)}};var Nl=le(_e()),Vp=0,yn=class extends Nl.default{constructor({apiId:e="",id:t=Vp++,color:s="",dataSetName:r="",formatStr:i,groupId:o,liveValue:l,liveValueTimeStamp:c=-1,position:u,setId:p="",symbol:m="circle",values:v=[],valuesTimeStamp:b=-1,name:y="",units:w=""}){super();this._apiId=e,this._id=t,this._liveValueTimeStamp=c,this._valuesTimeStamp=b,this._values=v,this._setId=p,this._symbol=m,this._groupId=o,this._dataSetName=r,this._color=s,this._liveValue=l,this._name=y,this._units=w,this._formatStr=i,this._position=u,this._nativeId=""}update(e){Object.keys(e).forEach(t=>{this[t]!==e[t]&&(this[t]=e[t])})}get apiId(){return this._apiId}get id(){return this._id}get color(){return this._color}set color(e){this._color=e,this.emit("color-changed",e)}get liveValue(){return this._liveValue}set liveValue(e){this._liveValue=e}get liveValueTimeStamp(){return this._liveValueTimeStamp}set liveValueTimeStamp(e){e>this.liveValueTimeStamp&&(this._liveValueTimeStamp=e,this.emit("live-value-changed",this.liveValue))}set dataSetName(e){this._dataSetName=e,this.emit("dataset-name-changed",e)}get valuesTimeStamp(){return this._valuesTimeStamp}set valuesTimeStamp(e){this._valuesTimeStamp=e}get values(){return this._values}set values(e){this._values=e,this.emit("values-changed",e)}set updatedRows(e){this._updatedRows=e,this.emit("updated-rows-changed",e)}get name(){return this._name}set name(e){this._name=e,this.emit("name-changed",e)}get nativeId(){return this._nativeId}set nativeId(e){this._nativeId=e}get units(){return this._units}set units(e){this._units=e,this.emit("units-changed",e)}get formatStr(){return this._formatStr}set formatStr(e){this._formatStr=e,this.emit("formatStr-changed",e)}get position(){return this._position}set position(e){this._position=e,this.emit("position-changed",e)}get setId(){return this._setId}set setId(e){this._setId=e,this.emit("set-id-changed",e)}get symbol(){return this._symbol}set symbol(e){this._symbol=e,this.emit("symbol-changed",e)}get groupId(){return this._groupId}set groupId(e){this._groupId=e,this.emit("group-id-changed",e)}};var $l=le(_e()),zp=0,Sn=class extends $l.default{constructor({apiId:e="",baseColumnId:t="",baseMax:s=10,baseMin:r=0,meterColumnId:i="",connectLines:o=!0,leftTraceColumnIds:l=[],leftTraceMax:c=10,leftTraceMin:u=0,id:p=zp++,viewType:m="",title:v="",drawLines:b=null,drawPoints:y=null,graphType:w="",rightTraceColumnIds:_=[],rightTraceMax:T=10,rightTraceMin:A=0}){super();this._apiId=e,this._baseColumnId=t,this._baseMax=s,this._baseMin=r,this._meterColumnId=i,this._connectLines=o,this._leftTraceColumnIds=l,this._leftTraceMax=c,this._leftTraceMin=u,this._id=p,this._viewType=m,this._title=v,this._drawLines=b,this._drawPoints=y,this._graphType=w,this._rightTraceColumnIds=_,this._rightTraceMax=T,this._rightTraceMin=A}update(e){Object.keys(e).forEach(t=>{this[t]!==e[t]&&(this[t]=e[t])})}get apiId(){return this._apiId}get baseColumnId(){return this._baseColumnId}set baseColumnId(e){this._baseColumnId=e,this.emit("baseColumnId-changed",e)}get baseMax(){return this._baseMax}set baseMax(e){this._baseMax=e,this.emit("baseMax-changed",e)}get baseMin(){return this._baseMin}set baseMin(e){this._baseMin=e,this.emit("baseMin-changed",e)}get meterColumnId(){return this._meterColumnId}set meterColumnId(e){this._meterColumnId=e,this.emit("meterColumnId-changed",e)}get connectLines(){return this._connectLines}set connectLines(e){this._connectLines=e,this.emit("connectLines-changed",e)}get drawLines(){return this._drawLines}set drawLines(e){this._drawLines=e,this.emit("trace-drawing-style-changed",{drawLines:e,drawPoints:this._drawPoints})}get drawPoints(){return this._drawPoints}set drawPoints(e){this._drawPoints=e,this.emit("trace-drawing-style-changed",{drawPoints:e,drawLines:this._drawLines})}get graphType(){return this._graphType}set graphType(e){this._graphType=e,this.emit("graphType-changed",e)}get id(){return this._id}set id(e){this._id=e,this.emit("id-changed")}get leftTraceColumnIds(){return this._leftTraceColumnIds}set leftTraceColumnIds(e){this._leftTraceColumnIds=e,this.emit("leftTraceColumnIds-changed",e)}get leftTraceMax(){return this._leftTraceMax}set leftTraceMax(e){this._leftTraceMax=e,this.emit("leftTraceMax-changed",e)}get leftTraceMin(){return this._leftTraceMin}set leftTraceMin(e){this._leftTraceMin=e,this.emit("leftTraceMin-changed",e)}get rightTraceColumnIds(){return this._rightTraceColumnIds}set rightTraceColumnIds(e){this._rightTraceColumnIds=e,this.emit("right-trace-column-ids-changed",e)}get rightTraceMax(){return this._rightTraceMax}set rightTraceMax(e){this._rightTraceMax=e,this.emit("right-trace-max-changed",e)}get rightTraceMin(){return this._rightTraceMin}set rightTraceMin(e){this._rightTraceMin=e,this.emit("right-trace-min-changed",e)}get title(){return this._title}set title(e){this._title=e,this.emit("title-changed",e)}get viewType(){return this._viewType}set viewType(e){this._viewType=e,this.emit("viewType-changed",e)}};function Vt(n){if(n===void 0)return n;if(typeof n!="string")return n.toString();let e=n.indexOf("-");return e===-1?n:parseInt(n.substring(e+1),16).toString()}function Kp(n,e){return n.getColumnById(e.id).then(s=>{let r=[],{values:i}=s;for(let o=0;o<i.length;++o)i[o]===null&&(i[o]=NaN),r.push(o);e.update({values:i,updatedRows:r})})}var tr=class{static create(e,t){let s=null,r=Ht.parseVersion(t.apiVers);return r.major===1&&r.minor===0&&(s=new tr(e,r)),s}constructor(e,t){return this.client=e,this.version=t,this.info=null,this.status=null,this.session={id:"",desc:""},this.collection=null,this.requestTimeStamp=-1,this.columnListTimeStamp=-1,this.viewListTimeStamp=-1,this.columns=[],this.dataSets=[],this.views=[],this}clear(){this.columns=[],this.dataSets=[],this.views=[],this.session={id:"",desc:""},this.collection=null,this.requestTimeStamp=-1,this.columnListTimeStamp=-1,this.viewListTimeStamp=-1}processInfo(e){return this.info=e,!0}processStatus(e){let t=Ut(e),s=this.columns;return this.status=t,Object.values(t?.views||{}).forEach(r=>{if(r.apiId=r.id,r.id=Vt(r.id),r?.baseColID&&(r.baseColumnId=Vt(r.baseColID),delete r.baseColID),r?.colID&&(r.meterColumnId=r.colID,delete r.colID),r?.leftTraceColIDs){r.leftTraceColumnIds=[];for(let i=0;i<r.leftTraceColIDs.length;++i)r.leftTraceColumnIds[i]=Vt(r.leftTraceColIDs[i]);delete r.leftTraceColIDs}r.rightTraceColumnIds=[],r?.rightTraceColIDs&&(r.rightTraceColIDs.forEach(i=>{r.rightTraceColumnIds.push(Vt(i))}),delete r.rightTraceColIDs)}),Object.entries(t?.sets||{}).forEach(([r,i])=>{i.apiId=r,i.id=Vt(r),i.columnIds=[];for(let o=0;o<i?.colIDs?.length;++o)i.columnIds[o]=Vt(i.colIDs[o]);delete i.colIDs}),Object.values(t?.columns||{}).forEach(r=>{r.apiId=r.id,r.id=Vt(r.id),r.setId=Vt(r.setID),r.groupId=r.groupID,delete r.setID,delete r.groupID}),this.requestTimeStamp=t.requestTimeStamp,this.checkSession({id:t.sessionID,desc:t.sessionDesc}),this.checkCollection(t.collection),this.checkDataSets(t.sets),this.checkColumnList(t.columnListTimeStamp,t.columns),this.checkViews(t.viewListTimeStamp,t.views),this.checkColumns(s,t.columns)}checkSession(e){this.session.id!==e.id&&(this.session.id=e.id,this.session.desc=e.desc,this.client.emitSessionChanged(this.session))}checkCollection(e){let t=!1;this.collection===null?(this.collection={},t=!0):(this.collection.isCollecting!==e.isCollecting||this.collection.canControl!==e.canControl)&&(t=!0),t&&(this.collection.isCollecting=e.isCollecting,this.collection.canControl=e.canControl,this.client.emitCollectionChanged(this.collection))}checkColumnList(e,t={}){let s=Ut(t);this.columnListTimeStamp!==e?(this.columnListTimeStamp=e,this.columns.forEach(r=>{s[r.apiId]||(this.columns=this.columns.filter(i=>i.id!==r.id),this.client.emitColumnRemoved(r),r.off())}),Object.keys(s).sort((r,i)=>{let o=s[r],l=s[i],c=this.dataSets.find(m=>m.id===o.setId),u=this.dataSets.find(m=>m.id===l.setId),p=c.position-u.position;return p===0&&(p=o.position-l.position),p}).forEach(r=>{let i=s[r],o=this.columns.find(c=>c.apiId===r),l=zt.checkColumnPending(r);if(o)delete i.liveValueTimeStamp,delete i.valuesTimeStamp,delete i.id,o.update(i);else if(!l){let c=this.dataSets.find(p=>p.id===i.setId)?.name,u=new yn(de(P({},i),{apiId:r,dataSetName:c}));this.columns.push(u),this.client.emitColumnAdded(u)}})):Object.values(s).forEach(r=>{let i=this.columns.find(o=>o.id===r.id);i&&(delete r.liveValueTimeStamp,delete r.valuesTimeStamp,delete r.id,i.update(r))})}checkColumns(e,t){let s=Ut(t),r=[];return Object.values(s).sort((i,o)=>i.position-o.position).forEach(i=>{let o=e.find(u=>u.id===i.id),l=!1,c=!1;o&&(l=o.liveValueTimeStamp!==i.liveValueTimeStamp,c=o.valuesTimeStamp!==i.valuesTimeStamp,c=c||o.valueCount!==i.valueCount,o.update({liveValueTimeStamp:i.liveValueTimeStamp,valuesTimeStamp:i.valuesTimeStamp})),l&&this.client.emitColumnLiveValueChanged(o,o.liveValue),c&&r.push(Kp(this.client,o))}),Promise.all(r)}checkDataSets(e){let t=Ut(e);this.dataSets.forEach(r=>{e[r.apiId]||(this.dataSets=this.dataSets.filter(i=>r.id!==i.id),this.emitDataSetRemoved(r),r.off())});let s=Object.keys(t);s.sort((r,i)=>{let o=t[r],l=t[i],c=o.position||0,u=l.position||0;return c<u?-1:c>u?1:0}),s.forEach(r=>{let i=t[r],o=this.dataSets.find(l=>l.apiId===r);if(o)o.update(i);else{let l=new bn(i);this.dataSets.push(l),this.client.emitDataSetAdded(l)}})}processViews(e,t){let s=Ut(t);this.views.forEach(i=>{s[i.apiId]||(this.views=this.views.filter(o=>o.id!==i.id),this.client.emitViewRemoved(i),i.off())});let r=this.client.getColumns();Object.values(s).forEach(i=>{let o=i.baseColumnId||i.meterColumnId,l,c,u=0;if(i.viewType==="graph"?c=i?.leftTraceColumnIds?.length+1:i.viewType==="meter"?c=1:console.warn(`Unsuported view type: ${i.viewType}`),r.forEach(p=>{p.nativeId&&(p.id===o&&(u++,l=p.nativeId),i?.leftTraceColumnIds?.forEach(m=>{p.id===m&&u++}))}),l&&u>=c)if(this.views.find(p=>p.id===i.id))this.views.find(p=>p.id===i.id)?.update(i);else{let p=new Sn(i);this.views.push(p),this.client.emitViewAdded(p)}}),this.viewListTimeStamp=e}checkViews(e,t){this.viewListTimeStamp!==e&&this.processViews(e,t)}refreshViews(){this.processViews(this.viewListTimeStamp,this.status.views)}};var Xp=1e3,je={DISCONNECTED:0,CONNECTED:1,ERROR:2},sr=[],zt=class extends jl.default{constructor(e,t={}){super();let s=e,r=null;if(this.usePollingTimer=!0,!s)throw new Error("No HTTP Module Specified");if(this.pollWaiting=!1,t.rtcClient){let{rtcClient:i}=t;s=i.createHttpShim(),this.usePollingTimer=!1,this.pollWaiting=!0,i.pollFunc=this._poll.bind(this)}Object.hasOwnProperty.call(t,"sourceName")&&(r=t.sourceName),this.serverURL=null,this.sourceName=r,this.http=s,this.state=je.DISCONNECTED,this.pollTimer=null,this.stopPolling=!1,this.proc=null,this.pollTimeoutMS=t.pollTimeoutMS||Xp,sr=[]}bind(e,t,s){this.on(e,t.bind(s))}getColumns(){let e=[];return this.proc&&(e=this.proc.columns),e}getColumnApiId(e){if(this.proc){let t=this.proc.columns.find(s=>s.id===e);if(t)return t.apiId}return e}getDataSets(){let e=null;return this.proc&&(e=this.proc.dataSets),e}getInfo(){let e=Ht.getInfoURL(this.serverURL);return this.http.getJSON(e)}getStatus(){let e=Ht.getStatusURL(this.serverURL);return this.http.getJSON(e,{timeout:15e3})}getColumnById(e){let t=Ht.getColumnURL(this.serverURL,this.getColumnApiId(e));return this.http.getJSON(t,{timeout:2e4})}getColumnUdmId(e){let t=this.getColumns(),s;return t.some(r=>r.id===e?(s=r.nativeId,!0):!1),s}_poll(){let{proc:e}=this,t=null;if(this.pollWaiting)return;let s=()=>{this.pollWaiting=!1},r=i=>{this.pollWaiting=!1,this._onError(i)};this.state===je.DISCONNECTED?(this.pollWaiting=!0,this.getInfo().then(i=>{this._processInfo(i)&&this._setState(je.CONNECTED),s(),this.usePollingTimer||this._poll()}).catch(i=>{r(i)})):this.state===je.CONNECTED&&(this.pollWaiting=!0,this.getStatus().then(i=>{e===this.proc&&(t=this.proc.processStatus(i))}).catch(i=>{r(i)})),t?t.then(s).catch(r):s()}_setState(e,t){let s=(r,i)=>this.state===r&&e===i;s(je.CONNECTED,je.DISCONNECTED)?this.emitDisconnect():s(je.DISCONNECTED,je.ERROR)||s(je.CONNECTED,je.ERROR)?(this.stopPolling=!0,this.emitError(t||new Error("Connection Error"))):(s(je.DISCONNECTED,je.CONNECTED)||s(je.ERROR,je.CONNECTED))&&(this.stopPolling=!1,this.emitConnect()),this.state=e}_onError(e){this._setState(je.ERROR,e)}_processInfo(e){let t=!1;if(this.proc=tr.create(this,e),this.proc)t=this.proc.processInfo(e);else throw new Error(`Unsupported API version: ${e.apiVers}`);return t}start(e,t){return new Promise((s,r)=>{let i=!0;this.stop().then(()=>{this.serverURL!==e&&(this.serverURL=e,this.emit("server-url-changed",e)),t?(this.emitRestored(),s()):this.getInfo().then(()=>{let o=()=>{this._poll(),this.usePollingTimer&&!this.stopPolling&&(this.pollTimer=setTimeout(o,this.pollTimeoutMS)),i&&(i=!1,s())};o()}).catch(o=>{r(o)})}).catch(()=>{console.error("Failed to start Data Share Client"),r(new Error("Failed to start Data Share Client"))})})}stop(){return new Promise(e=>{this.pollWaiting=!1,this.proc&&this.proc.clear(),this.pollTimer&&(clearTimeout(this.pollTimer),this.pollTimer=null,this._setState(je.DISCONNECTED),this.proc=null),e()})}requestStartCollection(){let e=Ht.getStartCollectionURL(this.serverURL);return this.http.getJSON(e)}requestStopCollection(){let e=Ht.getStopCollectionURL(this.serverURL);return this.http.getJSON(e)}static checkColumnPending(e){return sr.includes(e)}static addPendingColumn(e){sr.push(e)}static removePendingColumn(e){sr=sr.filter(t=>t!==e)}emitConnect(){this.emit("connect")}emitDisconnect(){this.emit("disconnect")}emitRestored(){this.emit("restored")}emitError(e){this.emit("error",e)}emitSessionChanged(e){this.emit("server-session-changed",e)}emitCollectionChanged(e){this.emit("server-collection-changed",e)}emitColumnAdded(e){this.emit("column-added",e),zt.addPendingColumn(e.id)}emitColumnRemoved(e){this.emit("column-removed",e)}emitUdmColumnAdded(e){this.emit("udm-column-added",e),zt.removePendingColumn(e.id)}emitDataSetAdded(e){this.emit("dataset-added",e)}emitDataSetRemoved(e){this.emit("dataset-removed",e)}emitColumnLiveValueChanged(e,t){this.emit("column-live-value-changed",e,t)}emitViewAdded(e){this.emit("view-added",e)}emitViewRemoved(e){this.emit("view-removed",e)}};var Wl=["color","formatStr","liveValue","liveValueTimeStamp","name","position","units","symbol"],Jp=["name","units","formatStr"];function Zp(n){let e=parseFloat(n.replace(/^%0?./,""));return Number.isNaN(e)&&(e=1),{precision:e,automatic:!1,useSciNotation:!1,useSigFigs:!1}}function Qp(n,e,t){function s(i,o){if(Jp.includes(i)){let l={};i==="formatStr"?l.precision=Zp(o):l[i]=o,n.updateColumnGroup(t.groupId,l)}else t[i]=e[i]}function r(i){s(i,e[i]),e.on(`${i}-changed`,o=>s(i,o))}Wl.forEach(i=>r(i)),e.on("values-changed",i=>{let o=i.map((l,c)=>c);t.values=i,t.updatedRows=o}),e.on("dataset-name-changed",i=>{t.emit("dataset-name-changed",i)})}function Yp(n,e,t){function s(i){t[i]=e[i],e.on(`${i}-changed`,o=>{let l={};l[i]=o,n.updateDataSet(t.id,l)})}s("position"),s("name");function r(i){let o=t.columnIds.map(c=>{let u=n.getColumnById(c);if(u&&u.foreignId)return`${u.foreignId}`});Wa(o,i).forEach(c=>{n.removeInternalColumn(c)})}r(e.columnIds),e.on("column-ids-changed",i=>{r(i)})}var as=class{constructor({dataWorld:e,udm:t}){this.client=null,this.dataWorld=e,this.dataCollection=e.dataCollection,this.udm=t,this.clientEventBinder=null,this.dwEventBinder=null,this.serverSessionID=null,this.collection={}}async start(e={}){console.assert(!this.client);let{dataCollection:t,dataWorld:s}=this;this.client=new zt(Wt,e),this.dwEventBinder=new Se;let{client:r}=this;if(this.dwEventBinder.on(s,"dataset-added",i=>{let o=`${i.foreignId}`,l=r.getDataSets(),c;l.forEach(u=>{u.id===o&&(c=u,c.nativeId=i.id)}),c?Yp(s,c,i):console.error("Failed to locate dataset")}),this.dwEventBinder.on(s,"column-added",i=>{let o=`${i.foreignId}`,l=r.getColumns().find(c=>c.id===o);l?(l.nativeId=i.id,l.nativeGroupId=i.groupId,Qp(s,l,i),this.client.emitUdmColumnAdded(l),setTimeout(()=>{let c=l.values||[],u=c.map((p,m)=>m);i.values=[...c],i.updatedRows=[...u]})):console.warn("Failed to locate column")}),this.clientEventBinder=this._bindClientEvents(),s.emit("collection-keep-changed",!1),this.sourceName=e.sourceName,this.sourceURI=e.sourceURI,e.imported){s.emit("collection-control-changed",!1),this.client.sourceName=this.sourceName;try{await t.sessionRestoring(e),this.restoredSession=!0}catch(i){throw new Error(i)}}else{let i={empty:!0,sessionType:"DataShare",sourceURI:e.sourceURI,sourceName:e.sourceName,experimentId:e.experimentId};try{await t.sessionStarting(i),await this.client.start(this.sourceURI,e.imported)}catch(o){console.error(o)}}}stop(){console.assert(this.client);let{dataCollection:e}=this;return this.dwEventBinder.unbindAll(),e.sessionClosing(),new Promise((t,s)=>{let r=()=>{this.client=null,t.apply(this,arguments)},i=()=>{s.apply(this,arguments),this.client=null};this.clientEventBinder.unbindAll(),this.clientEventBinder=null,this.client.stop().then(r,i)})}startCollection(){return new Promise((e,t)=>{this.client?this.client.requestStartCollection().then(()=>{e()}).catch(s=>{console.error("Failed to start collection on DataShareClient"),t(s)}):t()})}stopCollection(){return new Promise((e,t)=>{this.client?this.client.requestStopCollection().then(()=>{e()},s=>{console.error("Failed to stop collection on DataShareClient"),t(s)}):t()})}_bindClientEvents(){let{client:e,dataWorld:t}=this,s=Fl(t,e),r={connect:function(){},restored:function(){t.emit("session-source-name-changed",t.sessionSourceName)},error:function i(i){t.emit("session-connection-error",i)},"server-session-changed":function(o){this.serverSessionID===null?this.serverSessionID=o.id:this.serverSessionID!==o.id&&(s.unbindAll(),t.emit("session-remote-id-changed"),this.client.stop().catch(l=>{console.error("Failed to stop client: ",l)}))},"server-collection-changed":function(o){let l=this.collection.canControl!==o.canControl,c=this.collection.isCollecting!==o.isCollecting;this.collection=St(o),l&&t.emit("collection-control-changed",o.canControl),c&&(o.isCollecting?(t.notifyCollectionPreparing(),t._notifyCollectionStarted()):t._notifyCollectionStopped(),t.isCollecting=this.collection.isCollecting)},"dataset-added":function(o){t.createNewDataSet({foreignId:o.id,name:o.name})},"dataset-removed":function(o){let l=o.nativeId||o.id;t.removeInternalDataSet(l)},"column-added":function(o){let l={};Object.keys(o).forEach(c=>{Wl.includes(c)&&(l[c]=o[c])}),l.foreignId=o.id,l.foreignGroupId=parseInt(o.groupId),l.foreignSetId=parseInt(o.setId),l.editable=!1,l.deletable=!1,l.name=o.name,t.createNewColumn(l)},"column-removed":function(o){let l=o.nativeId||o.id;t.removeInternalColumn(l,!0)}};return Object.keys(r).forEach(i=>{let o=r[i];s.bind(e,i,o.bind(this))}),s}};var Ul=new Se;function rr(n,e,t){let s=e.group;t&&(n.wavelength=t.wavelength,n.sensorId=t.id,n.experimentId=t.experimentId,n.sensorAutoId=t.autoId,n.sensorName=t.name,n.addBinding(r=>{r.bind(t,"wavelength-changed",i=>{i&&(n.wavelength=i,n.name=s.name)})})),n.name=s.name,n.units=s.units,n.id=s.meterId,n.groupId=s.id,n.columnId=e.id,n.visible=s.metered,e.color&&(n.color=e.color),n.addBinding(r=>{r.bind(s,"name-changed",()=>{n&&(n.name=s.name)})}),n.addBinding(r=>{r.bind(s,"units-changed",i=>{n&&(n.units=i)})}),n.addBinding(r=>{r.bind(e,"live-value-changed",i=>{n&&(n.value=e.getFormattedValue(i))})})}async function em(n,e,t,s=null){let{group:r}=t,i=e.find(c=>`${c.columnId}`===t.id||r.meterId===c.id),o=null;if(i)if(o=n.getMeterById(i.id),!o)o=n.createMeter(),rr(o,t,s),o.importUdm(i),await n.addMeter(o,!0);else{if(rr(o,t,s),n.meterRule===Ke.Rule.DEFAULT){let l=i,{columnId:c}=l,u=Ba(l,["columnId"]);o.importUdm(c===o.columnId?i:u)}else o.visible=i.visible;await n.updateMeter(o)}else o=n.createMeter(),rr(o,t,s),n.meterRule===Ke.Rule.USER&&(o.visible=!1,o.position=null),await n.addMeter(o);return r.meterId=o.id,await n.updateColumnGroup(r.id,{meterId:r.meterId}),o}async function tm(n,e){let t=l=>{let c=[];for(let u=0;u<l.length;++u)c.push(n.getColumnById(l[u]));return c};if(!n.currentDataSet)return;let s=l=>l.map(n.getColumnGroupById.bind(n)),r=t(n.currentDataSet.columnIds),i=[],o=await n.getStoredMeterInfo();Ul.unbindAll(),await Promise.all(r.map(async l=>{let{sensorId:c}=l,u;if(typeof c=="number"&&c!==0)u=e.getSensorById(c);else if(l.type==="calc"){let m=l.group;if(m&&m.calcDependentGroups.length){let v=n.getColumnGroupById(m.calcDependentGroups[0]),b=v?v.sensorId:null;typeof b=="number"&&c===0&&(u=e.getSensorById(b))}}let p=await em(n,o,l,u);i.push(p.id),Ul.bind(l.group,"metered-changed",m=>{n.meterRule!==Ke.Rule.USER&&(p.visible=m,n.setMeterPosition(p))}),l.replaceDependent&&!l.group.isUserCreated&&s(l.group.calcDependentGroups).forEach(v=>{l.metered&&n.updateColumnGroup(v.id,{metered:!1})})})),n.meters.map(l=>l.id).filter(l=>!i.includes(l)).forEach(l=>{n.removeMeter(l)})}var wn=!1,xn=!1;async function Hr(n,e){if(wn){xn=!0;return}wn=!0;try{await tm(n,e)}catch(t){console.error(t)}wn=!1,xn&&(xn=!1,await bs(),Hr(n,e))}var Kt;async function sm(n,e){let{dataWorld:t,sensorWorld:s,dataCollection:r}=e;function i(u){let{mode:p}=r,m=!0,v=!1;p.match("events")?v=!0:(p.match("drop-counting")&&s.sensors.length<2||t.sessionType==="ManualEntry")&&(m=!1),u&&((s.ignoreSensors||s.sensors.length<1)&&(m=!1),t.emit("collection-control-changed",m),t.canCollect=m),t.emit("collection-keep-changed",v)}Kt=new Se;let o=null,l=()=>{function u(){Hr(t,s)}o&&(clearTimeout(o),o=null),o=setTimeout(()=>{u(),o=null},300)},c=()=>{t.isSessionEmpty&&r.timeUnits!=="s"&&(r.timeUnits="s")};i(!0),n&&(n.restored||n.imported)&&i(),Kt.on(t,"column-added",()=>{l()}),Kt.on(t,"column-removed",()=>{l()}),Kt.on(s,"sensor-added",()=>{i(!0),l(),c()}),Kt.on(s,"sensor-removed",()=>{i(!0),l(),c()}),Kt.on(r,"collection-mode-changed",u=>{let p=u.from.match("events")&&u.to.match("events");i(!p)}),Kt.on(t,"meter-visibility-changed",()=>{l()}),n.imported?await Hr(t,s):l()}async function rm(n,e){await sm(n,e)}function im(){Kt.unbindAll()}var Xt={init:rm,uninit:im};var ir=class{constructor({dataWorld:e,udm:t}){this.dataWorld=e,this.sensorWorld=e.sensorWorld,this.dataCollection=e.dataCollection,this.udm=t,this.restoredSession=!1}async start(e){let{dataWorld:t,sensorWorld:s,dataCollection:r,udm:i}=this,o={dataWorld:t,sensorWorld:s,dataCollection:r,udm:i};e.experimentId=this.experimentId;try{return e?.imported?(await this.dataCollection.sessionRestoring(e),this.restoredSession=!0,await Xt.init(e,o),await t.importedSessionFullySetup(),!0):(Xt.init(e,o),this.dataCollection.sessionStarting(e))}catch(l){return console.error(l),l}}async stop(){try{await this.stopCollection(!0),await this.dataCollection.sessionClosing(),Xt.uninit()}catch(e){console.error(e)}}async startCollection({appendToDataSet:e}={}){let{dataWorld:t,dataCollection:s}=this,r=t.currentDataSet&&t.isCurrentDataSetEmpty(!0)||e;if(t.isCollecting)throw new Error("Collection is already running");r||await t.createNewDataSet(),t.notifyCollectionPreparing(),await s.startMeasurements()}stopCollection(e){let{dataWorld:t,dataCollection:s}=this;return new Promise((r,i)=>{t.isCollecting?s.stopMeasurements(e).then(()=>{t._notifyCollectionStopped(),r()},i):r()})}setupSessionFile(){let{dataCollection:e}=this,t=e.mode,s=e.paramsLookup[t]||{};s.continuous=!0,e.setCollectionParams(t,s)}};var nr=class{constructor({dataWorld:e,udm:t}){this.dataWorld=e,this.sensorWorld=e.sensorWorld,this.dataCollection=e.dataCollection,this.udm=t,this.restoredSession=!1}async start(e){let{dataWorld:t,sensorWorld:s,dataCollection:r,udm:i}=this,o={dataWorld:t,sensorWorld:s,dataCollection:r,udm:i};try{!e?.restored&&!e?.imported?(await this.dataCollection.sessionStarting(e),Xt.init(e,o)):(await this.dataCollection.sessionRestoring(e),this.restoredSession=!0,await Xt.init(e,o),await bs(300),await t.importedSessionFullySetup())}catch(l){console.error(l)}}async stop(){let{dataCollection:e}=this;try{await e.sessionClosing(),Xt.uninit()}catch(t){console.error(t)}}};var nm={datacollection:ir,datashare:as,manualentry:nr};async function ql(n,e="",t){if(!t.experimentId){let{dataWorld:i}=n,l=await i.dataCollection.createExperiment();t.experimentId=l.experimentId}let s=null,r=nm[e.toLowerCase()];if(typeof r=="function")try{s=new r(n,t),s.experimentId=t.experimentId}catch(i){console.error(`Creating Session: ${e} failed:`),console.error(i)}return s}var Gl=class{constructor(e){this._firstTime=!0;this._completion=()=>{};this._completion=qt(()=>{e(this._firstTime),this._firstTime=!1})}get completion(){return()=>{this._completion(),this._completion=null}}};function Vr(n){return new Gl(n).completion}var Hl=["application/x-gambl","application/x-vmbl"],ct=()=>{let n="gambl";switch("GA"){case"SA":n="smbl";break;case"VA":n="vmbl";break;case"IA":n="imbl";break;default:n="gambl"}return n};function Vl(n){let e=n.split(".");return e[e.length-1]}var It=n=>n==="csv"?"text/csv":n==="png"?"image/png":n==="imbl"?"application/x-imbl":n==="vmbl"?"application/x-vmbl":n==="gambl"?"application/x-gambl":n==="smbl"?"application/x-smbl":n==="pdf"?"application/pdf":"application/xml";function zl({mimetype:n,extension:e}){if(window.cordova)return!Hl.includes(It(e));let t=n||It(e);return!Hl.includes(t)}var Kl=()=>{let n=["csv"];switch("GA"){case"GA":n=["gambl","ambl","smbl","imbl","qmbl"];break;case"SA":n=["smbl"];break;case"VA":n=["vmbl"];break;case"IA":n=["imbl"];break;default:n=["ambl"]}return n},zr=(n,e)=>{let t=(i=4)=>{let o="0123456789",l="";for(let c=0;c<i;++c)l+=o.charAt(Math.floor(Math.random()*o.length));return l},r=`${((i,o)=>i.split(`.${o}`)[0])(n,ct())}`;return e&&(r=`${r}_${t()}`),r};function Kr(n){return new Promise((e,t)=>{let s=new FileReader;s.onload=r=>{e(r.target.result)},s.onerror=r=>t(r),s.onabort=r=>t(r),s.readAsArrayBuffer(n)})}function Xl(n){return new Promise((e,t)=>{let s=new FileReader;s.onload=r=>{e(r.target.result)},s.onerror=r=>t(r),s.onabort=r=>t(r),s.readAsText(n)})}var Xr=class extends bl{constructor(e={}){super(e);this._id=e.id||0,this._dataSetId=e.dataSetId||0,this._type=e.type||Xr.COLLECTED,this._rowIndex=e.rowIndex||0,this.text=e.text||"",this._hasMoved={},console.assert(typeof this.text=="string"),lt(this,{text:ye,udmExport:Js,rowIndex:Js,setText:fe,udmImport:fe})}setText(e){this.text=e,console.assert(typeof this.text=="string")}get id(){return this._id}getHasMoved(e){return e in this._hasMoved?this._hasMoved[e]:!1}setHasMoved(e,t){this._hasMoved[e]=t}get type(){return this._type}get dataSetId(){return this._dataSetId}get setId(){return this._dataSetId.toString()}get rowIndex(){return this._rowIndex}set rowIndex(e){if(this._type!==Xr.USER_TAGGED)throw new Error("Cannot change rowIndex of collected DataMark.");this._rowIndex=e}get udmExport(){return de(P({},this.mixinUdmExport),{id:parseInt(this._id),dataSetId:parseInt(this._dataSetId),type:this._type,rowIndex:this.rowIndex,text:this.text})}udmImport(e){let{text:t=null}=e;t&&this.setText(t),super.udmImport(e)}},ls=Xr;ls.COLLECTED="collected",ls.USER_TAGGED="user-tagged";var Jr=class{constructor(e){this.id=0;this.fitType=is.LINEAR;this.customEq="";this.graphId=null;this.baseColumnId=null;this.yColumnId=null;this.coefficients=[];this.uncertainties=[];this.rmse=0;this.correlation=0;this.showUncertainty=!1;this.infoBox={x:0,y:0,isCollapsed:!1};this.range={min:0,max:1};Qa(this,{id:!1}),Object.assign(this,e)}get udmExport(){return Fr(this)}setStats({rmse:e,correlation:t}){e!==void 0&&(this.rmse=e),t!==void 0&&(this.correlation=t)}};var Zl=5e3,om="Untitled";function am(n,e){let t=Ct.convertTimeUnits(e.timeBasedParams.delta,"s",n),s="%.0f";return t>0&&t<1&&(s=`%.${Math.ceil(Math.abs(Math.log10(t)))}f`),s}function G(n){return parseInt(n,10)}function Ql(n,e){let t=Ct.convertTimeUnits(e.timeBasedParams.delta,"s",n);return t>0&&t<1?Math.ceil(Math.abs(Math.log10(t))):0}function Yl(n){let[,e]=M("Data Set %d").match(/^(.*)%d/),t=new RegExp(`^${e}(\\d*)`),[,s]=n.name.match(t)||[];return Number.parseInt(s)}var tt=class extends Jl.default{constructor(e){super();this._dataMarks=[];this.annotations=[];this.manualFits=[];this.api=e.api,Object.keys(Ki).forEach(t=>this.api.on(t,Ki[t].bind(this))),this._userConstants=[],this._blockSynced=!1,this._isCollecting=!1,this.session=null,this.sensorWorld=e.sensorWorld,this.dataCollection=e.dataCollection,this.udm=e.udm,this.power=e.power,this.appManifest=e.appManifest,this.popoverManager=e.popoverManager,this.ignoreNameChanges=!1,this.timeUnits=null,this._getTimeFormatStr=am,this._getTimeFormatPrecision=Ql,this.keepAwakeTimeout=null,this.autoSavePending=!1,this.autoSaveTimer=null,this.enableAutoSave=!0,this.dataSets=[],this.columns=[],this.columnGroups=[],this.meters=[],this.spectrums=[],this._graphInfos={},this._graphIdMap=[],this.columnGroupIndices={},this.userFileMetaData={filepath:"",age:0},this._sessionSubtype="",this._specialDataSetTransactionCounter=0,this.seenBaseCol={},this.seenTraceCol={},this.videoAttachmentImportHook=!1,this.dataCollection.on("start-measurements-failed",()=>{this._notifyCollectionStopped()}),this.dataCollection.on("time-units-changed",t=>{let s=this.columnGroups.find(r=>r.type==="time");if(s){s.units=t;let r=s.columns[0];r&&this.changeColumnUnit(r.id,t)}this.timeUnits=t}),this.dataCollection.on("collection-params-changed",t=>{if(t.mode==="time-based"&&this.isSessionEmpty){let r=this.columnGroups.find(i=>i.type==="time");if(r){let i=Ql(this.timeUnits,this.dataCollection);r.precision.update({precision:i})}}let s=t.params;s&&s.triggering&&(this.isTriggeringEnabled=s.triggering.enabled)}),this.dataCollection.on("device-detached",()=>{this.isCollecting&&this.stopCollection()}),this.on("column-group-name-changed",(t,s,r)=>{let i=l=>{let c=RegExp('"[^"]+"',"g"),u,p="",m=0;for(;(u=c.exec(l))!==null;){let v=u[0],b=c.lastIndex-v.length,y=c.lastIndex;p+=l.substring(m,b),v===`"${r}"`?p+=`"${s}"`:p+=l.substring(b,y),m=y}return m!==l.length&&(p+=l.substring(m)),p};this.columnGroups.filter(l=>l.customEq).forEach(l=>{let c=i(l.customEq);this.updateEquation(l,c)})}),this.currentDataSet=null,lt(this,{_dataMarks:ye,manualFits:ye,meters:ye,annotations:ye,addDataMark:fe,removeDataMark:fe,removeGraphManualFit:fe,_internalCreateDataMark:fe,_addManualFit:fe,_cleanupSession:fe,addMeter:fe,removeMeter:fe}),this._meterRule=Ke.Rule.DEFAULT}get _blockSynced(){return this.__blockSynced}set _blockSynced(e){this.__blockSynced=e,this.emit("block-synced",e)}get blockSynced(){return this.__blockSynced||!window.__isSessionClient?Promise.resolve(!0):new Promise(e=>{this.once("block-synced",t=>e(t))})}get isCollecting(){return this._isCollecting}set isCollecting(e){this._isCollecting=e,this.emit("is-collecting-changed",e)}get predictions(){return this.getSpecialDataSets().filter(e=>e.type==="prediction")}get graphMatches(){return this.getSpecialDataSets().filter(e=>e.type==="graph-match")}get experimentId(){return this.session?.experimentId}setFileIO(e){this.fileIO=e}getSession(){return this.session}_deleteAnnotationsWithNoData(){let e=new Set;this.annotations.forEach(t=>{t.type===tn.POINT&&t.targetRecords.every(s=>{let i=this.getColumnById(s.columnId).values[s.pointIndex];return $r.isValueEmpty(i)})&&e.add(t),t.type===tn.RANGE&&t.targetRecords.every(s=>this.getColumnById(s.columnId).values.slice(s.rangeStartIndex,s.rangeEndIndex+1).every($r.isValueEmpty))&&e.add(t)}),e.forEach(t=>this.removeGraphAnnotation(t))}setupSession(){try{console.warn("FIXME: remove this function -- components need to handle session-started event"),this.importing?this.importing=!1:this.session.setupSessionFile&&this.session.setupSessionFile()}catch(e){console.error("Failed to setup Session File"),console.error(e)}}getColumnGroupIndex(e){let t=this.columnGroupIndices;return qa(t[e])?1:t[e]}_incrementColumnGroupIndex(e){let t=this.getColumnGroupIndex(e)+1,s=this.columnGroupIndices;return s[e]=t,t}async sessionStarted(e){if(console.assert(this.sessionConfig),this.sessionConfig.fileFormat=e.fileFormat,this._userConstants=await this.api.getUserConstants(this.experimentId),this.sessionConfig.imported){let r=this.columnGroups.filter(i=>i.customEq).map(i=>this.updateEquation(i,null,!0));await Promise.all(r)}this.emit("session-started",this.sessionConfig);let t=this.sessionConfig.sessionFileFullPath||"";try{let s=await this.getDocumentAge();this.updateUserMetaData(t,s)}catch(s){console.error(s),this.updateUserMetaData(t,1)}}async importedSessionFullySetup(){let e=await this.getDocumentAge();this.updateUserMetaData(void 0,e)}async resetSession(e){this.startNewSession(e,void 0,void 0,!0)}async startNewSession(e="DataCollection",t={type:e},s="",r){let i,o=e,l=s;if(!await this._confirmNewSession())return i;let u=P({},t);this.udm.isBlock&&this.sessionConfig&&(u=this.sessionConfig??u,o=this.sessionConfig?.sessionType??o,l=this.sessionConfig?.sessionSubtype??l);let{sensorWorld:p}=this,m=u.ignoreSensors||u.type==="manual"||u.type==="DataShare",v=async()=>{r||console.assert(!this.session);let{udm:b}=this;try{if(this.session=await ql({dataWorld:this,udm:b},o,u),this.sessionName=u?.sessionName||M(om),this.session){if(Nr.functionList.length===0){let y=await this.getCalcColumnFunctions();Nr.initializeFunctions(y)}u.initialDataSetName=mt(M("Data Set %d"),1),u.sessionType=o,u.sessionSubtype=l,this.sessionSubtype=l,this.sessionConfig=u,this.emit("before-session-started",u),await p.setIgnoreAddedSensors(this.experimentId,m),await this.session.start(u)}}catch(y){this.session=null,console.error(y)}return this.session};if(this.emit("before-session-ended",u),this.udm.isBlock||await this.closeSession(),i=await v(),u.imported)try{let b=await this.getPageAttributes();this.emit("view-changed",b.attributes)}catch(b){throw new Error(b)}return i}promptCollectingConfirmNewSession(){return new Promise(e=>{let t={resolution:e,appName:this.appManifest.getAppName()};this.emit("prompt-collecting-confirm-new-session",t)})}async _confirmNewSession(){if(this.isCollecting&&this.sessionType==="DataCollection"){let e=await this.promptCollectingConfirmNewSession();return e.confirmed&&this.stopCollection(),e}return!0}async checkForSave(){try{return(await this._confirmNewSession()).cancelled?{cancelled:!0}:await this.getDocumentAge()!==this.userSessionAge&&!this.isSessionEmpty?{save:!0}:{}}catch(e){return{error:e}}}_cleanupSession(){if(this.session){this.columnGroupIndices={};let e=[].concat(this.dataSets,this.columns,this.columnGroups,this.meters);this.dataSets.forEach(t=>{this.removeInternalDataSet(t.id)}),this.meters=[],this.columns=[],this.dataSets=[],this.columnGroups=[],this.spectrums=[],this._graphInfos={},this._graphIdMap=[],this.currentDataSet=null,this.autoSavePending=!1,this.autoSaveTimer=null,this._sessionSubtype="",this.sessionConfig=void 0,this._meterRule=Ke.Rule.DEFAULT,Object.values(tt._autorunStopFunctions).forEach(t=>t()),tt._autorunStopFunctions={},Re(()=>{this._dataMarks=[],this.manualFits.length=0,this.annotations.length=0}),e.forEach(t=>t.off()),this.isCollecting=!1,this.emit("session-ended")}}get isSessionEmpty(){let e=this.getAllDataSets(),t=!1,s;if(e.length<2&&e[0]){s=e[0].columnIds,t=!0;for(let r=0;r<s.length&&t;++r){let i=this.getColumnById(s[r]);t=i.values.length===0&&!i.frozen}}else e.length===0&&(t=!0);return t}isCurrentDataSetEmpty(e){if(!this.currentDataSet)return!0;let t=this.currentDataSet.columnIds;function s(i){let o=i.values.length===0;return o||(o=i.values.every(l=>Number.isNaN(l)||l===null)),o}return t.map(i=>this.getColumnById(i)).filter(i=>e?i.type==="sensor":!0).every(i=>s(i))}closeSession(){let e=()=>{try{this._cleanupSession()}catch(t){console.error("Error cleaning up session:"),console.error(t)}};return new Promise((t,s)=>{this.session||t();let r=new Se,i=()=>{e(),r.unbindAll(),this.session=null,t.apply(this,arguments)},o=()=>{e(),r.unbindAll(),this.session=null,s.apply(this,arguments)},{session:l}=this;clearTimeout(this.autoSaveTimer),this.autoSaveTimer=null,(async()=>{if(l){this.sessionClosing=!0;try{await l.stop(),this.emit("session-closing"),this.meters.forEach(c=>{c.experimentId===l.experimentId&&this.removeMeter(c.id)}),this.sensorWorld.clearExperiment(l.experimentId),this.sessionClosing=!1,i()}catch(c){console.error(c),o()}}else this.sessionClosing=!1,i()})()})}async updateEquation(e,t=null,s=!1){let r=t||e.customEq,i=this.parseCustomEquation(r);await this.updateColumnGroup(e.id,{calcDependentGroups:e.calcDependentGroups,calcCoefficients:e.calcCoefficients,calcEquation:e.calcEquation,calcCustomEq:{equStr:r,parsed:i},suppressUpdate:s})}startCollection(e){let t=this.getSession();t&&typeof t.startCollection=="function"&&(this._notifyCollectionTriggered(),t.startCollection(e).then(()=>{this.isCollecting=!0}).catch(s=>{console.error(s),this._notifyCollectionStopped()}))}async stopCollection(){let e=this.getSession();return e&&typeof e.stopCollection=="function"?e.stopCollection().then(()=>{this.isCollecting=!1}).catch(()=>{console.error("stopCollection failed")}):!0}async requestAutoSave(){if(this.session&&!this.autoSavePending&&!this.isSessionEmpty){this.autoSavePending=!0;let{entry:e}=this.file,{age:t}=this.userFileMetaData;try{let s=await this.autoSaveData({filename:e.name,filepath:e.filepath||e.fullPath,age:t});return console.assert(s.blob),s.age>t&&await this.fileIO.writeFile({fileHandle:e,filepath:e.filepath,blob:s.blob}),this.autoSavePending=!1,this.emit("auto-save-completed"),!0}catch(s){return this.autoSavePending=!1,this.emit("auto-save-failed"),!1}}return Promise.resolve()}triggerPrestore(){this.emit("collection-prestore-reached")}createAutoSaveTimer(){let e=()=>{this.enableAutoSave&&this.requestAutoSave(),this.autoSaveTimer=setTimeout(e,Zl)};this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout(e,Zl)}getColumns(){return this.columns.filter(e=>!e.special)}getSpecialColumns(){return this.columns.filter(e=>e.special)}getAllColumns(){return this.columns}getColumnById(e){let t=e;return t!==void 0&&(t=`${e}`),this.getAllColumns().find(s=>s.id===t)}getColumnForGroupAndSet(e,t){return e==null?null:this.getAllColumns().find(s=>s.setId==t&&s.groupId==e)}getColumnForSet(e,t=this.currentDataSet?.id){return e?this.getAllColumns().find(s=>s.setId==t&&s.groupId==e.groupId):null}getColumnsForSet(e){let t=this.getColumnGroups(),s=[];return t.forEach(r=>{r.columns.forEach(i=>{i.setId===e&&s.push(i)})}),s}getOrderedColumnsForSet(e){let t=this.getDataSetByID(e);return t?t.columnIds.map(s=>this.getColumnById(s)):[]}getDataSets(){return this.dataSets.filter(e=>e.type==="regular")}getSpecialDataSets(){return this.dataSets.filter(e=>e.type!=="regular")}getAllDataSets(){return this.dataSets}getDataSetsOfType(e){return this.dataSets.filter(t=>t.type===e)||[]}getDataSetByID(e){return this.dataSets.find(t=>t.id===`${e}`)}getColumnGroupById(e){return this.columnGroups.find(t=>t.id===e)}getColumnGroups(){return this.columnGroups}getPageAttributes(e={}){return this.api.getPageAttributes(P({experimentId:this.experimentId},e))}async setExperimentName(e){try{return await this.archive&&await this.archive.setExportName(e),this.sessionName=e,this.api.setExperimentName({experimentId:this.experimentId,name:e})}catch(t){return console.error(t),t}}calculateSparkLine(e,t,s){return this.api.calculateSparkLineForColumn({experimentId:this.experimentId,baseColId:G(e),traceColId:G(t),pixelWidth:s})}getDataShareSource(e,t){let s=e||this.experimentId,r=parseInt(t);return this.api.getDataShareSource({experimentId:s,sourceId:r})}applyDataSetNameSuffix(e,t=""){let s=this.getDataSetByID(e)||{},r=Yl(s);if(r){let i=mt(M("Data Set %d"),r);this.updateDataSet(e,{name:`${i}${t}`})}}_getNextRegularSetName(){let e=this.dataSets.filter(r=>r.type==="regular").length,t=this.dataSets.map(r=>Yl(r)).filter(r=>Number.isFinite(r)),s=Math.max(...t,e)+1;return mt(M("Data Set %d"),s)}createNewDataSet(e={}){let t=P({experimentId:this.experimentId},e);return t.foreignId&&(t.foreignId=G(e.foreignId)),t.name||(t.name=this._getNextRegularSetName()),this.api.createNewDataSet(t)}createNewColumn(e={}){let t=P({experimentId:this.experimentId},e);return e.foreignId&&(t.foreignId=G(e.foreignId)),e.foreignGroupId&&(t.foreignGroupId=G(e.foreignGroupId)),e.foreignSetId&&(t.foreignSetId=G(e.foreignSetId)),this.api.createNewColumn(t)}createManualColumnGroup({name:e,units:t,precision:s,automaticPrecision:r,sourceColumnId:i,dataType:o=cl.NUMERIC,errorBarColumnId:l,errorBarType:c,errorBarValue:u,metered:p=!1}={}){return this.api.createManualColumnGroup({experimentId:this.experimentId,name:e,unit:t,precision:s,automaticPrecision:r,previousId:G(i),dataType:o,errorBarColumnId:l,errorBarType:c,errorBarValue:u,metered:p}).then(m=>(this._incrementColumnGroupIndex("manual"),this.getColumnGroupById(m.groupId)))}createCalcColumnGroup({name:e,units:t,precision:s,automaticPrecision:r,sourceColumnId:i,calcEquation:o,calcDependentGroups:l,calcCoefficients:c,calcCustomEq:u,errorBarColumnId:p,errorBarType:m,errorBarValue:v,metered:b=!1}={}){return this.api.createUserCalcColumnGroup({experimentId:this.experimentId,name:e,unit:t,previousId:G(i),precision:s,automaticPrecision:r,calcEquation:o,calcDependentGroups:l,calcCoefficients:c,calcCustomEq:u,errorBarColumnId:p,errorBarType:m,errorBarValue:v,metered:b}).then(y=>(this._incrementColumnGroupIndex("calc"),this.getColumnGroupById(y.groupId)))}removeColumnGroup(e){let t={experimentId:this.experimentId,groupId:parseInt(e)};return this.api.removeColumnGroup(t).then(s=>s)}async updateColumnAppearance(e,t,s){let r={};t&&(r.color=rl(t)),s&&(r.symbol=ja(s));try{await this.changeColumnProperties(e,r);let i=this.getColumnById(e);r.color&&(i.color=r.color),r.symbol&&(i.symbol=r.symbol)}catch(i){console.error(i)}}updateColumnCell(e,t,s){let r=parseInt(e),i=this.getColumnById(r);return i&&i.editable?(i.setValuesByRow([t],[s]),this.updateColumnValues(r,i.values,[t])):Promise.reject(new Error(`Cannot update cell for columnId= ${r}`))}checkHasStruckRowsForDataSet(e){return this.getColumnsForSet(e).some(t=>t.hasStruckRows)}checkHasStruckRows(){return this.columns.some(e=>e.hasStruckRows)}strikeRows(e,t,s){return this.api.strikeRows({experimentId:this.experimentId,dataSetId:G(e),row:t,count:s,strikethrough:!0})}unstrikeRows(e,t,s){return this.api.strikeRows({experimentId:this.experimentId,dataSetId:G(e),row:t,count:s,strikethrough:!1})}async unstrikeAllRowsForSet(e){let t=this.getColumnsForSet(e);if(t){let s=Math.max(...t.map(r=>r.values.length));await this.unstrikeRows(e,0,s)}}unstrikeAllRows(){return this.api.unstrikeAllRows({experimentId:this.experimentId})}updateDataSet(e,t){return console.assert(e),this.api.updateDataSetProperties({experimentId:this.experimentId,id:G(e),params:t})}async updateColumnValues(e,t,s,r){console.assert(e);let i=[],o=r||!1;s.forEach(u=>{i.push([u,t[u]])});let l=this.getColumnById(e),c=s.some(u=>t[u]===void 0&&l.values[u]!==void 0);await this.api.updateColumnValues({experimentId:this.experimentId,id:G(e),values:i,trim:o}),c&&this._deleteAnnotationsWithNoData()}changeColumnDataType(e,t){return this.api.changeColumnDataType({experimentId:this.experimentId,id:parseInt(e),type:t})}notifyCollectionPreparing(){this.isCollecting=this.isTriggeringEnabled,this.emit("collection-preparing")}_notifyCollectionTriggered(){this.emit("collection-triggered")}_notifyCollectionStarted(){this.isCollecting=!0,this.emit("collection-started")}_notifyCollectionStopped(){this.isCollecting=!1,this.emit("collection-stopped")}addEventData(e,t,s,r){console.assert(e);let i=G(e),o;$a(t)?o=Na(t):t&&r?o=t:o=null;let l=[];return s.forEach(c=>{l.push([G(c.column.id),c.value])}),this.api.addEventData({experimentId:this.experimentId,id:i,value:o,readings:l})}changeColumnUnit(e,t){this.blockInfoSyncing||(console.assert(e),this.api.changeColumnUnit({experimentId:this.experimentId,id:G(e),unit:t}))}changeColumnProperties(e,t={}){let s=G(e);return s===0?Promise.reject(new Error("changeCalled called before UDM id available.")):this.api.changeColumnProperties(P({experimentId:this.experimentId,id:s},t))}async addGraph(e={}){let t=P({experimentId:this.experimentId},e);e.baseColumnId&&(t.baseColumnId=G(t.baseColumnId));let s=await this.api.addGraph(t),{graphId:r}=s;return this._graphInfos[r]=t,s}getGraphUdmIds(){return Object.keys(this._graphInfos)}registerGraphId(e,t){let s=this._graphIdMap.findIndex(i=>i.graphId===e),r={graphId:e,udmId:t};s>=0?this._graphIdMap[s]=r:this._graphIdMap.push(r),this._graphIdMap.sort((i,o)=>i.graphId>=o.graphId)}clearGraphId(e){let t=this._graphIdMap.findIndex(s=>s.graphId===e);t>=0&&this._graphIdMap.splice(t,1)}get registeredGraphIds(){return[...this._graphIdMap]}changeGraphProperties(e,t={}){if(this.importing||this.sessionClosing)return Promise.resolve();let s=G(e);if(s===0)return Promise.reject(new Error("changeGraphProperties called before UDM id available."));let r=P({experimentId:this.experimentId,graphId:s},t);return t.baseColumnId&&(r.baseColumnId=G(t.baseColumnId)),this.api.changeGraphProperties(r)}addGraphTraces(e,t=[]){let s=!0;if(t.forEach(i=>{i.experimentId!==this.session.experimentId&&(console.error(`attemtped to add traces for stale exp ${i.experimentId} (currently ${this.session.experimentId}`),s=!1)}),!s)return Promise.reject();let r=G(e);return this.api.addGraphTraces({experimentId:this.experimentId,graphId:r,traces:t})}removeGraphTraces(e,t=[]){if(this.sessionClosing)return Promise.resolve();let s=!0;return t.forEach(r=>{r.experimentId!==this.session.experimentId&&(console.error(`attemtped to remove traces for stale exp ${r.experimentId} (currently ${this.session.experimentId}`),s=!1)}),s?this.api.removeGraphTraces({experimentId:this.experimentId,graphId:G(e),traces:t}):Promise.reject()}addGraphCurveFit(e,t={}){let s=P({},t),r=G(e),i;return t.fitId&&(i=G(t.fitId)),t.baseColumnId&&(s.baseColumnId=G(t.baseColumnId)),t.traceColumnId&&(s.traceColumnId=G(t.traceColumnId)),this.api.addGraphCurveFit(P({experimentId:this.experimentId,graphId:r,fitId:i},s))}removeGraphCurveFit(e,t){return this.api.removeGraphCurveFit({experimentId:this.experimentId,fitId:G(t)})}addGraphIntegral(e,t={}){let s=P({},t),r=G(e),i;return t.integralId&&(i=G(t.integralId)),t.baseColumnId&&(s.baseColumnId=G(t.baseColumnId)),t.traceColumnId&&(s.traceColumnId=G(t.traceColumnId)),this.api.addGraphIntegral(P({experimentId:this.experimentId,graphId:r,integralId:i},s))}removeGraphIntegral(e,t){return this.api.removeGraphIntegral({experimentId:this.experimentId,integralId:G(t)})}async addGraphManualFit(e,t){let{valueRange:s}=this.getColumnById(t.baseColumnId),r=new Jr(de(P({},t),{graphId:G(e),baseColumnId:G(t.baseColumnId),yColumnId:G(t.yColumnId),range:s}));try{r.id=await this.api.addManualFit(this.experimentId,r.udmExport),this._addManualFit(r)}catch(i){return console.error(`Could not create manual fit: ${i.message}`),null}return r}async removeGraphManualFit(e){let t=G(e.id);await this.api.removeManualFit(this.experimentId,t);let s=tt._autorunStopFunctions[t];s&&(s(),delete tt._autorunStopFunctions[t]),this.manualFits.remove(e)}_addManualFit(e){this.manualFits.push(e);let t=Vr(async s=>{let{experimentId:r}=this,i=e.udmExport;if(!(!r||s))try{await this.api.updateManualFit(r,i)}catch(o){console.error(`Manual fit autorun: got error trying to update id ${i.id??"???"}`),console.error(o)}});tt._autorunStopFunctions[e.id]=t}addGraphPeakIntegral(e,t={}){let s=G(e),r=0;return t.integralId&&(r=G(t.integralId)),t.baseColumnId&&(t.baseColumnId=G(t.baseColumnId)),t.traceColumnId&&(t.traceColumnId=G(t.traceColumnId)),t.leftmostId&&(t.leftmostId=G(t.leftmostId)),t.rightmostId&&(t.rightmostId=G(t.rightmostId)),this.api.addGraphPeakIntegral(P({experimentId:this.experimentId,graphId:s,integralId:r},t))}removeGraphPeakIntegral(e){return this.api.removeGraphPeakIntegral({experimentId:this.experimentId,integralId:G(e)})}addGraphStats(e,t={}){let s=P({},t),r=G(e),i;return t.statsId&&(i=G(t.statsId)),t.baseColumnId&&(s.baseColumnId=G(t.baseColumnId)),t.traceColumnId&&(s.traceColumnId=G(t.traceColumnId)),this.api.addGraphStats(P({experimentId:this.experimentId,graphId:r,statsId:i},s))}removeGraphStats(e,t){return this.api.removeGraphStats({experimentId:this.experimentId,statsId:G(t)})}setInfoBoxInfo(e,t,s){return this.experimentId?this.api.setInfoBoxInfo({experimentId:this.experimentId,id:G(e),infoBox:t,showUncertainty:s}):Promise.resolve()}async addGraphAnnotation(e,t={}){let s=P({},t),r=G(e);t.udmId&&(s.annotationId=G(t.udmId));let i=await this.api.addGraphAnnotation(P({experimentId:this.experimentId,graphId:r},s));if(i===void 0||i===0)return console.error("Could not create annotation."),null;let o=new sn(de(P({},t),{id:i,graphUdmId:r}));return this._internalRegisterAnnotation(o),o}_internalRegisterAnnotation(e){Re(()=>{this.annotations.push(e)});let t=Vr(async s=>{let r=P({experimentId:this.experimentId},e.udmExport);if(!(!this.experimentId||s))try{await this.api.updateGraphAnnotation(r)}catch(i){console.error(`Anotation autorun: got error trying to update id ${r.id??"???"}`),console.error(i)}});tt._autorunStopFunctions[e.id]=t}getAnnotationsForGraph(e){return this.annotations.filter(t=>t.containsGraph(e))}getAnnotationsForColumn(e){return this.annotations.filter(t=>t.containsTargetColumn(e))}async removeGraphAnnotation(e){let t=G(e.id);await this.api.removeGraphAnnotation({experimentId:this.experimentId,annotationId:t});let s=tt._autorunStopFunctions[t];s&&(s(),delete tt._autorunStopFunctions[t]),Re(()=>this.annotations.remove(e))}createInternalDataSet(e={}){let t=P({},e),{foreignId:s}=t,r=!1;delete t.foreignId,t.type==="regular"&&!t.name&&(t.name=this._getNextRegularSetName(),r=!0);let i=new ml(t);return s&&(i.foreignId=s),this.dataSets.push(i),i.type==="regular"&&(this.currentDataSet=i),this.emit("data-set-added",{addedDataSet:i}),this.emit("dataset-added",i),r&&this.updateDataSet(e.id,{name:t.name}),i}createInternalGroup(e){let{beforeSibling:t,siblingId:s}=e;delete e.siblingId,delete e.beforeSibling;let r=new ll(e);if(s){let i=this.columnGroups.findIndex(o=>o.id===s);if(i<0&&console.warn(`Could not find column group with id ${s}`),i>=0){let o=t?i-1:i+1;this.columnGroups.splice(o,0,r)}}else this.columnGroups.push(r);this.emit("column-group-added",r),["name","units","format-string"].forEach(i=>{r.on(`${i}-changed`,(o,l)=>{this.emit(`column-group-${i}-changed`,r,o,l)})}),!this.importing&&e.calcCustomEqNeedsParsing&&this.updateEquation(r)}parseCustomEquation(e){let t=i=>{let o=-1,l=this.getColumnGroups().filter(c=>c.name.startsWith(i)).at(0);return l&&(o=l.id),o},s=new Nr(this._userConstants),r=s.parse(e);return s.processResult(r,t),r}updateInternalGroup(e,t){let s=this.getColumnGroupById(e),r=s.customeEq||!1,i=t.calcCustomEq?.equStr||!1,o=t.calcCustomEqNeedsParsing||r&&i&&r!==i;s.update(t),!this.importing&&o&&this.updateEquation(s),this.emit("column-group-updated",s)}removeInternalGroup(e){let t=this.getColumnGroupById(e);this.columnGroups=this.columnGroups.filter(s=>s.id!==e),t.off(),this.emit("column-group-removed",t)}updateColumnGroup(e,t){if(!this.experimentId)return Promise.resolve();let s=this.getColumnGroupById(e),r=P({},t);return s?(r.errorBarColumnId&&(r.errorBarColumnId=G(r.errorBarColumnId)),s.type==="sensor"&&r.units!==void 0&&this.sensorWorld.changeSensorUnit(this.experimentId,s.sensorId,r.units),this.api.updateColumnGroup({experimentId:this.experimentId,groupId:e,properties:r})):Promise.reject(new Error(`Failed to find group for groupId= ${e}`))}updateColumnGroupByColumn(e,t){let s=this.getColumnById(e);return s?this.api.updateColumnGroup({experimentId:this.experimentId,groupId:s.groupId,properties:t}):Promise.reject(new Error(`Failed to find column for columnId= ${e}`))}createInternalColumnForDataSet(e,t){let s=t.siblingId?`${t.siblingId}`:"0",{beforeSibling:r}=t,i={};typeof t=="string"?i={id:t}:i=P({},t),i.type==="time"&&(i.title=M("Time")),i.id!==void 0&&(i.id=`${i.id}`),i.meterId!==void 0&&(i.meterId=`${i.meterId}`),i.setId!==void 0&&(i.setId=`${i.setId}`),console.assert(e),console.assert(i.id);let{precision:o}=i;delete i.precision,delete i.siblingId,delete i.beforeSibling;let l=new $r(i),c=Ga(()=>{this.blockInfoSyncing||this.changeColumnProperties(l.id,{color:l.color})},500);l.on("color-changed",c),i.foreignId&&(l.foreignId=i.foreignId),i.foreignGroupId&&(l.foreignGroupId=i.foreignGroupId),e.addColumn(l.id,s,r);let u=this.columns.findIndex(p=>p.id===s);if(u>=0){let p=Math.max(0,r?u-1:u+1);this.columns.splice(p,0,l)}else this.columns.push(l);if(this.emit("column-added",l),["values","strikethrough","color","format-string","updated-rows"].forEach(p=>{l.on(`${p}-changed`,m=>{if(this.emit(`column-${p}-changed`,l,m),p==="color"){let v=this.meters.find(b=>b.columnId===l.id);v&&(v.color=m)}p==="updated-rows"&&this.updateColumnValues(l.id,l.values,l.updatedRows)})}),o&&l.group.update({precision:o}),this.importing){if(e.columnIds.length===1&&(this.seenBaseCol[e.id]=!1,this.seenTraceCol[e.id]=!1),e.type==="prediction"){let p=()=>{let m=e.columnIds[0];if(m===l.id&&(this.seenBaseCol[e.id]=!0),e.columnIds.length<2)return;let v=e.columnIds[1];if(v===l.id&&(this.seenTraceCol[e.id]=!0),!this.seenBaseCol[e.id]||!this.seenTraceCol[e.id])return;delete this.seenTraceCol[e.id],delete this.seenBaseCol[e.id];let b=wt("prediction-"),y={name:e.name,id:b,baseColId:m,traceColId:v,onDocumentLoad:!0};this.createPrediction([],y)};l.once("values-changed",p)}else if(e.type==="spectrum"){let p=()=>{if(e.columnIds.length<2)return;let[m,v]=e.columnIds.filter(W=>this.getColumnById(W).group.isSpectrumGroup);if(m===l.id&&(this.seenBaseCol[e.id]=!0),v===l.id&&(this.seenTraceCol[e.id]=!0),!this.seenBaseCol[e.id]||!this.seenTraceCol[e.id])return;delete this.seenTraceCol[e.id],delete this.seenBaseCol[e.id];let b=[],y=this.getColumnById(m).values,w=this.getColumnById(v).values,_=Math.min(y.length,w.length),T=wt("spectrum-");for(let W=0;W<_;++W)b[W]=[y[W],w[W]];let A={points:b,name:e.name,id:T,baseColId:m,traceColId:v,onDocumentLoad:!0};this.createSpectrum(A)};l.once("values-changed",p)}else if(e.type==="graph-match"){let p=()=>{let m=e.columnIds[0];if(m===l.id&&(this.seenBaseCol[e.id]=!0),e.columnIds.length<2)return;let v=e.columnIds[1];if(v===l.id&&(this.seenTraceCol[e.id]=!0),!this.seenBaseCol[e.id]||!this.seenTraceCol[e.id])return;delete this.seenTraceCol[e.id],delete this.seenBaseCol[e.id];let y={id:wt("graph-match-"),name:e.name,matchType:this.getMatchTypeForColumn(v),dataSetId:e.id,baseColId:m,traceColId:v,onDocumentLoad:!0};this.createGraphMatch([],y)};l.once("values-changed",p)}}return l}removeInternalColumn(e,t=!1){let s=e;this.emit("removing-column",s),s!==void 0&&(s=`${s}`);let r=!1,i=this.getColumnById(s);if(i){let o=this.getDataSetByID(i.setId);o?o.removeColumn(s):console.warn(`unable to find data set for column id= ${s}`),this.columns=this.columns.filter(l=>l.id!==s),i.eventNames().forEach(l=>i.removeAllListeners(l)),this.emit("column-removed",i),this.ignoreNameChanges=!0,this.ignoreNameChanges=!1,t&&this.removeColumnGroup(i.groupId),r=!0}return r}removeInternalDataSet(e){let t=!1,s=this.getDataSetByID(e);if(s){s.columnIds.forEach(i=>{this.removeInternalColumn(i)}),this.dataSets=this.dataSets.filter(i=>i.id!==e),t=!0,this.emit("dataset-removed",e),s.off();let{currentDataSet:r}=this;r&&r.id===e&&(this.currentDataSet=null)}return t}setupSpectrum(e){return new Promise((t,s)=>{let r=new Se,i=[],o=0;(()=>new Promise((c,u)=>{let p=0,m=!1,v=r.on(this,"column-added",b=>{i[p]=b.id,p++,p===2&&(v.off(),m=!0,o!==0&&c(i))});this.createNewDataSet({type:"spectrum",name:e.name}).then(b=>{o=b.datasetId,m&&c(i),setTimeout(()=>{m||(v.off(),u(new Error("Timed out")))},3e3)}).catch(b=>{v.off(),u(b)})}))().then(()=>{if(e.dataSetId=parseInt(o),e.baseColId=parseInt(i[0]),e.traceColId=parseInt(i[1]),e.points){let c=this.getColumnById(i[0]),u=this.getColumnById(i[1]);console.assert(u&&c);let p=[],m=new Float64Array(e.points.length),v=new Float64Array(e.points.length);for(let b=0;b<e.points.length;++b)p.push(b),v[b]=e.points[b][0],m[b]=e.points[b][1];c.values=[],c.updatedRows=[],u.values=[],u.updatedRows=[],c.values=v,c.updatedRows=p,u.values=m,u.updatedRows=p}t(e)}).catch(c=>{console.error(c),s(c)})})}setupSpecialDataSet(e,t){return new Promise((s,r)=>{let i=new Se,o=[],l=0;(()=>new Promise((u,p)=>{let m=0,v=!1,b=++this._specialDataSetTransactionCounter,y=i.on(this,"column-added",_=>{_.context===b&&(o[m]=_.id,m++,m===2&&(y.off(),v=!0,l!==0&&u(o)))}),w={type:t.type,name:t.name,context:b};t.matchGroupId&&(w.matchGroupId=t.matchGroupId),this.createNewDataSet(w).then(_=>{l=_.datasetId,this.getDataSetByID(l)&&i.on(this,"dataset-name-changed",A=>{t.name=A.name}),v&&u({dataSetId:l,colIds:o}),setTimeout(()=>{v||(y.off(),p(new Error("Timed out")))},3e3)}).catch(_=>{y.off(),p(_)})}))().then(({dataSetId:u,colIds:p})=>{if(e){let m=this.getColumnById(p[0]),v=this.getColumnById(p[1]);console.assert(v&&m);let b=[],y=new Float64Array(e.length),w=new Float64Array(e.length);for(let _=0;_<e.length;++_)b.push(_),w[_]=e[_][0],y[_]=e[_][1];m.values=[],m.updatedRows=[],v.values=[],v.updatedRows=[],m.values=w,m.updatedRows=b,v.values=y,v.updatedRows=b}s({dataSetId:u,columnIds:p})}).catch(u=>{console.error(u),r(u)})})}createSpectrum(e){return new Promise((t,s)=>{let r=e.name||M("Spectrum"),i=e.id||wt("spectrum-"),o=e.points||[],l=e.onDocumentLoad||!1,c={points:o,name:r,id:i,traceColId:parseInt(e.traceColId)||void 0,baseColId:parseInt(e.baseColId)||void 0},u=new fn(c);l?(this.spectrums.push(u),t(u)):this.setupSpectrum(u).then(p=>{this.spectrums=[],this.spectrums.push(p),this.emit("spectrum-created",p),t(p)}).catch(p=>{console.error(`Failed to set up spectrum: ${p}`),s(p)})})}createPrediction(e,t){return new Promise((s,r)=>{let i=this.predictions.length+1,o=t.name||`${M("Prediction")} ${i}`,l=t.id||wt("prediction-"),c=t.onDocumentLoad||!1,u={name:o,id:l,traceColId:parseInt(t.traceColId)||void 0,baseColId:parseInt(t.baseColId)||void 0,type:"prediction"};c?s(u.traceColId):this.setupSpecialDataSet(e,u).then(({columnIds:p})=>{s(p[1])}).catch(p=>{console.error(`Failed to set up prediction: ${p}`),r(p)})})}auxDataSets(e){return this.dataSets.filter(t=>t.type===e)}createAuxDataSet(e,t,s,r={}){let i=Math.min(t.length,s.length),o=[];for(let l=0;l<i;++l)o.push([t[l],s[l]]);return new Promise((l,c)=>{let u=e==="fft"?M("FFT"):M("Histogram"),p=this.auxDataSets(e).length+1,m=r.name||`${u} ${p}`,v=r.id||wt(`${e}-`),b=r.onDocumentLoad||!1,y={name:m,id:v,traceColId:parseInt(r.traceColId)||void 0,baseColId:parseInt(r.baseColId)||void 0,type:e};b?l():this.setupSpecialDataSet(o,y).then(({dataSetId:w,columnIds:_})=>{l({dataSetId:w,columnIds:_})}).catch(w=>{c(w)})})}async removeAuxDataSet(e,t){let s=this.auxDataSets(e).find(r=>r.columnIds[1]===t);s&&await this.removeDataSet(s.id)}createGraphMatch(e,t){return new Promise((s,r)=>{let{matchType:i,name:o}=t,l=t.id||wt("graphMatch-"),c=t.onDocumentLoad||!1;console.assert(i),console.assert(o);let u={name:o,id:l,traceColId:parseInt(t.traceColId)||void 0,baseColId:parseInt(t.baseColId)||void 0,matchGroupId:parseInt(t.matchGroupId),type:"graph-match"};c?s({traceColId:u.traceColId,matchType:i}):(this.graphMatches.length&&this.removeDataSet(this.graphMatches[0].id).catch(p=>r(p)),this.setupSpecialDataSet(e,u).then(({columnIds:p})=>{s({traceColId:p[1],matchType:i})}).catch(p=>{console.error(`Failed to set up prediction: ${p}`),r(p)}))})}removeGraphMatches(){return new Promise((e,t)=>{let s=[];this.graphMatches.forEach(r=>{s.push(this.removeData(r.id))}),Promise.all(s).then(()=>{e()}).catch(r=>{t(r)})})}async removeDataSet(e){let t=await this.api.removeDataSet({experimentId:this.experimentId,datasetId:parseInt(e)});return this.emit("dataset-removed",e),Promise.resolve(t)}getMatchTypeForColumn(e){let t=this.getColumnById(e),s=null;return this.sensorWorld.isMotionDetector(t.sensorId)?s="Position":t.type==="calc"&&t.sensorMapId.startsWith("CC_MDV")&&(s="Velocity"),s}getMatchTypeForColumnGroup(e){let t=this.getColumnGroupById(e);return this.getMatchTypeForColumn(t.columns[0].id)}getGraphMatchColumns(){let e=[],t=[];return this.canCollect&&this.currentDataSet?.columnIds.forEach(s=>{let r=this.getColumnById(s),i=this.getMatchTypeForColumn(s);i&&t.indexOf(i)<0&&(t.push(i),e.push(r))}),e}generateMatchPoints(e,t){let s=[],r=this.getMatchTypeForColumnGroup(t);function i(o,l,c){let u=.4,p=Math.random()*(l-o)+o;return c&&Math.abs(c-p)<u?i(o,l,c):p}if(r){let o=this.getColumnById(e),{units:l}=o,c=l==="ft"||l==="ft/s"?3.2808:0,u=r.toUpperCase()==="VELOCITY",p=this.dataCollection.timeBasedParams,{delta:m}=p,v=Ct.convertTimeUnits(p.duration,"s",p.units),b={min:0,max:v},y={min:o.range.min,max:o.range.max};if(m>0&&v>0){let w=[],_=v/3,T=0;u?(y.min=0,y.max=c>0?2*c:2,_=v/3.33):T=o.units==="ft"?.82021:.25;for(let A=0;A<4;++A)w[A]=i(y.min+T,y.max-T,w[A-1]),u||s.push([b.min+_*A,w[A]]);if(u){s.push([0,0]);let A=(w[1]-w[0])/_;s.push([b.min+v*.03,A]),s.push([b.min+v*.33,A]),A=(w[2]-w[1])/_,s.push([b.min+v*.36,A]),s.push([b.min+v*.66,A]),A=(w[3]-w[2])/_,s.push([b.min+v*.69,A]),s.push([b.min+v,A])}}}return s}autoSaveData(e={}){let t=ct(),s=e.type||t,r=e.decimal||".",i={experimentId:this.experimentId,name:e.filename,format:s,decimal:r,age:e.age,filepath:e.filepath};return this.api.exportData(i).then(async o=>{if(await this.archive&&o.fileString)return this.archive.writeXml(o.fileString).then(()=>({age:o.age}));if(o.fileString){let l=new Blob([o.fileString],{type:It()});return Promise.resolve({blob:l,age:o.age})}return o.age>0?Promise.resolve({age:o.age}):Promise.reject()})}async exportData(e={}){let t=e.type||ct(),s=e.decimal||".",{fileHandle:r}=e,i={experimentId:this.experimentId,name:e.filename,format:t,decimal:s,filepath:e.filepath};t===ct()&&i.name&&await this.setExperimentName(i.name);let o=await this.api.exportData(i);if(!o.fileString)throw new Error("fileString wasn't returned");let l=o.fileString;await this.archive&&(await this.archive.writeXml(o.fileString),l=await this.archive.exportDocument());let c=new Blob([l],{type:It(t)});return e.skipWrite||await this.fileIO.writeFile({fileHandle:r,filepath:i.filepath,blob:c}),t===ct()&&this.updateUserMetaData(i.filepath,o.age),{age:o.age,content:o.fileString,contentToWrite:l,contentBlob:c,filepath:i.filepath,mimetype:It(t)}}checkRecoveryFile(){return this.api.checkRecoveryFile(this.experimentId)}getDocumentAge(){return new Promise(e=>{let t=setTimeout(()=>{e(this.userFileMetaData.age)},1e3);this.api.getDocumentAge(this.experimentId).then(s=>{clearTimeout(t),e(s.age)}).catch(()=>{e(0)})})}async _doImport(e,t,s){try{this.importing=!0;let r=await this.api.importData(s.path,s.format,s.content),{params:i,experimentId:o}=r,l=await this.getDataShareSource(o),c={imported:!0,sessionFileType:s.type,sessionFileFullPath:t,sessionName:e.name,experimentId:r.experimentId};i.specMode&&(this.dataCollection.experimentId=o,await this.dataCollection.setSpectrumDataMode(i.specMode));let u=i.sessionType!=="unknown"?i.sessionType:void 0,p=i.sessionSubtype||"";return c.type=i.mode||"",l&&(c.sourceId=l.attributes.sourceId,c.sourceName=l.attributes.name,c.sourceURI=l.attributes.uri,u="DataShare"),(await this.api.fetchAllDataMarks(o)).forEach(w=>this._internalCreateDataMark(w)),(await this.api.fetchGraphAnnotations(o)).forEach(w=>this._internalRegisterAnnotation(new sn(w))),(await this.getStoredMeterInfo(o)).some(w=>w.index!==-1)&&(this.meterRule=Ke.Rule.USER),(await this.api.fetchAllManualFits(o)).forEach(w=>{let{valueRange:_}=this.getColumnById(w.baseColumnId);this._addManualFit(new Jr(de(P({},w),{range:_})))}),await this.startNewSession(u,c,p),await this.dataCollection.setCollectionParams(i.mode,i.params,!0),this.importing=!1,this.updateUserMetaData(t),!0}catch(r){throw new Error(`Failed to close old session: ${r}`)}}async _importFromArchive(e,t){try{console.assert(await this.archive,"awaiting archival setup"),await this.archive.clearAttachments("videos");let s=await Kr(e),r=new Uint8Array(s);console.assert(t),console.assert(e.name),console.assert(r);let i=await this.archive.load({path:t,name:e.name,buffer:r});console.assert(i,`no xml was parsed from the archive ${t}`);let o=await this.archive.getAttachmentPaths().find(l=>l.startsWith("videos/"));if(o){let l=await this.archive.getAttachment(o),c=new Blob([l.data],{type:l.mimeType});return{xml:i,videoAttachment:c}}return{xml:i,videoAttachment:void 0}}catch(s){return s}}importDataThrottled(e={},t=500){return this.lastImportTimeStamp&&Date.now()<this.lastImportTimeStamp+t?Promise.reject(new Error("Import within throttle threshold")):this.importData(e)}async importData(e={}){let{fileData:t}=e,s=e.type||ct();this.lastImportTimeStamp=Date.now();let r=async({file:o,filepath:l})=>{console.assert(o);let c=o.name.toLowerCase().endsWith(".csv"),u={type:s,path:o.name,format:c?"csv":""};try{let p=l.split("/"),m=p[p.length-1],v=zl({mimetype:o.type,extension:Vl(m.includes(".")?m:o.name)});if(await this.closeSession(),v){let w=await Xl(o);return this._doImport(o,l,de(P({},u),{content:w}))}let{xml:b,videoAttachment:y}=await this._importFromArchive(o,l);if(!b)throw new Error(`no xml was parsed from ${l}`);return await this._doImport(o,l,de(P({},u),{content:b})),this.videoAttachmentImportHook&&y&&await this.videoAttachmentImportHook(y),!0}catch(p){return console.error(p),!1}};return await this._confirmNewSession()?r(t):!1}getDocumentMetaData(e){let t=e.type||"";return new Promise((s,r)=>{e.file===void 0&&s({}),e.file.entry.file(i=>{let o=new FileReader;o.onerror=l=>{console.error(`Loading file failed: ${l}`),r(l)},o.onload=l=>{let c=e.file.entry.name,u=l.target.result;u?this.api.getDocumentMetaData({experimentId:this.experimentId,path:c,format:t,content:u}).then(p=>{s(p)}).catch(()=>{console.error(`failed to load document at: ${c}`)}):r(new Error(`File "${c}" has no content!`))},o.readAsText(i)})})}updateUserMetaData(e,t){e!==void 0&&(this.userFileMetaData.filepath=e),t!==void 0&&(this.userFileMetaData.age=t)}get sessionSubtype(){return this._sessionSubtype}set sessionSubtype(e){e!==this._sessionSubtype&&(this._sessionSubtype=e,this.api.setSessionSubtype({experimentId:this.experimentId,subtype:e}),this.emit("session-subtype-changed"))}convertToVideoAbsoluteTime(e){return this.api.convertVideoTime(!0,e)}convertToVideoAdjustedTime(e){return this.api.convertVideoTime(!1,e)}setNotesText(e){return this.api.setNotesState({experimentId:this.experimentId,text:e,visible:!0})}async getNotesText(){let e=(await this.api.getNotesState(this.experimentId))?.text||"";return Ha(e)}setCustomCurveFit(e,t){return this.api.setCustomCurveFit({experimentId:this.experimentId,name:e,expression:t})}getCustomCurveFits(){return this.api.getCustomCurveFits(this.experimentId)}getCalcColumnFunctions(){return this.api.getCalcColumnFunctions(this.experimentId)}getUserConstants(){return this._userConstants}addUserConstant(e){return!e.name||!e.name.charAt||e.name.charAt(0)!=="$"?Promise.reject(new Error("constant name must begin with $")):this.api.addUserConstant(this.experimentId,e).then(t=>(this._userConstants.push(P({constantId:t},e)),this.emit("user-constants-updated"),t))}changeUserConstant(e,t){return!t.name||!t.name.charAt||t.name.charAt(0)!=="$"?Promise.reject(new Error("constant name must begin with $")):this.api.changeUserConstant(this.experimentId,e,t).then(()=>{let s=this._userConstants.findIndex(r=>r.constantId===e);s>=0&&(this._userConstants[s]=P({constantId:e},t),this.emit("user-constants-updated"))})}deleteUserConstant(e){return this.api.deleteUserConstant(this.experimentId,e).then(()=>{let t=this._userConstants.findIndex(s=>s.constantId===e);t>=0&&(this._userConstants.splice(t,1),this.emit("user-constants-updated"))})}addAuxGraph(e,t,s){return this.api.addAuxGraph(this.experimentId,e,t,s)}updateAuxGraphInfo(e,t){return this.api.updateAuxGraphInfo(this.experimentId,e,t)}deleteAuxGraph(e){return this.api.deleteAuxGraph(this.experimentId,e)}getInfoForGraphId(e){return this._graphInfos[e]}async addDataMark(e,t,s=[],r=!0){let i=s.map(c=>({graphId:parseInt(c),isShown:!0,isCollapsed:!1,position:{x:-1,y:-1}})),o={experimentId:this.experimentId,id:0,dataSetId:parseInt(t),rowIndex:e,type:r?ls.COLLECTED:ls.USER_TAGGED,appearanceInfo:i},l=await this.api.addDataMark(o);return this._internalCreateDataMark(de(P({},o),{id:l}))}async createDataMarkForDataSharing(e){let t=await this.api.addDataMark(de(P({},e),{experimentId:this.experimentId}));return this._internalCreateDataMark(de(P({},e),{id:t}))}async removeDataMark(e){await this.api.removeDataMark({experimentId:this.experimentId,id:e.id}),tt._autorunStopFunctions[e.id](),delete tt._autorunStopFunctions[e.id];let t=this._dataMarks.findIndex(s=>s.id===e.id);t>=0&&Re(()=>this._dataMarks.splice(t,1))}getDataMarkWithId(e){return this._dataMarks.find(t=>t.id===e)}getDataMarksForGraph(e){return this._dataMarks.filter(s=>s.containsGraph(e))}_internalCreateDataMark(e){let t=new ls(e);Re(()=>{this._dataMarks.push(t)});let s=Vr(async r=>{let i=P({experimentId:this.experimentId},t.udmExport);if(!(!this.experimentId||r))try{await this.api.updateDataMark(i)}catch(o){console.warn(`Datamark autorun: got error trying to update mark id ${i.id??"???"}`)}});return tt._autorunStopFunctions[t.id]=s,t}getStoredMeterInfo(e=this.experimentId){return this.api.getAllMeters(e)}set meterRule(e){e!==this._meterRule&&(this._meterRule=e,this.emit("meter-rule-changed"))}get meterRule(){return this._meterRule}createMeter(e={}){return new Ke(e)}async addMeter(e,t=!1){let s=this.getMeterById(e.id);if(s)return console.warn(`Meter ${e.id} already exists in list. Ignoring.`),s;if(!t){let r=await this.api.addMeter(P({experimentId:this.experimentId},e.udmExport()));e.id=r}return this.setMeterPosition(e),this.meters.some(({id:r})=>r===e.id)||(Re(()=>this.meters.push(e)),this.emit("meter-added",e)),e}async userSetMeterVisibility(e,t){let s=this.getMeterById(e);if(!s){console.warn(`userSetMeterVisibility() could not find meter with id ${e}`);return}this.meterRule=Ke.Rule.USER;let r=s.visible;s.visible=t,await this.updateMeter(s),!r&&t&&this.setMeterPosition(s);let{group:i}=this.getAllColumns().find(o=>o.meterId===e);i&&await this.updateColumnGroup(i.id,{metered:t}),this.emit("meter-visibility-changed",s)}setMeterPosition(e){e.visible?e.position||(e.position=fl(this.meters)):e.position=null,this.updateMeter(e)}incrementMeterPosition(e){this.meterRule=Ke.Rule.USER,vl(e,this.meters),this._updateAllMeters()}decrementMeterPosition(e){this.meterRule=Ke.Rule.USER,gl(e,this.meters),this._updateAllMeters()}updateMeter(e){return this.api.updateMeter(P({experimentId:this.experimentId},e.udmExport()))}_updateAllMeters(){this.meters.forEach(e=>this.updateMeter(e))}removeMeter(e){let t=this.getMeterById(e);if(!t){console.warn(`Cannot remove meter with id ${e} as it is not in the list.`);return}t.removeAllBindings(),this.meters=this.meters.filter(s=>s.id!==e),this.sessionClosing||this.api.removeMeter({experimentId:this.experimentId,id:e}),this.emit("meter-removed",t)}getMeterById(e){return this.meters.find(t=>e===t.id)}getDerivativePoints(){return this.api.getDerivativePoints(this.experimentId)}setDerivativePoints(e){return this.api.setDerivativePoints({experimentId:this.experimentId,derivativePoints:parseInt(e)})}getSmoothingPoints(){return this.api.getSmoothingPoints(this.experimentId)}setSmoothingPoints(e){return this.api.setSmoothingPoints({experimentId:this.experimentId,smoothingPoints:parseInt(e)})}getLayoutProperties(){return this.api.getLayoutProperties(this.experimentId)}setLayoutProperties(e){return this.api.setLayoutProperties(this.experimentId,e)}freezeColumn(e,t=!0){return this.api.freezeColumn(G(e),t,this.experimentId)}},or=tt;or._autorunStopFunctions={};Object.defineProperties(or.prototype,{sessionSourceName:{get(){let n="",e;return this.session&&this.session instanceof as&&(this.session.client.sourceName?n=this.session.client.sourceName:this.session.client.serverURL&&(e=this.session.client.serverURL.match(/^\s*(http:\/\/)?\s*([^:]+):?(\d+)?$/),e&&e.length===4&&(n=e[2]))),n}},sessionHostAddress:{get(){let n="";return this.session&&this.session instanceof as&&(n=this.session.client.serverURL),n}},sessionType:{get(){let n=null;return this.session&&(this.session instanceof ir?n="DataCollection":this.session instanceof as?n="DataShare":this.session instanceof nr&&(n="ManualEntry")),n}},userSessionAge:{get(){return this.userFileMetaData?.age?this.userFileMetaData.age:0}},canControl:{get(){return this._canControl},set(n){this._canControl=n}}});var sc=le(_e());var ec=le(Yi());var lm=0,Xe=class extends ec.default{constructor({autoId:e=-1,canZeroOnCollect:t=!1,dataMode:s=null,deviceId:r="",hasX4Mode:i=!1,id:o=lm++,liveSpectrum:l=[],liveValue:c=0,liveVoltage:u=0,name:p="",position:m=0,sensorId:v="",sensorInfo:b={},unitInfo:y=[],units:w="",wavelength:_="",x4Mode:T=!1,zeroOnCollect:A=!1,experimentId:W=0,reversed:Z=!1}){super();this.experimentId=W,this._autoId=e,this._canZeroOnCollect=t,this._dataMode=s,this._deviceId=r,this._hasX4Mode=i,this._id=o,this._liveSpectrum=l,this._liveValue=c,this._liveVoltage=u,this._name=p,this._position=m,this._sensorId=v,this._sensorInfo=b,this._unitInfo=y,this._units=w,this._wavelength=_,this._zeroOnCollect=A,this._x4Mode=T,this._calibrationReversed=Z,this._calibrationProcesses=[],this._calibration={type:this._sensorInfo?.calibration?.type,coeffs:St(this._sensorInfo?.calibration?.coeffs)},console.assert(Xe.sensorWorld)}clone(e){let t=new Xe({autoId:this.autoId,canZeroOnCollect:this.canZeroOnCollect,dataMode:this.dataMode,deviceId:this.deviceId,hasX4Mode:this.hasX4Mode,id:this.id,liveSpectrum:this.liveSpectrum,liveValue:this.liveValue,liveVoltage:this.liveVoltage,name:this.name,position:this.position,sensorId:this.sensorId,units:this.units,wavelength:this.wavelength,zeroOnCollect:this.zeroOnCollect,x4Mode:this.x4Mode});return e&&Object.keys(e).forEach(s=>{t[s]=e[s]}),t}addSamples(e){this.emit("samples-available",e),e.length>0&&(this.liveValue=e[e.length-1])}async zero(){await Xe.sensorWorld.zeroSensor(this.experimentId,this.id,this.liveValue)}async reverse(){try{await Xe.sensorWorld.reverseSensor(this.experimentId,this.id,this.liveValue),this._calibrationReversed=!this._calibrationReversed}catch(e){throw new Error(e)}}async calculateCalibrationCoeffs(e){return await Xe.sensorWorld.calculateCalibrationCoeffs(this.experimentId,this.id,e)}async setCalibrationCoeffs(e,t){(t||this._calibrationReversed)&&e.forEach((s,r)=>{e[r]=-s});try{return await Xe.sensorWorld.setCalibration(this.experimentId,this.id,e),this.updateInternalCalibrationCoeffs(e),{calibration:this._calibration}}catch(s){throw new Error(s)}}updateInternalCalibrationCoeffs(e){this._calibration.coeffs=St(e)}updateCalibrationProcesses(e){this._calibrationProcesses=St(e)}clearCalibrationProcesses(){this._calibrationProcesses=[]}getPrecisionForUnit(e){let t=this.unitInfo?.find(r=>r.unit===e),s;return t&&(s=St(t.precision)),this.x4Mode&&(s.precision+=1),s}setModeX4(e){return this.dataCollection.setSensorModeX4(this.experimentId,this.id,e)}setZeroOnCollect(e){return this.dataCollection.setSensorZeroOnCollect(this.experimentId,this.id,e)}get autoId(){let{_autoId:e}=this;return this.dds&&(e=this?.dds?.sensorNumber),e}get canZeroOnCollect(){return this._canZeroOnCollect}set canZeroOnCollect(e){this._canZeroOnCollect=e}get dataMode(){return this._dataMode}set dataMode(e){this._dataMode=e,this.emit("data-mode-changed",e)}get deviceId(){return this._deviceId}set deviceId(e){this._deviceId=e,this.emit("device-id-changed",e)}get hasX4Mode(){return this._hasX4Mode}set hasX4Mode(e){this._hasX4Mode=e}get id(){return this._id}set id(e){this._id=e}get liveSpectrum(){return this._liveSpectrum}set liveSpectrum(e){this._liveSpectrum=e,this.emit("live-spectrum-changed",e)}get liveValue(){return this._liveValue}set liveValue(e){this.lastTimestamp=Date.now(),this._liveValue=e,this.emit("live-value-changed",e)}get liveVoltage(){return this._liveVoltage}set liveVoltage(e){this._liveVoltage=e,this.emit("live-voltage-changed",e)}get liveVoltageFormatStr(){return`%.${this.sensorInfo.voltageDecimals}f`}get name(){return M(this._name,"sensormap")}set name(e){this._name=e,this.emit("name-changed",e)}get position(){return this._position}set position(e){this._position=e,this.emit("position-changed",e)}get sensorId(){return this._sensorId}get sensorInfo(){return this._sensorInfo}get units(){return this._units}set units(e){this._units=e}get unitInfo(){return this._unitInfo}get wavelength(){return this._wavelength}set wavelength(e){(async()=>{try{await Xe.sensorWorld.setSelectedWavelength(this.experimentId,this.id,e),this._wavelength=e,this.emit("wavelength-changed",e)}catch(t){console.error(t)}})()}get zeroOnCollect(){return this._zeroOnCollect}set zeroOnCollect(e){this._zeroOnCollect=e}get x4Mode(){return this._x4Mode}set x4Mode(e){this._x4Mode=e}get availableUnits(){return this?.unitInfo.map(e=>e.unit)}get calibration(){let e=this._calibration;return{type:e.type,coeffs:St(e.coeffs),processes:this._calibrationProcesses}}get canCalibrate(){let{_sensorInfo:e}=this,{type:t}=e?.calibration;return e?.calibration?.calibrate&&(t==="linear"||t==="power"||t==="modifiedpower")}get canCalibrateGDX(){return this._calibrationProcesses.length>0}get canOnePointCalibrate(){return this._sensorInfo?.calibration?.onePoint}get canReverse(){return this._sensorInfo?.calibration.reverse}get canZero(){let{sensorInfo:e}=this;return e?.calibration.zero&&["linear","rotary","linearposition"].includes(e?.calibration.type)}get groupId(){return 100+this.id}get isReversed(){return this._calibrationReversed}get triggerable(){let{sensorInfo:e}=this,t=!1;return["linearposition","linear"].includes(e.calibration.type)&&(t=!0),t}};var tc=P({},Xe);var Cn=0,In=class extends sc.default{constructor(e){super();this.softSensorIds=[],lt(this,{softSensorIds:ye,addSoftSensor:fe,removeSoftSensor:fe}),this.dataCollection=e.dataCollection,this.sensorMap=e.sensorMap,this.api=e.api,Object.keys(Ji).forEach(t=>this.api.on(t,Ji[t].bind(this))),this._sensors=[],this.interfaces=[],this.ignoreSensors=!1,this._nativeModulesColumnNames=[M("Absorbance","sensormap","Spec column name [vst-native-modules/src/sensorworld/SpecIOChannel.cpp]"),M("Transmittance","sensormap","Spec column name [vst-native-modules/src/sensorworld/SpecIOChannel.cpp]"),M("Intensity","sensormap","Spec column name [vst-native-modules/src/sensorworld/SpecIOChannel.cpp]"),M("Fluorescence","sensormap","Spec column name [vst-native-modules/src/sensorworld/SpecIOChannel.cpp]"),M("Raw","sensormap","Spec column name [vst-native-modules/src/sensorworld/SpecIOChannel.cpp]"),M("Distance","sensormap","Photogate column name [vst-native-modules/src/sensorworld/SpecIOChannel.cpp]"),M("Velocity","sensormap","Photogate column name [vst-native-modules/src/sensorworld/SpecIOChannel.cpp]"),M("Gate Time","sensormap","Photogate column name [vst-native-modules/src/sensorworld/SpecIOChannel.cpp]"),M("Pulse Time","sensormap","Photogate column name [vst-native-modules/src/sensorworld/SpecIOChannel.cpp]"),M("Period","sensormap","Photogate column name [vst-native-modules/src/sensorworld/SpecIOChannel.cpp]"),M("Launch Speed","sensormap","Photogate column name [vst-native-modules/src/sensorworld/SpecIOChannel.cpp]"),M("Time of Flight","sensormap","Photogate column name [vst-native-modules/src/sensorworld/SpecIOChannel.cpp]")],Xe.sensorWorld=this,this.dataCollection.setSensorWorld(this)}get sensors(){return this._sensors}get syncableSoftSensorIds(){return Fr(this.softSensorIds)}set syncableSoftSensorIds(e){Re(()=>{this.softSensorIds=e})}createInternalSensor(e,t){let s=new Xe(e);return this._sensors.push(s),t||this.emit("sensor-added",s),s}removeInternalSensor(e,t){let s=this._sensors.find(r=>r.id===e);s&&(this._sensors=this._sensors.filter(r=>r.id!==e),t||this.emit("sensor-removed",s))}clearExperiment(e){this._sensors.forEach(t=>{t.experimentId===e&&this.removeInternalSensor(t.id,!1)})}_setSensorOffline(e){let t=this._sensors.find(s=>s.id===e);t&&(t.clearCalibrationProcesses(),this.emit("sensor-offline",t))}getSensorById(e){return this.sensors.find(t=>t.id===e)}isSensorOnline(e){return!!this.getSensorById(e)}getFirstSensor(){return this.sensors[0]}addTestSensor(e){let t=new tc({autoId:e.autoId||-1});this.createInternalSensor(t)}isRadiationMonitor(e){let t;return e!==Cn&&(t=this.getSensorById(e)),!!(t&&t.dataMode==="Radiation")}isMotionDetector(e){let t;return e!==Cn&&(t=this.getSensorById(e)),!!(t&&t.dataMode==="Digital Motion")}isRotationSensor(e){let t;return e!==Cn&&(t=this.getSensorById(e)),!!(t&&t.dataMode==="Rotation")}setIgnoreAddedSensors(e,t){return this.api.setIgnoreAddedSensors(e,t)}prepareCollection(e){let t=e.measurementPeriod||1;return this.dataCollection.setMeasurementPeriod(t)}deviceConnectionChange(e){this.emit("device-connection-changed",e)}resetSensorState(){this._sensors.forEach(e=>{e._calibrationReversed=!1})}changeSensorUnit(e,t,s){return console.assert(t),this.api.changeSensorUnit(parseInt(e),parseInt(t),s)}calculateCalibrationCoeffs(e,t,s){let r=new Float64Array(s.length),i=new Float64Array(s.length);return s.forEach((o,l)=>{[r[l],i[l]]=o}),this.api.calculateCalibrationCoeffs(e,t,r,i)}setCalibration(e,t,s){return this.api.setCalibration(e,t,s)}setSelectedWavelength(e,t,s){return this.api.setSelectedWavelength(e,t,s||0)}zeroSensor(e,t,s){return this.api.zeroSensor(e,t,s)}reverseSensor(e,t){return this.api.reverseSensor(e,t)}setSensorModeX4(e,t,s){return this.api.setSensorModeX4(e,t,s)}setSensorZeroOnCollect(e,t,s){return this.api.setSensorZeroOnCollect(e,t,s)}takeDarkReference(e,t){return this.api.takeDarkReference(e,t)}calibrateSpectrometer(e,t){return this.api.calibrateSpectrometer(e,t)}setSpecSettings(e,t,s){return this.api.setSpecSettings(e,t,s)}async addSoftSensor(e,t=1){try{this.softSensorIds.length||await this.api.enableSoftDevice(e),await this.api.enableSoftSignWaveSensor(e,t),Re(()=>{this.softSensorIds=[...this.softSensorIds,t]})}catch(s){console.error(s)}}async addAndConfigureSoftSensor({experimentId:e=0,sensorTypeId:t,frequency:s=.014,amplitude:r=1,offset:i=0}){if(!t){console.error(`invalid mandatory argument sensorTypeId (${t})`);return}try{this.softSensorIds.length||await this.api.enableSoftDevice(e),await this.api.enableAndConfigureSoftSignWaveSensor(e,t,s,r,i),Re(()=>{this.softSensorIds=[...this.softSensorIds,t]})}catch(o){console.error(o)}}async removeSoftSensor(e,t=1){try{await this.api.disableSoftSignWaveSensor(e,t),Re(()=>{let s=this.softSensorIds.lastIndexOf(t);this.softSensorIds.splice(s,1),this.softSensorIds=[...this.softSensorIds]}),this.softSensorIds.length||await this.api.disableSoftDevice(e)}catch(s){console.error(s)}}async enableSpecialSoftSensor(e){return await this.api.enableSoftDevice(e),this.api.enableSpecialSoftSensor(e)}async configureSpecialSoftSensor(e={experimentId:0,scale:1,offset:0,levelOutput:!1}){let{experimentId:t}=e;return await this.api.enableSoftDevice(t),await this.api.enableSpecialSoftSensor(t),this.api.configureSpecialSoftSensor(e)}async disableSpecialSoftSensor(e){return await this.api.disableSpecialSoftSensor(e),this.api.disableSoftDevice(e)}async addSoft2Device(e){return(await this.api.addSoft2Device(e)).deviceId}async removeSoft2Device(e){return this.api.removeSoft2Device(e)}async getSoft2DeviceConfig(e){return this.api.getSoft2DeviceConfig(e)}async setSoft2DeviceConfig(e,t){return this.api.setSoft2DeviceConfig(e,t)}async addSoft2Sensor(e,t,s){let r=Number.isInteger(s)?"":s,i=Number.isInteger(s)?s:0;return this.api.addSoft2Sensor(e,t,r,i)}async removeSoft2Sensor(e,t){return this.api.removeSoft2Sensor(e,t)}async freezeSoft2Device(e,t){return this.api.freezeSoft2Device(e,t)}async unfreezeSoft2Device(e){return this.api.unfreezeSoft2Device(e)}async initSoft2DeviceInterface(){return this.api.initSoft2DeviceInterface()}};var ac=le(_e());var En={"settings-changed":function(e){this._setCollectionParams(e)},"rolling-counter-error":function(e){let{timestamp:t}=e,s=`Rolling counter error detected at time: ${t}`;typeof t=="number"&&t>=0&&this.emit("device-error",s)},"device-error":function(e){console.error("Device Error:"),console.error(e);let t={BLE_CONNECTION_ERROR:7};e.errorCode===t.BLE_CONNECTION_ERROR?this.emit("ble-communication-error",e):this.emit("device-error",e)},"device-sensor-enum-completed":function(e){this.emit("device-sensor-enum-completed",e)},"keep-values-ready":function(e){let{values:t}=e;this.emit("keep-values-ready",t)}};var rc=le(_e()),ar=!1,cm=[2,3,4],dm=[6,7,9,10,13,15,16,17,18,25,26],ic=2295,um=5538,hm=115;function _n(n){return n.vendorId===um&&n.productId===hm||n.vendorId===ic&&dm.includes(n.productId)}function Es(n){return n.vendorId===ic&&cm.includes(n.productId)}var Zr=function(){let{lastError:n}=window.chrome.runtime;Error.call(this,n.message),this.lastError=n};Zr.prototype=Object.create(Error.prototype);Zr.check=function(n){let e=!!window.chrome.runtime.lastError;return e&&n(new Zr),!e};var nc=function(n){return Zr.check(n)},lr=function(n){return{deviceId:typeof n.deviceId=="number"?n.deviceId:n.device,productId:n.productId,vendorId:n.vendorId,_usbId:n.device,_hidId:n.deviceId}},pm=function(n,e){let t={deviceId:null,productId:n.productId,vendorId:n.vendorId,_usbId:typeof n._usbId=="number"?n._usbId:e._usbId,_hidId:typeof n._hidId=="number"?n._hidId:e._hidId},s=typeof t._usbId=="number"?t._usbId:0,r=typeof t._hidId=="number"?t._hidId:0;return console.assert((r&4294901760)==0),console.assert((s&4294901760)==0),t.deviceId=s<<16&4294901760|r&65535,t},oc=class extends rc.default{constructor(){super();this.chomeHidAddedListener=null,this.chromeHidRemovedListener=null,this.chromeUsbAddedListener=null,this.chromeUsbRemovedListener=null,this.allDevices=[],this.pending={},this.pendingTimeout=null}getAttachedDevices(){return this.allDevices}findDeviceByVidPid(e,t){return this.allDevices.find(s=>s.vendorId===e&&s.productId===t)}_deviceAdded(e){console.assert(e&&e.productId),ar&&(console.log("UsbDeviceDiscovery: device-added"),console.dir(e)),this.allDevices.push(e),this.emit("device-added",e)}_deviceRemoved(e,t){let s,r=this.allDevices.length;for(typeof t!="string"&&(t="deviceId"),s=0;s<r;++s)if(console.dir(this.allDevices[s]),this.allDevices[s][t]===e.deviceId){ar&&(console.log("UsbDeviceDiscovery: device-removed"),console.dir(e));let i=this.allDevices.splice(s,1)[0];this.emit("device-removed",i);break}}_deviceAdded_BlacklistHID(e){let t=this.pending[e.productId];this.pending[e.productId]=pm(e,t||{}),ar&&(console.log("UsbDeviceDiscovery._deviceAdded_BlacklistHID: device added"),console.dir(e)),clearTimeout(this.pendingTimeout),this.pendingTimeout=setTimeout(()=>{let{pending:s}=this;this.pending={},Object.keys(s).forEach(r=>{let i=s[r];i.deviceId!==null?this._deviceAdded(i):(this.pending[r]=i,console.error("Failed to resolve merged USB/HID device"),console.error(i)),clearTimeout(this.pendingTimeout),this.pendingTimeout=null})},250)}_deviceRemoved_BlacklistHID(e,t){this._deviceRemoved(e,t)}start(){function e(s){return s=s||{},new Promise((r,i)=>{window.chrome.hid.getDevices(s,o=>{nc(i)&&r(o)})})}function t(s){return s=s||{},new Promise((r,i)=>{window.chrome.usb.getDevices(s,o=>{nc(i)&&r(o)})})}e().then(s=>{s.forEach(r=>{r=lr(r),ar&&(console.log("add device from HID STARTUP"),console.dir(r)),Es(r)?this._deviceAdded_BlacklistHID(r):this._deviceAdded(r)})}),t().then(s=>{s.forEach(r=>{r=lr(r),ar&&(console.log("add device from USB STARTUP"),console.dir(r)),Es(r)?this._deviceAdded_BlacklistHID(r):_n(r)||this._deviceAdded(r)})}),this._bindEvents()}_bindEvents(){this.chomeHidAddedListener=e=>{e=lr(e),Es(e)?this._deviceAdded_BlacklistHID(e):this._deviceAdded(e)},this.chromeHidRemovedListener=e=>{let t=this.allDevices.find(s=>s._hidId===e);t&&(Es(t)?this._deviceRemoved_BlacklistHID(t,"_hidId"):this._deviceRemoved(t))},this.chromeUsbAddedListener=e=>{e=lr(e),Es(e)?this._deviceAdded_BlacklistHID(e):_n(e)||this._deviceAdded(e)},this.chromeUsbRemovedListener=e=>{e=lr(e),Es(e)?this._deviceRemoved_BlacklistHID(e,"_usbId"):_n(e)||this._deviceRemoved(e)},window.chrome.hid.onDeviceAdded.addListener(this.chomeHidAddedListener),window.chrome.hid.onDeviceRemoved.addListener(this.chromeHidRemovedListener),window.chrome.usb.onDeviceAdded.addListener(this.chromeUsbAddedListener),window.chrome.usb.onDeviceRemoved.addListener(this.chromeUsbRemovedListener)}stop(){window.chrome.hid.onDeviceAdded.removeListener(this.chomeHidAddedListener),window.chrome.hid.onDeviceRemoved.removeListener(this.chromeHidRemovedListener),window.chrome.usb.onDeviceAdded.removeListener(this.chromeUsbAddedListener),window.chrome.usb.onDeviceRemoved.removeListener(this.chromeUsbRemovedListener),this.chomeHidAddedListener=null,this.chromeHidRemovedListener=null,this.chromeUsbAddedListener=null,this.chromeUsbRemovedListener=null}},Dn=window.chrome&&window.chrome.hid?oc:null;var _s=!1,mm=5e3,fm="resources/firmware.json",cr=class extends ac.default{constructor(e){super();this.nativeModulesAPI=e.nativeModulesAPI,this.api=e.api,this.usbDiscovery=null,this.sensorMap=e.sensorMap,this.deviceServerPorts=e.deviceServerPorts,this.appManifest=e.appManifest,this._timeUnits="s",Object.keys(En).forEach(t=>this.api.on(t,En[t].bind(this))),this.mode="time-based",this.isTimeBased=!0,this.spectrumMode="",this.defaultTimeParams={},this.defaultEventParams={delta:.25,name:M("Event"),units:"",accumulate:0,average:!1,isDirty:!1},this.defaultDropCountingParams={delta:.1},this.defaultFullSpectrumParams={},this.defaultPhotogateTimingParams={subMode:"motion",numEvents:8,params:{units:"m",barWidth:.05}},this.eventBasedParams={},this.paramsLookup={},this.timeBasedParams={},this.dataMarksEnabled=!1,this._pollDevicesTimerId=null,lt(this,{dataMarksEnabled:ye,setDataMarksEnabled:fe,setDefaultParams:fe})}get timeUnits(){return this._timeUnits}set timeUnits(e){this._timeUnits=e,this.timeBasedParams&&(this.timeBasedParams.units=e,this.emit("time-units-changed",e))}setSensorWorld(e){this.sensorWorld=e}setDefaultParams(e){e||(this.timeBasedParams={},this.timeUnits="s",this.timeBasedParams=P({},this.defaultTimeParams),this.timeBasedParams.units=this.timeUnits,this.eventBasedParams=P({},this.defaultEventParams),this.dataMarksEnabled=!1),this.paramsLookup={"time-based":this.timeBasedParams,"event-based":this.eventBasedParams,"events-with-entry":this.eventBasedParams,"selected-events":this.eventBasedParams,"drop-counting":this.defaultDropCountingParams,"photogate-timing":this.defaultPhotogateTimingParams,"full-spectrum":this.defaultFullSpectrumParams}}cancelKeep(){return this.api.cancelKeep(this.experimentId)}init(e={}){console.assert(e.sensorMap),this.deviceServerPorts&&(e.deviceServerPorts=this.deviceServerPorts),e.hasOwnProperty("hasFirmwareUpdater")||(e.hasFirmwareUpdater=!0),e.featureFlags||(e.featureFlags=il());let t={},{appManifest:s}=this;t.platform=window.navigator.platform,t.version=s.getAppVersion(),t.shortName=s.getAppShortName(),e.appInfo=t;let r=()=>{!this.usbDiscovery&&Dn&&(this.usbDiscovery=new Dn,this.usbDiscovery.on("device-added",this.usbDeviceAttached.bind(this)),this.usbDiscovery.on("device-removed",i=>{this.usbDeviceDetached(i).then(()=>{this.emit("device-detached")})}),this.usbDiscovery.start())};return new Promise((i,o)=>{let l=c=>{e.firmwareInfo=c,this.nativeModulesAPI.init(e).then(u=>{{r();let p=()=>{this.experimentId&&this.api.pollDevices(this.experimentId),this._pollDevicesTimerId=setTimeout(p,2e3)};this._pollDevicesTimerId=setTimeout(p,0)}if(u.defaults){let{defaults:p}=u;this.defaultTimeParams=p.defaultTimeBasedParams,this.defaultEventParams.delta=p.defaultEventsModeParams.delta,this.setDefaultParams()}typeof u.enums=="object"&&Object.keys(u.enums).forEach(p=>{cr[p]=u.enums[p],this[p]=u.enums[p]}),i(u)}).catch(o)};e.hasFirmwareUpdater?Wt.getJSON(fm).then(l).catch(()=>l({})):l()})}uninit(e){return new Promise((t,s)=>{let r=!1,i=null,o=(...c)=>{clearTimeout(i),r?r=!0:t(...c)};clearTimeout(this._pollDevicesTimerId),this._pollDevicesTimerId=null,this.usbDiscovery&&this.usbDiscovery.stop();let l=setTimeout(()=>{console.warn("Native module uninit failed to complete, forcing."),o()},mm);this.nativeModulesAPI.uninit(e).then(()=>{clearTimeout(l),o()},s)})}createExperiment(){return this.api.createExperiment()}sessionStarting(e={}){this.experimentId=e.experimentId,this.setDefaultParams();let t=e.sessionType==="DataShare"?P({},e):{experimentId:this.experimentId,empty:e.imported||!1};return e.initialDataSetName&&(t.datasetName=e.initialDataSetName),e.sessionType&&(t.sessionType=e.sessionType),e.type&&(t.collectionMode=e.type),e.spectrumMode&&(t.spectrumMode=e.spectrumMode,this._updateSpectrumMode(e.spectrumMode)),e.sessionSubtype&&(t.sessionSubtype=e.sessionSubtype),this.api.sessionStarting(t)}sessionClosing(){this.sensorWorld.resetSensorState();let e=this.experimentId;return this.experimentId=null,this.api.sessionClosing(e)}sessionRestoring(e){return this.experimentId=e.experimentId,this.api.sessionRestoring(e)}usbDeviceAttached(e){return _s&&(console.log("usbDeviceAttached"),console.dir(e)),this.api.usbDeviceAttached(P({experimentId:this.experimentId},e))}usbDeviceDetached(e){return _s&&(console.log("usbDeviceDetached"),console.dir(e)),this.api.usbDeviceDetached(P({experimentId:this.experimentId},e))}setSpectrumDataMode(e){return new Promise(t=>{this.api.setSpectrumDataMode({experimentId:this.experimentId,mode:e}).then(s=>{_s&&(console.log("Set Spectrum Data Mode:"),console.dir(s)),this._updateSpectrumMode(e),t(s)})})}_updateSpectrumMode(e){this.spectrumMode=e,this.emit("spectrum-mode-changed",e)}_setCollectionParams(e){if(!e)return;let t={mode:this.mode,params:St(this.paramsLookup[this.mode])},{mode:s,importing:r,params:i={}}=e,o=s,l,c;this.mode!==o&&this.collectionModeChanged(o,r),this.isTimeBased=!0,i.hasOwnProperty("delta")&&(l=i.delta),i.hasOwnProperty("duration")&&(c=i.duration),o==="photogate-timing"&&(this.paramsLookup[o]=i),i.hasOwnProperty("dataMarksEnabled")&&r&&et.authorized&&this.setDataMarksEnabled(i.dataMarksEnabled,r);let u=this.paramsLookup[o];switch(o){case"selected-events":case"events-with-entry":case"drop-counting":case"photogate-timing":this.isTimeBased=!1;break;default:typeof l!="undefined"&&i.hasOwnProperty("duration")&&i.hasOwnProperty("continuous")&&(u.delta=l,u.duration=c,u.continuous=i.continuous,u.remoteLogging=i.remoteLogging,u.triggering=i.triggering,u.units=i.units,o==="time-based"&&(this.timeUnits=i.units),i.hasOwnProperty("triggering")&&Object.keys(i.triggering).forEach(m=>{this.timeBasedParams.triggering[m]=i.triggering[m]}));break}let p={mode:o,params:this.paramsLookup[o]};this.notifyCollectionParamsChanged(p,t),_s&&(console.log("Collection settings changed:"),console.dir(e))}async setCollectionParams(e,t={},s){if(e!=="manual")return t.hasOwnProperty("delta")||(t.delta=this.paramsLookup[e].delta),e==="time-based"?t.hasOwnProperty("units")&&this.timeUnits!==t.units?this.timeUnits=t.units:t.units=this.timeUnits:e.match("events")&&(this.eventBasedParams.accumulate=t.accumulate,this.eventBasedParams.average=t.average||!1,Number.isNaN(t.accumulate)&&(this.eventBasedParams.accumulate=0)),s?this._setCollectionParams({mode:e,params:t,importing:!0}):await this.api.setCollectionParams({experimentId:this.experimentId,mode:e,params:t})}getCollectionParams(e){return e=e||this.mode,{mode:e,params:this.paramsLookup[e]}}notifyCollectionParamsChanged(e,t){if(e.params&&e.params.continuous&&e.params.delta<.005){let s=P({},e.params);s.continuous=!1,this.setCollectionParams(this.mode,s).then(()=>{_s&&console.warn("reset collection continuous to false due to data rate")})}else this.emit("collection-params-changed",e,t)}collectionModeChanged(e,t){let s=this.mode;this.mode=e,this.emit("collection-mode-changed",{to:e,from:s,importing:t})}prepareRemoteLogging(e){let{deviceId:t,config:s}=e;return this.api.prepareRemoteLogging(this.experimentId,t,s).then(()=>{console.log("successfully prepared remote logging")})}retrieveLoggedData(e){let{deviceId:t,deleteDataAfterRetrieval:s}=e;return this.api.retrieveLoggedData(this.experimentId,t,s)}deleteLoggedData(){return this.api.deleteLoggedData(this.experimentId)}detachRemoteDevices(){return this.api.detachRemoteDevices(this.experimentId)}setMeasurementPeriod(){return Promise.reject(new Error("DataCollection:setMeasurementPeriod is no longer used"))}setCollectionMode(e){return this.api.setCollectionMode(this.experimentId,e)}startMeasurements(e){return new Promise((t,s)=>{let r=i=>{console.error(i),this.emit("start-measurements-failed"),s()};this.api.startMeasurements(this.experimentId,e).then(()=>{t()}).catch(i=>{r(i)})})}stopMeasurements(e={}){return e.experimentId=this.experimentId,this.api.stopMeasurements(e).then(()=>{_s&&console.log("Stop measurements")})}setCanConfigure(e){return this.api.setCanConfigure(this.experimentId,e)}searchForSensors(e){return new Promise((t,s)=>{this.api.searchForSensors(this.experimentId,e).then(()=>{setTimeout(()=>{t()},1e3)},s)})}keepData(){let{sensorWorld:e}=this,t=this.eventBasedParams;return!e.sensors.find(r=>e.isRadiationMonitor(r.id))&&t.accumulate!==0&&!t.average&&(this.eventBasedParams.accumulate=0),this.api.keepData(this.experimentId,Date.now(),t.accumulate,t.average)}enableLiveVoltage(e){return this.api.enableLiveVoltage(this.experimentId,e)}setDataMarksEnabled(e=null,t=!1){e===null&&(e=!this.dataMarksEnabled),this.dataMarksEnabled=e,t||this.api.setDataMarksEnabled(this.experimentId,e)}};var lc=le(_e());var{priv:we}=Zi,Mn=class extends lc.default{constructor({api:e=null,dataWorld:t,permissions:s}={}){super();this[we]={api:e,usbDeviceList:[],bluetoothDeviceList:[],bluetoothAvailable:!0,bluetoothIsDiscovering:!1,bluetoothDiscoveryMode:"gdx"},console.assert(e);let{eventHandlers:r}=Zi;Object.keys(r).forEach(o=>this.api.on(o,r[o].bind(this)));let i=()=>{this.combinedDeviceList.filter(o=>o.orderCode.startsWith("GDX-CART")).forEach(o=>this.updateGdxSmartFanState(o))};this.hasCollectionPrepared=!1,t.on("collection-stopped",()=>{this.hasCollectionPrepared=!1,Oe("ff-smart-fan")&&i()}),t.on("collection-preparing",()=>{this.hasCollectionPrepared=!0,Oe("ff-smart-fan")&&i()}),this.permissions=s,this.dataWorld=t}get api(){return this[we].api}get usbDeviceList(){return this[we].usbDeviceList.slice()}get bluetoothDeviceList(){return this[we].bluetoothDeviceList.slice()}get bluetoothAvailable(){return this[we].bluetoothAvailable}get combinedDeviceList(){return this[we].usbDeviceList.concat(this[we].bluetoothDeviceList)}get bluetoothIsDiscovering(){return this[we].bluetoothIsDiscovering}get bluetoothDiscoveryMode(){return this[we].bluetoothDiscoveryMode}get hasConnectedDevices(){return this.getConnectedDevices().length>0}get connectedBluetoothDevices(){let e=[];return this[we].bluetoothDeviceList.forEach(t=>{t.connected&&e.push(t)}),e}get connectedUsbDevices(){let e=[];return this[we].usbDeviceList.forEach(t=>{t.connected&&e.push(t)}),e}get connectedDataLoggingDevices(){return[...this[we].usbDeviceList,...this[we].bluetoothDeviceList].filter(e=>e.connected&&e.supportsOfflineCollection)}getDevice(e){let t;return this[we].usbDeviceList.concat(this[we].bluetoothDeviceList).forEach(r=>{r.id===e&&(t=r)}),t}getConnectedDevices(){let e=[];return this[we].usbDeviceList.concat(this[we].bluetoothDeviceList).forEach(s=>{s.connected&&e.push(s)}),e}async startBluetoothDiscovery(){let e=await this.permissions.requestBluetooth();return e.success?(this[we].bluetoothIsDiscovering=!0,this[we].bluetoothDiscoveryMode="gdx",this.api.startBluetoothDiscovery(this.dataWorld.experimentId)):e}stopBluetoothDiscovery(){return this[we].bluetoothIsDiscovering=!1,this.api.stopBluetoothDiscovery(this.dataWorld.experimentId)}async startLabquestStreamDiscovery(){let e=await this.permissions.requestBluetooth();return e.success?(this[we].bluetoothIsDiscovering=!0,this[we].bluetoothDiscoveryMode="lqstream",this.api.startLabquestStreamDiscovery(this.dataWorld.experimentId)):e}stopLabquestStreamDiscovery(){return this[we].bluetoothIsDiscovering=!1,this.api.stopLabquestStreamDiscovery(this.dataWorld.experimentId)}discoverLabQuestStream(){return this.api.startLabquestStreamDiscovery(this.dataWorld.experimentId)}connectBluetoothDevice(e){return this.api.connectBluetoothDevice(this.dataWorld.experimentId,e.id)}disconnectDevice(e){return this.api.disconnectDevice(this.dataWorld.experimentId,e.id)}enableDeviceChannel(e,t,s){return this.api.enableDeviceChannel(this.dataWorld.experimentId,e,t,s)}identifyDevice(e){return this.api.identifyDevice(this.dataWorld.experimentId,e)}getGdxSensorMap(e){return this.api.getGdxSensorMap(this.dataWorld.experimentId,e)}writeDeviceAttributes(e,t){return this.api.writeDeviceAttributes(this.dataWorld.experimentId,e,t)}startCalibrationProcess(e,t){return this.api.startCalibrationProcess(this.dataWorld.experimentId,e,t)}startCalibrationProcessStep(e,t,s,r){return this.api.startCalibrationProcessStep(this.dataWorld.experimentId,e,t,s,r)}updateCalibrationProcessStep(e,t,s,r){return this.api.updateCalibrationProcessStep(this.dataWorld.experimentId,e,t,s,r)}stopCalibrationProcessStep(e,t,s,r){return this.api.stopCalibrationProcessStep(this.dataWorld.experimentId,e,t,s,r)}cancelCalibrationProcess(e,t){return this.api.stopCalibrationProcess(this.dataWorld.experimentId,e,t,!1)}keepCalibrationProcess(e,t){return this.api.stopCalibrationProcess(this.dataWorld.experimentId,e,t,!0)}resetFactoryCalibration(e){return this.api.resetFactoryCalibration(this.dataWorld.experimentId,e)}usingFactoryCalibration(e){return this.api.usingFactoryCalibration(this.dataWorld.experimentId,e)}updateGdxCartFanSettings(e,{thrustVal:t,isFanAlwaysEnabled:s}){let r=this.combinedDeviceList.find(i=>i.id===e);console.assert(r.orderCode.startsWith("GDX-CART")),r._update({gdxCartFanThrustVal:t,isGdxCartFanAlwaysEnabled:s}),this.updateGdxSmartFanState(r)}updateGdxSmartFanState(e){let{gdxCartFanThrustVal:t,isGdxCartFanAlwaysEnabled:s}=e,{hasCollectionPrepared:r}=this,o=s||r?t:0,l=o>=0?0:1,c=Math.abs(o),u={"Auxiliary Port Mode":1,"Fan Mode":l,"FAN PWM":c},p=e.deviceAttributes.map(m=>({attribID:m.id,value:Object.keys(u).includes(m.description)?u[m.description]:m.value}));this.writeDeviceAttributes(e.id,p)}async getGdxDeviceSources(){return this.api.getGdxDeviceSources(this.dataWorld.experimentId)}_notifyDeviceListChanged({to:e,from:t},s){s("device-list-changed",e);let r=e.filter(c=>c.connected),i=t.filter(c=>c.connected),o=Xi(r,i,(c,u)=>c.id===u.id),l=Xi(i,r,(c,u)=>u.id===c.id);o.forEach(c=>{s("device-connected",c)}),l.forEach(c=>{s("device-disconnected",c)})}};var gm="1.0.0",Qr=class{constructor(e={}){this._blockId=e.blockId,this._version=gm,this.showsTable=e.showsTable??!1,this.graphIds=e.graphIds??[],this.numberOfGraphs=e.numberOfGraphs??(e.type==="graph"?1:0),this.meterIds=e.meterIds??[],this.meterSize=e.meterSize??"",this.type=e.type,this.layout=e.layout??{},this._observers=[],lt(this,{showsGraphs:Js,showsTable:ye,numberOfGraphs:ye,graphIds:ye,meterIds:ye,meterSize:ye,type:ye,layout:ye})}get showsGraphs(){return this.numberOfGraphs>0}importValues({version:e,showsTable:t,graphIds:s,meterIds:r,meterSize:i,layout:o}){e!==this.version&&console.warn(`Attempting to import BlockInfo version ${this.version} from version ${e}`),t!==void 0&&(this.showsTable=t),s!==void 0&&(this.graphIds=s),r!==void 0&&(this.meterIds=r),i!==void 0&&(this.meterSize=i),o!==void 0&&(this.layout=o)}exportValues(){return{blockId:this.blockId,version:this.version,showsTable:this.showsTable,graphIds:[...new Set(this.graphIds)],numberOfGraphs:this.numberOfGraphs,meterIds:[...new Set(this.meterIds)],meterSize:this.meterSize,type:this.type,layout:this.layout}}get blockId(){return this._blockId}get version(){return this._version}static get GRAPH_NAMES(){return["graph_1","graph_2","graph_3"]}addObserver(e){let t=Za(this,()=>{e(this.exportValues())});this._observers.push(t)}stopObserving(){this._observers.forEach(e=>e()),this._observers=[]}};var Tn=class{constructor({api:e=null}){this.api=e}async getDocumentAge(e){return this.api.getDocumentAge(e)}getAllBlockIdentifiers(e){return this.api.getAllBlockIdentifiers(e)}removeInfoForBlockId(e,t){return this.api.removeInfoForBlockId(e,t)}async setBlockId(e,t,s={}){this._blockId=t;try{let r=await this.api.getInfoForBlockId(e,t);this._blockInfo=new Qr(JSON.parse(r)),this._blockInfo.rehydrated=!0}catch(r){console.warn(r),this._blockInfo=new Qr(s),this.api.setInfoForBlockId(e,t,JSON.stringify(s))}return this._blockInfo.addObserver(async r=>{try{await this.api.setInfoForBlockId(e,this._blockId,JSON.stringify(r))}catch(i){console.error(i)}}),this._blockInfo}get blockId(){return this._blockId||0}get isBlock(){return!!this._blockId}get blockInfo(){return this._blockInfo}};var cc=le(_e()),Rn=class extends cc.default{constructor(e){super();this.TIME_WARNING_THRESHOLD_MS=80;this._hackIdCounter=1e3;this._formatMeterInfo=e=>(e.id&&(e.id=parseInt(e.id)),e.columnId&&(e.columnId=parseInt(e.columnId)),e.sensorId&&(e.sensorId=parseInt(e.sensorId)),e.sensorMatchAutoId&&(e.sensorMatchAutoId=parseInt(e.sensorMatchAutoId)),e);this.rpc=e;let t={};["dw:data-set-added","dw:data-set-ready","dw:data-set-removed","dw:data-column-added","dw:data-column-removed","dw:data-column-updated","dw:data-set-updated","dw:unit-change-finished","dw:data-set-row-added","dw:data-column-values-updated","dw:data-column-live-readout-changed","dw:data-graph-updated","dw:data-annotation-updated","dw:data-video-updated","dw:data-group-added","dw:data-group-removed","dw:data-group-properties-changed","dw:session-started","dw:document-age-updated","gc-collection-started","collection-started","collection-ended","complete-collection","trigger-reached","prestore-reached","replay-engine-update","dw:strikethrough-changed","dw:video-trace-object-color-changed"].forEach(s=>{t[s]=(r,i)=>{let{params:o}=i,l=Date.now();this.emit(s,o);let c=Date.now()-l;c>this.TIME_WARNING_THRESHOLD_MS&&this.emit("rpc-time-warning",{rpcId:s,duration:c,threshold:this.TIME_WARNING_THRESHOLD_MS})}}),this.rpc.registerMethods(t,this)}setSessionReadyForDataCollection(e){return this.rpc.sendRequest("experiment-ready-for-data-collection",{experimentId:e})}getPageAttributes(e={}){return this.rpc.sendRequest("page-attributes",e)}setExperimentName(e){return this.rpc.sendRequest("set-experiment-name",e)}calculateSparkLineForColumn(e){return this.rpc.sendRequest("sparkline-for-column",e)}getDataShareSource(e){return this.rpc.sendRequest("data-share-source",e)}createNewDataSet(e){return this.rpc.sendRequest("create-new-dataset",e)}createNewColumn(e){return this.rpc.sendRequest("create-new-column",e)}createManualColumnGroup(e){return this.rpc.sendRequest("create-user-manual-column",e)}createUserCalcColumnGroup(e){return this.rpc.sendRequest("create-user-calc-column",e)}removeColumnGroup(e){return this.rpc.sendRequest("remove-column-group",e)}updateDataSetProperties(e){return this.rpc.sendRequest("update-dataset-properties",e)}updateColumnGroup(e){return this.rpc.sendRequest("update-column-group",e)}strikeRows(e){return this.rpc.sendRequest("strike-rows",e)}unstrikeAllRows(e){return this.rpc.sendRequest("unstrike-all-rows",e)}updateColumnValues(e){return this.rpc.sendRequest("update-column-values",e)}changeColumnDataType(e){return this.rpc.sendRequest("change-column-data-type",e)}addEventData(e){return this.rpc.sendRequest("add-event-data",e)}changeColumnUnit(e){return this.rpc.sendRequest("change-column-unit",e)}changeColumnProperties(e){return this.rpc.sendRequest("change-column-properties",e)}addGraph(e){return this.rpc.sendRequest("add-graph",e)}changeGraphProperties(e){let t=P({},e);return e.appearance?.bars||e.bars?t.type="bar-chart":(e?.appearance?.lines||e?.appearance?.points||e?.lines||e?.points)&&(t.type="normal"),this.rpc.sendRequest("change-graph",t)}addGraphTraces(e){return this.rpc.sendRequest("add-graph-traces",e)}removeGraphTraces(e){return this.rpc.sendRequest("remove-graph-traces",e)}addGraphCurveFit(e){return this.rpc.sendRequest("add-graph-curve-fit",e)}removeGraphCurveFit(e){return this.rpc.sendRequest("remove-graph-curve-fit",e)}addGraphIntegral(e){return this.rpc.sendRequest("add-graph-integral",e)}removeGraphIntegral(e){return this.rpc.sendRequest("remove-graph-integral",e)}addGraphPeakIntegral(e){return this.rpc.sendRequest("add-or-change-graph-peak-integral",e)}removeGraphPeakIntegral(e){return this.rpc.sendRequest("remove-graph-peak-integral",e)}addGraphStats(e){return this.rpc.sendRequest("add-graph-stats",e)}removeGraphStats(e){return this.rpc.sendRequest("remove-graph-stats",e)}setInfoBoxInfo(e){return this.rpc.sendRequest("set-infoxbox-info",e)}fetchGraphAnnotations(e){return this.rpc.sendRequest("fetch-graph-annotations",{experimentId:e})}addGraphAnnotation(e){return this.rpc.sendRequest("add-graph-annotation",e)}updateGraphAnnotation(e){this.rpc.sendRequest("update-graph-annotation",e)}removeGraphAnnotation(e){return this.rpc.sendRequest("remove-graph-annotation",e)}removeDataSet(e){return this.rpc.sendRequest("remove-dataset",e)}checkRecoveryFile(e){return this.rpc.sendRequest("check-recovery-file",{experimentId:e})}getDocumentAge(e){return this.rpc.sendRequest("document-age",{experimentId:e})}exportData(e){return this.rpc.sendRequest("export",e)}importData(e,t,s){return this.rpc.sendRequest("import",{path:e,format:t,content:s})}getDocumentMetaData(e){return this.rpc.sendRequest("document-meta-data",e)}setSessionSubtype(e){return this.rpc.sendRequest("set-experiment-subtype",e)}setNotesState(e){return this.rpc.sendRequest("set-notes-state",e)}getNotesState(e){return this.rpc.sendRequest("get-notes-state",{experimentId:e})}setCustomCurveFit(e){return this.rpc.sendRequest("set-custom-curve-fit",e)}getCustomCurveFits(e){return this.rpc.sendRequest("get-custom-curve-fits",{experimentId:e})}getCalcColumnFunctions(e){return this.rpc.sendRequest("get-calc-column-functions",{experimentId:e})}getUserConstants(e){return this.rpc.sendRequest("get-user-constants",{experimentId:e})}addUserConstant(e,t){return this.rpc.sendRequest("add-user-constant",P({experimentId:e},t))}changeUserConstant(e,t,s){return this.rpc.sendRequest("change-user-constant",P({experimentId:e,constantId:t},s))}deleteUserConstant(e,t){return this.rpc.sendRequest("delete-user-constant",{experimentId:e,constantId:t})}_prepareAuxBindings(e){return e?e.map(t=>({inputBaseId:parseInt(t.inputBaseId??0),inputTraceId:parseInt(t.inputTraceId??0),inputColumn:parseInt(t.inputColumn??0),outputBaseId:parseInt(t.outputBaseId),outputTraceId:parseInt(t.outputTraceId)})):[]}addAuxGraph(e,t,s,r){let i=parseInt(t);return r.columnBindings=this._prepareAuxBindings(r.columnBindings),this.rpc.sendRequest("add-aux-graph",{experimentId:e,parentGraphId:i,auxGraphType:s,auxInfo:r})}updateAuxGraphInfo(e,t,s){let r=parseInt(t);return s.columnBindings=this._prepareAuxBindings(s.columnBindings),this.rpc.sendRequest("update-aux-graph",{experimentId:e,auxGraphId:r,auxInfo:s})}deleteAuxGraph(e,t){let s=parseInt(t);return this.rpc.sendRequest("delete-aux-graph",{experimentId:e,auxGraphId:s})}setBlockInfo(e,t){return this.rpc.sendRequest("set-block-info",{experimentId:e,blockInfo:t})}getBlockInfo(e){return this.rpc.sendRequest("get-block-info",{experimentId:e})}fetchAllDataMarks(e){return this.rpc.sendRequest("fetch-all-datamarks",{experimentId:e})}addDataMark(e){return this.rpc.sendRequest("add-datamark",e)}updateDataMark(e){return this.rpc.sendRequest("update-datamark",e)}removeDataMark(e){return this.rpc.sendRequest("remove-datamark",e)}addMeter(e){return this.rpc.sendRequest("udm:add-meter",this._formatMeterInfo(e))}getMeter(e,t){return this.rpc.sendRequest("udm:get-meter",{experimentId:e,id:t})}updateMeter(e){return this.rpc.sendRequest("udm:update-meter",e)}removeMeter(e){return this.rpc.sendRequest("udm:remove-meter",e)}getAllMeters(e){return this.rpc.sendRequest("udm:get-all-meters",{experimentId:e})}getDerivativePoints(e){return this.rpc.sendRequest("get-derivative-points",{experimentId:e})}setDerivativePoints(e){return this.rpc.sendRequest("set-derivative-points",e)}getSmoothingPoints(e){return this.rpc.sendRequest("get-smoothing-points",{experimentId:e})}setSmoothingPoints(e){return this.rpc.sendRequest("set-smoothing-points",e)}getLayoutProperties(e){return this.rpc.sendRequest("get-layout-flags",{experimentId:e})}setLayoutProperties(e,t){return this.rpc.sendRequest("set-layout-flags",P({experimentId:e},t))}freezeColumn(e,t,s){return this.rpc.sendRequest("freeze-column",{udmId:e,freeze:t,experimentId:s})}fetchAllManualFits(e){return this.rpc.sendRequest("get-all-manual-fits",{experimentId:e})}addManualFit(e,t){return this.rpc.sendRequest("add-manual-fit",P({experimentId:e},t))}getManualFit(e,t){return this.rpc.sendRequest("get-manual-fit",{experimentId:e,fitId:t})}updateManualFit(e,t){return this.rpc.sendRequest("update-manual-fit",P({experimentId:e},t))}removeManualFit(e,t){return this.rpc.sendRequest("remove-manual-fit",{experimentId:e,id:t})}};var dc=le(_e()),An=class extends dc.default{constructor(e){super();this.rpc=e;let t={};["device-connection-changed","sensor-added","sensor-ready","sensor-id-changed","sensor-removed","sensor-online","sensor-offline","sensor-live-voltage","sensor-live-spectrum","sensor-data","sensor-property-change","sensor-calibration-changed"].forEach(s=>{t[s]=(r,i)=>{let{params:o}=i;this.emit(s,o)}}),this.rpc.registerMethods(t,this)}setIgnoreAddedSensors(e,t){return this.rpc.sendRequest("sw:ignore-added-sensors",{experimentId:e,ignoreSensors:t})}changeSensorUnit(e,t,s){return this.rpc.sendRequest("sw:change-sensor-unit",{experimentId:e,id:t,unit:s})}calculateCalibrationCoeffs(e,t,s,r){return this.rpc.sendRequest("calculate-calibration-coefficients",{experimentId:e,sensorId:t,voltages:s,references:r})}setCalibration(e,t,s){let r={experimentId:e,sensorId:t,coeffs:s};return this.rpc.sendRequest("set-sensor-calibration",r)}setSelectedWavelength(e,t,s){let r={experimentId:e,sensorId:t,wavelength:s||0};return this.rpc.sendRequest("set-sensor-selected-wavelength",r)}zeroSensor(e,t,s){return this.rpc.sendRequest("zero-sensor",{experimentId:e,sensorId:t,value:s})}reverseSensor(e,t){return this.rpc.sendRequest("reverse-sensor",{experimentId:e,sensorId:t})}setSensorModeX4(e,t,s){return this.rpc.sendRequest("set-sensor-mode-x4",{experimentId:e,sensorId:t,enable:s})}setSensorZeroOnCollect(e,t,s){return this.rpc.sendRequest("set-sensor-zero-on-collect",{experimentId:e,sensorId:t,enable:s})}takeDarkReference(e,t){return this.rpc.sendRequest("take-dark-reference",{experimentId:e,sensorId:t})}calibrateSpectrometer(e,t){return this.rpc.sendRequest("calibrate",{experimentId:e,sensorId:t})}setSpecSettings(e,t,s){return this.rpc.sendRequest("set-spec-settings",P({experimentId:e,sensorID:t},s))}enableSoftDevice(e){return this.rpc.sendRequest("enable-soft-device",{experimentId:e})}disableSoftDevice(e){return this.rpc.sendRequest("disable-soft-device",{experimentId:e})}enableSoftSignWaveSensor(e,t){return this.rpc.sendRequest("enable-soft-sine-wave-sensor",{experimentId:e,sensorTypeId:t})}enableAndConfigureSoftSignWaveSensor(e,t,s,r,i){return this.rpc.sendRequest("enable-and-configure-soft-sine-wave-sensor",{experimentId:e,sensorTypeId:t,frequency:s,amplitude:r,offset:i})}disableSoftSignWaveSensor(e,t){return this.rpc.sendRequest("disable-soft-sine-wave-sensor",{experimentId:e,sensorTypeId:t})}enableSpecialSoftSensor(e){return this.rpc.sendRequest("enable-soft-sensor",{experimentId:e})}configureSpecialSoftSensor(e={experimentId:0,scale:1,offset:0,levelOutput:!1}){return this.rpc.sendRequest("configure-soft-sensor",e)}disableSpecialSoftSensor(e){return this.rpc.sendRequest("disable-soft-sensor",{experimentId:e})}addSoft2Device(e){return this.rpc.sendRequest("add-soft2-device",{orderCode:e})}removeSoft2Device(e){return this.rpc.sendRequest("remove-soft2-device",{deviceId:e})}getSoft2DeviceConfig(e){return this.rpc.sendRequest("get-soft2-device-config",{deviceId:e})}setSoft2DeviceConfig(e,t){return this.rpc.sendRequest("set-soft2-device-config",{deviceId:e,config:t})}addSoft2Sensor(e,t,s="",r=0){return this.rpc.sendRequest("add-soft2-sensor",{deviceId:e,channelNumber:t,orderCode:s,sensorId:r})}removeSoft2Sensor(e,t){return this.rpc.sendRequest("remove-soft2-sensor",{deviceId:e,channelNumber:t})}freezeSoft2Device(e,t){return this.rpc.sendRequest("freeze-soft2-device",{deviceId:e,atTimeCount:t})}unfreezeSoft2Device(e){return this.rpc.sendRequest("unfreeze-soft2-device",{deviceId:e})}initSoft2DeviceInterface(){return this.rpc.sendRequest("init-soft2-device-interface",{})}};var uc=le(_e()),Pn=class extends uc.default{constructor(e){super();this.rpc=e;let t={};["devmgr:bluetooth-available","devmgr:bluetooth-device-discovered","devmgr:bluetooth-device-removed","devmgr:bluetooth-device-updated","devmgr:usb-device-added","devmgr:usb-device-removed","devmgr:usb-device-updated","devmgr:calibration-step-result","devmgr:device-attributes-changed"].forEach(s=>{t[s]=(r,i)=>{let{params:o}=i;this.emit(s,o)}}),this.rpc.registerMethods(t,this)}startBluetoothDiscovery(e){return this.rpc.sendRequest("start-bluetooth-discovery",{experimentId:e})}stopBluetoothDiscovery(e){return this.rpc.sendRequest("stop-bluetooth-discovery",{experimentId:e})}startLabquestStreamDiscovery(e){return this.rpc.sendRequest("start-labquest-stream-discovery",{experimentId:e})}stopLabquestStreamDiscovery(e){return this.rpc.sendRequest("stop-labquest-stream-discovery",{experimentId:e})}connectBluetoothDevice(e,t){return this.rpc.sendRequest("connect-bluetooth-device",{experimentId:e,deviceId:t})}disconnectDevice(e,t){return this.rpc.sendRequest("disconnect-device",{experimentId:e,deviceId:t})}enableDeviceChannel(e,t,s,r){return this.rpc.sendRequest("enable-device-channel",{experimentId:e,deviceId:t,channelId:s,enable:r})}identifyDevice(e,t){return this.rpc.sendRequest("identify-device",{experimentId:e,deviceId:t})}getGdxSensorMap(e,t){return this.rpc.sendRequest("get-gdxdevice-map",{experimentId:e,deviceId:t})}writeDeviceAttributes(e,t,s){let r={experimentId:e,deviceID:t,attributes:s};return this.rpc.sendRequest("write-device-attributes",r)}startCalibrationProcess(e,t,s){let r={experimentId:e,deviceId:t,processId:s};return this.rpc.sendRequest("start-calibration-process",r)}startCalibrationProcessStep(e,t,s,r,i){let o={experimentId:e,deviceId:t,processId:s,stepId:r,inputValue:i};return this.rpc.sendRequest("start-calibration-step",o)}updateCalibrationProcessStep(e,t,s,r,i){let o={experimentId:e,deviceId:t,processId:s,stepId:r,inputValue:i};return this.rpc.sendRequest("update-calibration-step",o)}stopCalibrationProcessStep(e,t,s,r,i){let o={experimentId:e,deviceId:t,processId:s,stepId:r,keep:i};return this.rpc.sendRequest("stop-calibration-step",o)}stopCalibrationProcess(e,t,s,r){let i={experimentId:e,deviceId:t,processId:s,keep:r};return this.rpc.sendRequest("stop-calibration-process",i)}resetFactoryCalibration(e,t){return this.rpc.sendRequest("reset-factory-calibration",{experimentId:e,deviceId:t})}usingFactoryCalibration(e,t){return this.rpc.sendRequest("using-factory-calibration",{experimentId:e,deviceId:t})}setGdxCartSmartFanThrust(e,t,s){console.log(`write smart fan to back-end - id: ${t}, thrust: ${s}`)}async getGdxDeviceSources(e){return this.rpc.sendRequest("get-gdx-device-sources",{experimentId:e})}};var hc=le(_e()),kn=class extends hc.default{constructor(e){super();this.rpc=e;let t={};["settings-changed","rolling-counter-error","device-error","keep-values-ready","device-sensor-enum-completed"].forEach(s=>{t[s]=(r,i)=>{let{params:o}=i;this.emit(s,o)}}),this.rpc.registerMethods(t,this)}cancelKeep(e){return this.rpc.sendRequest("keep-cancel",{experimentId:e})}pollDevices(e){return this.rpc.sendRequest("-poll-devices",{experimentId:e})}createExperiment(){return this.rpc.sendRequest("create-experiment")}sessionStarting(e){return this.rpc.sendRequest("experiment-starting",e)}sessionClosing(e){return this.rpc.sendRequest("experiment-closing",{experimentId:e})}sessionRestoring(e){return this.rpc.sendRequest("experiment-restoring",e)}usbDeviceAttached(e){return this.rpc.sendRequest("device-attached",e)}usbDeviceDetached(e){return this.rpc.sendRequest("device-detached",e)}setSpectrumDataMode(e){return this.rpc.sendRequest("set-spectrum-data-mode",e)}setCollectionParams(e){return this.rpc.sendRequest("set-collection-params",e)}setCollectionMode(e,t){return this.rpc.sendRequest("set-collection-mode",{experimentId:e,mode:t})}startMeasurements(e,t){return this.rpc.sendRequest("start-measurements",{experimentId:e,duration:t})}stopMeasurements(e){return this.rpc.sendRequest("stop-measurements",e)}setCanConfigure(e,t){return this.rpc.sendRequest("can-configure",{experimentId:e,canConfigure:t})}searchForSensors(e,t){return this.rpc.sendRequest("search-for-sensors",{experimentId:e,force:t})}keepData(e,t,s,r){return this.rpc.sendRequest("keep-event",{experimentId:e,timestamp:t,accumulate:s,average:r})}enableLiveVoltage(e,t){return this.rpc.sendRequest("enable-live-voltage",{experimentId:e,enable:t})}prepareRemoteLogging(e,t,s){return this.rpc.sendRequest("prepare-remote-logging",{experimentId:e,deviceId:t,config:s})}retrieveLoggedData(e,t,s){return this.rpc.sendRequest("retrieve-logged-data",{experimentId:e,deviceId:t,deleteDataAfterRetrieval:s,runNumber:1})}deleteLoggedData(e){return this.rpc.sendRequest("delete-logged-data",{experimentId:e})}detachRemoteDevices(e){return this.rpc.sendRequest("detach-remote-devices",{experimentId:e})}setDataMarksEnabled(e,t){return this.rpc.sendRequest("set-datamarks-enabled",{experimentId:e,dataMarksEnabled:t})}};var pc=le(_e()),Ln=class extends pc.default{constructor(e){super();this.rpc=e}init(e){return this.rpc.sendRequest("init",e)}uninit(e){return this.rpc.sendRequest("uninit",e)}loggingSetConfig(e){return this.rpc.sendRequest("logging-set-config",e)}loggingGetConfig(e){return this.rpc.sendRequest("logging-get-config",e)}loggingPrintBuildInfo(e){return this.rpc.sendRequest("logging-print-build-info",e)}};var On=class{constructor(e){this.rpc=e}async getDocumentAge(e){return this.rpc.sendRequest("udm:get-document-age",{experimentId:e})}getAllBlockIdentifiers(e){return this.rpc.sendRequest("udm:get-block-ids",{experimentId:e})}async getInfoForBlockId(e,t){return(await this.rpc.sendRequest("udm:get-block-info",{experimentId:e,blockId:t})).info}setInfoForBlockId(e,t,s){return this.rpc.sendRequest("udm:set-block-info",{experimentId:e,info:s,blockId:t})}removeInfoForBlockId(e,t){return this.rpc.sendRequest("udm:remove-block-info",{experimentId:e,blockId:t})}};var fc=le(Bn());function vm(){let n=()=>{},e=[],t=null,s=()=>e.length>0?e[e.length-1]:null,r=()=>{t&&t.disengage(),t=null;let p=s();if(!p)return;let{filters:m,extensions:v}=p,b=m.slice();v.forEach(y=>{y.filters.forEach(w=>b.push(w))}),t=fc.default.maintain.disabled({filter:b})},i=p=>{let m=e.indexOf(p);m!==-1&&e.splice(m),r()},o=p=>{e.push(p),r()},l=p=>{let m=[],v=(y,w)=>{let _;for(_ of y)_.nodeType===Node.ELEMENT_NODE&&w(_)},b=y=>{let w=y.shadowRoot;w&&(m.push(w),b(w)),v(y.children,b)};return v(p,y=>{m.push(y),b(y)}),m},c=(p,m=[])=>{let v=[],b=l(m),y={name:p,targets:m,filters:b,extensions:v,addExtension:w=>{v.push(w),r()},removeExtension:w=>{let _=v.indexOf(w);_!==-1&&v.splice(_)},remove:()=>{y.filters=null,y.extensions=null,y.refreshFocus=n,y.addExtension=n,y.removeExtension=n,y.remove=n,i(y)}};return o(y),y},u=(p,m,v)=>{let b=l(v),y={name:m,targets:v,filters:b,remove:()=>{p.removeExtension(y),y.filters=null,y.remove=n}};return p.addExtension(y),y};return{getDebugInfo:()=>e.map(({name:p,targets:m,filters:v,extensions:b})=>({name:p,targets:m,filters:v,extensions:b.map(({name:y,targets:w,filters:_})=>({name:y,targets:w,filters:_}))})),restrict:(p,m)=>{let v=c(p,m);return()=>{v.remove()}},extend:(p,m)=>{let v=s();if(!v)return n;let b=u(v,p,m);return()=>{b.remove()}}}}var gc={create:vm};var vc=le(_e()),Nn=class extends vc.default{constructor(e){super();this.rpc=e}computeCurveFit(e,t,s,r,i,o){let l={type:e,xVals:t,yVals:s,wVals:r,cVals:i,handle:o};return this.rpc.sendRequest("vsta:compute-curve-fit",l)}calcFitValues(e,t,s,r){let i={type:e,coeffs:t,values:s,handle:r};return this.rpc.sendRequest("vsta:calc-fit-values",i)}computeFFT(e,t,s,r){let i={xVals:e,yVals:t,removeLinear:s,filterType:r};return this.rpc.sendRequest("vsta:compute-fft",i)}computeHistogram(e,t,s){return this.rpc.sendRequest("vsta:compute-histogram",{inputValues:e,binWidth:t,binStart:s})}parseEquation(e){return this.rpc.sendRequest("vsta:parse-equation",e)}releaseHandle(e){return this.rpc.sendRequest("vsta:release-handle",e)}setUseRadians(e){return this.rpc.sendRequest("vsta:set-use-radians",e)}enableLogging(e){return this.rpc.sendRequest("vsta:enable-logging",e)}};var bm="resources/sensormap.json";function ym(n){return Object.freeze({getSensorMap(){return n},getSensorById(e){typeof e!="string"&&(e=`${e}`);let t=n.sensor;function s(u){return{id:u.id,minRange:parseFloat(u["min-range"]),maxRange:parseFloat(u["max-range"]),columnName:u["_column-name"],units:u.units,decimalPlaces:parseFloat(u["decimal-places"])}}function r(u){let p=[];return typeof u!="undefined"&&(u=Array.prototype.concat(u),u.forEach(m=>{p.push(s(m))})),p}function i(u){function p(y){return`k${y}`}let m,v=1,b=[];for(m=p(0);m in u;)b.push(parseFloat(u[m])),m=p(v++);return b}function o(u){let{calibration:p}=u,m=s(p.baseunit),v=r(p.unit);return{type:p.type,id:p.id,coeffs:i(p),unit:v,baseUnit:m,zero:p.zero,reverse:p.reverse,calibrate:p.calibrate,onePoint:p["single-point"]}}function l(u){let p={autoId:parseInt(u["auto-id"],10),type:u.type,id:u.id,family:u._family,name:u._name,minimumDelta:parseFloat(u["minimum-delta"]),typicalDelta:parseFloat(u["typical-delta"]),typicalDuration:parseFloat(u["typical-duration"]),meter:u.calibration.meter,calibration:o(u)};return u.hasOwnProperty("voltage-decimals")&&(p.voltageDecimals=parseFloat(u["voltage-decimals"])),p}let c=t.find(u=>u.id===e);return c&&(c=l(c)),c}})}async function bc(){let n={};try{let e=await Wt.get(bm);n=ym(JSON.parse(e))}catch(e){console.error(e)}return n}var yc=le(_e()),$n=Symbol("priv"),Sc=class extends yc.default{constructor(){super();let e=getComputedStyle(document.documentElement).getPropertyValue("--base-font-size");this._accessibilityScale=parseFloat(e)}get scale(){return this._accessibilityScale}set scale(e){e!==this._accessibilityScale&&(this._accessibilityScale=e,document.documentElement.style.setProperty("--base-font-size",`${e}em`),this.emit("accessibility-scale-changed",this._accessibilityScale))}};function wc(){return[$n].baseFontSize=getComputedStyle(document.documentElement).getPropertyValue("--base-font-size"),[$n].scale=parseFloat([$n].baseFontSize),new Sc}function xc(){let n={};function e(s,r){for(;n[s];)s++;r instanceof Promise?n[s]=()=>r():n[s]=r}function t(){let s=[],r=(o,l)=>o-l;return Object.keys(n).map(o=>parseInt(o)).sort(r).forEach(o=>{s.push(n[o])}),new Promise((o,l)=>{let c=()=>{let u=s.shift();u?u().then(c).catch(l):(n={},o())};c()})}return{add:e,execute:t}}var jn=null,Wn=null;var Cc=null,Un=async()=>{if(await Cc?.(),jn){jn();return}window.close()},Sm=async n=>Wn?Wn(n):!0,Ic=(n=xc(),e=!1)=>({closeWindow(t=!1,s={type:void 0}){return Sm(s)?t===!0||e?Un():(s.returnValue=!1,e=!0,n.execute().then(Un).catch(r=>{r.cancelClose?e=!1:(s.returnValue=!0,Un())})):Promise.resolve()},onClose:{addBeforeClose(t){Cc=t},addPromise(t,s){n.add(t,s)}}});var qn=()=>window.chrome.runtime.getManifest().version_name,Gn=()=>window.chrome.runtime.getManifest().name,Hn=()=>window.chrome.runtime.getManifest().short_name;var dr={},wm=()=>qn?qn():dr.version,xm=()=>Gn?Gn():dr.name,Cm=()=>Hn?Hn():dr.short_name,Ec=async()=>{try{void 0?dr=await(void 0)():dr=await Wt.getJSON("manifest.json")}catch(n){console.warn(n)}return{getAppVersion:wm,getAppName:xm,getAppShortName:Cm}};var Vn=void 0;var Dc=n=>Vn?Vn(n):{get isCheckingForUpdate(){return!1},get isUpdateAvailable(){return!1},get isUpdateDownloading(){return!1},get isUpdateDownloaded(){return!1},checkForUpdates(){return!1},downloadUpdate(){return!1},installUpdate(){return!1},on(){},off(){},once(){}};var Mc={},zn=new Set,Yr=n=>{zn.forEach(e=>e(n))},Tc=n=>{Mc=n},ei=()=>Mc;var Kn=()=>{};var{chrome:dt}=window,Rc=!1,Xn=n=>new Promise((e,t)=>{let s=Object.assign(n,{});s.forEach(r=>{r.description=r.name,delete r.name}),dt.fileSystem.chooseEntry({type:"openFile",accepts:s},r=>{let{lastError:i}=dt.runtime;i?i.message==="User cancelled"?e():(console.error(i),t(i)):r.file(o=>{e({file:o,filepath:dt.fileSystem.retainEntry(r)})},o=>{t(o)})})}),ti=n=>new Promise((e,t)=>{let{suggestedName:s,filters:r}=n;r.forEach(l=>{l.description=l.name,delete l.name});let i=r[0].extensions[0],o=`${s}.${i}`;dt.fileSystem.chooseEntry({type:"saveFile",suggestedName:o,accepts:r},l=>{dt.runtime.lastError?t():e({fileHandle:l,filename:l.name,filepath:dt.fileSystem.retainEntry(l)})})}),Jn=n=>{let{fileHandle:e,blob:t}=n,s=!1;return new Promise((r,i)=>{e.createWriter(o=>{function l(){Rc&&console.warn("Write file failed"),i()}dt.runtime.lastError&&(Rc&&console.log(dt.runtime.lastError),i(dt.runtime.lastError)),o.onerror=l,o.onwriteend=c=>{s||(c.currentTarget.truncate(c.currentTarget.position),s=!0),r(e.fullPath)},o.write(new Blob([t],{type:t.type}))})})},si=n=>new Promise((e,t)=>{dt.fileSystem.restoreEntry(n,s=>{dt.runtime.lastError?t(dt.runtime.lastError):e(s)})}),Zn=(n={})=>{let{dataWorld:e}=ei(),t=ct(),s=n.type||t,{decimal:r}=n,i=e.userFileMetaData.filepath,o=s===t,l=n.suggestedName||zr(e.sessionName,o);return new Promise((c,u)=>{let p=m=>{let{fileHandle:v,filename:b,filepath:y}=m;e.exportData({type:s,fileHandle:v,filename:b,filepath:y,decimal:r}).then(()=>{o&&Yr(b),c(b)}).catch(w=>{u(w)})};o&&!n.saveAs&&!n.suggestedName&&i?si(i).then(m=>{p({fileHandle:m,filename:m.name,filepath:i})}):ti({suggestedName:l,saveAs:!1,filters:[{name:n.appName,mimeTypes:[It(s)],extensions:[s]}]}).then(m=>{m.cancelled?u():p(m)}).catch(m=>{console.error(m),u()})})};var Qn="",Yn="showOpenFilePicker"in window,ur=!1,Im=n=>n.map(e=>({description:e.description,accept:{"*/*":e.extensions.map(t=>`.${t}`)}}));async function Em(n){if(Xn){let e=await Xn(n);return ur={fileHandle:e.file.handle,filepath:e.file.name,filename:e.file.name},e}throw new Error("showOpenDialog is not implemented for this platform.")}var _m=([{extensions:[n]}])=>n?`.${n}`:"";async function Ac(n){if(ti)return ti(n);if(!Yn)return Promise.resolve({filename:n.suggestedName,filepath:n.suggestedName});let{accepts:e}=n,s=await(async()=>{let r={types:Im(e),suggestedName:`${n.suggestedName}${_m(e)}`};return await window.showSaveFilePicker(r)})();return ur={fileHandle:s,filename:s.name,filepath:s.name},ur}async function Dm(n={}){if(Jn)return Jn(n);if(!n.blob)return Promise.reject();try{if(!Yn){let s=n.filepath?n.filepath:"Document",r=window.URL.createObjectURL(n.blob),i=document.createElement("a");return i.download=`${s}.${ct()}`,i.target="_blank",i.title=s,i.href=r,i.click(),s}let{fileHandle:e}=n;if(e.createWriter){let s=await e.createWriter();return await s.write(0,n.blob),await s.close(),!0}let t=await e.createWritable();return await t.write(n.blob),await t.close(),e.name}catch(e){return Promise.reject(e)}}function Mm(n){return si?si(n):Promise.resolve()}async function Tm(n={}){if(Zn){let e=P({appName:Qn},n);return Zn(e)}try{let{dataWorld:e}=ei(),t=ct(),s=n.type||t,{decimal:r}=n,i=e.userFileMetaData.filepath,o=s===t,l=n.suggestedName||zr(e.sessionName,o);i||(i=`${l}.${s}`);let c=async p=>{let{fileHandle:m,filename:v,filepath:b}=p,{filepath:y}=await e.exportData({type:s,fileHandle:m,filename:v,filepath:b,decimal:r});return o&&Yr(y),m};if(!n.saveAs&&ur)return c(ur);let u=await Ac({suggestedName:l,accepts:[{description:Qn,mimeTypes:[It(s)],extensions:[s]}]});return c(u)}catch(e){return e.message==="The user aborted a request."?!1:e}}function Pc(n,e,t){Qn=n,Yn=Oe("ff-web-native-file-system")&&"showOpenFilePicker"in window,Tc({dataWorld:e,popoverManager:t});let s={saveFile:Tm,showOpenDialog:Em,showSaveDialog:Ac,writeFile:Dm,restoreEntry:Mm,onSave(r){zn.add(r)},writeTemporaryFile:Kn};return e.setFileIO(s),s}var ft,kc=()=>{let n=[],e=null,t=()=>{ft.show()},s=()=>{ft.hide(),clearTimeout(e),e=null},r=i=>{ft.message=i.message,i.options.action&&i.options.action.text&&(ft.actionMessage=i.options.action.text,ft.addEventListener("actionClicked",()=>{i.options.action.callback(),s()}));let o=()=>{ft.removeEventListener("transitionend",o),n.length>0&&r(n.shift())};t(),i.options.duration===1/0?e=null:e=setTimeout(()=>{s(),ft.addEventListener("transitionend",o)},i.options.duration)};return{async attachWrapper(i){await import("./chunk/vst-ui-toast-WQBOLSQD.js"),ft=document.createElement("vst-ui-toast"),this.wrapperNode=i,this.wrapperNode.appendChild(ft),ft.addEventListener("doneClicked",()=>{s()})},makeToast(i,o={duration:this.LENGTH_SHORT}){this.wrapperNode||this.attachWrapper(document.body);let l={message:i,options:o};n.push(l),e===null&&r(n.shift())},hideToast(){s()},get element(){return ft},get LENGTH_SHORT(){return 1500},get LENGTH_MEDIUM(){return 5e3},get LENGTH_LONG(){return 1e4},get LENGTH_INDEFINITE(){return 1/0}}};var eo=null;var to=class{constructor(){this.blockResponses=!1;navigator.serviceWorker.addEventListener("message",async e=>{let{type:t,message:s}=e.data;t==="NATIVE_RESPONSE"&&(await this._hasOnmessage,this.checkResponseMessage(s),this.blockResponses||this.onmessage(s))})}checkResponseMessage(){}get _hasOnmessage(){return this.onmessage??(async()=>{for(;!this.onmessage;)await bs(100);return!0})()}postMessage(e){Le.joinedSession.then(t=>{t.postMessage({type:"NATIVE_MESSAGE",message:e})})}},so=class extends to{constructor(){super();navigator.serviceWorker.addEventListener("message",e=>{let{type:t,message:s}=e.data;t==="NATIVE_MESSAGE"&&this.sendNativeMessage(s)}),window.Module&&(window.Module.onRPCServiceNotify=this.checkMessage.bind(this))}checkMessage(){let e=window.Module.vstBackendPollMsg();this._processMessage(e)}_processMessage(e){let t=e?.toJS?e.toJS():e;t&&this.onmessage&&Le.joinedSession.then(s=>{s.postMessage({type:"NATIVE_RESPONSE",message:t})})}_checkGetHostStateMessage(e){let t=!1;if(e.method==="GET_HOST_STATE"){console.assert(Le.getHostServiceState);let s={id:parseInt(e.id),jsonrpc:"2.0",result:P({IS_HOST_SERVICE_STATE:!0},Le.getHostServiceState())};this._processMessage(s),t=!0}else e.method==="CLIENT_STATE_RESTORED"&&(t=!0);return t}sendNativeMessage(e){let t=0;this._checkGetHostStateMessage(e)||(e.method&&e.method.indexOf("vsta:")===0&&(t=1),e=new window.Module.ppVar(e),window.Module.vstBackendSendMsg(e,t),e.delete())}},Rm=n=>n.result?.IS_HOST_SERVICE_STATE,Am=n=>!n.id,ro=class extends to{constructor(){super(...arguments);this.blockResponses=!0;this.addPending=!1;this.pending=[]}checkResponseMessage(e){this.blockResponses&&!Am(e)?this.onmessage(e):this.addPending&&this.pending.push(e),this.blockResponses&&Rm(e)&&(this.addPending=!0,this.onmessage(e))}postMessage(e){e.method==="CLIENT_STATE_RESTORED"?(this.addPending=!1,this.blockResponses=!1,this.pending.forEach(t=>{this.onmessage(t)}),this.pending=[]):super.postMessage(e)}};async function Lc(){return eo?eo():window.__isSessionClient?new ro:new so}var Jt={PARSE_ERROR:-32700,INVALID_REQUEST:-32600,METHOD_NOT_FOUND:-32601,INVALID_PARAMS:-32602,INTERNAL_ERROR:-32603},Pm=1,We;function hr(n){this.msgChannel=n,this.callbacks={}}hr.prototype.sendRequest=function(e,t,s){let r=s,i=t;typeof i=="function"&&(r=i,i=null);let o={id:Pm++,jsonrpc:"2.0",method:e,params:i};this.callbacks[o.id]={callback:r,method:e},We&&We.logRequest("FE","NM",o),this.msgChannel.postMessage(o)};hr.prototype.sendNotification=function(e,t){let s={jsonrpc:"2.0",method:e,params:t};We&&We.logNotification("FE","NM",s),this.msgChannel.postMessage(s)};hr.prototype._processResponse=function(e){if(String(e.jsonrpc)!=="2.0"){console.warn("Received non JSON-RPC 2.0 compliant message");return}if(typeof e.id=="number"){let{callback:t,method:s}=this.callbacks[e.id];We&&We.logResponse("NM","FE",s,e),typeof t=="function"?t(e):console.warn(`Unable to find callback for response.id=${e.id}`),delete this.callbacks[e.id]}else console.warn(`Received invalid response ID: ${e.id}`)};function Ds(n,e){this.msgChannel=n,this.methods=e||{}}Ds.prototype.addMethods=function(e,t=this){e?Object.keys(e).forEach(s=>{this.methods[s]={},this.methods[s].method=e[s],this.methods[s].context=t}):console.error("Incorrect params. Expected: methods")};Ds.prototype.sendResponse=function(e,t){let s={jsonrpc:"2.0",id:e,result:t};We&&We.logResponse("FE","NM","",s),this.msgChannel.postMessage(s)};Ds.prototype.sendErrorResponse=function(e,t,s){let r=s;typeof r!="string"&&(r="Server Error",t===Jt.PARSE_ERROR?r="Parse error":t===Jt.INVALID_REQUEST?r="Invalid Request":t===Jt.METHOD_NOT_FOUND?r="Method not found":t===Jt.INVALID_PARAMS?r="Invalid Parameter(s)":t===Jt.INTERNAL_ERROR&&(r="Internal Error"));let i={jsonrpc:"2.0",id:e,error:{code:t,message:r}};typeof e=="number"?(We&&We.logErrorResponse("NM","FE","",i),this.msgChannel.postMessage(i)):console.warn("RPC Error (response to notification)")};Ds.prototype._processRequest=function(e){if(String(e.jsonrpc)!=="2.0"){console.warn("Received non JSON-RPC 2.0 compliant message");return}try{if(typeof e.method=="string"){let t=this.methods[e.method];if(!t)throw new Error(`handler not found for method ${e.method}`);let{method:s}=t;typeof s=="function"?(We&&(e.id?We.logRequest("NM","FE",e):We.logNotification("NM","FE",e)),s.call(t.context,this,e)):this.sendErrorResponse(e.id,Jt.METHOD_NOT_FOUND,`Method '${e.method}' not found`)}else this.sendErrorResponse(null,Jt.INVALID_REQUEST)}catch(t){console.error(`rpc failed when processing request: ${e.method}`),console.error(t)}};function gt(n,e){this.channel=n,this.methods=e||{},Oe("ff-nm-rpc-logging")&&import("./chunk/RPCLogger-XQCG4WVK.js").then(({RPCLogger:t})=>{We=new t}).catch(t=>{console.error(t)}),this.origin=window.location.origin,window.location.protocol==="chrome-extension:"&&(this.origin="*"),this.server=new Ds(this),this.client=new hr(this)}gt.prototype.setChannel=function(e){this.channel=e};gt.prototype.registerMethods=function(e,t){e?this.server.addMethods(e,t):console.error("Inncorrect paramaters. Expected: methods")};gt.prototype.getClient=function(){return this.client};gt.prototype.getServer=function(){return this.server};gt.prototype.postMessage=function(e){this.origin?this.channel.postMessage(e,this.origin):this.channel.postMessage(e)};gt.prototype.processMessage=function(e){e.method?this.server._processRequest(e):this.client._processResponse(e)};function Oc(n){let e=n.error.message||"RPC Response Error";Error.call(this,e),this.response=n,this.error=n.error,this.message=e}Oc.prototype=Object.create(Error.prototype);gt.prototype.sendRequest=function(e,t){let{client:s}=this,r=t;return new Promise((i,o)=>{typeof r=="undefined"&&(r=null),s.sendRequest(e,r,l=>{l.error?o(new Oc(l)):i(l.result)})})};gt.prototype.sendNotification=function(...e){let{client:t}=this;t.sendNotification(e)};gt.prototype.sendResponse=function(...e){let{server:t}=this;t.sendResponse(e)};gt.prototype.getLogString=()=>We?We.getLogString():"";var ri={RPCErrorCode:Jt,RPCMessageChannel:gt,RPCMessageClient:hr,RPCMessageServer:Ds};var{RPCMessageChannel:km}=ri,ii=!1,Ve={startup:{progress:null,resolve:null,reject:null,module:null,listener:null}};function Lm(n){let e=null;return n&&(n instanceof ArrayBuffer||n.buffer&&n.buffer instanceof ArrayBuffer)&&(e=n.buffer?n.buffer:n),e}function Fc(n){let e=n;return n&&typeof n=="object"&&!Array.isArray(n)&&(e={},Object.keys(n).forEach(t=>{let s=n[t];s=Lm(s)||Fc(s),e[t]=s})),e}var Bc=class extends km{postMessage(e){let t=typeof e!="string"?Fc(e):e;super.postMessage(t)}};function Om(n){ii&&(console.log("--- Module Started Loading ---"),console.dir(n))}function Fm(n){let e="--- Module Progress: ",t,s;n.lengthComputable&&(t=n.total,s=n.loaded,Ve.startup.progress(s/t),e+=`${s/(t*100)}%`),ii&&console.log(e)}function Bm(n){ii&&(console.log("--- Module Did Load"),console.dir(n));let e=Ve.startup.module;Ve.rpc=new Bc(e),Ve.rpc.origin=null,e.addEventListener("message",t=>Ve.rpc.processMessage(t.data)),Ve.startup.resolve({rpc:Ve.rpc,listener:Ve.startup.listener})}function Nm(n){ii&&(console.log("--- Module LoadEnd:"),console.dir(n))}function $m(n){console.error("--- Module Error:"),console.error(n),Ve.startup.reject({message:"Native Client Startup Error",event:n})}function jm(n){console.error("--- Module Abort:"),console.error(n),Ve.startup.reject({message:"Native Client Startup Aborted",event:n})}function Wm(n){console.error("--- Module Crash:"),console.error(n)}function Um(n){let e=document.createElement("div");e.style.width="0",e.style.height="0",e.addEventListener("loadstart",Om,!0),e.addEventListener("progress",Fm,!0),e.addEventListener("load",Bm,!0),e.addEventListener("loadend",Nm,!0),e.addEventListener("error",$m,!0),e.addEventListener("abort",jm,!0),e.addEventListener("crash",Wm,!0),n=de(P({},n),{width:0,height:0});let t=document.createElement("embed");return t.setAttribute("width",n.width),t.setAttribute("height",n.height),t.setAttribute("src",n.src),t.setAttribute("type",n.type),e.appendChild(t),{wrapper:e,module:t}}function qm(n,e){let t=Um({src:"resources/DataCollection.nmf",type:"application/x-pnacl"});Ve.startup.resolve=n,Ve.startup.reject=e,Ve.startup.module=t.module,Ve.startup.listener=t.wrapper,document.body.appendChild(t.wrapper)}var io=async(n,e)=>(Ve.startup.progress=t=>{console.log(`load progress: ${parseInt(t*100)}%`),e(t*100)},new Promise((t,s)=>{qm(i=>{let o={type:"query-background-page-device-server-ports"};chrome.runtime.sendMessage(o,l=>{l.type===o.type&&(l.error?s(l.error):(i.ports=l.ports,t(i)))})},s)}));var{RPCMessageChannel:Nc}=ri,Gm=n=>{let e=[],t=null;function s(r){let i={data:r};t&&t.processMessage(r),e.forEach(o=>{o(i)})}return n.onmessage=s,t=new Nc({postMessage:r=>{n.postMessage(r)},addEventListener:(r,i)=>{r==="message"&&e.push(i)}}),Promise.resolve({rpc:t,listener:document.createElement("embed")})},$c=async(n,e)=>io?io(Nc,e):Gm(n);function no(n){window.chrome.power.requestKeepAwake(n)}function oo(){window.chrome.power.releaseKeepAwake()}var Ms=null;async function Hm(n){if(no)return no(n);try{Ms=await navigator.wakeLock.requestWakeLock("screen"),Ms.addEventListener("release",()=>{Ms=null})}catch(e){console.warn(e.message)}return!0}function Vm(){return oo?oo():(Ms&&Ms.release().then(()=>{Ms=null}),!0)}var jc=()=>({requestWakeLock:Hm,releaseWakeLock:Vm});var ao=!1;var zm=async()=>ao?ao():{success:!0},Wc=()=>({requestBluetooth:zm});var Gc=le(_e());var Uc=le(_e()),{chrome:lo}=window,qc=class extends Uc.default{constructor(){super();this._startFileData=null;let{launchData:e}=window;if(e&&e.items&&e.items[0]){let{entry:s}=e.items[0];s.file(r=>{this._startFileData={file:r,filepath:lo.fileSystem.retainEntry(s)}})}let t=s=>{s.hasOwnProperty("startupFile")&&this.processStartFile()};lo.runtime.onMessage.addListener(s=>{t(s)})}processStartFile(){let{launchData:e}=window;if(e&&e.items&&e.items[0]){let{entry:t}=e.items[0];t.file(s=>{this._startFileData={file:s,filepath:lo.fileSystem.retainEntry(t)},this.emit("new-start-file",this._startFileData)})}}get startFileData(){return this._startFileData}},co=()=>new qc;var Hc=class extends Gc.default{constructor(){super();"launchQueue"in window&&window.launchQueue.setConsumer(async e=>{if(!e?.files?.length)return;let t=e.files[0];this._startFile=!0,this._startFileData={file:await t.getFile(),filepath:""},this.processStartFile(this._startFileData)})}processStartFile(e){this.emit("new-start-file",e)}get startFileData(){return this._startFileData}get startFile(){return this._startFile}},Vc=(n,e,t)=>co?co(n,e,t):new Hc;var uo=le(Bn()),ho=null,zc=null;function Kc(){ho&&ho.disengage()}function Km(){return zc}function Xm(n){return uo.default.maintain.disabled({filter:n})}function Jm(n){Kc(),ho=uo.default.maintain.disabled({filter:n}),zc=n}var Xc={disengage:Kc,getFilter:Km,maintainDisabled:Xm,disable:Jm};function Jc(n,e){if(n.match(/^[a-z]+:\/\//i))return n;if(n.match(/^\/\//))return window.location.protocol+n;if(n.match(/^[a-z]+:/i))return n;let t=document.implementation.createHTMLDocument(),s=t.createElement("base"),r=t.createElement("a");return t.head.appendChild(s),t.body.appendChild(r),e&&(s.href=e),r.href=n,r.href}var Zc=(()=>{let n=0,e=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(n+=1,`u${e()}${n}`)})();function st(n){let e=[];for(let t=0,s=n.length;t<s;t++)e.push(n[t]);return e}function ni(n,e){let s=(n.ownerDocument.defaultView||window).getComputedStyle(n).getPropertyValue(e);return s?parseFloat(s.replace("px","")):0}function Zm(n){let e=ni(n,"border-left-width"),t=ni(n,"border-right-width");return n.clientWidth+e+t}function Qm(n){let e=ni(n,"border-top-width"),t=ni(n,"border-bottom-width");return n.clientHeight+e+t}function po(n,e={}){let t=e.width||Zm(n),s=e.height||Qm(n);return{width:t,height:s}}function Qc(){let n,e;try{e=process}catch(s){}let t=e&&e.env?e.env.devicePixelRatio:null;return t&&(n=parseInt(t,10),Number.isNaN(n)&&(n=1)),n||window.devicePixelRatio||1}var rt=16384;function Yc(n){(n.width>rt||n.height>rt)&&(n.width>rt&&n.height>rt?n.width>n.height?(n.height*=rt/n.width,n.width=rt):(n.width*=rt/n.height,n.height=rt):n.width>rt?(n.height*=rt/n.width,n.width=rt):(n.width*=rt/n.height,n.height=rt))}function ed(n,e={}){return n.toBlob?new Promise(t=>{n.toBlob(t,e.type?e.type:"image/png",e.quality?e.quality:1)}):new Promise(t=>{let s=window.atob(n.toDataURL(e.type?e.type:void 0,e.quality?e.quality:void 0).split(",")[1]),r=s.length,i=new Uint8Array(r);for(let o=0;o<r;o+=1)i[o]=s.charCodeAt(o);t(new Blob([i],{type:e.type?e.type:"image/png"}))})}function Ts(n){return new Promise((e,t)=>{let s=new Image;s.decode=()=>e(s),s.onload=()=>e(s),s.onerror=t,s.crossOrigin="anonymous",s.decoding="async",s.src=n})}async function Ym(n){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(n)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}async function td(n,e,t){let s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"svg"),i=document.createElementNS(s,"foreignObject");return r.setAttribute("width",`${e}`),r.setAttribute("height",`${t}`),r.setAttribute("viewBox",`0 0 ${e} ${t}`),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),r.appendChild(i),i.appendChild(n),Ym(r)}var Ue=(n,e)=>{if(n instanceof e)return!0;let t=Object.getPrototypeOf(n);return t===null?!1:t.constructor.name===e.name||Ue(t,e)};function ef(n){let e=n.getPropertyValue("content");return`${n.cssText} content: '${e.replace(/'|"/g,"")}';`}function tf(n){return st(n).map(e=>{let t=n.getPropertyValue(e),s=n.getPropertyPriority(e);return`${e}: ${t}${s?" !important":""};`}).join(" ")}function sf(n,e,t){let s=`.${n}:${e}`,r=t.cssText?ef(t):tf(t);return document.createTextNode(`${s}{${r}}`)}function sd(n,e,t){let s=window.getComputedStyle(n,t),r=s.getPropertyValue("content");if(r===""||r==="none")return;let i=Zc();try{e.className=`${e.className} ${i}`}catch(l){return}let o=document.createElement("style");o.appendChild(sf(i,t,s)),e.appendChild(o)}function rd(n,e){sd(n,e,":before"),sd(n,e,":after")}var id="application/font-woff",nd="image/jpeg",rf={woff:id,woff2:id,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:nd,jpeg:nd,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function nf(n){let e=/\.([^./]*?)$/g.exec(n);return e?e[1]:""}function Rs(n){let e=nf(n).toLowerCase();return rf[e]||""}function of(n){return n.split(/,/)[1]}function pr(n){return n.search(/^(data:)/)!==-1}function mo(n,e){return`data:${e};base64,${n}`}async function fo(n,e,t){let s=await fetch(n,e);if(s.status===404)throw new Error(`Resource "${s.url}" not found`);let r=await s.blob();return new Promise((i,o)=>{let l=new FileReader;l.onerror=o,l.onloadend=()=>{try{i(t({res:s,result:l.result}))}catch(c){o(c)}},l.readAsDataURL(r)})}var go={};function af(n,e,t){let s=n.replace(/\?.*/,"");return t&&(s=n),/ttf|otf|eot|woff2?/i.test(s)&&(s=s.replace(/.*\//,"")),e?`[${e}]${s}`:s}async function As(n,e,t){let s=af(n,e,t.includeQueryParams);if(go[s]!=null)return go[s];t.cacheBust&&(n+=(/\?/.test(n)?"&":"?")+new Date().getTime());let r;try{let i=await fo(n,t.fetchRequestInit,({res:o,result:l})=>(e||(e=o.headers.get("Content-Type")||""),of(l)));r=mo(i,e)}catch(i){r=t.imagePlaceholder||"";let o=`Failed to fetch resource: ${n}`;i&&(o=typeof i=="string"?i:i.message),o&&console.warn(o)}return go[s]=r,r}async function lf(n){let e=n.toDataURL();return e==="data:,"?n.cloneNode(!1):Ts(e)}async function cf(n,e){if(n.currentSrc){let i=document.createElement("canvas"),o=i.getContext("2d");i.width=n.clientWidth,i.height=n.clientHeight,o==null||o.drawImage(n,0,0,i.width,i.height);let l=i.toDataURL();return Ts(l)}let t=n.poster,s=Rs(t),r=await As(t,s,e);return Ts(r)}async function df(n){var e;try{if((e=n==null?void 0:n.contentDocument)===null||e===void 0?void 0:e.body)return await mr(n.contentDocument.body,{},!0)}catch(t){}return n.cloneNode(!1)}async function uf(n,e){return Ue(n,HTMLCanvasElement)?lf(n):Ue(n,HTMLVideoElement)?cf(n,e):Ue(n,HTMLIFrameElement)?df(n):n.cloneNode(!1)}var hf=n=>n.tagName!=null&&n.tagName.toUpperCase()==="SLOT";async function pf(n,e,t){var s,r;let i=[];return hf(n)&&n.assignedNodes?i=st(n.assignedNodes()):Ue(n,HTMLIFrameElement)&&((s=n.contentDocument)===null||s===void 0?void 0:s.body)?i=st(n.contentDocument.body.childNodes):i=st(((r=n.shadowRoot)!==null&&r!==void 0?r:n).childNodes),i.length===0||Ue(n,HTMLVideoElement)||await i.reduce((o,l)=>o.then(()=>mr(l,t)).then(c=>{c&&e.appendChild(c)}),Promise.resolve()),e}function mf(n,e){let t=e.style;if(!t)return;let s=window.getComputedStyle(n);s.cssText?(t.cssText=s.cssText,t.transformOrigin=s.transformOrigin):st(s).forEach(r=>{let i=s.getPropertyValue(r);r==="font-size"&&i.endsWith("px")&&(i=`${Math.floor(parseFloat(i.substring(0,i.length-2)))-.1}px`),Ue(n,HTMLIFrameElement)&&r==="display"&&i==="inline"&&(i="block"),r==="d"&&e.getAttribute("d")&&(i=`path(${e.getAttribute("d")})`),t.setProperty(r,i,s.getPropertyPriority(r))})}function ff(n,e){Ue(n,HTMLTextAreaElement)&&(e.innerHTML=n.value),Ue(n,HTMLInputElement)&&e.setAttribute("value",n.value)}function gf(n,e){if(Ue(n,HTMLSelectElement)){let t=e,s=Array.from(t.children).find(r=>n.value===r.getAttribute("value"));s&&s.setAttribute("selected","")}}function vf(n,e){return Ue(e,Element)&&(mf(n,e),rd(n,e),ff(n,e),gf(n,e)),e}async function bf(n,e){let t=n.querySelectorAll?n.querySelectorAll("use"):[];if(t.length===0)return n;let s={};for(let i=0;i<t.length;i++){let l=t[i].getAttribute("xlink:href");if(l){let c=n.querySelector(l),u=document.querySelector(l);!c&&u&&!s[l]&&(s[l]=await mr(u,e,!0))}}let r=Object.values(s);if(r.length){let i="http://www.w3.org/1999/xhtml",o=document.createElementNS(i,"svg");o.setAttribute("xmlns",i),o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.display="none";let l=document.createElementNS(i,"defs");o.appendChild(l);for(let c=0;c<r.length;c++)l.appendChild(r[c]);n.appendChild(o)}return n}async function mr(n,e,t){return!t&&e.filter&&!e.filter(n)?null:Promise.resolve(n).then(s=>uf(s,e)).then(s=>pf(n,s,e)).then(s=>vf(n,s)).then(s=>bf(s,e))}var od=/url\((['"]?)([^'"]+?)\1\)/g,yf=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Sf=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function wf(n){let e=n.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function xf(n){let e=[];return n.replace(od,(t,s,r)=>(e.push(r),t)),e.filter(t=>!pr(t))}async function Cf(n,e,t,s,r){try{let i=t?Jc(e,t):e,o=Rs(e),l;if(r){let c=await r(i);l=mo(c,o)}else l=await As(i,o,s);return n.replace(wf(e),`$1${l}$3`)}catch(i){}return n}function If(n,{preferredFontFormat:e}){return e?n.replace(Sf,t=>{for(;;){let[s,,r]=yf.exec(t)||[];if(!r)return"";if(r===e)return`src: ${s};`}}):n}function vo(n){return n.search(od)!==-1}async function oi(n,e,t){if(!vo(n))return n;let s=If(n,t);return xf(s).reduce((i,o)=>i.then(l=>Cf(l,o,e,t)),Promise.resolve(s))}async function ai(n,e,t){var s;let r=(s=e.style)===null||s===void 0?void 0:s.getPropertyValue(n);if(r){let i=await oi(r,null,t);return e.style.setProperty(n,i,e.style.getPropertyPriority(n)),!0}return!1}async function Ef(n,e){await ai("background",n,e)||await ai("background-image",n,e),await ai("mask",n,e)||await ai("mask-image",n,e)}async function _f(n,e){let t=Ue(n,HTMLImageElement);if(!(t&&!pr(n.src))&&!(Ue(n,SVGImageElement)&&!pr(n.href.baseVal)))return;let s=t?n.src:n.href.baseVal,r=await As(s,Rs(s),e);await new Promise((i,o)=>{n.onload=i,n.onerror=o;let l=n;l.decode&&(l.decode=i),l.loading==="lazy"&&(l.loading="eager"),t?(n.srcset="",n.src=r):n.href.baseVal=r})}async function Df(n,e){let s=st(n.childNodes).map(r=>bo(r,e));await Promise.all(s).then(()=>n)}async function bo(n,e){Ue(n,Element)&&(await Ef(n,e),await _f(n,e),await Df(n,e))}function ad(n,e){let{style:t}=n;e.backgroundColor&&(t.backgroundColor=e.backgroundColor),e.width&&(t.width=`${e.width}px`),e.height&&(t.height=`${e.height}px`);let s=e.style;return s!=null&&Object.keys(s).forEach(r=>{t[r]=s[r]}),n}var ld={};async function cd(n){let e=ld[n];if(e!=null)return e;let s=await(await fetch(n)).text();return e={url:n,cssText:s},ld[n]=e,e}async function dd(n,e){let t=n.cssText,s=/url\(["']?([^"')]+)["']?\)/g,i=(t.match(/url\([^)]+\)/g)||[]).map(async o=>{let l=o.replace(s,"$1");return l.startsWith("https://")||(l=new URL(l,n.url).href),fo(l,e.fetchRequestInit,({result:c})=>(t=t.replace(o,`url(${c})`),[o,c]))});return Promise.all(i).then(()=>t)}function ud(n){if(n==null)return[];let e=[],t=/(\/\*[\s\S]*?\*\/)/gi,s=n.replace(t,""),r=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){let c=r.exec(s);if(c===null)break;e.push(c[0])}s=s.replace(r,"");let i=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",l=new RegExp(o,"gi");for(;;){let c=i.exec(s);if(c===null){if(c=l.exec(s),c===null)break;i.lastIndex=l.lastIndex}else l.lastIndex=i.lastIndex;e.push(c[0])}return e}async function Mf(n,e){let t=[],s=[];return n.forEach(r=>{if("cssRules"in r)try{st(r.cssRules||[]).forEach((i,o)=>{if(i.type===CSSRule.IMPORT_RULE){let l=o+1,c=i.href,u=cd(c).then(p=>dd(p,e)).then(p=>ud(p).forEach(m=>{try{r.insertRule(m,m.startsWith("@import")?l+=1:r.cssRules.length)}catch(v){console.error("Error inserting rule from remote css",{rule:m,error:v})}})).catch(p=>{console.error("Error loading remote css",p.toString())});s.push(u)}})}catch(i){let o=n.find(l=>l.href==null)||document.styleSheets[0];r.href!=null&&s.push(cd(r.href).then(l=>dd(l,e)).then(l=>ud(l).forEach(c=>{o.insertRule(c,r.cssRules.length)})).catch(l=>{console.error("Error loading remote stylesheet",l)})),console.error("Error inlining remote css file",i)}}),Promise.all(s).then(()=>(n.forEach(r=>{if("cssRules"in r)try{st(r.cssRules||[]).forEach(i=>{t.push(i)})}catch(i){console.error(`Error while reading CSS rules from ${r.href}`,i)}}),t))}function Tf(n){return n.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>vo(e.style.getPropertyValue("src")))}async function Rf(n,e){if(n.ownerDocument==null)throw new Error("Provided element is not within a Document");let t=st(n.ownerDocument.styleSheets),s=await Mf(t,e);return Tf(s)}async function hd(n,e){let t=await Rf(n,e);return(await Promise.all(t.map(r=>{let i=r.parentStyleSheet?r.parentStyleSheet.href:null;return oi(r.cssText,i,e)}))).join(`
`)}async function pd(n,e){let t=e.fontEmbedCSS!=null?e.fontEmbedCSS:e.skipFonts?null:await hd(n,e);if(t){let s=document.createElement("style"),r=document.createTextNode(t);s.appendChild(r),n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s)}}async function Af(n,e={}){let{width:t,height:s}=po(n,e),r=await mr(n,e,!0);return await pd(r,e),await bo(r,e),ad(r,e),await td(r,t,s)}async function Pf(n,e={}){let{width:t,height:s}=po(n,e),r=await Af(n,e),i=await Ts(r),o=document.createElement("canvas"),l=o.getContext("2d"),c=e.pixelRatio||Qc(),u=e.canvasWidth||t,p=e.canvasHeight||s;return o.width=u*c,o.height=p*c,e.skipAutoScale||Yc(o),o.style.width=`${u}`,o.style.height=`${p}`,e.backgroundColor&&(l.fillStyle=e.backgroundColor,l.fillRect(0,0,o.width,o.height)),l.drawImage(i,0,0,o.width,o.height),o}async function md(n,e={}){let t=await Pf(n,e);return await ed(t)}var yo=null;var fd=n=>{if(yo)return yo(n);let e=s=>!s.hidden,t=[...n.querySelectorAll(".app-graph")].filter(s=>!s.hidden);return n.classList.contains("app-graph")&&t.push(n),md(n,{filter:e})};var So=null;var gd=async()=>{try{if(So)await So();else return!0}catch(n){console.warn(n)}return!0};var vd=[],kf=n=>{vd.forEach(e=>e(n))},bd=n=>{vd.push(n)},yd=async()=>{await gd(),await new Promise(ce=>{window.wasmModuleReady,ce()});let n=await Promise.all([Ic(),Ec(),bc(),Lc()]),e=n[0],t=n[1],s=n[2],r=n[3],i=new Cs,o=await $c(r,kf),l=jc(),c=Dc(e),u=kc(),p=wc(),{rpc:m}=o,v=gc.create(),b=Wc(),y=new un(u,v),w=new cr({api:new kn(m),nativeModulesAPI:new Ln(m),deviceServerPorts:o.ports||null,sensorMap:s,appManifest:t}),_=new In({api:new An(m),sensorMap:s,dataCollection:w}),T=new Tn({api:new On(m)}),A=new or({api:new Rn(m),sensorWorld:_,dataCollection:w,appManifest:t,power:l,popoverManager:y,udm:T}),W=new Mn({api:new Pn(m),dataWorld:A,permissions:b}),Z=new Pt({dataWorld:A,api:new Nn(m)}),ee=Pc(t.getAppName(),A,y),ge=Vc(A,ee,u);return{analytics:i,appLifecycle:e,appManifest:t,appUpdate:c,fileIO:ee,sensorMap:s,toast:u,accessibility:p,deviceManager:W,sensorWorld:_,dataWorld:A,dataAnalysis:Z,dataCollection:w,popoverManager:y,ally:Xc,capture:fd,permissions:b,power:l,startupFileHandler:ge,rpc:m,udm:T}};function Sd(n,e){let t=n.shadowRoot.querySelector(".prediction-toolbar");n.style.display="flex",n.style.position="fixed",n.classList.add("animate-in"),e.disable(t),n.setDrawingAreaSize()}function Lf(n,e,t,s){let r=e.shadowRoot.querySelector(".prediction-toolbar"),i=e.shadowRoot.querySelector(".prediction-drawing-wrapper");s==="graph_1-table"&&n.forEach(o=>o.style.removeProperty("display")),e.classList.remove("animate-in"),r.classList.add("animate-out"),r.classList.remove("animate-out"),e.style.removeProperty("display"),e.style.removeProperty("top"),e.style.removeProperty("position"),i.classList.remove("fade-out"),t.disengage()}function Of(n,e,t,s,r,i,o,l){let c=e.shadowRoot.querySelector("#graph_tools_btn"),u=e.shadowRoot.querySelector("#autoscale_btn"),p=e.shadowRoot.querySelector(".graph-wrapper"),m=e.querySelector("vst-core-graph-predictions");if(c&&(c.style.display="none"),u&&(u.style.display="none"),i==="graph_1"){Sd(m,r);return}let v=e.getBoundingClientRect(),b=n.getBoundingClientRect(),y=p.getBoundingClientRect();e.style.maxBlockSize=`${v.height}px`,e.style.minBlockSize=`${v.height}px`,p.style.top=`${y.top}px`,p.style.height=`${y.height}px`,p.style.width=`${y.width}px`,p.style.position="fixed",p.style.zIndex="150",p.style.transition="all .4s cubic-bezier(.4, 0, .2, 1)",i==="graph_1-table"&&s.forEach(W=>{W.style.display="none"});let w="left top";i==="graph_2"?e.id==="graph_1"?w="left top":e.id==="graph_2"&&(w="left bottom"):i==="graph_3"&&(e.id==="graph_1"?w="left top":e.id==="graph_2"?w="left center":e.id==="graph_3"&&(w="left bottom"));let _=t.getBoundingClientRect();p.style.transformOrigin=w,p.style.height=`calc(100% - ${b.height-_.height}px)`,p.style.width="100%",p.style.top=`${_.top}px`,o(e.graphInstance);let T=!1,A=()=>{T||(T=!0,e.graphInstance.resize(),Sd(m,r),l())};p.addEventListener("transitionend",A)}function Ff(n,e,t,s,r,i,o,l){let c=e.shadowRoot.querySelector("#graph_tools_btn"),u=e.shadowRoot.querySelector("#autoscale_btn"),p=e.shadowRoot.querySelector(".graph-wrapper"),m=e.querySelector("vst-core-graph-predictions");if(Lf(s,m,r,i),c&&c.style.removeProperty("display"),u&&u.style.removeProperty("display"),i==="graph_1")return;let v=!1,b=()=>{v||(p.style.removeProperty("transition"),p.style.removeProperty("transform"),p.style.removeProperty("transform-origin"),p.style.removeProperty("z-index"),p.style.removeProperty("top"),p.style.removeProperty("height"),p.style.removeProperty("width"),p.style.removeProperty("position"),e.style.removeProperty("max-block-size"),e.style.removeProperty("min-block-size"),t._resizeVisibleGraphs(),l(),v=!0,n.afterViewChange=null)};n.afterViewChange=b,p.addEventListener("transitionend",b),p.getBoundingClientRect();let y=e.getBoundingClientRect();p.style.transformOrigin="top left",p.style.height=`${y.height}px`,p.style.width=`${y.width}px`,p.style.top=`${y.top}px`,o(e.graphInstance)}var wd=(n,e,t)=>{let s=e.shadowRoot.querySelector("#graph_group"),r,i=e.shadowRoot.querySelector("vst-core-table"),o=e.shadowRoot.querySelector("vst-core-meter-container"),l=[i,o];function c(v){v.resize(),r=requestAnimationFrame(c.bind(void 0,v))}function u(){cancelAnimationFrame(r)}return{open:v=>{let{currentView:b}=e;Of(n,v,e,l,t,b,c,u)},close:v=>{let{currentView:b}=e;Ff(n,v,s,l,t,b,c,u)}}};var Bf=!1,Nf=3,$f=(n,e)=>{let t=null;return e.forEach(s=>{if(s.type==="sensor"){let r=n.getSensorById(s.sensorId);r&&r.sensorId==="LPS"&&(t=s)}}),t},Ps=(n,e,t,s={},r=[])=>{let i=P({},t),o=e.sensors.map(R=>R.id),l=n.currentDataSet?n.getColumnsForSet(n.currentDataSet.id).filter(R=>R.type!=="sensor"||o.includes(R.sensorId)||R.frozen):[],c=[],u={graph_1:!0,graph_2:!1,graph_3:!1,table:!1,meter:!1},p=Ut(i.params),{mode:m}=i,v=p&&p.continuous,b=l.filter(R=>R.prefersBase),y=b.find(R=>R.type==="time"),w=y||b[0];w||(Bf&&console.warn("No baseColumn in dataset!"),[w]=l);let _=$f(e,l);_&&(w=_,y=null);let T={min:0,max:30},A=w?w.id:null;if(m==="time-based"&&!v)T.max=Ct.convertTimeUnits(p.duration,"s",p.units);else if(m.match("events"))T.max=1,u.table=!0;else if(m.match("drop-counting"))T.min=w?w.range.min:0,T.max=w?w.range.max:1,u.table=!0;else if(m==="photogate-timing")u.table=!0,p.subMode==="motion"?(T.min=0,T.max=.25):["gate","pulse"].includes(p.subMode)&&(T.min=0,T.max=5);else if(m==="full-spectrum"){let{minWavelength:R,maxWavelength:H}=s;T.min=R,T.max=H}l.forEach(R=>{if(R.type==="calc"&&R.replaceDependent&&R.group.calcDependentGroups.length){let he=(E=>E.map(n.getColumnGroupById.bind(n)))(R.group.calcDependentGroups);R.plotted&&he.forEach(E=>n.updateColumnGroup(E.id,{plotted:!1})),he.length===1&&he[0].id===w.groupId&&(R.prefersBase=!0,w=R,A=R.id)}});let W=m==="time-based"||m==="full-spectrum";for(let R=0;R<Nf;++R)c.push({baseColumnId:A,leftUnits:[],leftColumnIds:[],rightUnits:[],rightColumnIds:[],options:{appearance:{lines:W,points:!W},baseRange:T,leftRange:{min:NaN,max:NaN}}});let Z=R=>{let H=R&&R.calcDependentGroups.length?n.getColumnGroupById(R.calcDependentGroups[0]):null;return R&&R.sensorId&&e.isMotionDetector(R.sensorId)||H&&H.sensorId&&e.isMotionDetector(H.sensorId)},ee=R=>{let H=R&&R.calcDependentGroups.length?n.getColumnGroupById(R.calcDependentGroups[0]):null;return R&&R.sensorId&&e.isRotationSensor(R.sensorId)||H&&H.sensorId&&e.isRotationSensor(H.sensorId)};function ge(R,H){Number.isNaN(R.options.leftRange.min)?R.options.leftRange.min=H.range.min:R.options.leftRange.min=Math.min(R.options.leftRange.min,H.range.min),Number.isNaN(R.options.leftRange.max)?R.options.leftRange.max=H.range.max:R.options.leftRange.max=Math.max(R.options.leftRange.max,H.range.max)}function ce(R){let H=R.group,he={};e.sensors.length&&(he=Ua(e.sensors,"units"));let E=Object.keys(he).length;for(let be=0;be<c.length;++be){let Me=c[be],Ie=Me.leftUnits,ae=Me.rightUnits;if(R.id!==A&&(be===c.length-1||!Ie.length||Ie.includes(H.units)||Object.keys(s).length!==0)){let Ee=H&&H.calcDependentGroups.length?n.getColumnGroupById(H.calcDependentGroups[0]):null,Je=Z(Ee),Ze=ee(Ee),C=!1,He=!1;Je?(C=R.type==="calc"&&R.sensorMapId.startsWith("CC_MDV"),He=R.type==="calc"&&R.sensorMapId.startsWith("CC_MDA")):Ze&&(C=R.type==="calc"&&R.sensorMapId.endsWith("MV"),He=R.type==="calc"&&R.sensorMapId.endsWith("MA"));let x=!1;(He&&E===1||C&&E<3||R.plotted&&!C&&!He)&&(x=!0),_&&R.type==="time"&&(x=!1),x&&(r.includes(R.id)?(ae.push(H.units),Me.rightColumnIds.push(R.id)):(Ie.push(H.units),Me.leftColumnIds.push(R.id)),Me.baseUnits=w.units,u.table&&be===0?u.graph_1=!0:u.table||(u[`graph_${be+1}`]=R.plotted),ge(Me,R));break}}let{mode:oe,params:{subMode:te,params:Ce={}}}=t,{gateSeparation:Ge=0}=Ce;if(oe==="photogate-timing"&&te==="pulse"){let be=null;if(Ge>0?be="CC_VPG_VELOCITY":Ge===-1&&(be="CC_VPG_PULSE"),be){let Me=n.getColumns().find(Ie=>Ie.sensorMapId.startsWith(be));if(Me){let Ie=c[0].leftColumnIds;c.length>=2&&(c[1].leftColumnIds=Ie),c[0].leftColumnIds=[Me.id]}}}}l.sort((R,H)=>{let he=Z(R.group)||ee(R.group),E=Z(H.group)||ee(H.group);return he===E?0:he?1:-1}).forEach(R=>{ce(R)});let I=new URLSearchParams(window.location.search),O={};return I.has("graph_3")&&(O.graph_3=I.get("graph_3")==="true"),(O.graph_3||I.has("graph_2"))&&(O.graph_2=!!(I.get("graph_2")==="true"||O.graph_3),O.graph_2||(O.graph_3=!1)),(O.graph_3||O.graph_2||I.has("graph_1"))&&(O.graph_1=!!(I.get("graph_1")!=="false"||O.graph_2||O.graph_3),O.graph_1||(O.graph_2=!1,O.graph_3=!1)),I.has("table")&&(O.table=I.get("table")==="true"),I.has("meter")&&(O.meter=I.get("meter")==="true"),I.has("video")&&(O.video=I.get("video")==="true"),I.has("notes")&&(O.notes=I.get("notes")==="true"),I.has("configurator")&&(O.configurator=I.get("configurator")==="true"),{graphAutoLayouts:c,appAutoLayout:P(P({},u),O)}},xd=n=>{let e=n.getColumns().find(i=>i.prefersBase),t=e?e.id:null,r=n.getColumns().filter(i=>!i.prefersBase&&i.id!==t).map(i=>i.id);return[{baseColumnId:t,leftColumnIds:r,rightColumnIds:[],options:{appearance:{lines:!1,points:!0},baseRange:{min:0,max:1},leftRange:{min:0,max:1}}}]};var Cd=(n,e)=>n==="dark"?Te`
      :host(.dark:not(.light)) {
        ${e}
      }
    `:Te``;var Id=Te`
  :host,
  html {
    /* brand colors */
    --vst-color-brand-400: hsl(180, 100%, 14%);
    --vst-color-brand-300: hsl(182, 100%, 23%);
    --vst-color-brand-200: hsl(184, 42%, 58%);
    --vst-color-brand-100: hsl(180deg 60% 92%);

    --vst-color-brand-dark: var(--vst-color-brand-400);
    --vst-color-brand: var(--vst-color-brand-300);
    --vst-color-brand-bg: var(--vst-color-brand-100);

    /* rebrand secondary colors - not currently in use, but here for reference */
    --vst-color-orange: hsl(19, 87%, 54%);
    --vst-color-gold: hsl(40, 97%, 59%);
    --vst-color-peach: hsl(26, 96%, 82%);
    --vst-color-chartreuse: hsl(73, 100%, 67%);

    --vst-color-secondary-dark: var(--vst-color-orange);
    --vst-color-secondary: var(--vst-color-gold);
    --vst-color-secondary-bg: var(--vst-color-peach);

    /* semantic colors */
    --vst-color-success-400: hsl(142deg 100% 20%);
    --vst-color-success-300: hsl(135deg 96% 28%);
    --vst-color-success-200: hsl(138deg 90% 35%);
    --vst-color-success-100: hsl(127deg 46% 93%);

    --vst-color-success-dark: var(--vst-color-success-400);
    --vst-color-success: var(--vst-color-success-300);
    --vst-color-success-ui: var(--vst-color-success-200);
    --vst-color-success-bg: var(--vst-color-success-100);

    --vst-color-warning-400: hsl(20deg 98% 36.9%);
    --vst-color-warning-300: hsl(19deg 87.1% 53.6%);
    --vst-color-warning-200: hsl(20deg 92% 64%);
    --vst-color-warning-100: hsl(32deg 100% 96.5%);

    --vst-color-warning: var(--vst-color-warning-300);
    --vst-color-warning-ui: var(--vst-color-warning-200);
    --vst-color-warning-bg: var(--vst-color-warning-100);

    --vst-color-info-300: hsl(219deg 86% 38%);
    --vst-color-info-200: hsl(214deg 94% 55%);
    --vst-color-info-100: hsl(211deg 60% 91%);

    --vst-color-info: var(--vst-color-info-300);
    --vst-color-info-ui: var(--vst-color-info-200);
    --vst-color-info-bg: var(--vst-color-info-100);

    --vst-color-important: hsl(266, 52%, 48%);
    --vst-color-important-bg: hsl(265, 49%, 89%);

    --vst-color-danger-400: hsl(0deg 98% 34%);
    --vst-color-danger-300: hsl(0deg 78% 47%);
    --vst-color-danger-200: hsl(0deg 89% 56%);
    --vst-color-danger-100: hsl(0deg 59% 90%);

    --vst-color-danger-dark: var(--vst-color-danger-400);
    --vst-color-danger: var(--vst-color-danger-300);
    --vst-color-danger-ui: var(--vst-color-danger-200);
    --vst-color-danger-bg: var(--vst-color-danger-100);
    --vst-color-danger-fg: var(--vst-color-danger-400);

    /* graph colors */
    --vst-color-graph-red: hsl(356, 70%, 49%);
    --vst-color-graph-baby-blue: hsl(206, 58%, 51%);
    --vst-color-graph-vomit: hsl(56, 72%, 42%);
    --vst-color-graph-blue: hsl(230, 54%, 43%);
    --vst-color-graph-pink: hsl(335, 69%, 63%);
    --vst-color-graph-purple: hsl(291, 38%, 28%);

    /* dark & light mode colors */
    --vst-color-dark-300: hsl(200deg 6% 10%);
    --vst-color-dark-200: hsl(200deg 4% 16%);
    --vst-color-dark-100: hsl(195deg 3% 25%);
    --vst-color-neutral: hsl(197deg 3% 46%);
    --vst-color-light-300: hsl(200deg 4% 69%);
    --vst-color-light-200: hsl(204deg 9% 89%);
    --vst-color-light-100: hsl(210deg 11% 96%);
    --vst-color-bg-dark: hsl(200deg, 10%, 7%);
    --vst-color-bg-light: #fefefe;

    /* foreground & background colors */
    --vst-color-fg-primary: var(--vst-color-dark-300);
    --vst-color-fg-secondary: var(--vst-color-dark-200);
    --vst-color-fg-tertiary: var(--vst-color-dark-100);
    --vst-color-bg-primary: var(--vst-color-light-300);
    --vst-color-bg-secondary: var(--vst-color-light-200);
    --vst-color-bg-tertiary: var(--vst-color-light-100);
    --vst-color-bg: var(--vst-color-bg-light);

    /* Elements */
    --vst-color-btn: var(--vst-color-fg-primary);
    --vst-color-btn-bg: var(--vst-color-bg);
    --vst-color-btn-bg-hover: var(--vst-color-bg);
    --vst-color-btn-bg-active: var(--vst-color-bg-tertiary);
    --vst-color-btn-border: var(--vst-color-neutral);
    --vst-color-btn-text-bg-hover: var(--vst-color-bg-tertiary);
    --vst-color-btn-danger: var(--vst-color-danger-400);
    --vst-color-btn-danger-hover: var(--vst-color-danger-400);
    --vst-color-btn-danger-bg-hover: var(--vst-color-danger-100);
    --vst-color-toolbar-bg: var(--vst-color-bg-secondary);
    --vst-color-btn-toolbar-bg: var(--vst-color-bg-secondary);
    --vst-color-btn-toolbar-bg-hover: var(--vst-color-bg);
    --vst-color-media-btn-bg-hover: var(--vst-color-bg-tertiary);
    --vst-color-icon-hover: var(--vst-color-bg-tertiary);
    --vst-color-btn-graph-bg: #fff;
    --vst-color-btn-graph-border: var(--vst-color-fg-tertiary);
    --vst-color-btn-graph-bg-hover: #fff;
    --vst-color-btn-graph-border-hover: var(--vst-color-fg-secondary);
    --vst-color-examine-handle-bg: var(--vst-color-bg-secondary);
    --vst-color-prediction-toolbar-bg: var(--vst-color-bg);
    --vst-color-sensor-bg: var(--vst-color-bg);
    --vst-color-proximity-connect-bg: var(--vst-color-warning-bg);
    --vst-color-proximity-connect-text: var(--vst-color-warning);
    --vst-color-connect-pane-bg: var(--vst-color-warning-bg);
    --vst-color-connect-pane-text: var(--vst-color-warning);
    --vst-color-inner-popover-bg: var(--vst-color-bg);
    --vst-grid-selected-background-color: var(--vst-color-info-bg);
    --vst-grid-selected-border-color: var(--vst-color-info);
    --vst-grid-body-background-color: var(--vst-color-bg);
    --vst-grid-border-color: var(--vst-color-bg-primary);
    --vst-shadow-btn-hover: var(--vst-shadow-m);
    --vst-color-sample-video-bg: var(--vst-color-bg);
    --vst-color-notes-bg: var(--vst-color-bg);
    --vst-opacity-disabled: 0.45;
    --vst-color-predictions-overlay-bg: rgba(255, 255, 255, 0.65);
    --vst-color-popover-border: transparent;
    --vst-color-text-brand: var(--vst-color-brand);
    --vst-color-text-brand-hover: var(--vst-color-brand-dark);
    --vst-color-text-success: var(--vst-color-success);
    --vst-color-text-success-hover: var(--vst-color-success-dark);
    --vst-color-text-info: var(--vst-color-info-ui);
    --vst-color-text-info-hover: var(--vst-color-info);
    --vst-color-text-warning: var(--vst-color-warning);
    --vst-color-text-warning-hover: var(--vst-color-warning);
    --vst-color-text-important: var(--vst-color-important);
    --vst-color-text-important-hover: var(--vst-color-important-dark);
    --vst-color-text-danger: var(--vst-color-danger);
    --vst-color-text-danger-hover: var(--vst-color-danger-dark);
    --vst-color-tag-brand-bg: var(--vst-color-brand-bg);
    --vst-color-tag-brand-border: var(--vst-color-brand-dark);
    --vst-color-tag-brand: var(--vst-color-brand-dark);
    --vst-color-tag-success-bg: var(--vst-color-success-bg);
    --vst-color-tag-success-border: var(--vst-color-success-dark);
    --vst-color-tag-success: var(--vst-color-success-dark);
    --vst-color-tag-info-bg: var(--vst-color-info-bg);
    --vst-color-tag-info-border: var(--vst-color-info);
    --vst-color-tag-info: var(--vst-color-info);
    --vst-color-tag-warning-bg: var(--vst-color-warning-bg);
    --vst-color-tag-warning-border: var(--vst-color-warning);
    --vst-color-tag-warning: var(--vst-color-warning);
    --vst-color-tag-important-bg: var(--vst-color-important-bg);
    --vst-color-tag-important-border: var(--vst-color-important);
    --vst-color-tag-important: var(--vst-color-important);
    --vst-color-tag-danger-bg: var(--vst-color-danger-bg);
    --vst-color-tag-danger-border: var(--vst-color-danger-dark);
    --vst-color-tag-danger: var(--vst-color-danger-dark);
    --vst-color-divider-thumb-bg: var(--vst-color-bg-tertiary);
    --vst-color-divider-thumb-border: var(--vst-color-bg-primary);
    --vst-color-divider-thumb-bg-active: var(--vst-color-fg-secondary);
    --vst-color-logo: #5a5b5d;
    --vst-color-input-bg: var(--vst-color-bg);
    --vst-color-bg-graph: var(--vst-color-bg);
    --vst-color-calibration-bg: var(--vst-color-success-bg);
    --vst-color-calibration-border: var(--vst-color-success-dark);
    --vst-color-calibration-rsr-bg: rgba(255, 255, 255, 0.7);
    --vst-color-calibration-rsr-border: transparent;
    --vst-color-required-device-disconnected: hsl(47deg 93% 94%);

    /* Font Family
    https://css-tricks.com/snippets/css/system-font-stack/ */
    --vst-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu,
      Cantarell, 'Helvetica Neue', sans-serif;
    --vst-font-family-mono: Consolas, Monaco, monospace;

    /* Font Size */
    /* Clamp prevents font sizes from getting too big or too small when a user changes their default font sizes */
    /* Safari 12 fallback, TODO: convert to clamp when we drop Safari 12 support */
    --vst-font-size-2xs: min(max(6px, 0.5rem), 12px);
    --vst-font-size-xs: min(max(8px, 0.75rem), 18px);
    --vst-font-size-s: min(max(10px, 0.875rem), 22px);
    --vst-font-size-m: min(max(12px, 1rem), 24px);
    --vst-font-size-l: min(max(20px, 1.5rem), 36px);
    --vst-font-size-xl: min(max(24px, 2rem), 48px);
    --vst-font-size-2xl: min(max(32px, 2.5rem), 72px);
    --vst-font-size-3xl: min(max(48px, 4rem), 96px);

    /* Line Height */
    --vst-line-height-s: 1.3;
    --vst-line-height-m: 1.5;

    /* Spacing */
    /* Use px for spacing to differentiate zoom from default font size change and keep ui from getting too big or too small at different font sizes */
    --vst-space-3xs: 2px;
    --vst-space-2xs: 4px;
    --vst-space-xs: 8px;
    --vst-space-s: 12px;
    --vst-space-m: 16px;
    --vst-space-l: 24px;
    --vst-space-xl: 32px;
    --vst-space-2xl: 48px;
    --vst-space-3xl: 64px;

    /* Sizing */
    /* Safari 12 fallback TODO: convert to clamp when we drop Safari 12 support */
    --vst-toolbar-height: min(max(32px, 3rem), 54px);
    --vst-dialog-header-height: min(max(28px, 2.75rem), 48px);
    --vst-required-device-border-size: 5px;

    --vst-icon-size-2xs: min(max(8px, 0.75rem), 16px);
    --vst-icon-size-xs: min(max(14px, 1rem), 20px);
    --vst-icon-size-s: min(max(16px, 1.25rem), 24px);
    --vst-icon-size-m: min(max(20px, 1.5rem), 28px);
    --vst-icon-size-l: min(max(28px, 2rem), 36px);

    /* Transition */
    --vst-transition-easing: cubic-bezier(0.4, 0, 0.2, 1);
    --vst-transition-speed-fast: 0.1s;
    --vst-transition-speed: 0.3s;
    --vst-transition-speed-slow: 0.5s;
    --vst-transition-fast: all var(--vst-transition-speed-fast) var(--vst-transition-easing);
    --vst-transition: all var(--vst-transition-speed) var(--vst-transition-easing);
    --vst-transition-slow: all var(--vst-transition-speed-slow) var(--vst-transition-easing);

    /* Animations */
    --startup-animation-duration: 0.4s;
    --startup-animation-timing-function: cubic-bezier(0.21, 0.1, 0.11, 0.95);
    --startup-animation-base-delay: 0.3s;
    --startup-animation-secondary-delay: calc(
      var(--startup-animation-base-delay) + var(--startup-animation-duration)
    );

    /* Border Radius */
    --vst-radius: 4px;
    --vst-radius-pill: 9999px;
    --vst-radius-circle: 50%;

    /* Shadow */
    --vst-shadow-xs: 0px 1px 1px rgba(0, 0, 0, 0.1);
    --vst-shadow-s: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
    --vst-shadow-m: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
    --vst-shadow-l: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
    --vst-shadow-xl: 0 19px 38px rgba(0, 0, 0, 0.3), 0 15px 12px rgba(0, 0, 0, 0.22);

    /* Z-Index
(https://philipwalton.com/articles/what-no-one-told-you-about-z-index/) */
    --vst-z-graph-tools-btn: 149;
    --vst-z-toolbar: 100;
    --vst-z-selection: 125;
    --vst-z-annotation: 150;
    --vst-z-infobox: 175;
    --vst-z-graph-legend: 180;
    --vst-z-minigraph: 185;
    --vst-z-popover: 200;
    --vst-z-dialog: 300;
    --vst-z-soft-alert: 400;

    /* Breakpoints -  Used by JS to check what screen size we are */
    --vst-screen-size: xs;

    /* from globals - deprecated */
    --gutter: 0.5625rem;
    --transition-easing: cubic-bezier(0.4, 0, 0.2, 1);

    --transition-default-speed: 0.4s;
    --transition-fastest-speed: 0.125s;
    --transition-faster-speed: 0.25s;
    --transition-slower-speed: 0.6s;
    --transition-default: all var(--transition-default-speed) var(--transition-easing);
    --transition-faster: all var(--transition-faster-speed) var(--transition-easing);
    --transition-slower: all var(--transition-slower-speed) var(--transition-easing);

    --box-shadow-default-rotated: -1px 0 1px rgba(0, 0, 0, 0.1);
    --box-shadow-inset: inset 0 0 1px 1px rgba(0, 0, 0, 0.15);
    --box-shadow-inset-darker: inset 0 0 1px 1px rgba(0, 0, 0, 0.5);
  }

  ${Cd("dark",Te`
      --vst-color-success-400: hsl(142deg 100% 20%);
      --vst-color-success-300: hsl(135deg 96% 28%);
      --vst-color-success-200: hsl(138deg 90% 35%);
      --vst-color-success-100: hsl(127deg 46% 93%);
      --vst-color-success-bg: var(--vst-color-success-400);

      --vst-color-warning-300: hsl(20, 95%, 68%);
      --vst-color-warning-200: hsl(21, 100%, 77%);
      --vst-color-warning-100: hsl(22, 100%, 86%);

      --vst-color-warning-bg: transparent;

      --vst-color-info-300: #1c3461;
      --vst-color-info-200: #1d4d8c;
      --vst-color-info-100: #b2d8f7;

      /* Danger */
      --vst-color-danger-400: #570f0f;
      --vst-color-danger-300: #a1201b;
      --vst-color-danger-200: #ff4e45;
      --vst-color-danger-100: #fcb6b1;

      --vst-color-fg-primary: var(--vst-color-light-100);
      --vst-color-fg-secondary: var(--vst-color-light-200);
      --vst-color-fg-tertiary: var(--vst-color-light-300);

      --vst-color-bg-primary: var(--vst-color-dark-100);
      --vst-color-bg-secondary: var(--vst-color-dark-200);
      --vst-color-bg-tertiary: var(--vst-color-dark-300);

      --vst-color-bg: var(--vst-color-bg-dark);

      /* Elements */
      --vst-color-btn-text-bg-hover: var(--vst-color-bg-secondary);
      --vst-color-btn-danger: var(--vst-color-danger-300);
      --vst-color-btn-danger-hover: var(--vst-color-fg-primary);
      --vst-color-btn-danger-bg-hover: var(--vst-color-danger-300);
      --vst-color-toolbar-bg: var(--vst-color-bg-secondary);
      --vst-color-btn-toolbar-bg: var(--vst-color-bg-secondary);
      --vst-color-btn-toolbar-bg-hover: var(--vst-color-bg-primary);
      --vst-color-media-btn-bg-hover: var(--vst-color-bg-primary);
      --vst-color-icon-hover: var(--vst-color-bg-secondary);
      --vst-color-btn-graph-bg: var(--vst-color-bg-secondary);
      --vst-color-btn-graph-border: var(--vst-color-neutral);
      --vst-color-btn-graph-bg-hover: var(--vst-color-bg-primary);
      --vst-color-btn-graph-border-hover: var(--vst-color-bg-primary);
      --vst-color-examine-handle-bg: var(--vst-color-bg-primary);
      --vst-color-prediction-toolbar-bg: var(--vst-color-bg-tertiary);
      --vst-color-sensor-bg: var(--vst-color-bg-primary);
      --vst-color-proximity-connect-bg: transparent;
      --vst-color-proximity-connect-text: var(--vst-color-warning-100);
      --vst-color-connect-pane-bg: transparent;
      --vst-color-connect-pane-text: var(--vst-color-warning-100);
      --vst-color-inner-popover-bg: var(--vst-color-bg-tertiary);
      --vst-grid-selected-background-color: var(--vst-color-bg-primary);
      --vst-grid-selected-border-color: var(--vst-color-neutral);
      --vst-grid-body-background-color: var(--vst-color-bg);
      --vst-grid-border-color: var(--vst-color-neutral);
      --vst-color-sample-video-bg: var(--vst-color-bg-tertiary);
      --vst-color-notes-bg: var(--vst-color-bg-tertiary);
      --vst-color-btn: var(--vst-color-fg-primary);
      --vst-color-btn-bg: var(--vst-color-bg-primary);
      --vst-color-btn-bg-hover: var(--vst-color-bg-secondary);
      --vst-color-btn-bg-active: var(--vst-color-bg-tertiary);
      --vst-color-btn-border: var(--vst-color-neutral);
      --vst-shadow-btn-hover: 0;
      --vst-opacity-disabled: 0.25;
      --vst-color-predictions-overlay-bg: rgba(0, 0, 0, 0.45);
      --vst-color-popover-border: var(--vst-color-neutral);
      --vst-color-text-brand: var(--vst-color-fg-primary);
      --vst-color-text-brand-hover: var(--vst-color-fg-primary);
      --vst-color-text-success: var(--vst-color-success);
      --vst-color-text-success-hover: var(--vst-color-success-dark);
      --vst-color-text-info: var(--vst-color-info-ui);
      --vst-color-text-info-hover: var(--vst-color-info);
      --vst-color-text-warning: var(--vst-color-warning);
      --vst-color-text-warning-hover: var(--vst-color-warning);
      --vst-color-text-important: var(--vst-color-important);
      --vst-color-text-important-hover: var(--vst-color-important-dark);
      --vst-color-text-danger: var(--vst-color-danger-200);
      --vst-color-text-danger-hover: var(--vst-color-danger-100);
      --vst-color-bg-brand: var(--vst-color-brand-bg);
      --vst-color-bg-success: var(--vst-color-success-bg);
      --vst-color-bg-warning: var(--vst-color-warning-bg);
      --vst-color-bg-important: var(--vst-color-important-bg);
      --vst-color-bg-danger: var(--vst-color-danger-bg);
      --vst-color-tag-brand-bg: var(--vst-color-brand);
      --vst-color-tag-brand-border: var(--vst-color-brand);
      --vst-color-tag-brand: var(--vst-color-fg-primary);
      --vst-color-tag-success-bg: var(--vst-color-success);
      --vst-color-tag-success-border: var(--vst-color-success);
      --vst-color-tag-success: var(--vst-color-fg-primary);
      --vst-color-tag-info-bg: var(--vst-color-info);
      --vst-color-tag-info-border: var(--vst-color-info);
      --vst-color-tag-info: var(--vst-color-fg-primary);
      --vst-color-tag-warning-bg: var(--vst-color-warning);
      --vst-color-tag-warning-border: var(--vst-color-warning);
      --vst-color-tag-warning: var(--vst-color-fg-primary);
      --vst-color-tag-important-bg: var(--vst-color-important);
      --vst-color-tag-important-border: var(--vst-color-important);
      --vst-color-tag-important: var(--vst-color-fg-primary);
      --vst-color-tag-danger-bg: var(--vst-color-danger);
      --vst-color-tag-danger-border: var(--vst-color-danger);
      --vst-color-tag-danger: var(--vst-color-fg-primary);
      --vst-color-divider-thumb-bg: var(--vst-color-fg-secondary);
      --vst-color-divider-thumb-border: var(--vst-color-neutral);
      --vst-color-divider-thumb-bg-active: var(--vst-color-bg-primary);
      --vst-color-logo: var(--vst-color-fg-primary);
      --vst-color-bg-graph: var(--vst-color-bg-secondary);
      --vst-color-calibration-bg: var(--vst-color-bg-secondary);
      --vst-color-calibration-border: var(--vst-color-neutral);
      --vst-color-calibration-rsr-bg: var(--vst-color-bg-secondary);
      --vst-color-calibration-rsr-border: var(--vst-color-neutral);
      --vst-color-input-bg: transparent;
      --vst-dark-outline-color: var(--vst-color-brand-100);
    `)}

  ${ws("s",Te`
      :host,
      html {
        --vst-screen-size: s;
      }
    `)}

  ${ws("m",Te`
      :host,
      html {
        --vst-screen-size: m;
      }
    `)}

  ${ws("l",Te`
      :host,
      html {
        --vst-screen-size: l;
      }
    `)}

  ${ws("xl",Te`
      :host,
      html {
        --vst-screen-size: xl;
      }
    `)}

  ${ws(":host","s",Te`
      :host,
      html {
        --vst-space-l: 2rem;
      }
    `)}
`;var jf=()=>{if(!window.chrome.storage){console.error("Add the `storage` permission in your manifest.json!");return}let n={};window.chrome.storage.local.get("localStorage_data",e=>{try{n=e.localStorage_data||{}}catch(t){console.warn("Failed to load the previous data. Perhaps the first run?")}window.__defineGetter__("localStorage",()=>({getItem(t){try{return n[t]}catch(s){return}},setItem(t,s){n[t]=`${s}`;try{window.chrome.storage.local.set({localStorage_data:n})}catch(r){console.error(r)}},removeItem(t){try{delete n[t],window.chrome.storage.local.remove(t)}catch(s){console.error(s)}}}))})},wo=()=>{jf()};var Ed=n=>{wo&&wo(n)};var xo=n=>{window.chrome.runtime.sendMessage(n)};var Wf=(n,e)=>{xo?xo(n,e):console.log(`no background page to send msg: ${n}`)},_d=()=>({sendMessage:Wf});var Rd=le(_e());function li(...n){window.location.replace(...n)}var Dd=le(_e()),{chrome:Md}=window,Td=class extends Dd.default{constructor(){super();let{launchData:e}=window;if(this.authKey="",e?.url){let{url:t}=e;this.emitUrlChange(t)}Md.runtime.onMessage.addListener(t=>{t.startupFile&&t.startupFile.url&&this.emitUrlChange(t.startupFile.url)})}checkOpeningUrl(){Md.runtime.sendMessage("check-start-file")}emitUrlChange(e){if(e){let s=new URL(e).searchParams.get("key");s.length&&(this.emit("url-changed",s),this.authKey=s)}}},Co=()=>new Td;var ci=class extends Rd.default{constructor(){super();this._search=Va,this._messageListener=this.__messageListener.bind(this),this._setup=null}get sessionId(){return Xa()}get experimentId(){return Ka()}get hostId(){return za()}get blockId(){return Ja()}get blockType(){return this._search.get("blockType")}get isBlock(){return!!(this.sessionId||this.experimentId||this.blockId)}get manual(){return this._search.has("manual")}get isContentCreatorSession(){return this.experimentId&&!this.sessionId}get _hasSession(){return this.__hasSession}set _hasSession(e){this.__hasSession=e,this.emit("has-session-updated",e)}get hasSession(){return this._hasSession!==void 0?Promise.resolve(this._hasSession):new Promise(e=>{this.once("has-session-updated",t=>{e(t)})})}get hasFile(){return!!(this._search.has("video")||this._search.has("experimenturl")||this._search.has("experimentid")||this.sessionId||this.experimentId)}static async authorizeApp(e){try{await et.authorize(e)}catch(s){if(s.message==="eula"){let r=window.location.hostname.includes("graphicalanalysis")?"/accept/index.html":"/auth/accept.html";li(`${r}${e?`?key=${e}`:""}`);return}li(`/auth/${e?`?key=${e}`:""}`);return}let t=new URL(window.location.href);window.history.replaceState(null,null,t.toString())}async handleVideo(e){if(await this.hasSession)return;let t=await fetch(e.replace("sample-videos/","sample-videos%2F"));if(!t.ok){this.emit("startup-url-error",{status:t.status,fileType:"video",location:e});return}let s=await t.blob(),r=e.split("/").pop(),i=new File([s],`${r}`,{type:s.type});this.emit("startup-url-video",{videoData:{file:i,filepath:r}})}async handleExperimentUrl(e){if(await this.hasSession)return;let t;try{t=await fetch(e.replace("sample-experiments/","sample-experiments%2F"),{mode:"cors"}).catch(o=>({ok:!1,status:o.message}))}catch{t={ok:!1}}if(!t.ok){this.emit("startup-url-error",{status:t.status,fileType:"experiment",location:e,skipToast:!this.fallbackExperiment||this.manual});return}let s=await t.blob(),r=e.split("/").slice(-1)[0],i=new File([s],r,{type:s.type});this.emit("startup-url-experiment",{fileData:{file:i,filepath:i.name,name:i.name}})}async handleSessionId(e){let t,s="";try{if(t=await fetch(`https://sessions.graphicalanalysis.app/${e}`,{mode:"cors"}).catch(o=>({ok:!1,status:o.message,error:o})),t.error)throw new Error(t.error);s=await t.clone().text()}catch{t={ok:!1}}if(this.emit("startup-url-session",{sessionId:e}),!t.ok||s.includes("<Code>AccessDenied</Code>")){this.removeMessageListener(),this._hasSession=!1,this.fallbackExperiment=!0,this.handleExperimentUrl(`https://2e1cohznn2.execute-api.us-west-2.amazonaws.com/beta/${this.experimentId}`);return}let r=await t.blob();if(r){let i=new File([r],e,{type:r.type});this.emit("startup-url-experiment",{fileData:{file:i,filepath:i.name,name:i.name}}),this._hasSession=!0}else this._hasSession=!1}async checkOpeningUrl(e,{requireKey:t=!0}={}){if(this.sessionId?this.handleSessionId(this.sessionId):(this._hasSession=!1,this.experimentId&&(window.__isSessionClient||this.handleExperimentUrl(`https://2e1cohznn2.execute-api.us-west-2.amazonaws.com/beta/${this.experimentId}`),this.emit("startup-url-experiment-configuration",{experimentId:this.experimentId}))),this._search.has("video")&&this.handleVideo(this._search.get("video")),this._search.has("experimenturl")&&this.handleExperimentUrl(this._search.get("experimenturl")),this._search.has("key")){let s=this._search.get("key");await ci.authorizeApp(s)}else t&&!await et.validateLicense(e)&&li("/auth/")}__messageListener({data:e}){let t=["FILE_CACHE_UPDATED","FILE_CACHE_USED"],s=["FILE_SAVE_PENDING","FILE_SAVE_ERROR","FILE_SAVE_SUCCESS"];![...t,...s].includes(e.type)||this.emit(e.type,e.payload)}setupMessageListener(){!navigator.serviceWorker||this._setup||(navigator.serviceWorker.addEventListener("message",this._messageListener),this._setup=!0)}removeMessageListener(){!navigator.serviceWorker||(navigator.serviceWorker.removeEventListener("message",this._messageListener),this._setup=!1)}};function Ad(){return Co?Co():new ci}var Io=[],Pd=n=>{Io.push(n)},kd=()=>{Io=[]},Ld=n=>{Io.forEach(e=>e(n))};var Od=[],Uf=n=>{let e=n.length,t=[];for(let r=0;r<e;++r){let i=n[r].serviceHostPort.split(":")[1];t.push({address:`${n[r].ipAddress}:${i}`,name:n[r].serviceName.split(".")[0]})}function s(r,i){let o=r.name.toLowerCase(),l=i.name.toLowerCase(),c=0;return o<l?c=-1:o>l&&(c=1),c}t.sort(s),Od=t,Ld(t)},di=()=>{window.chrome.runtime.sendMessage({dsSourceDiscovery:"start"}),window.chrome.runtime.onMessage.addListener(n=>{n.mdnsServices&&Uf(n.mdnsServices)})},Eo=()=>{},_o=()=>(di(),Od);var qf=[],Gf=n=>{Pd(n)},Hf=()=>{kd()},Vf=()=>di?di():()=>{console.log("not implemented")},zf=()=>(Hf(),Eo?Eo():()=>{console.log("not implemented")}),Kf=()=>_o?_o():qf,Fd=()=>({startListeners:Vf,stopListeners:zf,getSourceList:Kf,onListChange:Gf});var jd=le(Mo());var it="FILE_DATA",Be="meta",Nd="VstUdmData",Zf=22,hi=class{static get name(){return Nd}open(){let e=10,t=250;return new Promise((s,r)=>{window.indexedDB||r(new Error("IndexedDB not supported"));let i=0,o=setInterval(()=>{this._openSequence().then(()=>{clearInterval(o),s()},l=>{clearInterval(o),r(l)}),++i>=e&&(clearInterval(o),r(new Error("indexedDB could not open database after several attempts.")))},t)})}_openSequence(){return new Promise((e,t)=>{let s=window.indexedDB.open(Nd,Zf);s.onerror=r=>{t(r.target.error)},s.onsuccess=r=>{this.db=r.target.result,e()},s.onupgradeneeded=r=>{let i=r.target.result;i.objectStoreNames.contains("data")&&i.deleteObjectStore("data"),i.objectStoreNames.contains(it)&&i.deleteObjectStore(it),i.objectStoreNames.contains(Be)&&i.deleteObjectStore(Be),i.createObjectStore(it),i.createObjectStore(Be,{keyPath:"key"})},s.onblocked=r=>{t(new Error("indexedDB is blocked."))}})}set(e,t,s={}){let r=[],i=new Promise((o,l)=>{let c=this.db.transaction([it],"readwrite");c.oncomplete=()=>{o()},c.onerror=u=>{l(u.target.error)},c.objectStore(it).put(t,e)});return r.push(i),i=new Promise((o,l)=>{let c=this.db.transaction([Be],"readwrite");c.oncomplete=()=>{o()},c.onerror=u=>{l(u.target.error)},s.length=t.length,s.timestamp=Date.now(),s.key=e,c.objectStore(Be).put(s)}),r.push(i),Promise.all(r)}get(e){return new Promise((t,s)=>{let i=this.db.transaction([it]).objectStore(it).get(e);i.onerror=o=>{s(o.target.error)},i.onsuccess=()=>{i.result?t(i.result):s(new Error(`no key '${e}'`))}})}setMeta(e,t){return this.getMeta(e).then(s=>{let r=Object.keys(t);return r.forEach(i=>{i!=="length"&&(s[i]=t[i])}),r.timestamp=Date.now,new Promise((i,o)=>{let l=this.db.transaction([Be],"readwrite");l.oncomplete=()=>{i()},l.onerror=c=>{o(c.target.error)},l.objectStore(Be).put(s)})})}getMeta(e){return new Promise((t,s)=>{let i=this.db.transaction([Be]).objectStore(Be).get(e);i.onerror=o=>{s(o.target.error)},i.onsuccess=()=>{i.result?t(i.result):s(new Error(`no key '${e}'`))}})}keys(e){return new Promise((t,s)=>{let i=this.db.transaction([it]).objectStore(it).getAllKeys();i.onerror=o=>{s(o.target.error)},i.onsuccess=()=>{if(e){let o=[];i.result.forEach(l=>{l.startsWith(e)&&o.push(l)}),t(o)}else t(i.result)}})}remove(e){let t=[],s=new Promise((r,i)=>{let o=this.db.transaction([it],"readwrite");o.oncomplete=()=>{r()},o.onerror=l=>{i(l.target.error)},o.objectStore(it).delete(e)});return t.push(s),s=new Promise((r,i)=>{let o=this.db.transaction([Be],"readwrite");o.oncomplete=()=>{r()},o.onerror=l=>{i(l.target.error)},o.objectStore(Be).delete(e)}),t.push(s),Promise.all(t)}clear(e){if(!e){let t=[],s=new Promise((r,i)=>{let o=this.db.transaction([it],"readwrite");o.oncomplete=()=>{r()},o.onerror=l=>{i(l.target.error)},o.objectStore(it).clear()});return t.push(s),s=new Promise((r,i)=>{let o=this.db.transaction([Be],"readwrite");o.oncomplete=()=>{r()},o.onerror=l=>{i(l.target.error)},o.objectStore(Be).clear()}),t.push(s),Promise.all(t)}return this.keys(e).then(t=>{let s=[];return t.forEach(r=>{s.push(this.remove(r))}),Promise.all(s)})}size(){return new Promise((e,t)=>{let r=this.db.transaction([Be]).objectStore(Be).openCursor(),i=0,o={};r.onerror=l=>{t(l.target.error)},r.onsuccess=l=>{let c=l.target.result;if(c){c.key.endsWith("/data.udm")?i+=2*c.value.length:i+=c.value.length,i+=4*1024;let u=c.key.lastIndexOf("/vstudm/data.udm");if(u>=0){let p=c.key.substring(0,u),m=parseInt(p);Number.isNaN(m)||(o[p]={})}c.continue()}else{let u=Object.keys(o).length;e({size:i,documentCount:u})}}})}prune(e=1){return new Promise((t,s)=>{let i=this.db.transaction([Be]).objectStore(Be).getAll();i.onerror=o=>{s(o.target.error)},i.onsuccess=()=>{if(!i.result||i.result.length===0)t();else{let o=i.result,l=[];o.sort((c,u)=>{let p=c.timestamp||0;return(u.timestamp||0)-p});for(let c=e;c<o.length;c++)l.push(this.remove(o[c].key));Promise.all(l).then(()=>{t()})}}})}};function $d(n){return new TextDecoder().decode(n)}function Qf(n){return new TextEncoder().encode(n)}function gr(){return er()}var pi={REQUEST:"ARCHIVE_REQUEST",RESPONSE:"ARCHIVE_RESPONSE"},vr=class{static get dataBaseName(){return hi.name}constructor(e={}){this.configuration={platform:"deprecated"},this._sequence=0,this.name=e.name||gr(),this.exportName=this.name,this.importPath=null,this.attachments=e.attachments??{},this.currentOffset=0,this.maxDBSize=e.maxDBSize,this.leaveAfterPrune=e.leaveAfterPrune,this.db=new hi,!window.__isSessionClient&&navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",async({data:{type:t,id:s,property:r,args:i}})=>{if(t===pi.REQUEST){let l=(await navigator.serviceWorker.ready).active,c=await(typeof this[r]=="function"?this[r](...i):this[r]);l.postMessage({type:pi.RESPONSE,id:s,payload:c})}})}get archivePaths(){return Object.keys(this.attachments).map(e=>this._makeKey(e))}async _prune(){let e,t=200*1024*1024;try{e=(await navigator.storage.estimate()).quota/10}catch(r){e=t}let s=Math.floor(Math.min(this.maxDBSize,e,t));return s!==null&&s>=0?this.db.size().then(r=>{let i=o=>{let l="KB",c=Math.floor(o/1024);return c>1024&&(c=Math.floor(c/1024),l="MB"),`${c}${l}`};if(console.log(`Current IndexedDB contains ${r.documentCount} documents, size is ${i(r.size)} (prune threshold ${i(s)})`),r.size>=s||r.documentCount>this.leaveAfterPrune)return this.db.prune(this.leaveAfterPrune).then(()=>this.db.size().then(o=>{let l=i(o.size);this.db.keys().then(c=>{let u=Object.keys(this.attachments);for(let p=0;p<u.length;p++)c.includes(u[p])||delete this.attachments[u[p]]}),console.log(`IndexedDB was pruned, left ${o.documentCount} documents, new size ${l}`)}))}):Promise.resolve()}static create(e={}){let t=new vr(e);return window.__isSessionClient?new Proxy(t,{get(s,r){if(["then"].includes(r))return s[r];let i=async(o,l)=>{let u=(await navigator.serviceWorker.ready).active,p=crypto.randomUUID();return new Promise((m,v)=>{u.postMessage({type:pi.REQUEST,id:p,property:o,args:l});let b=({data:y})=>{y.type===pi.RESPONSE&&y.id===p&&(y.payload?m(y.payload):v(new Error(`Archive property: ${o} not found`)),navigator.serviceWorker.removeEventListener("message",b))};navigator.serviceWorker.addEventListener("message",b)})};return typeof s[r]=="function"?function(...o){return i(r,o)}:i(r)}}):t.db.open().then(()=>t._prune().then(()=>t._findSequenceStart().then(s=>(console.debug(`Archive numbering sequence starts at ${s}`),t._sequence=s,e.name||(t.name=gr()),t.db.clear(t._makeKey()).then(()=>t)))))}open(e={}){return this._reset(e),this.db.keys(this._makeKey()).then(t=>{let s=!1,r=this._makeKey("data.udm");if(t.forEach(i=>{i===r?s=!0:this.attachments[this._getPath(i)]={}}),!s)return Promise.reject(new Error(`Document ${this.name} doesn't exist`))})}load(e={}){console.assert(e.path),console.assert(e.buffer);let t;return e.reuseSession?t=Promise.resolve():(this.name=gr(),t=this._prune()),this.exportName=e.name,this.importPath=e.path,t.then(()=>this._parse(e.buffer))}newSession(e={}){let t;return e.reuseSession?(console.debug("reusing old session DB entry"),t=Promise.resolve()):(this.name=e.name||gr(),t=this._prune()),t.then(()=>this.db.clear(this._makeKey()))}clear(){return this.db.clear()}setExportName(e){return this.exportName=e,this.db.setMeta(this._makeKey("data.udm"),{exportName:e}).catch(t=>{if(!t.message.startsWith("no key"))return Promise.reject(t)})}_reset(e={}){this.name=e.name||gr(),this.exportName=this.name,this.importPath=null,this.attachments={},this.currentOffset=0}_findSequenceStart(){return this.listDocuments().then(e=>{let t=0,s=0;return e.forEach(r=>{let i=parseInt(r.key);Number.isNaN(i)||(i>t&&(t=i),i<5e3&&i>s&&(s=i))}),t>=9999&&(t=s,console.debug(`post rolover sequence starts at ${t}`)),t})}_makeKey(e,t){return console.assert(this.name),t?`${this.name}/vstudm/${t}/${e}`:e?`${this.name}/vstudm/${e}`:`${this.name}/vstudm`}_getPath(e){let t=`${this.name}/vstudm/`;return e.startsWith(t)?e.substring(t.length):e}_archiveSize(){let e=1024,t=s=>{let r=s.length,i=r%512;return i&&(i=512-i),512+r+i};return this.db.keys(this._makeKey()).then(s=>{let r=[];return s.forEach(i=>{r.push(this.db.getMeta(i).then(o=>{e+=t(o)}))}),Promise.all(r).then(()=>e)})}_parse(e){if(!this.name)return Promise.reject(new Error("Name not set"));let t=0,s=this._parseHeader(e);return s?this.db.clear(this._makeKey()).then(()=>{let r=[];for(;s;){let i=s.name.indexOf("/");if(i<0)return Promise.reject(new Error("malformed UDM archive"));let o=s.name.substr(i+1);r.push(this._extractData(e,o)),o!=="data.udm"&&(this.attachments[o]={}),t+=s.length+512;let l=t%512;l&&(t+=512-l);let c=e.subarray(t,t+512);s=this._parseHeader(c)}return Promise.all(r).then(()=>{let i=this._makeKey("data.udm");return this.db.get(i).then(o=>o)})}):Promise.reject(new Error("not a UDM archive"))}_defaultMeta(){return{exportName:this.exportName,importPath:this.importPath}}writeXml(e){let t=this._defaultMeta();if(typeof e=="string")return this.db.set(this._makeKey("data.udm"),e,t);if(e instanceof Uint8Array){let s=$d(e);return this.db.set(this._makeKey("data.udm"),s,t)}return Promise.reject(new Error(`Unhandled input type ${typeof e}`))}exportDocument(){if(!this.name)return Promise.reject(new Error("Document name not set"));let e;this.currentOffset=0;let t=(o,l)=>new Promise((c,u)=>{let p=()=>{o()?l().then(p).catch(m=>{u(m)}):c()};p()}),s=o=>this.db.get(this._makeKey(o)).then(l=>this._writeHeader(e,`vstudm/${o}`,l.byteLength).then(()=>this._writeFile(e,l))),r=Object.keys(this.attachments),i=0;return this._archiveSize().then(o=>(console.debug(`exporting document, archive size is ${o}`),e=new Uint8Array(o),t(()=>i<r.length,()=>s(r[i++])).then(()=>this.db.get(this._makeKey("data.udm")).then(l=>{let c=Qf(l);return this._writeHeader(e,"vstudm/data.udm",c.byteLength).then(()=>this._writeFile(e,c).then(()=>this.currentOffset%512!=0?Promise.reject(new Error("Incorrectly aligned final currentOffset")):(e.fill(0,this.currentOffset,this.currentOffset+1024),e)))}))))}async addAttachment(e,t){let s=t.type||"video/mp4",r=new Uint8Array(await Kr(t));await this.db.set(this._makeKey(t.name,e),r,{mimeType:s});let i=`${e}/${t.name}`;return this.attachments[i]={},{archPath:`vstudm/${i}`,fileContents:r}}async replaceAttachment(e,t,s){let r=s.type||"video/mp4",i=this._makeKey(t,e),o=this._makeKey(s.name,e),l=await this.db.get(o);await this.db.remove(i),await this.db.set(o,l,{mimeType:r});let c=`${e}/${s.name}`,u=`${e}/${t}`;return delete this.attachments[u],this.attachments[c]={},{archPath:`vstudm/${c}`,fileContents:l}}setAttachmentId(e,t){let s=e;s.startsWith("vstudm/")&&(s=s.substr(7));let r=this.attachments[s];return r.id=t,t}getAttachmentPaths(){return Object.keys(this.attachments)}async getAttachment(e){let t=this._makeKey(e),s=await this.db.getMeta(t);return{data:await this.db.get(t),mimeType:s.mimeType||"video/mp4"}}removeAttachment(e){return console.log("remove attachment %s",e),delete this.attachments[e],this.db.remove(this._makeKey(e))}clearAttachments(e){let t=Object.keys(this.attachments),s=[];return t.forEach(r=>{(!e||r.startsWith(e))&&s.push(this.removeAttachment(r))}),Promise.all(s)}removeAttachmentById(e){let t=Object.keys(this.attachments),s;return t.forEach(r=>{this.attachments[r].id===e&&(s=r)}),s?this.removeAttachment(s):Promise.reject(new Error(`Could not find id ${e}`))}_extractData(e,t){let s=0,r=e.subarray(0,512),i=this._parseHeader(r),o;for(;i;){if(i.name===`vstudm/${t}`){let c=e.subarray(s+512,s+512+i.length);if(t==="data.udm"){let u=$d(c);o=this.db.set(this._makeKey(t),u,this._defaultMeta())}else o=this.db.set(this._makeKey(t),c);break}s+=512+i.length;let l=s%512;l&&(s+=512-l),r=e.subarray(s,s+512),i=this._parseHeader(r)}return o||Promise.reject(new Error(`Failed to extract data for ${t}`))}_calcCheckSum(e){let t=256,s;for(s=0;s<148;s++)t+=e[s];for(s=156;s<512;s++)t+=e[s];return t}_parseHeader(e){console.assert(e instanceof Uint8Array),console.assert(e.length>=512);let t=(l,c)=>{let u=e.subarray(l,l+c),p=u.indexOf(0);return p>-1&&(u=e.subarray(l,l+p)),String.fromCharCode(...u)},s=()=>{let l=t(148,6);return parseInt(l,8)};if(e[148]===0)return null;let r=this._calcCheckSum(e),i=s();if(r!==i)return console.warn(`checksum mismatch, calculated  ${r}, parsed ${i}`),null;if(t(265,6)!=="vstudm")return null;let o={};return o.name=t(0,100),o.length=parseInt(t(124,12),8),o}_writeHeader(e,t,s){return new Promise(r=>{let i=new Uint8Array(512);i.fill(0);let o,l=Math.min(t.length,99);for(o=0;o<l;o++)i[o]=t.charCodeAt(o);let u=436 .toString(8);for(o=0;o<Math.min(u.length,8);o++)i[o+100]=u.charCodeAt(o);let p=s.toString(8);for(o=0;o<Math.min(p.length,11);o++)i[o+124]=p.charCodeAt(o);for(o=0;o<6;o++)i[265+o]="vstudm".charCodeAt(o);let m=this._calcCheckSum(i);for(m=m.toString(8),o=0;o<6;o++)i[o+148]=m.charCodeAt(o);i[o+148+1]=" ".charCodeAt(0),e.set(i,this.currentOffset),this.currentOffset+=512,r()})}async _writeFile(e,t){let s=t.byteLength;e.set(t,this.currentOffset),this.currentOffset+=s;let r=s%512;r&&(r=512-r),e.fill(0,this.currentOffset,this.currentOffset+r),this.currentOffset+=r}_createTar(e){let t=e.length,s=t%512,r=512-s;t+=3*512+r;let i=new Uint8Array(t);i.subarray(0,512).fill(0);let l,c="vstudm/data.udm";for(l=0;l<c.length;l++)i[l]=c.charCodeAt(l);let u=e.length.toString(8);for(l=0;l<Math.min(u.length,11);l++)i[l+124]=u.charCodeAt(l);let p="vstudm";for(l=0;l<p.length;l++)i[265+l]=String(p).charCodeAt(l);let m=this._calcCheckSum(i);m=m.toString(8);let v=Math.min(m.length,6);for(l=0;l<6-v;l++)i[l+148]="0".charCodeAt(0);for(;l<6;l++)i[l+148]=m.charCodeAt(l-(6-v));for(i[l+148+1]=" ".charCodeAt(0),l=0;l<e.length;l++)i[l+512]=e.charCodeAt(l);return i.subarray(512+e.length).fill(0),i}listDocuments(){let e=0,t=[],s=(i,o)=>new Promise((l,c)=>{let u=()=>{i()?o().then(u).catch(p=>{c(p)}):l()};u()}),r=i=>this.db.getMeta(i).then(o=>{let l=i.lastIndexOf("/vstudm/data.udm");if(l<0)return Promise.reject(new Error(`Malformed key ${i}`));let c=i.substring(0,l),u={exportName:o.exportName,key:c};t.push(u)});return this.db.keys().then(i=>{let o=[];return i.forEach(l=>{l.endsWith("/data.udm")&&o.push(l)}),o}).then(i=>s(()=>e<i.length,()=>r(i[e++])).then(()=>t))}};var To=class extends jd.default{constructor({api:e,dataWorld:t}){super();this.validateJWT=e=>this.api.validateJWT(e);this.dataWorld=t,this.dataWorld.videoAttachmentImportHook=this.videoAttachmentImportHook.bind(this),this.api=e,this.videoId=null,this.dataWorld.on("session-ended",async()=>{this.dataWorld?.archive?.clearAttachments&&this.dataWorld.archive.clearAttachments("videos"),this.videoId=null}),this.dataWorld.on("view-changed",async s=>{s.videos?.length&&(this.videoId=s.videos[0].id)}),this.dataWorld.archive=new Promise(async s=>{let r=vr.create({maxDBSize:2*1024*1024*1024,leaveAfterPrune:20});if(await this.dataWorld.blockSynced,window.__isSessionClient){let i=await r.attachments,o=Object.keys(i);o.length&&Promise.all(o.map(async l=>{if(!l.includes("videos"))return;let c=await r.getAttachment(l),u=new Blob([c.data],{type:c.mimeType});this.updateVideo(u)}))}s(r)}).then(s=>{this.dataWorld.archive=s})}get videoUrl(){return this._videoUrl}async videoAttachmentImportHook(e){this.updateVideo(e,!0)}async updateVideo(e,t=!1){this._videoUrl&&window.URL.revokeObjectURL(this._videoUrl);try{t||await this._setVideo(e),this._videoUrl=window.URL.createObjectURL(e)||"",this.emit("video-src-changed",{src:this._videoUrl})}catch(s){console.error(s)}}async _setVideo(e){try{await this.dataWorld.archive.clearAttachments("videos");let{archPath:t}=await this.dataWorld.archive.addAttachment("videos",e);return this.videoId=await this.api.setVideo(this.dataWorld.experimentId,t),this.dataWorld.archive.setAttachmentId(t,this.videoId),this.videoId}catch(t){return console.error(t),t}}async removeVideo(e=this.videoId){try{await this.api.removeVideo(this.dataWorld.experimentId,Math.floor(e)),await this.dataWorld.archive.clearAttachments("videos"),this.emit("video-src-changed",{src:""})}catch(t){console.error(t)}}setVideoVisibility(e,t=this.videoId){return this.api.setVideoVisibility(this.dataWorld.experimentId,e,t)}};var Ro=class{constructor(e){this.rpc=e}setVideo(e,t){return this.rpc.sendRequest("add-video",{experimentId:e,archPath:t})}removeVideo(e,t){return this.rpc.sendRequest("remove-video",{experimentId:e,videoId:Math.floor(t)})}setVideoVisibility(e,t,s){return this.rpc.sendRequest("set-video-visibility",{experimentId:e,visible:t,videoId:Math.floor(s)})}validateJWT(e){return this.rpc.sendRequest("validate-jwt",{token:e})}};var Wd=le(Mo());var Ao=class{constructor(){this.replayStarted=()=>{},this.startVideo=()=>{},this.reportTimestamp=()=>{},this.replayEnded=()=>{}}},Po=class{constructor(e,t){let{replayDuration:s=10,videoDelay:r=0,replayRate:i=1,dataInterval:o=.05,startTime:l=0}=t;this.videoStartDelay=r,this.replayRate=i,this.reportingInterval=o/i,this.duration=s,this.startTime=l,this.delegate=e}start(){if(!this.timer){let e=Date.now();this._playbackTime=e-(this.videoStartDelay<0?this.videoStartDelay*1e3/this.replayRate:0),this._scheduleTimer(),this.delegate.replayStarted(),this._serviceTime()}}stop(){this.timer&&(clearTimeout(this.timer),this.timer=void 0)}seekTime(e){this.startTime=e,this.timer&&(this.stop(),this.start())}_scheduleTimer(){this.timer=setTimeout(()=>{this._serviceTime()&&this._scheduleTimer()},this.reportingInterval*1e3)}_now(){let e=(Date.now()/1e3-this._playbackTime/1e3)*this.replayRate,t=this.startTime+e;return{elapsedTime:e,reportedTime:t}}get currentTimestamp(){return this._now().reportedTime}_serviceTime(){let e=!0,{elapsedTime:t,reportedTime:s}=this._now();return this.delegate.reportTimestamp(s),!this._videoStarted&&(this.videoStartDelay<0||s>=this.videoStartDelay)&&(this.delegate.startVideo(s-this.videoStartDelay,this.replayRate),this._videoStarted=!0),t>=this.duration-this.startTime&&(this.delegate.replayEnded(),this.stop(),e=!1),e}};var br=class extends Wd.default{constructor({api:e,dataWorld:t,dataCollection:s}){super();this._defaults={currentDataSetId:0,isReplayActive:!1,replayRate:1},Object.assign(this,this._defaults),this.videoSync={enabled:!1,videoSyncTime:0,dataSyncTime:0},lt(this,{videoSync:ye,currentDataSetId:ye,isReplayActive:ye,replayRate:ye,updateVideoSync:fe,resetService:fe,enterReplayMode:fe,exitReplayMode:fe,updateReplayRate:fe,updateDataSet:fe,startDataPlayback:fe}),this.api=e,this.dataWorld=t,this.dataCollection=s,this.isSyncPaneOpen=!1,this._replayParams={},this._replayTimingCache={}}static getDefaultTimingInformation(e,t){let{mode:s,params:r}=t,i=10,o=1;s==="time-based"&&(r.delta&&(o=r.delta),r.duration&&(i=r.duration),r.units&&(o=en(o,r.units,"s"),i=en(i,r.units,"s")));let l={};return e.forEach(c=>{l[c]={duration:i,timeInterval:o}}),l}async resetService(e){this.timer&&(this.timer.stop(),this.timer=null,this.emit("replay-playing-changed",{playing:!1})),this.isReplayActive=!1,await this.api.exitReplayMode(this.dataWorld.experimentId,!0),this._replayParams={},await Promise.all(this.dataWorld.getDataSets().map(async i=>{let o=parseInt(i.id);this._replayParams[o]=await this.api.getReplayParams(this.dataWorld.experimentId,o)}));let{dataSyncTime:t,videoSyncTime:s,enabled:r}=Object.values(this._replayParams)[0]||{};if(this.updateVideoSync({dataSyncTime:t,videoSyncTime:s,enabled:r},void 0,e),e){let{dataSetId:i,active:o,rate:l}=await this.api.getReplayOptions(this.dataWorld.experimentId);Re(()=>{this.replayRate=l>0?l:1}),o&&await this.enterReplayMode(i)}else Re(()=>{Object.assign(this,this._defaults)}),await this.api.setReplayOptions(this.dataWorld.experimentId,this.currentDataSetId,this.isReplayActive,this.replayRate);this.emit("replay-service-reset",this)}getResetTimestamp(){let e=0,{params:t}=this.dataCollection.getCollectionParams("time-based");return t&&(e-=t.delta/2),e}updateSyncPaneOpen(e){this.isSyncPaneOpen=e}get linkVideoToExamine(){return!this.isReplaying&&this.videoSync.enabled&&!(this.isSyncPaneOpen&&Oe("ff-ga-interactive-sync-inputs"))}get linkDataInputToExamine(){return!this.isReplaying&&this.videoSync.enabled&&this.isSyncPaneOpen&&Oe("ff-ga-interactive-sync-inputs")}async enterReplayMode(e,t=0){let s=parseInt(e);if(!this.isReplayActive)try{let r=this.dataWorld.getDataSets().map(i=>parseInt(i.id));try{this._replayTimingCache=await this.api.fetchTimingInformation(this.dataWorld.experimentId,r)}catch(i){console.error(i),this._replayTimingCache=br.getDefaultTimingInformation(r,this.dataCollection.getCollectionParams())}Re(()=>{this.currentDataSetId=s,this.isReplayActive=!0,this.emit("replay-status-change",{isReplayActive:!0})}),await this.api.setReplayOptions(this.dataWorld.experimentId,s,!0,this.replayRate),await this.api.enterReplayMode(this.dataWorld.experimentId,s,t),this.resumeTimestamp=void 0}catch(r){console.error(r)}}async exitReplayMode(){this.emit("replay-status-change",{isReplayActive:!1}),!!this.isReplayActive&&(this.isReplaying&&this.pauseDataPlayback(),Re(()=>{this.isReplayActive=!1,this.currentDataSetId=0}),await this.api.exitReplayMode(this.dataWorld.experimentId),await this.api.setReplayOptions(this.dataWorld.experimentId,0,!1,this.replayRate))}setReplayParams(e,t,s,r,i,o=!1){return this._replayParams[e]={dataSetId:e,videoId:t,dataSyncTime:s,videoSyncTime:r,enabled:i},o?Promise.resolve():this.api.setReplayParams(this.dataWorld.experimentId,e,t,s,r,i)}get replayParams(){return this._replayParams}get isReplaying(){return!!this.timer}set currentTimestamp(e){if(!this.isReplayActive){console.error("Attempting to set currentTimestamp w/o first entering playback mode.");return}this.isReplaying?this.timer.seekTime(e):this.resumeTimestamp=e;let{enabled:t,videoSyncTime:s,dataSyncTime:r}=this.videoSync,i=r-s,o=Math.max(0,e-i);t&&this.emit("scrub-video-requested",{timestamp:o});try{this.api.updateDataPlaybackTime(this.dataWorld.experimentId,e)}catch(l){console.error(l)}}get currentTimestamp(){return this.isReplayActive?this.isReplaying?this.timer.currentTimestamp:this.resumeTimestamp:(console.error("Attempting to fetch currentTimestamp w/o first entering playback mode."),NaN)}async updateDataSet(e){let t=parseInt(e);t!==this.currentDataSetId&&(this.isReplaying&&this.pauseDataPlayback(),await this.api.exitReplayMode(this.dataWorld.experimentId,!1),Re(()=>{this.currentDataSetId=t}),await this.api.enterReplayMode(this.dataWorld.experimentId,t),await this.api.setReplayOptions(this.dataWorld.experimentId,t,!0,this.replayRate),this.resumeTimestamp=void 0)}updateReplayRate(e){this.isReplaying||(this.replayRate=e,this.api.setReplayOptions(this.dataWorld.experimentId,this.currentDataSetId,this.isReplayActive,e))}rewind(){this.pauseDataPlayback(),this.resumeTimestamp=void 0,this.currentTimestamp=this.replayStart}updateVideoSync(e,t,s=!1){this.videoSync=P(P({},this.videoSync),e);let{dataSyncTime:r,videoSyncTime:i,enabled:o}=this.videoSync;this.dataWorld.getDataSets().map(async l=>{let c=parseInt(l.id);c!==0&&t!==0&&this.setReplayParams(c,t,r,i,o,s)})}get replayStart(){let{duration:e=10}=this._replayTimingCache[this.currentDataSetId];return this.resumeTimestamp&&e>=this.resumeTimestamp?this.resumeTimestamp:this.getResetTimestamp()}startDataPlayback(){let{duration:e=10,timeInterval:t=.02}=this._replayTimingCache[this.currentDataSetId],s=this.replayStart,{replayRate:r=1}=this,{enabled:i,videoSyncTime:o,dataSyncTime:l}=this.videoSync,c=i?l-o:0,u=new Ao;u.reportTimestamp=m=>this.api.updateDataPlaybackTime(this.dataWorld.experimentId,m);let p=(m,v)=>this.emit("start-video-requested",{time:m,rate:v});u.startVideo=i?p:()=>{},u.replayEnded=()=>{this.pauseDataPlayback()},this.timer=new Po(u,{startTime:s,replayDuration:e,replayRate:r,dataInterval:t,videoDelay:c}),this.timer.start(),this.emit("replay-playing-changed",{time:s,playing:!0})}pauseDataPlayback(){if(this.timer){let e=this.timer.currentTimestamp,{enabled:t,videoSyncTime:s,dataSyncTime:r}=this.videoSync,i=r-s,o=Math.max(0,e-i);t&&this.emit("pause-video-requested",{timestamp:o}),this.resumeTimestamp=e,this.timer.stop(),this.timer=null,this.emit("replay-playing-changed",{time:this.resumeTimestamp,playing:!1})}}_stepBackDataPlayback(){let{timeInterval:e}=this._replayTimingCache[this.currentDataSetId]||{};e&&Number.isFinite(this.currentTimestamp)&&(this.currentTimestamp-=e)}_stepForwardDataPlayback(){let{timeInterval:e}=this._replayTimingCache[this.currentDataSetId]||{};e&&Number.isFinite(this.currentTimestamp)&&(this.currentTimestamp+=e)}};var ko=class{constructor(e){this.rpc=e}enterReplayMode(e,t,s=0){return this.rpc.sendRequest("enter-replay-mode",{experimentId:e,dataSetId:t,columnGroupId:s})}updateDataPlaybackTime(e,t){return this.rpc.sendRequest("data-replay-update-time",{experimentId:e,timeStamp:t})}exitReplayMode(e,t=!1){return this.rpc.sendRequest("exit-replay-mode",{experimentId:e,noFlush:t})}setReplayOptions(e,t,s,r){return this.rpc.sendRequest("set-replay-options",{experimentId:e,dataSetId:t,active:s,rate:r})}getReplayOptions(e){return this.rpc.sendRequest("get-replay-options",{experimentId:e})}setReplayParams(e,t,s,r,i,o){return this.rpc.sendRequest("set-replay-params",{experimentId:e,dataSetId:t,videoId:s,dataSyncTime:r,videoSyncTime:i,enabled:o})}getReplayParams(e,t){return this.rpc.sendRequest("get-replay-params",{experimentId:e,dataSetId:t})}fetchTimingInformation(e,t,s=0){return this.rpc.sendRequest("fetch-timing-information",{experimentId:e,dataSetIds:t,columnGroupId:s})}};var Lo=class{constructor(e){this.rpc=e}fetchStatusJSON(e){return this.rpc.sendRequest("datashare-get-status",{experimentId:e})}fetchColumnDataJSON(e,t){let s=t.map(r=>Math.floor(r));return this.rpc.sendRequest("datashare-get-columns",{experimentId:e,columnIds:s})}};var Oo={};try{Oo.EventTarget=new EventTarget().constructor}catch(n){(function(e,t){var s=e.create,r=e.defineProperty,i=o.prototype;l(i,"addEventListener",function(u,p,m){for(var v=t.get(this),b=v[u]||(v[u]=[]),y=0,w=b.length;y<w;y++)if(b[y].listener===p)return;b.push({target:this,listener:p,options:m})}),l(i,"dispatchEvent",function(u){var p=t.get(this),m=p[u.type];return m&&(l(u,"target",this),l(u,"currentTarget",this),m.slice(0).forEach(c,u),delete u.currentTarget,delete u.target),!0}),l(i,"removeEventListener",function(u,p){for(var m=t.get(this),v=m[u]||(m[u]=[]),b=0,y=v.length;b<y;b++)if(v[b].listener===p){v.splice(b,1);return}}),Oo.EventTarget=o;function o(){"use strict";t.set(this,s(null))}function l(u,p,m){r(u,p,{configurable:!0,writable:!0,value:m})}function c(u){var p=u.options;p&&p.once&&u.target.removeEventListener(this.type,u.listener),typeof u.listener=="function"?u.listener.call(u.target,this):u.listener.handleEvent(this)}})(Object,new WeakMap)}var Ud=Oo.EventTarget;var mi=le(ln());var Yf="1.4.0";var Et=class{constructor(){this.dataMap={}}getEntryForKey(e){return this.dataMap[e]}setEntryForKey(e,t){this.dataMap[e]=t}removeEntryForKey(e){this.dataMap[e]&&delete this.dataMap[e]}setColumnData(e,t){let s=Et.normalizeColumnId(e);this.setEntryForKey(s,t),this.columnDataDidChange(s,t)}removeColumnData(e){let t=Et.normalizeColumnId(e);this.removeEntryForKey(t),this.columnDataWasRemoved(e)}static normalizeColumnId(e){return typeof e=="string"&&e.startsWith("/columns/")?e:`/columns/${e}`}static get platformInfo(){return{agent:mi.default.name,agentVers:mi.default.version,apiVers:"1.0.3",platform:mi.default.os.toString(),idsVersion:Yf}}setStatus(e){this.setEntryForKey("/status",e),this.statusDidChange(e)}setInfo(e){this.setEntryForKey("/info",e),this.infoDidChange(e)}exportDataMap(){return this.dataMap}importDataMap(e){this.dataMap=e}columnDataDidChange(e,t){}columnDataWasRemoved(e){}statusDidChange(e){}infoDidChange(e){}sendMessage(e){}onReceiveMessage(e,t){switch(t.type){default:break}}};var Fo=class extends Et{constructor(e){super();this.clientDataConnections=[],this.runningState="stopped",this.forceStatusPush=!1,this.viewTimeCount=1,this.liveValues={},this.isUpdating=!1,this.onStatusChanged=Sl(()=>this.updateDataMapFromUDM(),75);let{dataCollection:t,dataWorld:s,api:r}=e;this.$dataCollection=t,this.$dataWorld=s,this.$api=r;let i=e.clientDataChannels,o=e.clientPeerConnections;i?i.forEach(l=>this.addDataChannel(l)):o&&o.forEach(l=>this.addPeerDataConnection(l))}_resetProperties(){this.importDataMap({}),this._errorBarInfoCache={},this._oldDataMarks=[],this.cachedLayout={},this.cachedGraphs={},this.isUpdating=!1,this.forceStatusPush=!1,this.requeueStatus=void 0}get connectedPeers(){return this.clientDataConnections.length}async start(){if(this.runningState!=="stopped"){console.warn("Attempt to start server that is already running.");return}this.runningState="starting",this.textEncoder=new TextEncoder,this._resetProperties(),this.eventBinder=new Se,this.eventBinder.bindListeners({source:this.$dataWorld,target:this,eventMap:{"session-started":"onSessionDidStart","session-closing":"onSessionClosing","is-collecting-changed":"forceStatusChange","dataset-added":"onStatusChanged","dataset-removed":"onStatusChanged","column-added":"onColumnListChanged","column-removed":"onColumnListChanged","dataset-name-changed":"forceStatusChange","column-group-unit-change-finished":"onStatusChanged","column-group-added":"_onColumnGroupAdded","column-group-removed":"_onColumnGroupRemoved"}}),this._errorBarInfoCache={},this.eventBinder.bindListeners({source:this.$dataCollection,target:this,eventMap:{"collection-mode-changed":"onCollectionModeChanged"}}),this.bindToColumns(),this.storeUnsubscribe=$e.subscribe(this.onViewModelChanged.bind(this)),this.mobxUnsubscribe=qt(()=>{this.onViewModelChanged(ue)}),await this.initFromUDM(),this._sendAllData(),this._dataMarkAutorunCancel=qt(()=>{let e=this.$dataWorld._dataMarks.map(t=>t.udmExport);(!this._oldDataMarks||!Qs(e,this._oldDataMarks))&&(this._sendDataMarksInfo(),this._oldDataMarks=e)}),this.runningState="running"}stop(){return this.runningState!=="running"?(console.warn("Attempt to stop server that is not running."),new Promise(e=>e())):(this.runningState="stopping",this.sendMessage({type:"session-did-end",data:this.runningState}),this.eventBinder.unbindAll(),this.unbindColumns(),this.storeUnsubscribe(),delete this.storeUnsubscribe,this.mobxUnsubscribe(),delete this.mobxUnsubscribe,delete this.textEncoder,this._dataMarkAutorunCancel(),delete this._dataMarkAutorunCancel,this._errorBarInfoCache={},this.runningState="stopped",new Promise(e=>setTimeout(()=>{this.clientDataConnections.forEach(t=>t.close()),this.clientDataConnections=[],e()},1e3)))}async fetchStatusJSON(){return this.$api.fetchStatusJSON(this.$dataWorld.experimentId)}async fetchColumnDataJSON(e){return this.$api.fetchColumnDataJSON(this.$dataWorld.experimentId,e)}addDataConnection(e){console.assert(this.runningState==="running"),this.clientDataConnections.push(e),e.on("data",t=>this.onReceiveMessage(e,JSON.parse(t))),e._useByteEncoding=!1,this._sendAllData(e)}removeDataConnection(e){e.onmessage=null,this.clientDataConnections.splice(this.clientDataConnections.indexOf(e),1)}sendMessage(e,t=null){let s=JSON.stringify(e),r=this.textEncoder.encode(s);t?t.open?t.send(t._useByteEncoding?r:s):console.warn(`Client with peer ID ${t.peer} is not open. Unable to write.`):this.clientDataConnections.forEach(i=>{i.open?i.send(i._useByteEncoding?r:s):console.warn(`Client with peer ID ${i.peer} is not open. Unable to write.`)})}onReceiveMessage(e,t){switch(super.onReceiveMessage(e,t),t.type){case"client-info":{let s=e.metadata||{};e.metadata=de(P({},s),{clientInfo:t.data})}break;case"enable-byte-encoding":e._useByteEncoding=!0,e.send(JSON.stringify({type:"byte-encoding-enabled"}));break;case"request-all-data":this._sendAllData(e);break;default:break}}columnDataDidChange(e,t){this.sendMessage({type:"update-col",colId:e,data:t})}statusDidChange(e){this.sendMessage({type:"update-status",data:e})}infoDidChange(e){this.sendMessage({type:"update-info",data:e})}columnDataWasRemoved(e){this.sendMessage({type:"remove-column",colId:e})}async onSessionDidStart(){this._resetProperties(),await this.initFromUDM(),this._appTransitioning=!1,this._sendAllData()}onSessionClosing(){this._appTransitioning=!0}forceStatusChange(){this.forceStatusPush=!0,this.onStatusChanged()}onViewModelChanged(e=this.cachedLayout){let t=$e.getState();(!Qs(e,this.cachedLayout)||!Qs(t.graphs,this.cachedGraphs))&&setTimeout(()=>{this.forceStatusPush=!0,this.viewTimeCount++,this.onStatusChanged()},50),this.cachedLayout=P({},e),this.cachedGraphs=t.graphs}onCollectionModeChanged(){setTimeout(()=>{this.sendMessage({type:"reset-views",newViewListCount:this.viewTimeCount+1}),this.forceStatusPush=!0,this.viewTimeCount+=2,this.updateDataMapFromUDM()},300)}onColumnListChanged(){this.bindToColumns(),this.onStatusChanged()}onLiveReadout(e,t){let{value:s=0,timestamp:r=0}=this.liveValues[e]||{};t!==s&&(this.liveValues[e]={value:t,timestamp:r+1},this.forceStatusPush=!0,this.onStatusChanged())}_sendDataMarksInfo(e=null){if(this._appTransitioning)return;let t=this.$dataWorld._dataMarks.map(r=>r.udmExport),s={type:"data-marks-changed",datamarks:t};this.sendMessage(s,e)}_sendAllData(e=null){let t={type:"all-data",data:this.exportDataMap()};this.sendMessage(t,e),setTimeout(()=>{this._sendDataMarksInfo(e),this.$dataWorld.columnGroups.forEach(s=>this._sendErrorBarInfoForGroup(s,e))},e?750:0)}bindToColumns(){this.columnBinder?this.columnBinder.unbindAll():this.columnBinder=new Se,this.$dataWorld.getAllColumns().forEach(e=>{this.columnBinder.bindListeners({source:e,target:this,eventMap:{"name-changed":"onStatusChanged","units-changed":"onStatusChanged","wavelength-changed":"onStatusChanged","format-string-changed":"onStatusChanged","values-changed":"onStatusChanged","set-id-changed":"onStatusChanged","group-id-changed":"onStatusChanged","updated-rows-changed":"onStatusChanged","color-changed":"onViewModelChanged","symbol-changed":"onViewModelChanged"}}),this.columnBinder.bind(e,"live-value-changed",t=>this.onLiveReadout(e.id,t))})}unbindColumns(){this.columnBinder&&this.columnBinder.unbindAll(),this.columnBinder=null}async initFromUDM(){let e=await this.fetchStatusJSON(),t=JSON.parse(e.status),s=[];this.columnTimeCounts={};for(let[o,l]of Object.entries(t.columns))s.push(o),this.columnTimeCounts[o]={time:l.valuesTimeStamp,count:l.valuesCount,live:l.liveValue};this.sessionId=t.sessionID;let r=await this.fetchColumnDataJSON(s);for(let[o,l]of Object.entries(r))this.setColumnData(o,JSON.parse(l));this.setInfo(Et.platformInfo),this.setStatus(t);let i=$e.getState();this.cachedLayout=P({},ue),this.cachedGraphs=i.graphs}async updateDataMapFromUDM(){if(this.runningState!=="running")return;if(this.isUpdating){this.requeueStatus={forceStatusPush:this.forceStatusPush};return}this.isUpdating=!0;let e=this.forceStatusPush;if(this.forceStatusPush=!1,!Object.entries(this.dataMap).length){await this.initFromUDM(),this.isUpdating=!1;return}let t=await this.fetchStatusJSON(),s=JSON.parse(t.status),r=this.getEntryForKey("/status"),i=[],o=new Set;for(let[c,u]of Object.entries(s.columns)){o.add(c);let p=0,m=this.$dataWorld.getColumnById(c);m&&(p=m.liveValue);let v=this.columnTimeCounts[c];v?(v.time!==u.valuesTimeStamp||v.count!==u.valueCount)&&i.push(u.id):i.push(u.id),this.columnTimeCounts[u.id]={time:u.valuesTimeStamp,count:u.valueCount,live:p}}let l=e||this.sessionId!==s.sessionID||i.length;this.sessionId=s.sessionID;for(let[c]of Object.entries(r.columns??{}))o.has(c)||(this.removeColumnData(c),l=!0);if(i.length){this.viewTimeCount++;let c=await this.fetchColumnDataJSON(i);for(let[u,p]of Object.entries(c))this.setColumnData(u,JSON.parse(p))}l&&this.setStatus(s),this.isUpdating=!1,this.requeueStatus&&(this.forceStatusPush=this.forceStatusPush||this.requeueStatus.forceStatusPush,this.requeueStatus=void 0,this.onStatusChanged())}setStatus(e){Object.values(e.columns).forEach(t=>{let s=this.liveValues[t.id];if(s){let r=mt(t.formatStr,s.value);r||(r=s.value),t.liveValue=r,t.liveValueTimeStamp=s.timestamp}}),super.setStatus(de(P({},e),{collection:{isCollecting:this.$dataWorld.isCollecting,canCollect:!1},viewListTimeStamp:this.viewTimeCount}))}_sendErrorBarInfoForGroup(e,t=null){let s={columnId:e.errorBarColumnId,type:e.errorBarType,value:e.errorBarValue},r=this._errorBarInfoCache[e.id];if(!r)this._errorBarInfoCache[e.id]=s,this.eventBinder.bindListeners({source:e,target:this,eventMap:{"error-bar-column-id-changed":"_onErrorBarChanged","error-bar-type-changed":"_onErrorBarChanged","error-bar-value-changed":"_onErrorBarChanged"}});else if(Qs(s,r)&&t===null)return;if(e.columns.length>=1){let[{id:i=""}]=e.columns,o={type:"error-bar-info-changed",colId:i,info:s};this.sendMessage(o,t)}}_onErrorBarChanged({group:e}){this._sendErrorBarInfoForGroup(e)}_onColumnGroupAdded(e){this._sendErrorBarInfoForGroup(e)}_onColumnGroupRemoved(e){delete this._errorBarInfoCache[e.id]}};var Bo=class extends Et{constructor(e){super();this.name="Client",this._pollFuncAttempts=3,this._allDataReceived=!1,this._useByteDecoding=!1,this._byteEncodingRequestTimeout=null,this._textDecoder=new TextDecoder,this._dataMarkIdMap={};let{dataWorld:t,dataCollection:s}=e;this.$dataWorld=t,this.$dataCollection=s;let{peerConnection:r,name:i,connectionCompletion:o}=e;this.peerConnection=r,i&&(this.name=i),r.hostDataConnection?(this.hostDataConnection=r.hostDataConnection,this.hostDataConnection.on("data",l=>{try{let c=this._useByteDecoding?this._textDecoder.decode(l):l;this.onReceiveMessage(r.hostDataConnection,JSON.parse(c))}catch(c){!this._useByteDecoding&&!this._byteEncodingRequestTimeout?(this.hostDataConnection.send(JSON.stringify({type:"enable-byte-encoding"})),this._byteEncodingRequestTimeout=setTimeout(()=>{r.handleClientDataConnectionErrors(this.hostDataConnection,{type:"encoding-error",message:"Host does not support bytewise encoding."})},5e3),console.warn("Could not decode host data. Requesting byte encoding.")):(console.error("Got the following error:"),console.error(c),r.handleClientDataConnectionErrors(this.hostDataConnection,{type:"data-error",message:"Could not parse data from host. Try re-connecting."}))}}),this.hostDataConnection.on("error",l=>{r.handleClientDataConnectionErrors(this.hostDataConnection,l)})):console.error("RTCDataShareClient must be constructed with either a peerConnection or a data channel."),o&&(this.connectionCompletion=o)}createHttpShim(){class e{constructor(s){this.client=s}async getJSON(s){let r=this.client.getEntryForKey(s);if(!r)throw new Error(`HTTPShim: could not find ${s} in data map.`);return yl(r)}}return new e(this)}onReceiveMessage(e,t){if(super.onReceiveMessage(e,t),!this.hostStartingNewExperiment&&!(!this._allDataReceived&&!(t.type==="all-data"||t.type==="byte-encoding-enabled")))switch(t.type){case"all-data":if(!this._useByteDecoding){let s=t.data["/info"]?.idsVersion;if(s){let[r=1,i=0]=s.split(".").map(o=>parseInt(o));if(r===1&&i>=1){e.send(JSON.stringify({type:"enable-byte-encoding"}));return}}}this.importDataMap(t.data),this._allDataReceived=!0,this.connectionCompletion&&(this.connectionCompletion(),this.connectionCompletion=null),this.triggerStatusFetch(),this.sendMessage({type:"client-info",data:Et.platformInfo});break;case"update-col":this.setColumnData(t.colId,t.data);break;case"update-status":this.setStatus(t.data);break;case"update-info":this.setInfo(t.data);break;case"remove-column":this.removeColumnData(t.colId);break;case"live-readout":this.onLiveReadout(t);break;case"host-new-session":this.hostStartingNewExperiment=!0,this.peerConnection.confirmFollowHostNewExperiment();break;case"session-did-end":t.data!=="running"&&(this.peerConnection.sessionDidEnd(),this.peerConnection.dispose());break;case"reset-views":{let s=this.getEntryForKey("/status");this.setStatus(de(P({},s),{views:{},viewListTimeStamp:t.newViewListCount})),this.triggerStatusFetch()}break;case"byte-encoding-enabled":clearTimeout(this._byteEncodingRequestTimeout),this._byteEncodingRequestTimeout=null,this._useByteDecoding=!0,this.sendMessage({type:"request-all-data"});break;case"data-marks-changed":this._updateDataMarks(t.datamarks);break;case"error-bar-info-changed":this._updateErrorBars(t.colId,t.info);break;default:console.warn(`Unknown object type: ${t.type}`);break}}async _updateDataMarks(e){let t={};this.$dataWorld.getDataSets().forEach(c=>{t[c.foreignId]=c.id});let s=new Set;e.forEach(async c=>{c.dataSetId=t[c.dataSetId],c.appearanceInfo.forEach(u=>s.add(u.graphId))}),s.size>3&&console.warn("Datamarks over DataSharing is advertising > 3 graphs. This may cause unintended behavior.");let r=[...s];r.sort((c,u)=>c>=u);let i=this.$dataWorld.registeredGraphIds,o={};for(let c=0;c<r.length;c++)o[r[c]]=i[c]?.udmId??"n/a";e.forEach(async c=>{c.appearanceInfo.forEach(p=>{p.graphId=o[p.graphId]});let u=this._dataMarkIdMap[c.id]??null;if(u){let p=this.$dataWorld.getDataMarkWithId(u);console.assert(p),p.udmImport(c)}else{let p=await this.$dataWorld.createDataMarkForDataSharing(c);this._dataMarkIdMap[c.id]=p.id}});let l=[];this.$dataWorld._dataMarks.forEach(c=>{e.find(u=>this._dataMarkIdMap[u.id]===c.id)||l.push(c)}),l.forEach(c=>this.$dataWorld.removeDataMark(c))}_updateErrorBars(e,t){let s=p=>this.$dataWorld.getAllColumns().find(m=>`${m.foreignId}`==`${p}`),{columnId:r,type:i,value:o}=t,l=s(e);if(!l){console.error(`Data sharing: unable to find column with foreignId ${e}. This indicates that our column list is out of sync with the host. Did we receive 'all-data' on connect?`);return}let{group:c}=l;if(!c){console.error("Data sharing: could not find group to assign error bar attributes.");return}let u={};if(i===al.COLUMN){let p=s(r);p?u.errorBarColumnId=p.id:console.error(`Data sharing: could not find error bar column ${r}, type = COLUMN.`)}u.errorBarType=i,u.errorBarValue=o,this.$dataWorld.updateColumnGroup(c.id,u)}onLiveReadout(e){}triggerStatusFetch(){typeof this.pollFunc=="function"?this.pollFunc():this._pollFuncAttempts>0?(--this._pollFuncAttempts,setTimeout(()=>{this.triggerStatusFetch()},100)):console.error("this.pollFunc was never set")}sendMessage(e){let t=JSON.stringify(e);this.hostDataConnection.open?this.hostDataConnection.send(t):console.warn(`HOST ${this.hostDataConnection.peer} is not open.`)}statusDidChange(e){super.statusDidChange(e),this.triggerStatusFetch()}};var No=class extends Ud{constructor(e){super();this.services=e}async initiate(e=!0){this.peer&&await this.dispose();let t={url:"stun:global.stun.twilio.com:3478",urls:"stun:global.stun.twilio.com:3478"},s=[];e&&(s=await fetch("https://q1ts9bzhdk.execute-api.us-west-2.amazonaws.com/default/twilio-turn-credentials").then(l=>l.json()).then(l=>l.iceServers.filter(c=>c.url.includes("turn"))));let[r,i]="datashare.graphicalanalysis.com".split(":"),{default:{peerjs:{Peer:o}}}=await import("./chunk/peerjs.min-4JPB3VDP.js");return this.peer=new o({host:r,secure:!i,port:i||443,config:{iceServers:[t,...s]}}),this.peer.on("connection",this.clientConnected.bind(this)),this.peer.on("disconnected",()=>{this.peer.destroy(),delete this.peer}),new Promise(l=>{this.peer.on("open",c=>{this.peerId=c,l(c),ne.updateErrorType("")}),this.peer.on("error",c=>{console.error(`Peer received error: '${c.type}'. ${c.message}`),ne.updateErrorType(c.message)})})}connect(e){return new Promise(t=>{this.hostDataConnection=this.peer.connect(e,{reliable:!0}),this.hostDataConnection.on("open",()=>{this.openedServerConnection(()=>t(this.clientDataShare))})})}sessionDidEnd(){this.dispatchEvent(new CustomEvent("rtc-datashare-did-end"))}confirmFollowHostNewExperiment(){this.dispatchEvent(new CustomEvent("rtc-datashare-confirm-follow-host"))}async clientConnected(e){this.dataShareHost||(this.dataShareHost=new Fo(de(P({},this.services),{peerConnection:this})),await this.dataShareHost.start()),console.assert(this.dataShareHost),e.on("open",()=>{this.dataShareHost.addDataConnection(e),ne.updateConnectionCount(this.dataShareHost.connectedPeers),e.on("close",()=>{this.dataShareHost?.removeDataConnection(e),ne.updateConnectionCount(this.dataShareHost?.connectedPeers??0)}),e.on("error",t=>this.handleClientDataConnectionErrors(e,t))})}handleClientDataConnectionErrors(e,t){this.errored=!0,console.error(`Host lost connection to client ${e.peer}.`),console.error(t),ne.updateErrorType(t.message)}async dispose(){this.dataShareHost&&(await this.dataShareHost.stop(),delete this.dataShareHost),this.hostDataConnection&&(this.hostDataConnection.close(),delete this.hostDataConnection),this.peer&&this.peer.disconnect(),this.clientDataShare&&delete this.clientDataShare,ne.updateConnectionCount(0),delete this.peerId,delete this.peer}openedServerConnection(e){this.clientDataShare=new Bo({peerConnection:this,connectionCompletion:e,dataWorld:this.services.dataWorld,dataCollection:this.services.dataCollection})}};var qd=({dataWorld:n,dataCollection:e,rpc:t})=>{let s=new To({api:new Ro(t),dataWorld:n}),r=new br({api:new ko(t),dataWorld:n,dataCollection:e}),i=new No({api:new Lo(t),dataWorld:n,dataCollection:e}),o=_d(),l=Fd(),c=Ad();return{gaAppService:s,gaReplayService:r,bgPageComm:o,dsSourceDiscovery:l,gaPeerConnection:i,urlHandler:c}};var eg=n=>{let e=10,{barWidth:t}=n,s=n.units;return s==="\xB0"?e=360/t:s==="rad"?e=2*Math.PI/t:s==="rev"&&(e=1/t),e=Math.floor(e),{numberOfSpokes:e,angleUnits:s,objectId:""}},tg=n=>{let e=1,{numberOfSpokes:t}=n,s=n.angleUnits;return s==="\xB0"?e=360/t:s==="rad"?e=2*Math.PI/t:s==="rev"&&(e=1/t),{barWidth:e,units:s,objectId:""}},Gd={backendToFrontend(n){let e={};return n.subMode==="motion"?n.params.units!=="m"?(e.measurementType="angular-motion",e.angularMotion=eg(n.params)):(e.measurementType="linear-motion",e.linearMotion={accessory:n.params.objectId||"vernier_picket_fence",spacing:n.params.barWidth||.05,numberOfFlags:n.numEvents!==-1?n.numEvents/2:8,endAfterTrial:n.numEvents!==-1}):n.subMode==="gate"||n.subMode==="pulse"?n.subMode==="pulse"&&n.params.gateSeparation<0?(e.measurementType="timer",e.period={timeMeasurements:"between-gates",useFirstEventAsTime0:!1}):n.subMode==="gate"&&n.params.flagWidth<0?e.measurementType="gate-state":(e.measurementType="speed-through-gate",e.speedThroughGate={flagWidth:n.params.flagWidth||.05,timingMode:n.subMode,gateSeparationWidth:n.params.gateSeparation||.02,showMidTime:!1}):n.subMode==="pendulum"?(e.measurementType="timer",e.period={timeMeasurements:"pendulum"}):n.subMode==="projectile"&&(e.measurementType="projectile",e.projectile={type:n.params.type,gateSeparationWidth:n.params.value,timeOfFlightPad:n.numEvents===5}),e},frontendToBackend(n){let e={};if(e.numEvents=-1,n.measurementType==="speed-through-gate")n.speedThroughGate.timingMode==="gate"?(e.subMode="gate",e.numEvents=-1,e.params={flagWidth:parseFloat(n.speedThroughGate.flagWidth)}):(e.subMode="pulse",e.params={gateSeparation:parseFloat(n.speedThroughGate.gateSeparationWidth)}),e.params.units="m";else if(n.measurementType==="linear-motion")e.subMode="motion",e.params={barWidth:n.linearMotion.spacing,objectId:n.linearMotion.accessory},e.numEvents=n.linearMotion.endAfterTrial?n.linearMotion.numberOfFlags*2:-1,e.params.units="m";else if(n.measurementType==="angular-motion")e.subMode="motion",e.params=tg(n.angularMotion);else if(n.measurementType==="timer"){let{timeMeasurements:t}=n.period;t==="between-gates"?(e.subMode="pulse",e.params={gateSeparation:-1,units:"m"}):t==="pendulum"&&(e.subMode="pendulum",e.numEvents=-1)}else n.measurementType==="gate-state"?(e.subMode="gate",e.params={flagWidth:-1,units:"m"}):n.measurementType==="projectile"&&(e.subMode="projectile",e.numEvents=4+Number(n.projectile.timeOfFlightPad),e.params={type:n.projectile.type,value:parseFloat(n.projectile.gateSeparationWidth),units:"m"});return e}};var Hd=Te`
  :host {
    background: var(--vst-color-bg-secondary);
    user-select: none;
    display: flex;
    border-top: 1px solid var(--vst-color-bg-primary);
    padding: 0;
  }

  /* layout */
  .modes-sensors-wrapper {
    flex: 1;
    overflow-x: auto;
    display: flex;
  }

  .modes,
  .sensors {
    flex: 1 1 auto;
    display: flex;
  }

  .modes {
    padding-inline-start: calc(var(--vst-space-xs) / 2);
  }

  .flex {
    display: flex;
    align-items: center;
  }

  .sensors {
    justify-content: flex-end;
    margin-inline-start: var(--vst-space-xs);
  }

  .datashare-connection-status {
    width: 5px;
    height: 5px;
    border-radius: var(--vst-radius);
  }

  .datashare-connection-status--online {
    background-color: var(--vst-color-success);
  }

  .datashare-connection-status--offline {
    background-color: var(--vst-color-fg-tertiary);
  }

  /* button/meter styles */
  .bottombar-btn {
    margin: var(--vst-space-xs) calc(var(--vst-space-xs) / 2);
    flex: 0 0 auto;
  }

  ${pl(Te`.bottombar-btn`)}

  /* mode specific */
  .mode-prefix::after {
    content: ':';
  }

  .mode-name {
    margin-inline-end: 1em;
  }

  .mode-name:last-child {
    margin: 0;
  }

  /* sensor specific */
  .device-manager-btn {
    flex-shrink: 0;
    margin-inline-end: var(--vst-space-xs);
  }

  .device-manager-btn:hover .device-manager-icon {
    opacity: 1;
  }

  .device-manager-icon {
    opacity: 0.8;
    width: 1.125rem;
    height: 1.125rem;
  }

  :host([device-needs-firmware-update]) .device-manager-btn {
    position: relative;
  }

  :host([device-needs-firmware-update]) .device-manager-btn::after {
    display: block;
    content: '';
    width: 0.5rem;
    height: 0.5rem;
    border-radius: 100%;
    background-color: var(--vst-color-danger);
    position: absolute;
    top: var(--vst-space-2xs);
    right: var(--vst-space-2xs);
  }
`;var sg=n=>n!==0?1/n:n,Vd=class extends tl(Br(xt)){static get observableProperties(){return{errorType:ne,online:ns,hostId:{store:ne,key:"id"},isClient:ne}}static get properties(){return{_collectionModeDisabled:{state:!0},mode:{type:String,reflect:!0},sessionType:{type:String,reflect:!0},hasBluetooth:{type:Boolean,reflect:!0},dataShareSource:{type:String,reflect:!0},collectionRate:{type:String},collectionTimeUnits:{type:String},photogateSubmode:{type:String},deviceNeedsFirmwareUpdate:{type:Boolean,reflect:!0}}}constructor(){super();this.mode="",this.sessionType="DataCollection",this.hasBluetooth=!0,this.dataShareSource="",this._collectionModeDisabled=!1,this.collectionRate="",this.collectionTimeUnits="",this.photogateSubmode="",this.deviceNeedsFirmwareUpdate=!1,this._eventBinder=new Se,Wr.addEventListener("frame-features-updated",()=>this.requestUpdate())}updated(e){e.forEach(async(t,s)=>{s==="mode"?this.modeChanged(this.mode):s==="sessionType"&&this.typeChanged(this.sessionType)})}firstUpdated(){[this.$dataWorld,this.$dataCollection,this.$deviceManager,this.$popoverManager,this.$urlHandler]=this.requestServices(["dataWorld","dataCollection","deviceManager","popoverManager","urlHandler"]),this._eventBinder.bindListeners({source:this.$dataWorld,target:this,eventMap:{"session-ended":"onDataWorldSessionEnded","session-source-name-changed":"onDataWorldSessionSourceNameChanged","session-started":"onDataWorldSessionStarted","collection-preparing":"onDataWorldCollectionPreparing","collection-stopped":"onDataWorldCollectionStopped"}}),this._eventBinder.bindListeners({source:this.$dataCollection,target:this,eventMap:{"collection-params-changed":"onDataCollectionCollectionParamsChanged"}}),this._eventBinder.bindListeners({source:this.$deviceManager,target:this,eventMap:{"device-list-changed":"onDeviceListChanged"}});let e=this.$dataCollection.getCollectionParams();this.collectionParamsUpdated(e),this.meterContainerEl=this.querySelector("vst-core-meter-container"),this.disabledChangeObserver=new MutationObserver(t=>{let s=t.find(r=>r.attributeName==="disabled"&&!r.target.disabled);s&&this._collectionModeDisabled===!0&&(s.target.disabled=!0)}).observe(this.shadowRoot.querySelector("button#collection_mode_btn"),{attributes:!0})}disconnectedCallback(){super.disconnectedCallback(),this._eventBinder.unbindAll(),this.disabledChangeObserver&&this.disabledChangeObserver.disconnect()}openDataCollectionSettings(){this.dispatchEvent(new CustomEvent("open-data-collection-settings"))}collectionParamsUpdated(e){let t,s;if(e.mode&&e.mode!==this.mode&&(this.mode=e.mode),e.mode==="time-based"&&e.params&&e.params.hasOwnProperty("delta")){t=Ct.convertTimeUnits(e.params.delta,"s",e.params.units),s=sg(t);let r=Ct.sigFig(s,6),i=Ct.getPrecision(r);this.collectionRate=mt(`%.${i}f`,r),this.collectionTimeUnits=`${M("samples")}/${e.params.units}`}if(e.mode==="photogate-timing")switch(Gd.backendToFrontend(e.params).measurementType){case"speed-through-gate":this.photogateSubmode=M("Speed through Gate");break;case"linear-motion":this.photogateSubmode=M("Linear Motion");break;case"angular-motion":this.photogateSubmode=M("Angular Motion");break;case"timer":this.photogateSubmode=M("Timer");break;case"gate-state":this.photogateSubmode=M("Gate State");break;case"projectile":this.photogateSubmode=M("Projectile Launcher");break;default:this.photogateSubmode=""}}typeChanged(e){this.isDataShare=e==="DataShare",this.isManualEntry=e==="ManualEntry",this.isDataCollection=e==="DataCollection",!this.isDataShare&&!this.isManualEntry&&!this.isDataCollection&&(this.isManualEntry=!0),this._collectionModeDisabled=!this.isDataCollection,this.requestUpdate()}modeChanged(e){this.isTimeBased=e==="time-based",this.isEventsWithEntry=e==="events-with-entry",this.isSelectedEvents=e==="selected-events",this.isDropCounting=e==="drop-counting",this.isPhotogateTiming=e==="photogate-timing",this.requestUpdate()}setSensorMessage(e){typeof e=="string"?(this.meterContainerEl.message=M("No sensor connected"),this.meterContainerEl.showMessage=!0):this.meterContainerEl.showMessage=!1}onDataWorldSessionEnded(){this.setSourceName()}onDataWorldSessionSourceNameChanged(e){this.setSourceName(e)}onDataWorldSessionStarted(e){this.$dataWorld.sessionSourceName&&this.setSourceName(this.$dataWorld.sessionSourceName),this.sessionType=e.sessionType,this._collectionModeDisabled=!this.isDataCollection}onDataWorldCollectionPreparing(){this._collectionModeDisabled=!0}onDataWorldCollectionStopped(){this._collectionModeDisabled=!this.isDataCollection}onDataCollectionCollectionParamsChanged(e){this.collectionParamsUpdated(e)}onDeviceListChanged(){let e=!1;this.$deviceManager.getConnectedDevices().forEach(s=>{s.firmware.hasUpdate&&(e=!0)}),this.deviceNeedsFirmwareUpdate=e}setSourceName(e){this.dataShareSource=e}reconnectDataShareClient(){this.dispatchEvent(new CustomEvent("reconnect-data-share-client"))}static get styles(){return[xs,Hd]}render(){return ie`
      <h2 visually-hidden>${M("Bottom Bar")}</h2>
      <div class="modes-sensors-wrapper">
        <div class="modes">
          <vst-ui-tooltip
            for="#collection_mode_btn"
            position="top"
            content="${M("Data Collection Settings")}"
          ></vst-ui-tooltip>
          <button
            class="bottombar-btn"
            id="collection_mode_btn"
            @click="${this.openDataCollectionSettings}"
            ?disabled="${this._collectionModeDisabled||Wr.disabledFeatures.has("mode-switching")}"
            aria-label="${M("Data Collection Settings")}"
          >
            ${this.isDataShare&&this.isClient?ie`
                  <div class="session-type flex">
                    <span class="mode-prefix" margin="inline-end-2xs">${M("Mode")}</span>
                    <span margin="inline-end-xs">${M("Data Share")}</span>

                    <div
                      class="datashare-connection-status ${this.errorType===""?"datashare-connection-status--online":"datashare-connection-status--offline"}"
                      margin="inline-end-2xs"
                    ></div>
                    <span class="mode-prefix" margin="inline-end-2xs">${M("ID")}</span>
                    <span>${this.hostId}</span>
                  </div>
                `:""}
            ${this.isDataShare&&!this.isClient?ie`
                  <div class="session-type">
                    <span class="mode-prefix">${M("Mode")}</span>
                    <span class="mode-prefix">${M("Data Share")}</span>
                    <span class="mode-name" id="data_share_source">${this.dataShareSource}</span>
                  </div>
                `:""}
            ${this.isManualEntry?ie`
                  <div class="session-type">
                    <span class="mode-prefix">${M("Mode")}</span>
                    <span class="mode-name">${M("Manual Entry")}</span>
                  </div>
                `:""}
            ${this.isDataCollection?ie`
                  <div class="session-type type-data-collection">
                    ${this.isTimeBased?ie`
                          <div class="mode">
                            <span class="mode-prefix">${M("Mode")}</span>
                            <span class="mode-name">${M("Time Based")}</span>

                            <span class="mode-prefix">${M("Rate")}</span>
                            <span>${this.collectionRate}</span>
                            <span class="mode-name">${this.collectionTimeUnits}</span>

                            <!--<span class="mode-prefix">Duration</span>
                                  <span class="mode-name">30s</span>-->
                          </div>
                        `:""}
                    ${this.isEventsWithEntry?ie`
                          <div class="mode mode-events-with-entry">
                            <span class="mode-prefix">${M("Mode")}</span>
                            <span class="mode-name">${M("Events with Entry")}</span>
                          </div>
                        `:""}
                    ${this.isSelectedEvents?ie`
                          <div class="mode mode-selected-events">
                            <span class="mode-prefix">${M("Mode")}</span>
                            <span class="mode-name">${M("Selected Events")}</span>
                          </div>
                        `:""}
                    ${this.isDropCounting?ie`
                          <div class="mode mode-drop-counting">
                            <span class="mode-prefix">${M("Mode")}</span>
                            <span class="mode-name">${M("Drop Counting")}</span>
                          </div>
                        `:""}
                    ${this.isPhotogateTiming?ie`
                          <div class="mode mode-photogate">
                            <span class="mode-prefix">${M("Mode")}</span>
                            <span class="mode-name">${M("Photogate Timing")}</span>
                            ${this.photogateSubmode?ie` <span>${this.photogateSubmode}</span> `:""}
                          </div>
                        `:""}
                  </div>
                `:""}
          </button>
          ${this.isDataShare&&this.isClient&&this.errorType==="offline"&&this.online?ie`
                <button class="bottombar-btn" @click="${this.reconnectDataShareClient}">
                  ${M("Reconnect")}
                </button>
              `:""}
        </div>

        <div class="sensors" id="sensors">
          <slot></slot>
        </div>
      </div>
      ${Ss(!Wr.disabledFeatures.has("sensor-connect")&&this.isDataCollection,ie`
          <vst-ui-tooltip
            for="#device_manager"
            position="top"
            content="${M("Sensor Setup")}"
          ></vst-ui-tooltip>
          <button
            aria-label="${M("Sensor Setup")}"
            class="device-manager-btn bottombar-btn"
            id="device_manager"
            @click="${()=>{this.dispatchEvent(new CustomEvent("open-sensor-dialog",{bubbles:!0,composed:!0}))}}"
          >
            <vst-ui-icon .icon="${sl}" class="device-manager-icon"></vst-ui-icon>
          </button>
        `)}
    `}};customElements.define("ga-bottombar",Vd);var zd=class extends xt{render(){return ie`
      <svg version="1.1" class="logo" viewBox="0 0 263.33 42.67">
        <path
          fill="#EE3524"
          d="M46.1,23.5c-1,3.61-2.63,8.72-5.95,9.34c-3.08,0.56-8.9-2.56-18.79-20.65C19.07,8.01,16.41,6,13.54,6.21
                  C6.07,6.74,0.25,22.66,0,23.33l0.1,0.33v5l1.57-4.68C3.28,19.66,8.5,8.38,13.75,8c2.11-0.15,4.09,1.55,6.01,5.05
                  C27.71,27.59,34.1,34.7,39.33,34.7c0.34,0,0.83-0.03,1.16-0.09c2.53-0.47,3.61-2.65,5.61-5.23V23.5z"
        ></path>
        <g>
          <path
            fill="#949699"
            d="M9.28,23.75l1,2.23c0.91-0.41,1.79-0.67,2.62-0.77l-0.29-2.43C11.54,22.91,10.42,23.24,9.28,23.75z"
          ></path>
          <path
            fill="#949699"
            d="M4.67,26.73l1.56,1.88c0.81-0.67,1.61-1.25,2.38-1.73l-1.29-2.07C6.45,25.34,5.56,25.99,4.67,26.73z"
          ></path>
          <path
            fill="#949699"
            d="M20.14,25.69l-1.77,1.68c0.59,0.62,1.17,1.39,1.71,2.28l2.09-1.27C21.54,27.34,20.86,26.44,20.14,25.69z"
          ></path>
          <path
            fill="#949699"
            d="M46.1,34.29c-1,0.44-1.18,0.86-1.79,1.24l1.35,2.08c0.13-0.08,0.44-0.17,0.44-0.25V34.29z"
          ></path>
          <path
            fill="#949699"
            d="M0.82,30.47l1.81,1.64c0.7-0.78,1.41-1.51,2.11-2.16l-1.68-1.77C2.31,28.87,1.56,29.64,0.82,30.47z"
          ></path>
          <path fill="#949699" d="M0.1,35.78c0-0.74,1.12-1.46,1.69-2.14l-1.69-1.4V35.78z"></path>
          <path
            fill="#949699"
            d="M14.63,25.23c0.83,0.13,1.63,0.46,2.37,0.96l1.37-2.02c-1.04-0.71-2.17-1.16-3.35-1.35L14.63,25.23z"
          ></path>
          <path
            fill="#949699"
            d="M34.94,37.62l-0.21,2.43c0.52,0.04,1.03,0.07,1.54,0.07c0.59,0,1.2-0.03,1.8-0.09l-0.24-2.43
                      C36.86,37.7,35.91,37.7,34.94,37.62z"
          ></path>
          <path
            fill="#949699"
            d="M23.21,30.14l-2.06,1.32c0.61,0.95,1.27,1.83,1.98,2.63l1.83-1.61C24.34,31.76,23.75,30.98,23.21,30.14z"
          ></path>
          <path
            fill="#949699"
            d="M39.72,37.29l0.54,2.38c1.1-0.25,2.16-0.59,3.17-1.03l-0.97-2.24C41.59,36.78,40.67,37.08,39.72,37.29z"
          ></path>
          <path
            fill="#949699"
            d="M29.34,38.69c1.02,0.45,2.09,0.79,3.18,1.03l0.52-2.39c-0.94-0.21-1.85-0.5-2.73-0.88L29.34,38.69z"
          ></path>
          <path
            fill="#949699"
            d="M24.68,35.66c0.84,0.75,1.74,1.43,2.68,1.99l1.26-2.09c-0.81-0.49-1.58-1.07-2.31-1.72L24.68,35.66z"
          ></path>
        </g>
        <g>
          <path
            fill="#5A5B5D"
            d="M67.6,26.34c-0.94-0.62-1.96-0.92-3.7-0.92c-3.1,0-5.16,2.25-5.16,5.26c0,3.16,2.27,5.26,5.06,5.26
                      c1.33,0,1.68-0.13,2.16-0.23v-4.08h-2.83v-1.58h4.76v6.99c-0.73,0.25-2,0.6-4.1,0.6c-4.26,0-7.09-2.73-7.09-7.01
                      c0-4.14,3-6.89,7.11-6.89c1.96,0,2.83,0.29,3.95,0.67L67.6,26.34z"
          ></path>
          <path
            fill="#5A5B5D"
            d="M71.37,23.96h3.29c2.66,0,5.22,0.42,5.22,3.64c0,1.64-1.21,2.79-2.77,3.06v0.04
                      c0.6,0.23,0.89,0.52,1.31,1.35l2.54,5.35h-2.2l-2.06-4.66c-0.6-1.31-1.23-1.31-2.25-1.31h-1.16v5.97h-1.93V23.96z M73.29,29.73
                      h1.64c1.83,0,2.91-0.81,2.91-2.1c0-1.21-0.92-1.98-2.7-1.98h-1.85V29.73z"
          ></path>
          <path
            fill="#5A5B5D"
            d="M87.31,23.96h2.02l5.68,13.44h-2.1l-1.37-3.39h-6.59l-1.37,3.39h-2.02L87.31,23.96z M88.25,25.77
                      l-2.68,6.66h5.35L88.25,25.77z"
          ></path>
          <path
            fill="#5A5B5D"
            d="M96.64,23.96h3.52c2.75,0,5.04,0.96,5.04,4.02c0,2.98-2.33,4.04-4.76,4.04h-1.89v5.37h-1.93V23.96z
                      M98.57,30.33h1.91c1.19,0,2.7-0.6,2.7-2.37c0-1.69-1.77-2.31-2.96-2.31h-1.64V30.33z"
          ></path>
          <path
            fill="#5A5B5D"
            d="M107.75,23.96h1.92v5.62h6.43v-5.62h1.92V37.4h-1.92v-6.12h-6.43v6.12h-1.92V23.96z"
          ></path>
          <path fill="#5A5B5D" d="M121.75,23.96h1.93V37.4h-1.93V23.96z"></path>
          <path
            fill="#5A5B5D"
            d="M136.57,26.17c-0.85-0.5-1.79-0.75-2.77-0.75c-3.1,0-5.16,2.23-5.16,5.26c0,3.16,2.27,5.26,5.06,5.26
                      c0.96,0,2.25-0.25,2.93-0.65l0.12,1.87c-1.02,0.42-2.27,0.48-3.06,0.48c-4.26,0-7.09-2.73-7.09-7.01c0-4.14,3-6.89,7.11-6.89
                      c1.04,0,2.06,0.15,3.02,0.58L136.57,26.17z"
          ></path>
          <path
            fill="#5A5B5D"
            d="M143.5,23.96h2.02l5.68,13.44h-2.1l-1.37-3.39h-6.59l-1.37,3.39h-2.02L143.5,23.96z M144.44,25.77
                      l-2.68,6.66h5.35L144.44,25.77z"
          ></path>
          <path fill="#5A5B5D" d="M153.31,23.96h1.93V35.7h5.62v1.69h-7.55V23.96z"></path>
          <path
            fill="#5A5B5D"
            d="M172.95,23.96h2.02l5.68,13.44h-2.1l-1.37-3.39h-6.59l-1.37,3.39h-2.02L172.95,23.96z M173.9,25.77
                      l-2.68,6.66h5.35L173.9,25.77z"
          ></path>
          <path
            fill="#5A5B5D"
            d="M182.77,23.96h2.62l5.93,10.82h0.04V23.96h1.93V37.4h-2.46l-6.08-11.05h-0.04V37.4h-1.93V23.96z"
          ></path>
          <path
            fill="#5A5B5D"
            d="M200.75,23.96h2.02l5.68,13.44h-2.1l-1.37-3.39h-6.59l-1.37,3.39h-2.02L200.75,23.96z M201.69,25.77
                      l-2.68,6.66h5.35L201.69,25.77z"
          ></path>
          <path fill="#5A5B5D" d="M210.56,23.96h1.93V35.7h5.62v1.69h-7.55V23.96z"></path>
          <path
            fill="#5A5B5D"
            d="M222,31.77l-5.26-7.82H219l4,6.03l3.91-6.03h2.25l-5.24,7.82v5.62H222V31.77z"
          ></path>
          <path
            fill="#5A5B5D"
            d="M237,25.98c-0.98-0.39-1.52-0.56-2.52-0.56c-1.08,0-2.35,0.39-2.35,1.79c0,2.58,5.78,1.98,5.78,6.41
                      c0,2.87-2.21,4.01-4.91,4.01c-0.94,0-1.87-0.27-2.75-0.56l0.19-1.79c0.65,0.27,1.81,0.65,2.79,0.65c1.1,0,2.64-0.62,2.64-2.2
                      c0-3-5.78-2.18-5.78-6.35c0-2.39,1.89-3.66,4.31-3.66c0.89,0,1.94,0.15,2.87,0.48L237,25.98z"
          ></path>
          <path fill="#5A5B5D" d="M240.71,23.96h1.93V37.4h-1.93V23.96z"></path>
          <path
            fill="#5A5B5D"
            d="M252.36,25.98c-0.98-0.39-1.52-0.56-2.52-0.56c-1.08,0-2.35,0.39-2.35,1.79c0,2.58,5.78,1.98,5.78,6.41
                      c0,2.87-2.21,4.01-4.91,4.01c-0.94,0-1.87-0.27-2.75-0.56l0.19-1.79c0.65,0.27,1.81,0.65,2.79,0.65c1.1,0,2.64-0.62,2.64-2.2
                      c0-3-5.78-2.18-5.78-6.35c0-2.39,1.89-3.66,4.31-3.66c0.89,0,1.94,0.15,2.87,0.48L252.36,25.98z"
          ></path>
        </g>
      </svg>
    `}};customElements.define("ga-logo",zd);var Kd=class extends HTMLElement{connectedCallback(){if(!this.parentNode.host.isDialogMediator)throw new Error("a <vst-ui-dialog-manager> should be in the shadowRoot of a DialogMediator component.");this.querySelectorAll("vst-ui-dialog").forEach(e=>{this.dispatchEvent(new CustomEvent("register-dialog",{composed:!0,bubbles:!0,detail:e}))}),this.mutationObserver=new MutationObserver(this.childConnected.bind(this)),this.mutationObserver.observe(this,{childList:!0})}childConnected(e){e.forEach(t=>{t.type==="childList"&&(Array.from(t.addedNodes).forEach(s=>{if(s.nodeType===1){if(!/vst-ui-dialog|style/i.test(s.nodeName)){console.error(`${s.nodeName}: only <vst-ui-dialog> elements should be children of the <vst-ui-dialog-manager> component.`);return}this.dispatchEvent(new CustomEvent("register-dialog",{composed:!0,bubbles:!0,detail:s}))}}),Array.from(t.removedNodes).forEach(s=>{s.nodeName==="vst-ui-dialog"&&this.dispatchEvent(new CustomEvent("dispose-dialog",{composed:!0,bubbles:!0,detial:s}))}))})}};customElements.define("vst-ui-dialog-manager",Kd);var Xd=Te`
  /* ---single-to-multi-line---
////////////////////////
 ---end--- */
  @keyframes fadeInDown {
    0% {
      opacity: 0;
      transform: translate3d(0, -10px, 0);
    }
    100% {
      opacity: 1;
      transform: none;
    }
  }

  /* ---single-to-multi-line---
////////////////////////
 ---end--- */
  @keyframes fadeInLeft {
    0% {
      opacity: 0;
      transform: translate3d(-10px, 0, 0);
    }
    100% {
      opacity: 1;
      transform: none;
    }
  }

  /* ---single-to-multi-line---
////////////////////////
 ---end--- */
  @keyframes fadeInRight {
    0% {
      opacity: 0;
      transform: translate3d(10px, 0, 0);
    }
    100% {
      opacity: 1;
      transform: none;
    }
  }

  /* ---single-to-multi-line---
////////////////////////
 ---end--- */
  @keyframes fadeInUp {
    0% {
      opacity: 0;
      transform: translate3d(0, 10px, 0);
    }
    100% {
      opacity: 1;
      transform: none;
    }
  }

  /* ---single-to-multi-line---
////////////////////////
 ---end--- */
  @keyframes fadeIn {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }

  /* ---single-to-multi-line---
////////////////////////
 ---end--- */
  @keyframes fadeOut {
    0% {
      opacity: 1;
    }
    100% {
      opacity: 0;
    }
  }

  /* ---single-to-multi-line---
////////////////////////
 ---end--- */
  @keyframes fadeOutDown {
    0% {
      opacity: 1;
      transform: translate3d(0, -10px, 0);
    }
    100% {
      opacity: 0;
      transform: none;
    }
  }

  /* ---single-to-multi-line---
////////////////////////
 ---end--- */
  @keyframes fadeOutDownFar {
    0% {
      opacity: 1;
      transform: none;
    }
    100% {
      opacity: 0;
      transform: translate3d(0, 20px, 0);
    }
  }

  /* ---single-to-multi-line---
////////////////////////
 ---end--- */
  @keyframes fadeOutUp {
    0% {
      opacity: 1;
      transform: none;
    }
    100% {
      opacity: 0;
      transform: translate3d(0, -10px, 0);
    }
  }

  /* ---single-to-multi-line---
////////////////////////
 ---end--- */
  @keyframes glow {
    0% {
      box-shadow: 0 0 0 0 var(--vst-color-info);
    }
    25% {
      box-shadow: 0 0 10px 2px var(--vst-color-info);
    }
    50% {
      box-shadow: 0 0 0 0 var(--vst-color-info);
    }
    75% {
      box-shadow: 0 0 10px 2px var(--vst-color-info);
    }
    100% {
      box-shadow: 0 0 0 0 var(--vst-color-info);
    }
  }

  :host {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100vw;
    height: calc(100vh - var(--chrome-menubar-height, 0px));
    /*  stylelint-disable-line length-zero-no-unit */
    position: absolute;
    top: var(--chrome-menubar-height);
    left: 0;
    z-index: var(--vst-z-dialog);
    background-color: var(--vst-color-bg-secondary);
    /* transition: var(--transition-default)(); */
    transition-delay: 555ms;
    padding: var(--vst-space-l);
  }

  :host(.transition-out) {
    ${jr}
    ${ul}
    animation-duration: 500ms;
    animation-delay: 250ms;
  }
  :host(.transition-out) .wrapper {
    ${jr}
    ${hl}
    animation-duration: 250ms;
  }

  .wrapper {
    ${jr}
    ${dl}
    margin-block-start: var(--splash-wrapper-margin-start, -5vh);
    /*  make it look vertically centered visually. */
    display: block;
    width: 100%;
    max-inline-size: var(--splash-wrapper-inline-size, 23.4375rem);
    background: var(--progress-wrapper-color, var(--vst-color-bg));
    text-align: center;
    padding: var(--splash-wrapper-padding, var(--vst-space-l));
    border-radius: var(--vst-radius);
  }

  .error-message a {
    color: var(--vst-color-brand);
  }
  .error-message a:hover {
    color: var(--vst-color-brand-dark);
  }

  .error-message-title {
    margin: 0 0 1em 0;
    color: var(--vst-color-danger);
  }

  .error-message-extended {
    font-size: var(--vst-font-size-xs);
    color: var(--vst-color-fg-secondary);
    text-align: left;
  }
  .error-message-extended p {
    margin-block-end: 0;
  }
  .error-message-extended span {
    font-family: monospace;
  }

  .logo {
    display: block;
    width: 100%;
    margin: 0 auto;
  }

  /*  All Progress Bars */
  /*  TODO Make this a ui-component */
  .progress-bar {
    appearance: none;
    /*  Reset the default appearance */
    background: var(--progress-bar-background-color, var(--vst-color-bg-secondary));
    box-shadow: 0;
    border-radius: 0;
    border: 0;
    width: 100%;
    height: 0.1875rem;
    margin-block-start: var(--vst-space-xs);
  }

  /*  Determinate */
  .progress-bar[value] {
    appearance: none;
    /*  Reset the default appearance */
  }

  /*  Indeterminate */
  .progress-bar:not([value]) {
    appearance: none;
    /*  Reset the default appearance */
  }

  .progress-bar[value]::-webkit-progress-bar {
    background-color: var(--progress-bar-background-color, var(--vst-color-bg-tertiary));
  }

  .progress-bar::-webkit-progress-value {
    background-color: var(--vst-color-brand);
    background-image: linear-gradient(
      to right,
      var(--progress-bar-color, var(--vst-color-brand-dark)),
      var(--progress-bar-color, var(--vst-color-brand)),
      96%
    );
    border-radius: 0;
    box-shadow: 0;
    transition: var(--transition-default);
  }

  /*  For some reason if we combine this selector with webkit-progress-value Chrome won't honor it -rl. */
  .progress-bar::-moz-progress-bar {
    background-color: var(--vst-color-brand);
    border-radius: 0;
    box-shadow: 0;
    transition: var(--transition-default);
  }
`;var Jd=class extends xt{static get properties(){return{showProgress:{type:Boolean},percentLoaded:{type:Number},errorMsg:{type:String}}}constructor(){super();this.showProgress=!1,this.percentLoaded=0,this.errorMsg=""}hide(){this.classList.add("transition-out"),this.addEventListener("animationend",e=>{e.animationName==="fadeOut"&&this.getRootNode().host.shadowRoot.removeChild(this)})}static get styles(){return[xs,Xd]}render(){return ie`
      <div class="wrapper">
        <slot name="logo"></slot>
        <progress
          class="progress-bar"
          .value="${this.percentLoaded}"
          max="100"
          ?hidden="${!this.showProgress}"
        ></progress>
        ${this.errorMsg?ie` <p class="caption" variant="error" margin="block-start-l">${this.errorMsg}</p> `:""}
      </div>
    `}};customElements.define("vst-ui-splash-screen",Jd);var rg=422,ig=92,ng=30,og=15,ag=[{label:M("Go Direct USB"),type:"goDirectFamilyUSB"},{label:M("Go!\u2009Link"),type:"goLinkUSB"},{label:M("Go!Temp"),type:"goTempUSB"},{label:M("Go!\u2009Motion"),type:"goMotionUSB"},{label:M("LabQuest"),type:"labQuestFamilyUSB"}],yr=!1,Zd=!1,lg=()=>{window.matchMedia("(prefers-color-scheme: dark)").matches&&window.StatusBar?.backgroundColorByHexString("#27292a")},Qd=n=>new Promise(e=>setTimeout(e,n)),Yd=class extends el($e)(_l(Ml(Ya(Br(an))))){static get properties(){return{_isUnsupportedBrowserMessageVisible:{state:!0},_isPWAMessageVisible:{state:!0},_frameFeatures:{state:!0},_showDataLoggingStatusDialog:{state:!0},experimentName:{type:String},isImportedSession:{type:Boolean},isSessionEmpty:{type:Boolean},Layout:{type:Object},graphModeTransition:{type:Object},dataShareUpdates:{type:Object},progress:{type:Number},$services:{type:Object},showSampleExperiments:{type:Boolean},sampleExperiments:{type:Object},showDataShareHost:{type:Boolean},showDataShareStatus:{type:Boolean},showDataCollectionSettings:{type:Boolean},auxGraphCount:{type:Number},savePending:{type:Boolean},saveError:{type:String},autoSaving:{type:Boolean},isCollecting:{type:Boolean}}}static get observableProperties(){return{license:et,daysRemaining:et,authorized:et,peerId:{store:ne,key:"id"},isDataShareHost:{store:ne,key:"isHost"},isDataShareClient:{store:ne,key:"isClient"},dataShareStatus:{store:ne,key:"status"},online:ns,errorType:ne,connectionCount:ne,colorMode:ol}}constructor(){super();document.addEventListener("keydown",e=>{e.key==="b"&&e.ctrlKey&&(this._debugActive=!0,setTimeout(()=>{this._debugActive=!1},300)),this._debugActive&&e.key==="f"&&e.ctrlKey&&(e.preventDefault(),(async()=>{await import("./chunk/vst-core-feature-flags-WWEFOYSI.js"),this.$services.popoverManager.presentDialog("vst-core-feature-flags",{title:M("Experimental Features")})})())}),this._continueDSSession=!1,this._initialized=!1,this._isUnsupportedBrowserMessageVisible=!1,this._isPWAMessageVisible=!1,this._showDataLoggingStatusDialog=!1,this.experimentName=M("Untitled"),this.isImportedSession=!1,this.isSessionEmpty=!0,this.progress=0,this.showSampleExperiments=!1,this.showDataShareHost=!1,this.showDataShareStatus=!1,this.showDataCollectionSettings=!1,this.auxGraphCount=0,this.isCollecting=!1,this.autoSaving=!1,Ed(window),window.matchMedia("(orientation: portrait)").addListener(()=>{ue.openedPanes===4&&ue.updateLayout({video:!1})})}get appInfo(){return{appName:"Vernier Graphical Analysis",fileExtension:".gambl",sampleExperimentAddress:"experiments.graphicalanalysis.com"}}showAddMeterDialog(){this.dispatchEvent(new CustomEvent("open-dialog",{bubbles:!0,composed:!0,detail:{dialog:"select_meters_display",params:{title:M("Add/Remove Meters")}}}))}async showSensorDialog(e=!1){let t=await this.$services.deviceManager.getGdxDeviceSources(),s=!!this.$services.urlHandler.sessionId;e&&(!s||t.length===0)||this.dispatchEvent(new CustomEvent("open-dialog",{bubbles:!0,composed:!0,detail:{dialog:"device_manager",params:{title:M("Sensors"),onLoad:e,studentMode:s||Oe("ff-connections-student-mode"),allowsLabQuestStreamDiscovery:!0,webUSBOptions:ag,windowsButNot10Message:M("This version of Windows supports only USB connection to Go Direct Sensors.")}}}))}connectedCallback(){if(super.connectedCallback&&super.connectedCallback(),Zt.default.name==="Chrome"){import("./chunk/vst-ui-chromebar-F4NGV63E.js");let e=document.createElement("vst-ui-chromebar"),t=document.querySelector("#app");document.body.insertBefore(e,t),document.body.style.setProperty("--chrome-menubar-height","32px")}}updated(e){(e.has("isDataShareHost")||e.has("isDataShareClient"))&&(import("./chunk/ga-datashare-disconnected-MHTSA6M5.js"),import("./chunk/ga-datashare-status-TLOUDUX3.js")),e.has("showDataShareHost")&&this.showDataShareHost&&import("./chunk/ga-datashare-host-B4KYQRS5.js"),e.forEach((t,s)=>{s==="colorMode"&&(this.classList=this.colorMode,window.StatusBar?.backgroundColorByHexString(this.colorMode==="dark"?"#27292a":"#e3e4e5"),this.colorMode==="dark"?window.StatusBar?.styleLightContent():window.StatusBar?.styleDarkContent())})}async firstUpdated(){document.addEventListener("deviceready",lg,!1),this.classList=this.colorMode,this._splashScreenEl=this.shadowRoot.querySelector("#splash_screen"),Zt.default.name==="Chrome"&&(Zt.default.os.family.includes("OS X")||Zt.default.os.family.includes("Windows")?this._showChromeOnMacWinDialog():this._splashScreenEl.showProgress=!0,bd(o=>{this.progress=o})),Zt.default.name==="Chrome"&&(this._isPWAMessageVisible=!0);let e=await yd(),{dataWorld:t,dataCollection:s,rpc:r}=e,i=qd({dataWorld:t,dataCollection:s,rpc:r});await Promise.allSettled([import("./chunk/ga-main-content-4WHCBYFC.js"),import("./chunk/ga-toolbar-F5RZOK6Y.js"),import("./chunk/vst-ui-soft-alert-DYC65MOD.js")]),this.$services=P(P({},e),i),this.provideServices(this.$services),this.$services.urlHandler.on("url-changed",o=>{et.authorize(o)}),this.$services.urlHandler.authKey&&et.authorize(this.$services.urlHandler.authKey),this.$services.urlHandler.checkOpeningUrl&&(this.$services.urlHandler.on("startup-url-error",async({status:o="404",fileType:l="file",location:c="storage",error:u,skipToast:p})=>{await this.initialized,p||this.$services.toast.makeToast(`${o}: ${u??`Failed to fetch ${l} from location: ${c}`}`,{duration:5e3}),this._urlFile&&!Le._templateFile?(await this.$services.dataWorld.startNewSession(this.$services.urlHandler.manual?"ManualEntry":"DataCollection"),Le.notifyHostInitialized(this.$services)):this._showWelcomeDialog()}),this.$services.urlHandler.on("startup-url-experiment",async({fileData:o})=>{this._urlFile=!0,await this.initialized,this._startSession(o)}),this.$services.urlHandler.on("startup-url-experiment-configuration",async({experimentId:o})=>{this._urlFile=!0,yr=[o,!0],window.__isSessionClient&&await Qi(this.$services)}),this.$services.urlHandler.on("startup-url-session",async({sessionId:o})=>{this._urlFile=!0,yr=[o],window.__isSessionClient&&await Qi(this.$services)}),this.$services.urlHandler.isBlock&&this._setupServiceWorkerSaveListeners(),await this.$services.urlHandler.checkOpeningUrl(this.$services.gaAppService.validateJWT,{requireKey:!1})),await this.initApp(),qt(()=>{if(this.authorized){let{sensorWorld:{sensors:o}}=this.$services;o.forEach(l=>{this.enableDataMarksForMeltStation(l)})}}),this._initialized=!0}get _dataLoggingStatusHeaderText(){return this.$services.deviceManager.getConnectedDevices().at(0)?.offlineLoggingStatus?.offlineStatus==="waiting"?M("Remote Logging in Process"):M("Logged Data on Device")}get persistentHostIframe(){return window.frameElement?.hasAttribute("persistent-host")}get _initialized(){return this.__initialized}set _initialized(e){this.__initialized=e,this.dispatchEvent(new CustomEvent("app-initialized",{detail:e})),this.$services?.dataCollection?.emit?.("app-initialized",e)}get initialized(){return new Promise(e=>{this._initialized?e():this.addEventListener("app-initialized",()=>e(),{once:!0})})}_setupServiceWorkerSaveListeners(){this.autoSaving}async initApp(){super.initApp(),rs()&&!window.__isSessionClient&&await Le.updateComplete&&Le.skipWaitingAndClaim();let{dataWorld:e,dataCollection:t,deviceManager:s,sensorMap:r,fileIO:i,popoverManager:o,accessibility:l,analytics:c,startupFileHandler:u,sensorWorld:p}=this.$services;this.registerDialogTemplate(["vst-core-column-options","vst-core-device-manager","vst-ui-message-box","vst-ui-custom-expression-info","vst-ui-presentation","vst-core-export","vst-ui-prompt","vst-core-device-info","vst-core-fit-options","vst-core-meter-select"]),this._setupAutoLayout(),this._setupCustomCurveFits(),await Qd(10),this.eventBinder.bindListeners({source:t,target:this,eventMap:{"device-error":"onDataCollectionDeviceError","ble-communication-error":"onDataCollectionBleCommunicationError","start-measurements-failed":"onDataCollectionStartMeasurementsFailed","collection-params-changed":"onDataCollectionCollectionParamsChanged","collection-mode-changed":"onDataCollectionCollectionModeChanged","device-sensor-enum-completed":"_handleDeviceSensorEnumCompleted"}}),await t.init({sensorMap:r.getSensorMap(),hasFirmwareUpdater:!0}),window.addEventListener("online",()=>ns.updateOnline()),window.addEventListener("offline",this._onOffline.bind(this));let m=["graph_1","graph_2","graph_3"];$e.dispatch(on(m)),!this._urlFile&&!this.$services.urlHandler.sessionId&&!Le._templateFile?await e.startNewSession(this.$services.urlHandler.manual?"ManualEntry":"DataCollection"):this.$services.urlHandler.blockType&&await this._startBlockSession(this.$services.urlHandler.blockType,this.$services.urlHandler.blockId),this._updateExperimentTitle(),i.onSave(()=>{this._updateExperimentTitle()}),import("./chunk/vst-ui-wait-IROF3HL3.js"),this.uiWaitEl=this.shadowRoot.querySelector("vst-ui-wait"),this.uiWaitEl.fillScreen=!0;let v=this.shadowRoot.querySelector("#popover_wrapper");o.attachWrapper(v),this.addEventListener("popover-creation",T=>$e.dispatch(Cl(T.detail.id))),this.addEventListener("popover-removal",T=>$e.dispatch(Il(T.detail.id)));let b=this.shadowRoot.querySelector("#toast_wrapper");await this.$services.toast.attachWrapper(b),this.addEventListener("open-dialog",T=>c.trackEvent("dialog_open",{dialog_name:T.detail.dialog})),this.addEventListener("dialog-close",T=>c.trackEvent("dialog_close",{dialog_name:T.detail.dialog})),this.addEventListener("popover-creation",T=>c.trackEvent("popover_created",{dialog_name:T.detail.title})),this.addEventListener("popover-removal",T=>c.trackEvent("popover_removed",{dialog_name:T.detail.title})),this.addEventListener("open-file",()=>c.trackEvent("open_file",{dialog_name:this.getAttribute("id")})),this.addEventListener("save-file",()=>c.trackEvent("file_saved",{dialog_name:this.getAttribute("id")})),this.addEventListener("save-as",()=>c.trackEvent("file_saved",{dialog_name:this.getAttribute("id")})),this.eventBinder.bindListeners({source:e,target:this,eventMap:{"collection-preparing":"onDataWorldCollectionPreparing","collection-started":"onDataWorldCollectionStarted","collection-stopped":"onDataWorldCollectionStopped","collection-prestore-reached":"onDataWorldCollectionPrestoreReached","collection-threshold-reached":"onDataWorldCollectionThresholdReached","is-collecting-changed":"onDataWorldIsCollectingChanged","session-remote-id-changed":"onDataWorldSessionRemoteIdChanged","session-ended":"onSessionEnded","before-session-ended":"onBeforeSessionEnded"}}),this.eventBinder.bindListeners({source:s,target:this,eventMap:{"device-list-changed":"_checkIfDataLoggingSupportChanged"}}),this.eventBinder.bindListeners({source:p,target:this,eventMap:{"sensor-added":"enableDataMarksForMeltStation"}}),e.on("column-values-changed",()=>{$e.dispatch(rn(!1))}),e.on("session-connection-error",T=>{console.error(T),this.$services.toast.makeToast(M("Connection Lost"),{duration:5e3})}),e.on("prompt-collecting-confirm-new-session",async({appName:T,resolution:A})=>{let{promptConfirmNewSession:W}=await import("./chunk/promptConfirmNewSession-MQJWZHIW.js");A(W.call(this,T))});let y=this.shadowRoot.querySelector("#main_content");this.graphModeTransition=wd(this,y,this.$services.ally),l.on("accessibility-scale-changed",T=>{$e.dispatch(xl(T))});let{startFile:w,startFileData:_}=u;(_||Le._templateFile)&&await this._startSession(_??{file:Le._templateFile,filepath:"/"}),u.on("new-start-file",this._startSession.bind(this)),this._curMode=t.getCollectionParams().mode,!s.hasConnectedDevices&&!(w||this._urlFile)&&this._showWelcomeDialog(),this._splashScreenEl.hide(),this.addEventListener("experiment-reset",()=>{e.resetSession(this.$services.urlHandler.manual?"ManualEntry":"DataCollection")})}enableDataMarksForMeltStation(e){let{dataCollection:t}=this.$services;et.authorized&&(e.autoId===ig||e.autoId===rg)&&t.setDataMarksEnabled(!0)}async addDataMark(){let{dataWorld:e}=this.$services,t=e.getGraphUdmIds(),s=e.currentDataSet.columnIds.find(r=>!e.getColumnById(r).prefersBase);if(s){let r=e.getColumnById(s).values.length-1;e.addDataMark(r,e.currentDataSet.id,t)}}onBeforeSessionEnded(){if(!this.isDataShareHost)return;let{gaPeerConnection:e}=this.$services;e.dataShareHost&&e.dataShareHost.sendMessage({type:"host-new-session"})}onFollowHostNewExperimentConfimration(){let{gaPeerConnection:e}=this.$services;this.dispatchEvent(new CustomEvent("open-dialog",{bubbles:!0,composed:!0,detail:{dialog:"message_box",params:{title:M("Start New Experiment?"),choiceRequired:!0,content:M("Your Data Sharing Host is starting a new experiment. You may continue with your experiment or join into the new experiment."),actions:[{id:"disconnect",message:M("Disconnect"),variant:"text",onClick:async()=>{ne.resetPeerStatus(),await e.dispose(),this.dispatchEvent(ys("message_box"))}},{id:"join",message:M("Join New Experiment"),onClick:async()=>{this.dispatchEvent(ys("message_box")),this._continueDSSession=!0,await this.onStartDataShareClient({detail:{serverid:ne.id}})}}]},onClose:()=>{this.isRemoteIdDialogOpen=!1}}}))}async _onOffline(){let{gaPeerConnection:e}=this.$services;ns.updateOnline(),await e.dispose(),this.isDataShareHost&&(this.showDataShareHost=!1,this.showDataShareStatus=!1)}onSessionEnded(){ue.resetLayout(),this.auxGraphCount=0;let e=["graph_1","graph_2","graph_3"];$e.dispatch(on(e)),ne.isClient&&!this._continueDSSession&&this.onStopDataShare(),this._continueDSSession=!1,this._stopLayoutAutorun&&this._stopLayoutAutorun(),this._stopLayoutAutorun=void 0}disconnectedCallback(){super.disconnectedCallback();let{dataWorld:e}=this.$services;e.off("session-ended",this.resetStoreSession),e.off("session-remote-id-changed",this.onDataWorldSessionRemoteIdChanged),window.removeEventListener("online",()=>ns.updateOnline()),window.removeEventListener("offline",this._onOffline.bind(this))}onDataWorldCollectionPreparing(){let{dataWorld:e}=this.$services;this.isCollecting=!0,this.isUIDisabled&&this.showWait(!0),e.isTriggeringEnabled&&this._setupTriggering()}onDataWorldCollectionStarted(){Oe("ff-enable-logging")&&this.$services.dataCollection.timeBasedParams.remoteLogging&&this.$services.dataCollection.detachRemoteDevices()}async onOpenSampleFile({detail:{file:e,url:t,experiment:s}}){let{dataWorld:r,popoverManager:i}=this.$services,o=e;if(o.name instanceof Array){let c=0,{localURL:u}=o,p=!1,m=-1,{getCacheFile:v}=await import("./chunk/file-rw-W5VB3ABJ.js");do o=await v(u),p=(o.end||0)===m,m=o.end,c++;while((o.end===0||!p)&&c<10)}let l=await r.importData({fileData:{file:o,filepath:t.replace(/\?.+/,"")}});s.status="cached",l&&i.closeAll()}_checkIfDataLoggingSupportChanged(){let{dataCollection:e,deviceManager:t}=this.$services,s=t.getConnectedDevices().length,r=t.connectedDataLoggingDevices.length>0,{mode:i,params:o}=e.getCollectionParams();Oe("ff-enable-logging")&&i==="time-based"&&o.remoteLogging&&(s>1||!r)&&(o.remoteLogging=!1,e.setCollectionParams(i,o))}async _handleOpenFile(){let{appManifest:e,dataWorld:t,fileIO:s,popoverManager:r}=this.$services;try{let{cancelled:i}=await this.trySave().catch(c=>c);if(i)return;let o=await s.showOpenDialog([{extensions:Kl(),name:e.getAppName()},{extensions:["csv"],name:M("Comma Separated Values")}]);if(!o)return;await t.importData({fileData:o})?r.closeAll():this.$services.toast.makeToast(M("Open failed"))}catch(i){console.error(i)}}_handleDataLoggingStatusClose(){let{deviceManager:e}=this.$services,t=e.getConnectedDevices().at(0);t?.offlineLoggingStatus?.offlineStatus==="waiting"&&e.disconnectDevice(t),this._showDataLoggingStatusDialog=!1}_handleDataLoggingDisconnect(){let{deviceManager:e}=this.$services,t=e.getConnectedDevices().at(0);e.disconnectDevice(t),this._showDataLoggingStatusDialog=!1}async _handleDataLoggingRetrieval(e){let t=e.composedPath().at(0),{delete:s,disconnect:r}=e.detail,{dataCollection:i,deviceManager:o}=this.$services,l=o.getConnectedDevices().at(0);try{await i.stopMeasurements(),await i.retrieveLoggedData({deviceId:l.id,deleteDataAfterRetrieval:s}),r&&o.disconnectDevice(l),this._showDataLoggingStatusDialog=!1}catch(c){console.warn(c)}finally{t.reset()}}async _handleDeviceSensorEnumCompleted(){let{deviceManager:e}=this.$services,t=e.getConnectedDevices().at(0);!Oe("ff-enable-logging")||!t?.supportsOfflineCollection||["completed","waiting"].includes(t.offlineLoggingStatus.offlineStatus)&&(await import("./chunk/ga-data-logging-status-WVXTKGDY.js"),this.dispatchEvent(new CustomEvent("close-dialog",{bubbles:!0,composed:!0,detail:"device_manager"})),this._showDataLoggingStatusDialog=!0)}onDataWorldCollectionStopped(){this.isCollecting=!1,this.dispatchEvent(new CustomEvent("collection-stopped")),this.showWait(!1),this.isUIDisabled&&this.toggleUIUpdates()}onDataWorldCollectionPrestoreReached(){this.showWait(!1),this._setupTriggering(!0)}onDataWorldCollectionThresholdReached(){this.showWait(!1),this.waitingForTrigger=!1,this.isUIDisabled&&this.showWait(!0)}onDataWorldIsCollectingChanged(e){e?this.classList.add("is-collecting"):this.classList.remove("is-collecting")}onDataCollectionDeviceError(e){let{dataWorld:t,dataCollection:s}=this.$services;this.showWait(!1),typeof e.errorCode=="number"&&(e.errorCode===s.DeviceError.COMMUNICATION_FAILED?this._showDialog(M("A communication error has occurred. Start a new experiment to continue.")):s.mode==="time-based"&&!this.waitingForTrigger&&(t.stopCollection(),e.errorCode===s.DeviceError.DROPPED_MEASUREMENT?this._showDialog(M("Dropped Measurement(s). Please start a new experiment and use a slower data collection rate.")):this._showDialog(M("A communications error caused data collection to stop. Please try again."))))}_showDialog(e){this.messageBoxInView||(this.messageBoxInView=!0,this.dispatchEvent(new CustomEvent("open-dialog",{bubbles:!0,composed:!0,detail:{dialog:"message_box",params:{title:M("Device Error"),content:e,actions:[{id:"okay",message:M("OK"),onClick:async()=>{this.dispatchEvent(ys("message_box"))}}]},onClose:()=>{this.messageBoxInView=!1}}})))}async onDataCollectionBleCommunicationError(){let{toast:e}=this.$services;e.makeToast(M("The Bluetooth connection has been lost"),{duration:5e3})}onDataCollectionStartMeasurementsFailed(){this.showWait(!1)}onDataCollectionCollectionParamsChanged(e){let{params:t}=e;t&&this._curMode==="time-based"&&(t.delta<.001&&(t.duration===0||t.duration>.05)?(this.toggleUIUpdates({graphs:!1,table:!1,autoSave:!1}),this.isUIDisabled=!0):(this.toggleUIUpdates(),this.isUIDisabled=!1),t.triggering&&(this.triggeringParams=t.triggering,this.triggeringPrestore=t.triggering.prestore,this.triggeringSensor=t.triggering.sensor,this.waitingForTrigger=t.triggering.enabled))}onDataCollectionCollectionModeChanged(e){let{dataCollection:t}=this.$services,s=e.to,r=t.getCollectionParams();s==="time-based"?r&&(r.delta<.001&&(r.duration===0||r.duration>.05)?(this.toggleUIUpdates({graphs:!1,table:!1,autoSave:!1}),this.isUIDisabled=!0):(this.toggleUIUpdates(),this.isUIDisabled=!1),r.triggering&&(this.triggeringParams=r.triggering,this.triggeringPrestore=r.triggering.prestore,this.triggeringSensor=r.triggering.sensor,this.waitingForTrigger=r.triggering.enabled)):(s.match("events")||s==="drop-counting"||s==="photogate-timing")&&this.toggleUIUpdates(),this._curMode=s}toggleUIUpdates(e){let{dataWorld:t}=this.$services,s=P({graphs:!0,table:!0,autoSave:!0},e);t.enableAutoSave=s.autoSave}showWait(e,t){let s=this.shadowRoot.querySelector("ga-toolbar").shadowRoot.querySelector("vst-ui-toolbar");e?(this.classList.add("show-wait"),s.classList.add("show-wait"),this.uiWaitEl.hidden=!1,t&&t.message&&(this.uiWaitEl.message=t.message)):(this.classList.remove("show-wait"),s.classList.remove("show-wait"),this.uiWaitEl.hidden=!0,this.uiWaitEl.message="",this.uiWaitEl.removeElements())}async _startSession(e={}){let{dataWorld:t,popoverManager:s}=this.$services;if(e&&e.file)try{s.closeAll();let{cancelled:r}=await this.trySave().catch(i=>i);if(r)return;window.__isSessionClient||(await t.importDataThrottled({fileData:e}),Le.notifyHostInitialized(this.$services))}catch(r){console.warn(`Import failed: ${r}`)}}async _startBlockSession(e,t){if(this._blockSessionStarted)return;this._blockSessionStarted=!0;let{dataWorld:s,udm:r}=this.$services;await s.blockSynced,await s.startNewSession(this.$services.urlHandler.manual?"ManualEntry":void 0,s.sessionConfig,void 0),Le.authoringMode||await Promise.all(s.getAllColumns().map(p=>s.freezeColumn(p.id,!0)));let{frameFeatures:i}=await import("./chunk/FrameFeatures-EN7KYCUN.js");this._frameFeatures=i,this._frameFeatures.initializeBlockTypeFeatures(e);let{buildBlockLayout:o}=await import("./chunk/buildBlockLayout-UM3ZFXA5.js"),l={graphIds:[],blockId:t,showsTable:e==="table",meterIds:e==="meter"?[s.meters[0]?.id]:void 0,meterSize:e==="meter"?"small":void 0,type:e,layout:o(e)},c=await r.setBlockId(s.experimentId,t,l);c.rehydrated&&$e.dispatch(rn(!1)),ue.updateLayout(c.layout),(await s.getStoredMeterInfo()).forEach(async p=>{let m=s.meters.find(v=>v.id===p.id);m||(m=s.createMeter(p),s.addMeter(m,!0)),m?this._configureBlockMeter(m):console.warn(`Unable to retrieve udm meter info for meter id = ${p.id}`)}),this.addEventListener("attach-block-meter",({detail:p})=>{c.meterIds=[...c.meterIds,p.id],this._configureBlockMeter(p)}),this.addEventListener("detatch-block-meter",({detail:p})=>{c.meterIds=c.meterIds.filter(m=>m!==p)}),this._setupServiceWorkerSaveListeners()}_configureBlockMeter(e){let{dataWorld:t,sensorWorld:s}=this.$services;if(e.columnId!==0){let r=t.getColumnById(e.columnId),i=s.getSensorById(e.sensorId);i||(i=s.sensors.find(o=>t.meters.find(l=>l.sensorId===e.sensorId)?!1:o.id===e.sensorId||o.name===e.sensorName||o.autoId===e.sensorAutoId)),rr(e,r,i)}}async onCreateExperiment(){let{dataWorld:e,popoverManager:t}=this.$services;t.closeAll();try{if((await this.trySave().catch(r=>r))?.cancelled){t.closeAll();return}await e.startNewSession("DataCollection"),this._showWelcomeDialog()}catch(s){console.error(s)}}async _showWelcomeDialog(){if(rs())return;let{analytics:e,popoverManager:t}=this.$services;await import("./chunk/ga-welcome-U5UYW6IA.js"),e.trackEvent("dialog_open",{dialog_name:"Welcome"}),t.presentDialog("ga-welcome",{properties:{isPWAMessageVisible:this._isPWAMessageVisible},events:()=>({"open-file":()=>{this._handleOpenFile()},"open-sensor-dialog":()=>{this.showSensorDialog()},close:()=>{e.trackEvent("dialog_close",{dialog_name:"Welcome"}),t.closeAll()},"show-sample-experiments":async()=>{t.closeAll();let{readCacheJsonFile:s}=await import("./chunk/file-rw-W5VB3ABJ.js");this.sampleExperiments=await fetch("https://ga-experiment-library.s3-us-west-2.amazonaws.com/experiment-manifest.json").then(r=>r.json()).catch(()=>s("experiment-manifest.json")),this.showSampleExperiments=!0,this.requestUpdate()},"connect-data-sharing":async()=>{await import("./chunk/ga-datashare-connect-UCSPJDU5.js"),t.presentDialog("ga-datashare-connect",{title:M("Data Sharing"),events:()=>({"start-datashare-client":s=>this.onStartDataShareClient(s)})})},"reset-pwa-message":async()=>{this._isPWAMessageVisible=!1}})})}_resetSampleExperiments(){this.showSampleExperiments=!1,this.shadowRoot.querySelector("ga-sample-data").hasAttribute("downloaded")||this._showWelcomeDialog()}_resetDataShareStatus(){this.showDataShareStatus=!1}onShowDataShareHost(){this.showDataShareHost=!0,this.requestUpdate()}async onStartDataShareHost({target:e}){try{if(this.peerId)return;let{gaPeerConnection:t}=this.$services,s=await t.initiate();ne.updatePeerStatus({id:s,type:"host"}),e.hostStarting=!1,this.requestUpdate()}catch(t){ne.resetPeerStatus(),console.error(t)}}onToggleDataShareStatus(){this.showDataShareStatus=!this.showDataShareStatus}openDataCollectionSettings(){import("./chunk/ga-data-collection-settings-AD4YPUUE.js"),this.showDataCollectionSettings=!0}closeDataCollectionSettings(){this.showDataCollectionSettings=!1}async onStopDataShare(){if(this._dataShareClientStarting){console.warn("Calling onStopDataShare in the middle of starting datashare. Plese wait for the client to connect, then call stop.");return}let{gaPeerConnection:e}=this.$services;this.showDataShareStatus=!1,e.dispose(),ne.resetPeerStatus(),this.requestUpdate()}_resetDataShareHost(){this.showDataShareHost=!1}async onStartDataShareClient({detail:{serverid:e}}){let{dataWorld:t,gaPeerConnection:s,popoverManager:r}=this.$services;try{this._dataShareClientStarting=!0,await s.initiate();let i=await s.connect(e);await t.startNewSession("DataShare",{rtcClient:i}),r.closeAll(),ne.updatePeerStatus({type:"client",id:e}),this.addPeerConnectionListeners(),this.isConnecting=!1}catch(i){console.error(i)}finally{this._dataShareClientStarting=!1}}addPeerConnectionListeners(){let{gaPeerConnection:e,toast:t}=this.$services;e.hasListeners||(e.addEventListener("rtc-datashare-did-end",()=>{t.makeToast(M("Session ended by Host"),{duration:5e3}),ne.resetPeerStatus()}),e.addEventListener("rtc-datashare-confirm-follow-host",this.onFollowHostNewExperimentConfimration.bind(this)),e.hasListeners=!0)}_setupCustomCurveFits(){let e=new Se,{dataWorld:t,dataAnalysis:s}=this.$services;e.on(t,"session-ended",async()=>{await s.curveFitStore.removeAllFits()})}_generateAutoLayout(){let{dataWorld:e,dataCollection:t,sensorWorld:s}=this.$services,r={},i=[];if(e.sessionType==="ManualEntry")r={graph_1:!0,table:!0},i=xd(e);else if(e.sessionType==="DataShare")r={graph_1:!0};else{let o=Ps(e,s,t.getCollectionParams());r=o.appAutoLayout,i=o.graphAutoLayouts}return{appAutoLayout:r,graphsLayout:i}}_setupAutoLayout(){let e=new Se,{dataWorld:t,dataCollection:s,sensorWorld:r}=this.$services,i=(o,l)=>{$e.dispatch(nn(o)),ue.updateLayout(l)};e.on(t,"before-session-started",async o=>{if(this.isImportedSession=o.imported,!this.isImportedSession){let{appAutoLayout:l,graphsLayout:c}=this._generateAutoLayout();i(c,l);let u={graph_1:ue.graph_1,graph_2:ue.graph_2,graph_3:ue.graph_3,table:ue.table,meter:ue.meter,video:ue.video,notes:ue.notes,configurator:ue.configurator};await t.setLayoutProperties(u)}}),e.on(t,"session-started",async o=>{if(this._stopLayoutAutorunFirstRun=!0,this.isImportedSession=o.imported,delete this._lastSync,this._updateExperimentTitle(),this.$services.udm.isBlock){let{blockInfo:l}=this.$services.udm;if(l)ue.updateLayout(l.layout);else{let{blockType:c,blockId:u}=this.$services.urlHandler;await this._startBlockSession(c,u)}}else if(this.isImportedSession){let l=await t.getLayoutProperties();l&&ue.updateLayout(l)}else{let{appAutoLayout:l,graphsLayout:c}=this._generateAutoLayout();i(c,l)}if(this._stopLayoutAutorun=qt(()=>{let l={graph_1:ue.graph_1,graph_2:ue.graph_2,graph_3:ue.graph_3,table:ue.table,meter:ue.meter,video:ue.video,notes:ue.notes,configurator:ue.configurator};if(this._stopLayoutAutorunFirstRun){this._stopLayoutAutorunFirstRun=!1;return}t.setLayoutProperties(l)}),await this.$services.gaReplayService.resetService(this.isImportedSession),yr&&!Zd){Zd=!0;let{setupUdmWatcher:l}=await import("./chunk/setupUdmWatcher-6TKFKABO.js");l.call(this,...yr),yr=!1}rs()&&!this._sensorDialogShownOnLoad&&(this.showSensorDialog(!0),this._sensorDialogShownOnLoad=!0)}),e.on(s,"collection-mode-changed",({to:o,from:l})=>{let c=o.includes("events")&&l.includes("events");if(!this.isImportedSession&&!c){let u=Ps(t,r,s.getCollectionParams());i(u.graphAutoLayouts,u.appAutoLayout)}}),e.on(s,"collection-params-changed",({mode:o},{mode:l})=>{let c=o==="photogate-timing"&&l==="photogate-timing";if(!this.isImportedSession&&c){let u=Ps(t,r,s.getCollectionParams());i(u.graphAutoLayouts,u.appAutoLayout)}}),e.on(s,"collection-params-changed",()=>{if(!this.isImportedSession){let l=Ps(t,r,s.getCollectionParams()).graphAutoLayouts.map(c=>c.options.baseRange.max);$e.dispatch(wl(l))}}),["sensor-ready","sensor-removed"].forEach(o=>{e.on(r,o,async()=>{this.isSessionEmpty&&t.sessionType==="DataCollection"&&(s.timeUnits!=="s"&&(s.timeUnits="s"),setTimeout(()=>{if(!this.isImportedSession){let l=Ps(t,r,s.getCollectionParams());i(l.graphAutoLayouts,l.appAutoLayout)}},250))})}),e.on(t,"data-share-view-changed",({graphLayouts:o,appLayout:l})=>{this.dataShareUpdates.graphs&&this.dataShareUpdates.layout?i(o,l):this.dataShareUpdates.graphs?$e.dispatch(nn(o)):this.dataShareUpdates.layout&&ue.updateLayout(l)})}stateChanged(e){this.isSessionEmpty=e.isSessionEmpty,this.dataShareUpdates=e.enableDataShareUpdates}_updateExperimentTitle(){let{dataWorld:e}=this.$services;this.experimentName=e.sessionName}onDataWorldSessionRemoteIdChanged(){if(this.isRemoteIdDialogOpen||ne.id)return;this.isRemoteIdDialogOpen=!0;let{dataWorld:e}=this.$services,t="DataShare",s={};e.getSession()&&e.sessionHostAddress&&(s={sourceURI:e.sessionHostAddress,sourceName:e.sessionSourceName}),this.dispatchEvent(new CustomEvent("open-dialog",{bubbles:!0,composed:!0,detail:{dialog:"message_box",params:{title:M("Start New Experiment?"),choiceRequired:!0,content:M("Your Data Sharing Host is starting a new experiment. You may continue with your experiment or join into the new experiment."),actions:[{id:"offline",message:M("Disconnect"),variant:"text",onClick:async()=>{ne.resetPeerStatus(),this.dispatchEvent(ys("message_box"))}},{id:"new_session",message:M("Join New Experiment"),onClick:async()=>{this.dispatchEvent(ys("message_box"));let{cancelled:r}=await this.trySave().catch(i=>i);r&&await this.onDataWorldSessionRemoteIdChanged(),await e.startNewSession(t,s)}}]},onClose:()=>{this.isRemoteIdDialogOpen=!1}}}))}_setupTriggering(e=!1){let t={};if(this.triggeringParams.prestore&&!e){let s=this.triggeringParams.prestore>1?M("points"):M("point");t.message=mt(M("Collecting %d %s"),this.triggeringParams.prestore,s)}else{let{dataWorld:s,sensorWorld:r}=this.$services,o=(()=>{let l;return r.sensors.forEach(c=>{c.id===this.triggeringParams.sensor&&(l=c)}),l})();if(o){let l=this.triggeringParams.slope===1?M("increase"):M("decrease"),c=s.getColumnGroups().find(v=>v.sensorId===o.id),u=c.name?c.name:"unknown";t={message:mt(M("Waiting for %s to %s across %s %s"),u,l,this.triggeringParams.threshold,o.units)};let p=s.meters.find(v=>v.sensorId===o.id),m=document.createElement("vst-core-meter-container");m.ignoreServiceEvents=!0,m.metersize="medium",m.hideMeterButtons=!0,m._addMeter(p),this.uiWaitEl.addElement(m)}}this.showWait(!0,t)}async _showChromeOnMacWinDialog(){let{_splashScreenEl:e}=this,t;Zt.default.os.family.includes("OS X")?t="macOS":Zt.default.os.family.includes("Windows")&&(t="Windows"),e.errorMsg=`You are running Graphical Analysis as a Chrome Packaged App. Please download the native app for ${t}.`,await this.updateComplete;let s=e.shadowRoot.querySelector(".wrapper"),r=document.createElement("button");r.innerText="Download",r.classList.add("download-btn"),r.addEventListener("click",()=>{window.open("https://www.vernier.com/products/software/graphical-analysis/","_blank"),setTimeout(()=>{document.dispatchEvent(new CustomEvent("close-app",{bubbles:!0,composed:!0}))})}),s.appendChild(r),Zs.on("dev-override",()=>{Zs.off("dev-override"),r.remove(),e.errorMsg="",this._splashScreenEl.showProgress=!0})}_incrementAuxGraphCount(){this.auxGraphCount++}_decrementAuxGraphCount(){this.auxGraphCount--}static get styles(){return[xs,Id,Te`
        :host {
          --vst-color-brand-400: hsl(182, 100%, 16%);
          --vst-color-brand-300: hsl(182, 100%, 23%);
          --vst-color-brand-200: hsl(182, 70%, 35%);
          --vst-color-brand-100: hsl(182, 60%, 90%);

          background-color: var(--vst-color-bg-secondary);
          height: 100%;

          /* apply safe areas only if the environment specifies them */
          padding: env(safe-area-inset-top, 0) env(safe-area-inset-right, 0)
            env(safe-area-inset-bottom, 0) env(safe-area-inset-left, 0);
        }

        #data_collection_settings_dialog {
          --overflow-y: hidden;
          --dialog-max-block-size: 100%;
          --dialog-z-index: calc(var(--vst-z-popover) - 1);
          --dialog-padding: 0;
        }
        vst-ui-logo-vernier[cover] {
          position: fixed;
          top: 0;
          left: 0;
          bottom: 0;
          right: 0;
          z-index: 9001;
          background: var(--vst-color-bg-dark);
        }
        .content-wrapper {
          display: flex;
          flex-direction: column;
          height: calc(100% - var(--chrome-menubar-height, 0px));
        }

        .toolbar {
          border-bottom: 1px solid var(--vst-color-bg-primary);
        }

        .soft_alert_trial {
          z-index: calc(var(--vst-z-popover) - 1);
        }
      `]}render(){return ie`
      ${this.persistentHostIframe?ie`<vst-ui-logo-vernier cover></vst-ui-logo-vernier>`:""}

      <vst-ui-dialog no-close no-escape ?open=${this._isUnsupportedBrowserMessageVisible}>
        <h1 slot="header">${M("Unsupported Browser")}</h1>
        <p slot="content">
          ${M("Chrome 102 or later is required. iPad and iPhone are not supported.")}
        </p>
      </vst-ui-dialog>

      <vst-ui-splash-screen id="splash_screen" .percentLoaded="${this.progress}">
        ${Ss(!rs(),ie`<ga-logo slot="logo"></ga-logo>`,ie`<vst-ui-logo-vernier slot="logo" alt="Vernier Logo"></vst-ui-logo-vernier>`)}
      </vst-ui-splash-screen>

      ${this.$services?ie`
            <h1 visually-hidden>Graphical Analysis</h1>
            <div class="content-wrapper">
              <ga-toolbar
                .experimentName="${this.experimentName}"
                .license="${this.license}"
                .dataShareHostingActive="${this.isDataShareHost}"
                .showDataShareStatus="${this.showDataShareStatus}"
                .dataShareHostingStatus="${this.dataShareStatus}"
                .auxGraphEnabled="${this.auxGraphCount>=1}"
                .savePending="${this.savePending}"
                .saveError="${this.saveError}"
                .autoSaving="${this.autoSaving}"
                @create-new-experiment="${this.onCreateExperiment}"
                @submit-auth="${({detail:{key:e}})=>et.authorize(e)}"
                @show-datashare-host="${this.onShowDataShareHost}"
                @start-datashare-host="${this.onStartDataShareHost}"
                @toggle-datashare-status="${this.onToggleDataShareStatus}"
                @open-file="${this._handleOpenFile}"
                @save-file="${e=>this.onSaveFile(e.detail)}"
                @mark-data=${this.addDataMark}
                ?hidden=${this._frameFeatures?.disabledFeatures?.has("toolbar")}
              >
              </ga-toolbar>
              <ga-main-content
                id="main_content"
                class="main-content"
                .isCollecting="${this.isCollecting}"
                .graphModeTransition="${this.graphModeTransition}"
                @increment-aux-count="${this._incrementAuxGraphCount}"
                @decrement-aux-count="${this._decrementAuxGraphCount}"
                @add-remove-meters-clicked=${this.showAddMeterDialog}
              >
              </ga-main-content>
              <ga-bottombar
                ?hidden="${this.$services.gaReplayService?.isReplayActive||this._frameFeatures?.disabledFeatures?.has("bottom-bar")}"
                @open-data-collection-settings="${this.openDataCollectionSettings}"
                @reconnect-data-share-client="${async()=>this.onStartDataShareClient({detail:{serverid:ne.id}})}"
                @open-sensor-dialog=${()=>this.showSensorDialog()}
              >
                <vst-core-meter-container
                  .isCollecting=${this.isCollecting}
                  metersize="mini"
                ></vst-core-meter-container>
              </ga-bottombar>
              ${Ss(this.license,ie`
                  <vst-ui-soft-alert
                    aria-label="${M("Pro Expiry Alert")}"
                    id="soft_alert_bottom"
                    class="soft_alert_trial"
                    ?hidden=${this.daysRemaining>ng}
                    type=${this.daysRemaining<og?"error":"warning"}
                    canClose
                  >
                    ${this.daysRemaining<=1?M("Vernier Graphical Analysis\xAE Pro access expires today"):M(`Vernier Graphical Analysis\xAE Pro access expires in ${this.daysRemaining} days`)}
                  </vst-ui-soft-alert>
                `)}
              <div class="popover-wrapper" id="popover_wrapper"></div>
              <div id="toast_wrapper"></div>
              <vst-ui-wait hidden></vst-ui-wait>
              <slot name="tooltip_wrapper"></slot>
              <vst-ui-dialog
                style="--dialog-padding: 0"
                ?open="${this.showDataCollectionSettings}"
                id="data_collection_settings_dialog"
                @dialog-close="${this.closeDataCollectionSettings}"
              >
                ${Ss(this.showDataCollectionSettings,ie`
                    <h2 slot="header">${M("Data Collection Settings")}</h2>
                    <ga-data-collection-settings slot="content"></ga-data-collection-settings>
                  `)}
              </vst-ui-dialog>

              <vst-ui-dialog
                ?open="${this.showDataShareHost}"
                style="--dialog-z-index: calc(var(--vst-z-popover) - 1); --dialog-padding: var(--vst-space-xl)"
                @dialog-close="${this._resetDataShareHost}"
              >
                <h2 slot="header">${M("Start a Data Sharing Session")}</h2>
                <ga-datashare-host
                  id="datashare_host"
                  ?hidden="${!this.showDataShareHost}"
                  .hostActive="${this.isDataShareHost}"
                  @start-datashare-host="${this.onStartDataShareHost}"
                  slot="content"
                ></ga-datashare-host>
              </vst-ui-dialog>

              <vst-ui-dialog
                style="--dialog-z-index: calc(var(--vst-z-popover) - 1);"
                ?open="${this.showDataShareStatus}"
                @dialog-close="${this._resetDataShareStatus}"
              >
                <h2 slot="header">${M("Data Sharing Status")}</h2>
                <ga-datashare-status
                  slot="content"
                  @stop-datashare-host="${this.onStopDataShare}"
                  ?hidden="${!this.showDataShareStatus}"
                ></ga-datashare-status>
              </vst-ui-dialog>

              <vst-ui-dialog
                ?open="${this.errorType==="offline"&&(this.isDataShareHost||this.isDataShareClient)}"
                @dialog-close="${this.isDataShareHost?()=>ne.resetPeerStatus():""}"
              >
                <h2 slot="header">${M("Connection Lost")}</h2>
                <ga-datashare-disconnected
                  slot="content"
                  @start-new-session="${this.onStartDataShareHost}"
                  @reconnect-data-share-client="${async()=>this.onStartDataShareClient({detail:{serverid:ne.id}})}"
                ></ga-datashare-disconnected>
              </vst-ui-dialog>

              <vst-ui-dialog
                ?open="${this.showSampleExperiments}"
                style="--overflow-y: hidden"
                @dialog-close="${this._resetSampleExperiments}"
              >
                ${this.showSampleExperiments?ie`
                      <h2 slot="header">${M("Sample Experiments")}</h2>
                      <ga-sample-data
                        slot="content"
                        .experiments="${this.sampleExperiments}"
                        @open-sample-experiment="${this.onOpenSampleFile}"
                      ></ga-sample-data>
                    `:ie``}
              </vst-ui-dialog>

              <vst-ui-dialog
                ?open=${this._showDataLoggingStatusDialog}
                @dialog-close=${()=>{this._handleDataLoggingStatusClose()}}
              >
                <h2 slot="header">${this._dataLoggingStatusHeaderText}</h2>
                <ga-data-logging-status
                  slot="content"
                  .isUSB=${this.$services.deviceManager.connectedUsbDevices.length>0}
                  .status=${this.$services.deviceManager.getConnectedDevices().at(0)?.offlineLoggingStatus}
                  @retrieve-data=${this._handleDataLoggingRetrieval}
                  @disconnect=${this._handleDataLoggingDisconnect}
                ></ga-data-logging-status>
              </vst-ui-dialog>
            </div>
            <vst-ui-dialog-manager>
              ${this.dialogs.templates.map(e=>e.call(this))}
            </vst-ui-dialog-manager>
          `:""}
    `}};customElements.define("ga-app",Yd);Le.init().then(async({newServiceWorkerReady:n})=>{await n,fetch("https://ga-experiment-library.s3-us-west-2.amazonaws.com/experiment-manifest.json")});"ResizeObserver"in window||(async()=>{let n=await import("./chunk/resize-observer-NO3LDFRV.js");window.ResizeObserver=n.ResizeObserver})();
/*!
 * Platform.js v1.3.6
 * Copyright 2014-2020 Benjamin Tan
 * Copyright 2011-2013 John-David Dalton
 * Available under MIT license
 */
/*! (c) Andrea Giammarchi - ISC */
/*! ally.js - v1.4.1 - https://allyjs.io/ - MIT License */
