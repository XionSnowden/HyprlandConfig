import{a as T}from"./chunk-J6L6J5R7.js";import{a as _}from"./chunk-NNBWZ6HI.js";import{a as r,b as d,d as a,j as h,k as R}from"./chunk-SSPC3AL5.js";import{c as p}from"./chunk-LI3RKPGW.js";import{a as I,b as A,h as b}from"./chunk-CM6X6NVN.js";var o={NONE:0,PROPORTIONAL:1,LINEAR:2,QUADRATIC:3,POWER:5,INVERSE:7,INVERSE_SQUARED:8,NATURAL_EXPONENT:10,NATURAL_LOG:11,SINE:14,COSINE_SQUARED:15,COSINE:18,CUSTOM:21};var C=4,x=f=>_.sigFig(f,C),y=class{constructor(){this._releaseHandle=async()=>{},this._updateCustomFit=async()=>{},this.builtins=[{type:"PROPORTIONAL",name:p("Proportional","mathematical","curvefit"),y:"ax",coefficients:["a"],id:o.PROPORTIONAL},{type:"LINEAR",name:p("Linear","mathematical","curvefit"),y:"mx + b",coefficients:["m","b"],id:o.LINEAR},{type:"QUADRATIC",name:p("Quadratic","mathematical","curvefit"),y:"ax^2 + bx + c",coefficients:["a","b","c"],id:o.QUADRATIC},{type:"POWER",name:p("Power","mathematical","curvefit"),y:"ax^b",coefficients:["a","b"],id:o.POWER},{type:"INVERSE",name:p("Inverse","mathematical","curvefit"),y:"a/x",coefficients:["a"],id:o.INVERSE},{type:"INVERSE_SQUARED",name:p("Inverse Squared","mathematical","curvefit"),y:"a/x^2",coefficients:["a"],id:o.INVERSE_SQUARED},{type:"NATURAL_EXPONENT",name:p("Natural Exponent","mathematical","curvefit"),y:"a exp(-cx) + b",coefficients:["a","b","c"],id:o.NATURAL_EXPONENT},{type:"NATURAL_LOG",name:p("Natural Log","mathematical","curvefit"),y:"a * ln(bx)",coefficients:["a","b"],id:o.NATURAL_LOG},{type:"SINE",name:p("Sine","mathematical","curvefit"),y:"a * sin(bx + c) + d",coefficients:["a","b","c","d"],id:o.SINE},{type:"COSINE",name:p("Cosine","mathematical","curvefit"),y:"a * cos(bx + c) + d",coefficients:["a","b","c","d"],id:o.COSINE},{type:"COSINE_SQUARED",name:p("Cosine Squared","mathematical","curvefit"),y:"a * cos(bx + c)^2 + d",coefficients:["a","b","c","d"],id:o.COSINE_SQUARED}],this.customs=[],h(this,{builtins:r,customs:r,fits:d,updateFit:a,removeFit:a,removeAllFits:a,_newFit:a})}get fits(){return[...this.builtins,...this.customs]}getFit(t){return this.customs.find(e=>e.type===t)||this.builtins.find(e=>e.type===t)}getFitById(t){return[...this.customs,...this.builtins].find(e=>e.id===t)}_getCustomFit(t){return this.customs.find(e=>e.type===t)}getFitInfo(t,{coefficients:e=[],uncertainties:i=[],correlation:n=null,rmse:s=0}){let c={y:"",rmse:0,coefficients:[]},m=this.getFit(t);if(m){if(c.y=m.y,c.rmse=x(s),e)for(let l=0;l<m.coefficients.length;l++){let N=x(e[l]),S=x(i[l]);c.coefficients.push({name:m.coefficients[l],value:N,uncertainty:S})}Number.isFinite(n)&&(c.r=x(n))}return c}_newFit({type:t,y:e,handle:i,coefficients:n}){let s={type:t,id:o.CUSTOM,name:t,y:e,handle:i,coefficients:n};return this.customs.push(s),s}async updateFit({type:t,y:e,handle:i,coefficients:n}){let s=this._getCustomFit(t);return s?(await this._releaseHandle(s.handle),s.type=t,s.y=e,s.handle=i,s.coefficients=n):s=this._newFit({type:t,y:e,handle:i,coefficients:n}),await this._updateCustomFit(t,e),s}async removeFit(t){let e=this._getCustomFit(t);await this._releaseHandle(e.handle),this.customs.remove(e)}async removeAllFits(){let t=this.customs.slice();for(let e=0;e<t.length;++e){let i=t[e];await this.removeFit(i.type)}}},Q=new y;var O=b(T()),j=Object.freeze({FFT:"fft",HISTOGRAM:"histogram",REGULAR:"regular"}),v=0,F=class extends O.default{constructor({id:t=`${v++}`,type:e="regular",name:i="DataSet",position:n=0,columnIds:s=[]}){super();this._id=t,this._type=e,this._name=i,this._position=n,this._columnIds=s}get id(){return this._id}get type(){return this._type}get name(){return this._name}set name(t){this._name=t,this.emit("name-changed",this.name)}get position(){return this._position}set position(t){this._position=t,this.emit("position-changed",this.position)}get columnIds(){return[...this._columnIds]}addColumn(t,e=null,i=!1){let n=this._columnIds;if(!n.includes(t)){let s=!1;if(e&&e!=="0"){let c=n.indexOf(e);c>=0&&(i||c++,n.splice(c,0,t),s=!0)}else i&&(n.splice(0,0,n),s=!0);s||n.push(t),this.emit("column-added",t)}}removeColumn(t){let e=this._columnIds,i=e.indexOf(t);i>=0&&(e.splice(i,1),this.emit("column-removed",t))}};var u=class{constructor({appearanceInfo:t,graphUdmId:e}){this.editingGraphId=0;this.appearanceInfo=t?.map(i=>u._newAppearance(i))??[],e!==void 0&&e>0&&this._createAppearance(e),h(this,{appearanceInfo:r.deep,editingGraphId:r,mixinUdmExport:d,setShownOnGraph:a,setCollapseOnGraph:a,setPositionOnGraph:a,setEditingOnGraph:a})}get mixinUdmExport(){return{appearanceInfo:this.appearanceInfo.map(t=>t.udmExport)}}udmImport(t){let{appearanceInfo:e=null}=t;e&&(this.appearanceInfo=e.map(i=>u._newAppearance(i)))}setShownOnGraph(t,e=!0){let i=this._getAppearance(t);e&&!i&&(i=this._createAppearance(t)),i&&(i.isShown=e)}isShownOnGraph(t){let e=this._getAppearance(t);return e?e.isShown:!1}containsGraph(t){return!!this._getAppearance(t)}setCollapseOnGraph(t,e=!0){let i=this._getAppearance(t);i||(i=this._createAppearance(t)),i.isCollapsed=e}isCollapsedOnGraph(t){let e=this._getAppearance(t);return e?e.isCollapsed:!1}setPositionOnGraph(t,e){let i=this._getAppearance(t);i||(i=this._createAppearance(t)),i.position=e}getPositionOnGraph(t){let e=this._getAppearance(t);return e?e.position:{x:-1,y:-1}}setEditingOnGraph(t){this.editingGraphId=t}_getAppearance(t){return this.appearanceInfo.find(e=>e.graphId===t)}_createAppearance(t){let e=u._newAppearance({graphId:t});return this.appearanceInfo.push(e),e}static _newAppearance(t={}){class e{constructor(n={}){this._graphId=n.graphId??0,this.isShown=n.isShown??!0,this.isCollapsed=!1,this.position=n.position??{x:-1,y:-1},h(this,{isShown:r,isCollapsed:r,position:r,graphId:d,udmExport:d})}get graphId(){return this._graphId}get udmExport(){return{graphId:parseInt(this.graphId),isShown:this.isShown,isCollapsed:this.isCollapsed,position:I({},this.position)}}}return new e(t)}};var E=class{constructor({columnId:t,pointIndex:e,rangeStartIndex:i,rangeEndIndex:n}){this.columnId="";this.pointIndex=null;this.rangeStartIndex=null;this.rangeEndIndex=null;t!==void 0&&(this.columnId=`${t}`),e!==void 0&&(this.pointIndex=e),i!==void 0&&(this.rangeStartIndex=i),n!==void 0&&(this.rangeEndIndex=n),R(this)}get udmExport(){return{columnId:parseInt(this.columnId),pointIndex:this.pointIndex,rangeStartIndex:this.rangeStartIndex,rangeEndIndex:this.rangeEndIndex}}},g=Object.freeze({FREE:"freeform",POINT:"point",RANGE:"range"}),w=class extends u{constructor({id:t,graphUdmId:e,text:i,type:n,appearanceInfo:s,targetRecords:c}){super({appearanceInfo:s,graphUdmId:e});this.id=0;this.text="";this.type=g.FREE;this.targetRecords=[];t!==void 0&&(this.id=t),i!==void 0&&(this.text=i),n!==void 0&&(this.type=n),c!==void 0&&(this.targetRecords=c.map(m=>new E(m))),h(this,{text:r,type:r,targetRecords:r,udmExport:d,setText:a,setPointTarget:a,setRangeTarget:a})}setPointTarget(t,e){if(this.type===g.RANGE){console.error("Annotation is already in RANGE mode. Cannot add a POINT target.");return}this.type=g.POINT;let i=this.targetRecords.find(n=>n.columnId===t);i?i.pointIndex=e:this.targetRecords.push(new E({columnId:t,pointIndex:e}))}setRangeTarget(t,e,i){if(this.type===g.POINT){console.error("Annotation is already in POINT mode. Cannot add a RANGE target.");return}console.assert(e<i,"Range start must be less than range end."),this.type=g.RANGE;let n=this.targetRecords.find(s=>s.columnId===t);n?(n.rangeStartIndex=e,n.rangeEndIndex=i):this.targetRecords.push(new E({columnId:t,rangeStartIndex:e,rangeEndIndex:i}))}setText(t){this.text=t}getPointIndexForColumn(t){return this.targetRecords.find(e=>e.columnId===t)?.pointIndex??null}getRangeIndexesForColumn(t){let e=this.targetRecords.find(i=>i.columnId===t);return e?{startIndex:e.rangeStartIndex,endIndex:e.rangeEndIndex}:null}containsTargetColumn(t){return this.targetRecords.some(e=>e.columnId===t)}get udmExport(){return A(I({},this.mixinUdmExport),{id:this.id,text:this.text,type:this.type,targetRecords:this.targetRecords.map(t=>t.udmExport)})}};export{o as a,Q as b,j as c,F as d,u as e,g as f,w as g};
