import{a as y}from"./chunk-ZAKMYXQF.js";import{v as d}from"./chunk-IMQHRNK4.js";import{c as p}from"./chunk-CRHRJPRJ.js";import{b as c,c as m,h as f}from"./chunk-BVG7RORO.js";var u=class extends f{static get properties(){return{dragContainer:{type:Object},xPos:{type:Number},yPos:{type:Number},draggableId:{type:Number},emitPositionOn:{type:String}}}constructor(){super();this.dragContainer=document.body,this.draggableId=0,y(this,"track",s=>this.dragHandler(s)),this.emitPositionOn=""}firstUpdated(){setTimeout(()=>{this.throttleEnforceContainment=d(this.enforceContainment.bind(this),25),this.dragContainer.addEventListener("resize",this.throttleEnforceContainment)},100),this.shadowRoot.querySelector("slot").addEventListener("slotchange",()=>{this.slottedElements=Array.from(this.children)})}connectedCallback(){super.connectedCallback(),this.emitPositionOn&&this.addEventListener(`${this.emitPositionOn}`,()=>{this.emitNewPosition({isInitialPlacement:!0,dragEnd:!1})})}disconnectedCallback(){this.dragContainer.removeEventListener("resize",this.throttleEnforceContainment)}updated(s){s.forEach((n,t)=>{switch(t){case"xPos":this._xPosChanged();break;case"yPos":this._yPosChanged();break;default:}})}emitNewPosition({isInitialPlacement:s=!1,dragEnd:n=!1}={}){let t=this.getBoundingClientRect(),e=this.dragContainer.getBoundingClientRect(),i=n?this.yPos+t.height/2:t.top+t.height/2,r=n?this.xPos+t.width:t.right;this.dispatchEvent(new CustomEvent("draggable-moved",{bubbles:!0,composed:!0,detail:{isInitialPlacement:s,draggableId:this.draggableId,maxTranslate:this.maxTranslate,draggableRect:t,containerRect:e,absolutePosition:{topLeft:{x:t.left-e.left,y:t.top-e.top},centerRight:{x:r-e.left,y:i-e.top}}}}))}dragHandler(s){let{dragContainer:n}=this,t=this,e=n,i=s.detail,{state:r,dx:o,dy:a}=i,l=0,h=0;r==="start"?(this.slottedElements.forEach(g=>{g.dragging=!0}),t.style.willChange="transform",this.containerRect=e.getBoundingClientRect(),this.draggingRect=t.getBoundingClientRect(),t.style.position="fixed",this.xPos=this.draggingRect.left,this.yPos=this.draggingRect.top,this.maxTranslate={left:this.containerRect.left-this.draggingRect.left,right:this.containerRect.right-this.draggingRect.right,top:this.containerRect.top-this.draggingRect.top,bottom:this.containerRect.bottom-this.draggingRect.bottom}):r==="track"?requestAnimationFrame(()=>{o&&this.maxTranslate.left<=o&&o<=this.maxTranslate.right?l=o:this.maxTranslate.left>o?l=this.maxTranslate.left:this.maxTranslate.right<o&&(l=this.maxTranslate.right),this.maxTranslate.top<=a&&a<=this.maxTranslate.bottom?h=a:this.maxTranslate.top>a?h=this.maxTranslate.top:this.maxTranslate.bottom<a&&(h=this.maxTranslate.bottom),t.style.transform=`translate(${l}px, ${h}px)`}):r==="end"&&(this.draggingRect=t.getBoundingClientRect(),setTimeout(()=>{t.xPos=this.draggingRect.left,t.yPos=this.draggingRect.top,t.style.removeProperty("transform"),t.style.removeProperty("will-change"),this.slottedElements.forEach(g=>{g.dragging=!1}),this.emitNewPosition({isInitialPlacement:!1,dragEnd:!0})},10)),this.emitNewPosition()}enforceContainment(){let s=this.dragContainer,n=this;if(window.getComputedStyle(this).position==="fixed"&&!this.hidden){let e=s.getBoundingClientRect(),i=n.getBoundingClientRect(),r=e.right-i.width;this.xPos=Math.max(e.left,Math.min(i.left,r));let o=e.bottom-i.height;this.yPos=Math.max(e.top,Math.min(i.top,o))}}resetPosition(){this.style.removeProperty("left"),this.style.removeProperty("right"),this.style.removeProperty("top"),this.style.removeProperty("bottom"),this.style.removeProperty("position"),this.style.removeProperty("transform"),this.style.removeProperty("will-change")}_xPosChanged(){this.style.left=`${this.xPos}px`,this.style.right="auto"}_yPosChanged(){this.style.top=`${this.yPos}px`,this.style.bottom="auto"}static get styles(){return[p,c`
        :host {
          border-radius: var(--vst-radius);
        }
      `]}render(){return m`<slot></slot>`}};customElements.define("vst-ui-draggable",u);export{u as a};
