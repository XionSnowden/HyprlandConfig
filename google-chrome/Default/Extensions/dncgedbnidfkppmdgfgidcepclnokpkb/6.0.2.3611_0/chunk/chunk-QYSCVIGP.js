import{f as W,h as Y}from"./chunk-CM6X6NVN.js";var j=W((K,H)=>{(function(r,h){typeof H=="object"&&H.exports?H.exports=h():r.nearley=h()})(K,function(){function r(t,n,a){return this.id=++r.highestId,this.name=t,this.symbols=n,this.postprocess=a,this}r.highestId=0,r.prototype.toString=function(t){var n=typeof t=="undefined"?this.symbols.map(q).join(" "):this.symbols.slice(0,t).map(q).join(" ")+" \u25CF "+this.symbols.slice(t).map(q).join(" ");return this.name+" \u2192 "+n};function h(t,n,a,o){this.rule=t,this.dot=n,this.reference=a,this.data=[],this.wantedBy=o,this.isComplete=this.dot===t.symbols.length}h.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},h.prototype.nextState=function(t){var n=new h(this.rule,this.dot+1,this.reference,this.wantedBy);return n.left=this,n.right=t,n.isComplete&&(n.data=n.build(),n.right=void 0),n},h.prototype.build=function(){var t=[],n=this;do t.push(n.right.data),n=n.left;while(n.left);return t.reverse(),t},h.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,k.fail))};function m(t,n){this.grammar=t,this.index=n,this.states=[],this.wants={},this.scannable=[],this.completed={}}m.prototype.process=function(t){for(var n=this.states,a=this.wants,o=this.completed,c=0;c<n.length;c++){var f=n[c];if(f.isComplete){if(f.finish(),f.data!==k.fail){for(var b=f.wantedBy,x=b.length;x--;){var T=b[x];this.complete(T,f)}if(f.reference===this.index){var w=f.rule.name;(this.completed[w]=this.completed[w]||[]).push(f)}}}else{var w=f.rule.symbols[f.dot];if(typeof w!="string"){this.scannable.push(f);continue}if(a[w]){if(a[w].push(f),o.hasOwnProperty(w))for(var A=o[w],x=0;x<A.length;x++){var P=A[x];this.complete(f,P)}}else a[w]=[f],this.predict(w)}}},m.prototype.predict=function(t){for(var n=this.grammar.byName[t]||[],a=0;a<n.length;a++){var o=n[a],c=this.wants[t],f=new h(o,0,this.index,c);this.states.push(f)}},m.prototype.complete=function(t,n){var a=t.nextState(n);this.states.push(a)};function d(t,n){this.rules=t,this.start=n||this.rules[0].name;var a=this.byName={};this.rules.forEach(function(o){a.hasOwnProperty(o.name)||(a[o.name]=[]),a[o.name].push(o)})}d.fromCompiled=function(t,n){var a=t.Lexer;t.ParserStart&&(n=t.ParserStart,t=t.ParserRules);var t=t.map(function(c){return new r(c.name,c.symbols,c.postprocess)}),o=new d(t,n);return o.lexer=a,o};function R(){this.reset("")}R.prototype.reset=function(t,n){this.buffer=t,this.index=0,this.line=n?n.line:1,this.lastLineBreak=n?-n.col:0},R.prototype.next=function(){if(this.index<this.buffer.length){var t=this.buffer[this.index++];return t===`
`&&(this.line+=1,this.lastLineBreak=this.index),{value:t}}},R.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},R.prototype.formatError=function(t,n){var a=this.buffer;if(typeof a=="string"){var o=a.split(`
`).slice(Math.max(0,this.line-5),this.line),c=a.indexOf(`
`,this.index);c===-1&&(c=a.length);var f=this.index-this.lastLineBreak,b=String(this.line).length;return n+=" at line "+this.line+" col "+f+`:

`,n+=o.map(function(T,w){return x(this.line-o.length+w+1,b)+" "+T},this).join(`
`),n+=`
`+x("",b+f)+`^
`,n}else return n+" at index "+(this.index-1);function x(T,w){var A=String(T);return Array(w-A.length+1).join(" ")+A}};function k(t,n,a){if(t instanceof d)var o=t,a=n;else var o=d.fromCompiled(t,n);this.grammar=o,this.options={keepHistory:!1,lexer:o.lexer||new R};for(var c in a||{})this.options[c]=a[c];this.lexer=this.options.lexer,this.lexerState=void 0;var f=new m(o,0),b=this.table=[f];f.wants[o.start]=[],f.predict(o.start),f.process(),this.current=0}k.fail={},k.prototype.feed=function(t){var n=this.lexer;n.reset(t,this.lexerState);for(var a;;){try{if(a=n.next(),!a)break}catch(z){var b=new m(this.grammar,this.current+1);this.table.push(b);var o=new Error(this.reportLexerError(z));throw o.offset=this.current,o.token=z.token,o}var c=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var f=this.current+1,b=new m(this.grammar,f);this.table.push(b);for(var x=a.text!==void 0?a.text:a.value,T=n.constructor===R?a.value:a,w=c.scannable,A=w.length;A--;){var P=w[A],S=P.rule.symbols[P.dot];if(S.test?S.test(T):S.type?S.type===a.type:S.literal===x){var V=P.nextState({data:T,token:a,isToken:!0,reference:f-1});b.states.push(V)}}if(b.process(),b.states.length===0){var o=new Error(this.reportError(a));throw o.offset=this.current,o.token=a,o}this.options.keepHistory&&(c.lexerState=n.save()),this.current++}return c&&(this.lexerState=n.save()),this.results=this.finish(),this},k.prototype.reportLexerError=function(t){var n,a,o=t.token;return o?(n="input "+JSON.stringify(o.text[0])+" (lexer error)",a=this.lexer.formatError(o,"Syntax error")):(n="input (lexer error)",a=t.message),this.reportErrorCommon(a,n)},k.prototype.reportError=function(t){var n=(t.type?t.type+" token: ":"")+JSON.stringify(t.value!==void 0?t.value:t),a=this.lexer.formatError(t,"Syntax error");return this.reportErrorCommon(a,n)},k.prototype.reportErrorCommon=function(t,n){var a=[];a.push(t);var o=this.table.length-2,c=this.table[o],f=c.states.filter(function(x){var T=x.rule.symbols[x.dot];return T&&typeof T!="string"});if(f.length===0)a.push("Unexpected "+n+`. I did not expect any more input. Here is the state of my parse table:
`),this.displayStateStack(c.states,a);else{a.push("Unexpected "+n+`. Instead, I was expecting to see one of the following:
`);var b=f.map(function(x){return this.buildFirstStateStack(x,[])||[x]},this);b.forEach(function(x){var T=x[0],w=T.rule.symbols[T.dot],A=this.getSymbolDisplay(w);a.push("A "+A+" based on:"),this.displayStateStack(x,a)},this)}return a.push(""),a.join(`
`)},k.prototype.displayStateStack=function(t,n){for(var a,o=0,c=0;c<t.length;c++){var f=t[c],b=f.rule.toString(f.dot);b===a?o++:(o>0&&n.push("    ^ "+o+" more lines identical to this"),o=0,n.push("    "+b)),a=b}},k.prototype.getSymbolDisplay=function(t){return Z(t)},k.prototype.buildFirstStateStack=function(t,n){if(n.indexOf(t)!==-1)return null;if(t.wantedBy.length===0)return[t];var a=t.wantedBy[0],o=[t].concat(n),c=this.buildFirstStateStack(a,o);return c===null?null:[t].concat(c)},k.prototype.save=function(){var t=this.table[this.current];return t.lexerState=this.lexerState,t},k.prototype.restore=function(t){var n=t.index;this.current=n,this.table[n]=t,this.table.splice(n+1),this.lexerState=t.lexerState,this.results=this.finish()},k.prototype.rewind=function(t){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[t])},k.prototype.finish=function(){var t=[],n=this.grammar.start,a=this.table[this.table.length-1];return a.states.forEach(function(o){o.rule.name===n&&o.dot===o.rule.symbols.length&&o.reference===0&&o.data!==k.fail&&t.push(o)}),t.map(function(o){return o.data})};function Z(t){var n=typeof t;if(n==="string")return t;if(n==="object"){if(t.literal)return JSON.stringify(t.literal);if(t instanceof RegExp)return"character matching "+t;if(t.type)return t.type+" token";if(t.test)return"token matching "+String(t.test);throw new Error("Unknown symbol type: "+t)}}function q(t){var n=typeof t;if(n==="string")return t;if(n==="object"){if(t.literal)return JSON.stringify(t.literal);if(t instanceof RegExp)return t.toString();if(t.type)return"%"+t.type;if(t.test)return"<"+String(t.test)+">";throw new Error("Unknown symbol type: "+t)}}return{Parser:k,Grammar:d,Rule:r}})});var te=W((ee,J)=>{(function(r,h){typeof define=="function"&&define.amd?define([],h):typeof J=="object"&&J.exports?J.exports=h():r.moo=h()})(ee,function(){"use strict";var r=Object.prototype.hasOwnProperty,h=Object.prototype.toString,m=typeof new RegExp().sticky=="boolean";function d(e){return e&&h.call(e)==="[object RegExp]"}function R(e){return e&&typeof e=="object"&&!d(e)&&!Array.isArray(e)}function k(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Z(e){var s=new RegExp("|"+e);return s.exec("").length-1}function q(e){return"("+e+")"}function t(e){if(!e.length)return"(?!)";var s=e.map(function(i){return"(?:"+i+")"}).join("|");return"(?:"+s+")"}function n(e){if(typeof e=="string")return"(?:"+k(e)+")";if(d(e)){if(e.ignoreCase)throw new Error("RegExp /i flag not allowed");if(e.global)throw new Error("RegExp /g flag is implied");if(e.sticky)throw new Error("RegExp /y flag is implied");if(e.multiline)throw new Error("RegExp /m flag is implied");return e.source}else throw new Error("Not a pattern: "+e)}function a(e){for(var s=Object.getOwnPropertyNames(e),i=[],l=0;l<s.length;l++){var v=s[l],u=e[v],y=[].concat(u);if(v==="include"){for(var E=0;E<y.length;E++)i.push({include:y[E]});continue}var _=[];y.forEach(function(p){R(p)?(_.length&&i.push(c(v,_)),i.push(c(v,p)),_=[]):_.push(p)}),_.length&&i.push(c(v,_))}return i}function o(e){for(var s=[],i=0;i<e.length;i++){var l=e[i];if(l.include){for(var v=[].concat(l.include),u=0;u<v.length;u++)s.push({include:v[u]});continue}if(!l.type)throw new Error("Rule has no type: "+JSON.stringify(l));s.push(c(l.type,l))}return s}function c(e,s){if(R(s)||(s={match:s}),s.include)throw new Error("Matching rules cannot also include states");var i={defaultType:e,lineBreaks:!!s.error||!!s.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var l in s)r.call(s,l)&&(i[l]=s[l]);if(typeof i.type=="string"&&e!==i.type)throw new Error("Type transform cannot be a string (type '"+i.type+"' for token '"+e+"')");var v=i.match;return i.match=Array.isArray(v)?v:v?[v]:[],i.match.sort(function(u,y){return d(u)&&d(y)?0:d(y)?-1:d(u)?1:y.length-u.length}),i}function f(e){return Array.isArray(e)?o(e):a(e)}var b=c("error",{lineBreaks:!0,shouldThrow:!0});function x(e,s){for(var i=null,l=Object.create(null),v=!0,u=null,y=[],E=[],_=0;_<e.length;_++)e[_].fallback&&(v=!1);for(var _=0;_<e.length;_++){var p=e[_];if(p.include)throw new Error("Inheritance is not allowed in stateless lexers");if(p.error||p.fallback){if(i)throw!p.fallback==!i.fallback?new Error("Multiple "+(p.fallback?"fallback":"error")+" rules not allowed (for token '"+p.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+p.defaultType+"')");i=p}var O=p.match.slice();if(v)for(;O.length&&typeof O[0]=="string"&&O[0].length===1;){var B=O.shift();l[B.charCodeAt(0)]=p}if(p.pop||p.push||p.next){if(!s)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+p.defaultType+"')");if(p.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+p.defaultType+"')")}if(O.length!==0){v=!1,y.push(p);for(var N=0;N<O.length;N++){var I=O[N];if(!!d(I)){if(u===null)u=I.unicode;else if(u!==I.unicode&&p.fallback===!1)throw new Error("If one rule is /u then all must be")}}var U=t(O.map(n)),M=new RegExp(U);if(M.test(""))throw new Error("RegExp matches empty string: "+M);var F=Z(U);if(F>0)throw new Error("RegExp has capture groups: "+M+`
Use (?: \u2026 ) instead`);if(!p.lineBreaks&&M.test(`
`))throw new Error("Rule should declare lineBreaks: "+M);E.push(q(U))}}var $=i&&i.fallback,G=m&&!$?"ym":"gm",D=m||$?"":"|";u===!0&&(G+="u");var oe=new RegExp(t(E)+D,G);return{regexp:oe,groups:y,fast:l,error:i||b}}function T(e){var s=x(f(e));return new S({start:s},"start")}function w(e,s,i){var l=e&&(e.push||e.next);if(l&&!i[l])throw new Error("Missing state '"+l+"' (in token '"+e.defaultType+"' of state '"+s+"')");if(e&&e.pop&&+e.pop!=1)throw new Error("pop must be 1 (in token '"+e.defaultType+"' of state '"+s+"')")}function A(e,s){var i=e.$all?f(e.$all):[];delete e.$all;var l=Object.getOwnPropertyNames(e);s||(s=l[0]);for(var v=Object.create(null),u=0;u<l.length;u++){var y=l[u];v[y]=f(e[y]).concat(i)}for(var u=0;u<l.length;u++)for(var y=l[u],E=v[y],_=Object.create(null),p=0;p<E.length;p++){var O=E[p];if(!!O.include){var B=[p,1];if(O.include!==y&&!_[O.include]){_[O.include]=!0;var N=v[O.include];if(!N)throw new Error("Cannot include nonexistent state '"+O.include+"' (in state '"+y+"')");for(var I=0;I<N.length;I++){var U=N[I];E.indexOf(U)===-1&&B.push(U)}}E.splice.apply(E,B),p--}}for(var M=Object.create(null),u=0;u<l.length;u++){var y=l[u];M[y]=x(v[y],!0)}for(var u=0;u<l.length;u++){for(var F=l[u],$=M[F],G=$.groups,p=0;p<G.length;p++)w(G[p],F,M);for(var D=Object.getOwnPropertyNames($.fast),p=0;p<D.length;p++)w($.fast[D[p]],F,M)}return new S(M,s)}function P(e){for(var s=Object.create(null),i=Object.create(null),l=Object.getOwnPropertyNames(e),v=0;v<l.length;v++){var u=l[v],y=e[u],E=Array.isArray(y)?y:[y];E.forEach(function(N){if((i[N.length]=i[N.length]||[]).push(N),typeof N!="string")throw new Error("keyword must be string (in keyword '"+u+"')");s[N]=u})}function _(N){return JSON.stringify(N)}var p="";p+=`switch (value.length) {
`;for(var O in i){var B=i[O];p+="case "+O+`:
`,p+=`switch (value) {
`,B.forEach(function(N){var I=s[N];p+="case "+_(N)+": return "+_(I)+`
`}),p+=`}
`}return p+=`}
`,Function("value",p)}var S=function(e,s){this.startState=s,this.states=e,this.buffer="",this.stack=[],this.reset()};S.prototype.reset=function(e,s){return this.buffer=e||"",this.index=0,this.line=s?s.line:1,this.col=s?s.col:1,this.queuedToken=s?s.queuedToken:null,this.queuedThrow=s?s.queuedThrow:null,this.setState(s?s.state:this.startState),this.stack=s&&s.stack?s.stack.slice():[],this},S.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedThrow:this.queuedThrow}},S.prototype.setState=function(e){if(!(!e||this.state===e)){this.state=e;var s=this.states[e];this.groups=s.groups,this.error=s.error,this.re=s.regexp,this.fast=s.fast}},S.prototype.popState=function(){this.setState(this.stack.pop())},S.prototype.pushState=function(e){this.stack.push(this.state),this.setState(e)};var V=m?function(e,s){return e.exec(s)}:function(e,s){var i=e.exec(s);return i[0].length===0?null:i};S.prototype._getGroup=function(e){for(var s=this.groups.length,i=0;i<s;i++)if(e[i+1]!==void 0)return this.groups[i];throw new Error("Cannot find token type for matched text")};function z(){return this.value}if(S.prototype.next=function(){var e=this.index;if(this.queuedGroup){var s=this._token(this.queuedGroup,this.queuedText,e);return this.queuedGroup=null,this.queuedText="",s}var i=this.buffer;if(e!==i.length){var l=this.fast[i.charCodeAt(e)];if(l)return this._token(l,i.charAt(e),e);var v=this.re;v.lastIndex=e;var u=V(v,i),y=this.error;if(u==null)return this._token(y,i.slice(e,i.length),e);var l=this._getGroup(u),E=u[0];return y.fallback&&u.index!==e?(this.queuedGroup=l,this.queuedText=E,this._token(y,i.slice(e,u.index),e)):this._token(l,E,e)}},S.prototype._token=function(e,s,i){var l=0;if(e.lineBreaks){var v=/\n/g,u=1;if(s===`
`)l=1;else for(;v.exec(s);)l++,u=v.lastIndex}var y={type:typeof e.type=="function"&&e.type(s)||e.defaultType,value:typeof e.value=="function"?e.value(s):s,text:s,toString:z,offset:i,lineBreaks:l,line:this.line,col:this.col},E=s.length;if(this.index+=E,this.line+=l,l!==0?this.col=E-u+1:this.col+=E,e.shouldThrow)throw new Error(this.formatError(y,"invalid syntax"));return e.pop?this.popState():e.push?this.pushState(e.push):e.next&&this.setState(e.next),y},typeof Symbol!="undefined"&&Symbol.iterator){var X=function(e){this.lexer=e};X.prototype.next=function(){var e=this.lexer.next();return{value:e,done:!e}},X.prototype[Symbol.iterator]=function(){return this},S.prototype[Symbol.iterator]=function(){return new X(this)}}return S.prototype.formatError=function(e,s){if(e==null)var i=this.buffer.slice(this.index),e={text:i,offset:this.index,lineBreaks:i.indexOf(`
`)===-1?0:1,line:this.line,col:this.col};var l=Math.max(0,e.offset-e.col+1),v=e.lineBreaks?e.text.indexOf(`
`):e.text.length,u=this.buffer.substring(l,e.offset+v);return s+=" at line "+e.line+" col "+e.col+`:

`,s+="  "+u+`
`,s+="  "+Array(e.col).join(" ")+"^",s},S.prototype.clone=function(){return new S(this.states,this.state)},S.prototype.has=function(e){return!0},{compile:T,states:A,error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:P}})});var Q=Y(j());var re=Y(te()),C=r=>r[0],g=re.default.compile({ws:/[ \t]+/,number:[{match:/\d*\.\d+[eE]-?\d+/},{match:/\d*\.\d+/},{match:/\d+[eE]-?\d+/},{match:/\d+/}],reservedFuncNames:/e[_a-df-zA-Z][_0-9a-zA-Z]*/,mathConst:[{match:/[Pp][Ii]/,value:r=>r.toLowerCase()},{match:/[Ee]/,value:r=>r.toLowerCase()}],and:/AND|&&/,or:/OR|\|\|/,not:/NOT|!/,xor:"XOR",variable:/\$[_a-zA-Z][_0-9a-zA-Z]*/,id:/[_a-zA-Z][_0-9a-zA-Z]*/,str1:{match:/"[^\"]*"/,value:r=>r.slice(1,-1)},str2:{match:/'[^\']*'/,value:r=>r.slice(1,-1)},plus:"+",minus:"-",multiply:"*",divide:"/",exponent:"^",lparen:"(",rparen:")",comma:","}),ne={Lexer:g,ParserRules:[{name:"main",symbols:["_","expr","_"],postprocess:r=>({expr:r[1]})},{name:"expr",symbols:["expr","_",g.has("plus")?{type:"plus"}:plus,"_","multdiv"],postprocess:r=>({type:"ADD",left:r[0],right:r[4]})},{name:"expr",symbols:["expr","_",g.has("minus")?{type:"minus"}:minus,"_","multdiv"],postprocess:r=>({type:"SUB",left:r[0],right:r[4]})},{name:"expr",symbols:["expr","_",g.has("and")?{type:"and"}:and,"_","multdiv"],postprocess:r=>({type:"AND",left:r[0],right:r[4]})},{name:"expr",symbols:["expr","_",g.has("or")?{type:"or"}:or,"_","multdiv"],postprocess:r=>({type:"OR",left:r[0],right:r[4]})},{name:"expr",symbols:["expr","_",g.has("xor")?{type:"xor"}:xor,"_","multdiv"],postprocess:r=>({type:"XOR",left:r[0],right:r[4]})},{name:"expr",symbols:["multdiv"],postprocess:C},{name:"multdiv",symbols:["multdiv","_",g.has("multiply")?{type:"multiply"}:multiply,"_","prefix"],postprocess:r=>({type:"MULT",left:r[0],right:r[4]})},{name:"multdiv",symbols:["multdiv","_",g.has("divide")?{type:"divide"}:divide,"_","prefix"],postprocess:r=>({type:"DIV",left:r[0],right:r[4]})},{name:"multdiv",symbols:["prefix"],postprocess:C},{name:"prefix",symbols:[g.has("minus")?{type:"minus"}:minus,"_","factor"],postprocess:r=>({type:"UMINUS",factor:r[2]})},{name:"prefix",symbols:[g.has("not")?{type:"not"}:not,"_","factor"],postprocess:r=>({type:"NOT",factor:r[2]})},{name:"prefix",symbols:["factor"],postprocess:C},{name:"factor",symbols:["exp","_","factor"],postprocess:r=>({type:"MULT",left:r[0],right:r[2]})},{name:"factor",symbols:["exp"],postprocess:C},{name:"exp",symbols:["term","_",g.has("exponent")?{type:"exponent"}:exponent,"_","exp"],postprocess:r=>({type:"EXP",left:r[0],right:r[4]})},{name:"exp",symbols:["term"],postprocess:C},{name:"term",symbols:["number"],postprocess:C},{name:"term",symbols:["paren_expr"],postprocess:C},{name:"term",symbols:["func"],postprocess:C},{name:"term",symbols:["str"],postprocess:C},{name:"term",symbols:["const"],postprocess:C},{name:"term",symbols:["var"],postprocess:C},{name:"funcName",symbols:[g.has("id")?{type:"id"}:C]},{name:"funcName",symbols:[g.has("reservedFuncNames")?{type:"reservedFuncNames"}:reservedFuncNames]},{name:"func",symbols:["funcName","_",g.has("lparen")?{type:"lparen"}:lparen,"_","args","_",g.has("rparen")?{type:"rparen"}:rparen],postprocess:r=>({type:"FUNCTION",name:r[0][0].value,args:r[4]})},{name:"args",symbols:["_","args","_",g.has("comma")?{type:"comma"}:comma,"_","expr","_"],postprocess:r=>[...r[1]].concat(r[5])},{name:"args",symbols:["_","expr","_"],postprocess:r=>[r[1]]},{name:"args",symbols:["_"],postprocess:r=>[]},{name:"paren_expr",symbols:[g.has("lparen")?{type:"lparen"}:lparen,"_","expr","_",g.has("rparen")?{type:"rparen"}:rparen],postprocess:r=>({type:"PARENS",expr:r[2]})},{name:"number",symbols:[g.has("number")?{type:"number"}:number],postprocess:r=>({type:"NUMBER",value:r[0].value})},{name:"str",symbols:[g.has("str1")?{type:"str1"}:str1],postprocess:r=>({type:"STRING",value:r[0].value})},{name:"str",symbols:[g.has("str2")?{type:"str2"}:str2],postprocess:r=>({type:"STRING",value:r[0].value})},{name:"const",symbols:[g.has("mathConst")?{type:"mathConst"}:mathConst],postprocess:r=>({type:"CONST",name:r[0].value})},{name:"var",symbols:[g.has("variable")?{type:"variable"}:variable],postprocess:r=>({type:"VAR",name:r[0].value})},{name:"_$ebnf$1",symbols:[]},{name:"_$ebnf$1",symbols:["_$ebnf$1",g.has("ws")?{type:"ws"}:ws],postprocess:function(h){return h[0].concat([h[1]])}},{name:"_",symbols:["_$ebnf$1"],postprocess:r=>null}],ParserStart:"main"};var le=Q.default.Grammar.fromCompiled(ne),se=class{constructor(h){this.name=h.functionId,this.category=h.category,this.arityMin=h.numRequiredArguments,this.arityMax=h.arguments.length,this.arguments=h.arguments,this.hidden=h.hidden}get nameAndArugments(){let h="";for(let m=0;m<this.arguments.length;m++){let d=this.arguments[m];d.isOptional||(m!==0&&(h+=", "),h+=d.argId)}return`${this.name}(${h})`}},ae=[],ie={},L=(r,h,m)=>{switch(r.type){case"ADD":case"SUB":case"MULT":case"DIV":case"EXP":case"AND":case"OR":case"XOR":L(r.left,h,m),L(r.right,h,m);break;case"FUNCTION":{let d=ie[r.name.toLowerCase()];if(!d)throw new Error(`Built-in function not found: ${r.name}`);let R=r.args.length;if(R<d.arityMin||R>d.arityMax)throw new Error(`Invalid number of arguments to ${r.name}, expected ${d.arity}, found ${r.args.length}`);r.args.forEach(k=>L(k,h,m));break}case"PARENS":L(r.expr,h,m);break;case"CONST":switch(r.name){case"pi":r.value=Math.PI;break;case"e":r.value=Math.E;break;default:throw new Error(`Invalid constant found: ${r.name}`)}break;case"VAR":{r.value=NaN;break}case"NUMBER":break;case"STRING":if(r.columnGroupId=h(r.value),r.columnGroupId<0)throw new Error(`Failed to lookup column: ${r.value}`);break;case"UMINUS":case"NOT":L(r.factor,h,m);break;case"ID":break;default:throw new Error(`Found unhandled parse node type: ${r.type}`)}},ue=class{constructor(h){this._userConstants=[],this._userConstantMap={},h.forEach(m=>{this._userConstants.push(m),this._userConstantMap[m.name]=m})}static initializeFunctions(h){h.forEach(m=>{let d=new se(m);ae.push(d),ie[d.name.toLowerCase()]=d})}static get functionList(){return ae}get constantList(){return this._userConstants}parse(h){let m=new Q.default.Parser(le);m.feed(h);let d=null;if(Array.isArray(m?.results)&&m.results.length>0)[d]=m.results;else throw new Error("Parse Error");return d}processResult(h,m){L(h.expr,m,this._userConstantMap)}};export{ue as a};
