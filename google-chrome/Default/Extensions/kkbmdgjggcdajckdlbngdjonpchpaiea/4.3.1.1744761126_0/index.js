!function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,(function(e){return o(t[a][1][e]||e)}),l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}var a=e("./debug"),s=a.cmdLog,c=a.errLog,u=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lockedUntil=new Date,this.classPasses=[],this.lastLock=null,this.activePolicy=null,this.unlockWatcherInt=setInterval((function(){var e=new Date;t.lastLock&&e-t.lockedUntil>0&&t.unlock({action:"unlock",data:t.lastLock})}),15e3),"undefined"!=typeof chrome&&void 0!==chrome.extension&&chrome.extension.onMessage.addListener((function(e,n,r){if(n.id===chrome.runtime.id){if("?"===e.locked){var o=t.classPasses[0]||t.lastLock;o&&r({action:"lock",data:o})}"checkIn"===e.locked&&t.includesPassId(e.passId)&&(t.activePolicy.returnPass(t.classPasses),t.unlock({action:"unlock",type:"pass"}))}}))}var t,n,i;return t=e,(n=[{key:"mapToIds",value:function(e){if(!Array.isArray(e))throw new Error("Input must be an array");return e.map((function(e){return e.passId}))}},{key:"includesPassId",value:function(e){return this.mapToIds(this.classPasses).includes(e)}},{key:"applyBindings",value:function(e){if("object"!==r(e))throw new Error("channel required");void 0!==e.subscribe&&(e.subscribe("tm",this.teacherMessage.bind(this)),e.subscribe("url",this.openTab.bind(this)),e.subscribe("lock",this.lock.bind(this)),e.subscribe("unlock",this.unlock.bind(this)),e.subscribe("policyUpdate",this.policyUpdate.bind(this)),e.subscribe("setState",this.setState.bind(this)),e.subscribe("startRecording",this.startRecording.bind(this)),e.subscribe("updateExtension",this.updateExtension.bind(this)),e.subscribe("classpass",this.classpass.bind(this)))}},{key:"teacherMessage",value:function(e){if("object"!==r(e))throw new Error("message object required");if((!this.activePolicy||this.activePolicy.isClassroomActive())&&void 0!==chrome.notifications){var t={type:chrome.notifications.TemplateType.BASIC,iconUrl:chrome.extension.getURL("assets/icon48.png"),title:"Classroom",message:e.data.m,priority:2,requireInteraction:!0,buttons:[{title:"Yes"},{title:"No"}]},n=e.data.mId||1,o="mtype-"+n;[2,3].includes(n)||(o=null,t.buttons=null,t.requireInteraction=!1),chrome.notifications.create(o,t)}}},{key:"openTab",value:function(e){if(s("[openTab] ->",e),"object"!==r(e))throw new Error("message object required");if((!this.activePolicy||this.activePolicy.isClassroomActive())&&void 0!==chrome.tabs)try{chrome.windows.getAll({populate:!0},(function(t){0===t.length?chrome.windows.create({url:e.data}):chrome.tabs.create({url:e.data})}))}catch(e){c("[openTab] ->",e)}}},{key:"lock",value:function(e){var t=this;if("object"!==r(e))throw new Error("message object required");if((!this.activePolicy||this.activePolicy.isClassroomActive())&&void 0!==chrome.tabs){var n;if("object"===r(e.data)&&e.data.lockMessage&&e.data.lockMessage,this.lastLock=e.data,this.lastLock.type="lock",this.activePolicy&&this.activePolicy.lockExpiration&&this.activePolicy.lockExpiration>-1){var o=new Date(0);o.setUTCSeconds(this.activePolicy.lockExpiration),n=o}if(n&&n>new Date?this.lockedUntil=n:this.lockedUntil=new Date((new Date).getTime()+3e5),this.classPasses.length>0)return void s("[lock] classPasses ->",this.classPasses);try{chrome.windows.getCurrent((function(e){"fullscreen"===e.state&&chrome.windows.update(e.id,{state:"normal"})}))}catch(e){c("[lock] tab getCurrent error ->",e)}try{s("[lock] ->",this.lastLock),chrome.tabs.query({},(function(e){e.forEach((function(e){chrome.tabs.sendMessage(e.id,{action:"lock",data:t.lastLock},(function(){}))}))}))}catch(e){c("[lock] tab sendMessage error ->",e)}}}},{key:"unlock",value:function(e){if("object"!==r(e))throw new Error("message object required");if(e.type&&"pass"===e.type?(this.classPasses=[],this.setState({data:"ready",activePass:"false"})):this.lastLock=null,this.classPasses.length>0)s("[unlock] active passes ->",this.classPasses);else if(s("[unlock]"),void 0!==chrome.tabs)try{chrome.tabs.query({},(function(e){e.forEach((function(e){chrome.tabs.sendMessage(e.id,{action:"unlock"},(function(){}))}))}))}catch(e){c("[unlock] tab sendMessage error ->",e)}}},{key:"policyUpdate",value:function(e){if("object"!==r(e))throw new Error("message object required");if("undefined"!=typeof Event){var t=new Event("policyUpdate");t.triggeredAt=e.data.at,document.dispatchEvent(t)}}},{key:"setState",value:function(e){if("object"!==r(e))throw new Error("message object required");if(!this.activePolicy||this.activePolicy.isClassroomActive()){var t=new Event("setState");t.newState=e.data,e.activePass&&(t.activePass=e.activePass),document.dispatchEvent(t)}}},{key:"startRecording",value:function(e){if("object"!==r(e))throw new Error("message object required");if(!this.activePolicy||this.activePolicy.isClassroomActive()){if("object"!==r(e.data))throw new Error("message must have a data object");if("number"!=typeof e.data.duration)throw new Error("message requires a duration");var t=new Event("startRecording");t.duration=1e3*e.data.duration,document.dispatchEvent(t)}}},{key:"updateExtension",value:function(e){if("object"!==r(e))throw new Error("message object required");chrome.runtime.requestUpdateCheck((function(){}))}},{key:"activePasses",value:function(e){var t=this;if(s("[activePasses] ->",e),e&&e.passes&&0!==e.passes.length){for(var n=e.passes.map((function(e){return e.id})),r=0;r<n.length;r++)this.classPasses.push({passId:n[r],type:"pass",lockMessage:"Pass in Use"});if(this.classPasses.length>0){this.setState({data:"ready",activePass:"true"});try{chrome.windows.getCurrent((function(e){"fullscreen"===e.state&&chrome.windows.update(e.id,{state:"normal"})}))}catch(e){c("[lock] tab getCurrent error ->",e)}try{chrome.tabs.query({},(function(e){e.forEach((function(e){chrome.tabs.sendMessage(e.id,{action:"lock",data:t.classPasses[0]},(function(){}))}))}))}catch(e){c("[lock] tab sendMessage error ->",e)}}}}},{key:"classpass",value:function(e){if("object"!==r(e))throw new Error("message object required");if(!this.activePolicy||this.activePolicy.isClassroomActive()){var t=e.data;if("string"==typeof t&&(t=JSON.parse(t)),"string"!=typeof t.passId)throw new Error("message must have a pass id");if(s("[classpass] ->",t),"clear"===t.action&&this.classPasses.length>0&&this.unlock({action:"unlock",type:"pass"}),"create"===t.action){t={passId:t.passId,type:"pass",lockMessage:"Pass in Use"},this.classPasses.push(t),this.setState({data:"ready",activePass:"true"});try{chrome.windows.getCurrent((function(e){"fullscreen"===e.state&&chrome.windows.update(e.id,{state:"normal"})}))}catch(e){c("[lock] tab getCurrent error ->",e)}try{chrome.tabs.query({},(function(e){e.forEach((function(e){chrome.tabs.sendMessage(e.id,{action:"lock",data:t},(function(){}))}))}))}catch(e){c("[lock] tab sendMessage error ->",e)}}}}}])&&o(t.prototype,n),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.exports=u},{"./debug":3}],2:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),s=new I(r||[]);return a(i,"_invoke",{value:C(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",v="executing",y="completed",g={};function m(){}function b(){}function w(){}var k={};f(k,c,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==n&&i.call(E,c)&&(k=E);var O=w.prototype=m.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,a,s,c){var u=p(e[o],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==r(f)&&i.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var u=p(t,n,r);if("normal"===u.type){if(o=r.done?y:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(i.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(r(t)+" is not iterable")}return b.prototype=w,a(O,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),f(x.prototype,u,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),f(O,l,"Generator"),f(O,c,(function(){return this})),f(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function i(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)}))}}var s,c,u=e("./debug"),l=u.cfgLog,f=u.debugEnable,h=u.debugDisable;function p(e){return new Promise((function(t){chrome.storage.local.get([e],(function(n){n&&t(n[e])}))}))}function d(e){return v.apply(this,arguments)}function v(){return(v=a(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.set(t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=a(o().mark((function e(){var t,n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p("debug");case 2:return"string"==typeof(t=e.sent)&&""!==t&&(f(t),console.log("[Setup] debug enabled ->",t)),e.next=6,p("bitrate");case 6:return"number"==typeof(n=e.sent)&&n>0&&l("[Setup] bitrate ->",s=n),e.next=10,p("jpegQuality");case 10:"number"==typeof(r=e.sent)&&r>0&&r<=100&&l("[Setup] jpegQuality ->",c=r);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=a(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p("identInt");case 2:if(!("number"==typeof(t=e.sent)&&t>=6e4&&t<=648e5)){e.next=5;break}return e.abrupt("return",t);case 5:return e.abrupt("return",648e5);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.exports.ClearStorage=function(e){chrome.storage.local.remove(e)},t.exports.Debug=function(e){e&&"string"==typeof e?(d({debug:e}),chrome.runtime.reload()):h()},t.exports.GetBitrate=function(){return s||6e3},t.exports.GetIdentInt=function(){return g.apply(this,arguments)},t.exports.GetJpegQuality=function(){return c},t.exports.GetStorage=p,t.exports.SetBitrate=function(e){"number"==typeof e&&e>=3e3&&e<=7e3?(l("[SetBitrate] ->",s=e),d({bitrate:s})):l("[SetBitrate] -> invalid value")},t.exports.SetIdentInt=function(e){l("[SetIdentInt] ->",e),d({identInt:e})},t.exports.SetJpegQuality=function(e){"number"==typeof e&&e>0&&e<=100&&(l("[SetJpegQuality] ->",c=e),d({jpegQuality:c}))},t.exports.SetStorage=d,t.exports.Setup=function(){return y.apply(this,arguments)}},{"./debug":3}],3:[function(e,t,n){"use strict";function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),s=new I(r||[]);return a(i,"_invoke",{value:C(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",v="executing",y="completed",g={};function m(){}function b(){}function w(){}var k={};f(k,c,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==n&&i.call(E,c)&&(k=E);var O=w.prototype=m.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(r,a,s,c){var u=p(e[r],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==o(f)&&i.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var r;a(this,"_invoke",{value:function(e,o){function i(){return new t((function(t,r){n(e,o,t,r)}))}return r=r?r.then(i,i):i()}})}function C(t,n,r){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var u=p(t,n,r);if("normal"===u.type){if(o=r.done?y:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(o(t)+" is not iterable")}return b.prototype=w,a(O,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),f(x.prototype,u,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),f(O,l,"Generator"),f(O,c,(function(){return this})),f(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)}))}}var s,c,u,l,f,h,p=e("debug"),d=e("@twilio/rtc-diagnostics").testMediaConnectionBitrate,v=p("ls-classroom:commands"),y=p("ls-classroom:config"),g=p("ls-classroom:group"),m=p("ls-classroom:policy"),b=p("ls-classroom:real_time"),w=p("ls-classroom:rtc_handler"),k=p("ls-classroom:rtc_connection"),_=p("ls-classroom:s3"),E=p("ls-classroom:scheduler"),O=p("ls-classroom:snapshot"),S=p("ls-classroom:tab_capture"),x=p("ls-classroom:tab_reporter"),C=p("ls-classroom:tabs"),A=p("ls-classroom:telemetry"),T=p("ls-classroom:user"),P=p("ls-classroom:wasm"),I=p.log;function j(){p.disable()}function R(e){p.enable(e)}function L(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];c&&c.publish("remoteDebug",t[0]+t[1].message),console.error(t)}function M(){return U.apply(this,arguments)}function U(){return(U=a(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p.log=I,j(),f&&(clearTimeout(f),f=void 0),!c){e.next=13;break}return e.prev=4,e.next=7,c.detach();case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),y("[disableRemoteDebug]",e.t0);case 12:c=void 0;case 13:case"end":return e.stop()}}),e,null,[[4,9]])})))).apply(this,arguments)}function N(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];I.apply(p,t);try{t.splice(1,3);for(var r="",i=0;i<t.length;i++)"object"===o(t[i])?r+=JSON.stringify(t[i],D()):r+="".concat(t[i]);var a=(new TextEncoder).encode(r).length;a>65536&&(r=r.substring(0,65536)),r=r.replace(/%c/g,""),c.publish("remoteDebug",r)}catch(e){L("[logRedirector]",e)}}function D(){var e=new WeakSet;return function(t,n){if("object"===o(n)&&null!==n){if(e.has(n))return"[circular]";e.add(n)}return n}}function G(){var e=d({iceServers:h});e.on("error",(function(e){L("[mediaConnectionBitrateTest]",e)})),e.on("end",(function(e){y("[mediaConnectionBitrateTest] results: ",e)})),setTimeout((function(){e.stop()}),1e4)}t.exports={cmdLog:v,cfgLog:y,grpLog:g,polLog:m,rltLog:b,rthLog:w,rtcLog:k,s3Log:_,schLog:E,sshLog:O,tbcLog:S,tbrLog:x,tbsLog:C,telLog:A,usrLog:T,wsmLog:P,errLog:L,debugDisable:j,debugEnable:R,debugIceServers:function(e){h=e},remoteDebug:function(e){""!==e?(c=s.channels.get("".concat(u,":").concat(l,":debug")),p.log=N,R(e),y("[EnableRemoteDebug] scope ->",e),f&&clearTimeout(f),f=setTimeout(M,6e5)):M()},debugSetAbly:function(e,t,n){s=e,l=t,u=n},twilioDiagnostics:function(e){h?"bitrate"===e&&(y("[twilioDiagnostics] running bitrate test"),setTimeout(G,5e3)):y("[twilioDiagnostics] iceServers not set")}}},{"@twilio/rtc-diagnostics":29,debug:100}],4:[function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var c=e("./debug").grpLog,u=e("./insights"),l=["currentHost","favico","state","visits","top","topTime","visitMap","insightHost","selectedQuickPollOption"],f={currentHost:"",favico:"",state:"working",visits:0,top:"",topTime:0,visitMap:{}},h=function e(t){var n={};return t&&"object"===s(t)&&Object.keys(t).forEach((function(r){"object"===s(t[r])?n[r]=e(t[r]):n[r]=t[r]})),n},p=function(){function e(t,n,r){var o=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"object"!==s(t))throw new Error("group attributes required");if(void 0===t.id)throw new Error("group id required");if("object"!==s(n))throw new Error("ably object required");if("string"!=typeof r)throw new Error("customerId required");this.id=t.id,this.ably=n,this.reconfigure(t),this.customerId=r,this.attributes=h(f),this.resume(),this.isActive()&&this.sendUpdate(),this.checkStateInt=setInterval((function(){var e=new Date;o.isActive()||void 0!==o.attributes.lastModified&&e-o.attributes.lastModified>9e5&&(o.attributes=h(f),"undefined"!=typeof localStorage&&delete localStorage["group:".concat(o.id,":checkpoint")])}),3e5),this.insights=new u,this.insights.addListener((function(e){c("[insight] triggered ->",e),o.updateInsight(e)})),this.pausedInternetCheck()}var t,n,o;return t=e,(n=[{key:"setAttrs",value:function(e){var t=this;if("object"!==s(e))throw new Error("new attributes required");var n=Object.keys(e);0!==n.length&&(n.forEach((function(e){if(-1===l.indexOf(e))throw new Error("".concat(e," is not a valid attribute"))})),void 0!==e.state&&(this.attributes.state=e.state,this.attributes.lastModified=new Date),this.isActive()&&(n.forEach((function(n){t.attributes[n]=e[n]})),this.attributes.lastModified=new Date))}},{key:"isActive",value:function(){return document.IsGroupActive(this.id)}},{key:"setTop",value:function(){var e=this,t=!1;Object.keys(this.attributes.visitMap).forEach((function(n){e.attributes.top!==n&&e.attributes.topTime<e.attributes.visitMap[n].timeSec?(e.setAttrs({topTime:e.attributes.visitMap[n].timeSec,top:n}),t=!0):e.attributes.top===n&&e.setAttrs({topTime:e.attributes.visitMap[n].timeSec})})),t&&(this.setCheckpoint(),this.sendUpdate())}},{key:"sendUpdate",value:function(){var e=this;this.sendUpdateTO||this.policy&&!this.policy.isClassroomActive()||this.isActive()&&(this.sendUpdateTO=setTimeout((function(){if(clearTimeout(e.sendUpdateTO),delete e.sendUpdateTO,"undefined"!=typeof document&&"function"==typeof document.dispatchEvent){var t=new Event("GroupUpdate");t.groupId=e.id,t.attributes=e.attributes,document.dispatchEvent(t)}}),1e3))}},{key:"initializeHost",value:function(e){if("string"!=typeof e)throw new Error("host required");void 0===this.attributes.visitMap[e]&&(this.attributes.visitMap[e]={cnt:0,timeSec:0})}},{key:"incrementVisits",value:function(e){if("string"!=typeof e)throw new Error("host required");this.isActive()&&(this.initializeHost(e),this.attributes.visitMap[e].cnt++,this.setAttrs({visits:this.attributes.visits+1}),this.setCheckpoint(),this.sendUpdate())}},{key:"incrementHostTime",value:function(e,t){if("string"!=typeof e)throw new Error("host required");if("number"!=typeof t)throw new Error("seconds must be a number");this.isActive()&&(this.initializeHost(e),this.attributes.visitMap[e].timeSec+=t,this.setCheckpoint(),this.setTop())}},{key:"setCurrent",value:function(e,t){if("string"!=typeof e)throw new Error("host required");if(this.isActive()){var n=!1,r={};this.attributes.currentHost!==e&&(r.currentHost=e,n=!0),this.attributes.favico!==t&&(r.favico=t,n=!0),n&&(this.setAttrs(r),this.setCheckpoint(),this.sendUpdate())}}},{key:"setState",value:function(e){if("string"!=typeof e)throw new Error("state required");c("[setState] update ->",e),this.attributes.state!==e&&(this.setAttrs({state:e}),c("[setState] attributes ->",this.attributes),this.setCheckpoint())}},{key:"setCheckpoint",value:function(){var e=h(this.attributes);e.createdAt=(new Date).toISOString(),"undefined"!=typeof localStorage&&localStorage.setItem("group:".concat(this.id,":checkpoint"),JSON.stringify(e))}},{key:"resume",value:function(){if("undefined"!=typeof localStorage){var e=localStorage.getItem("group:".concat(this.id,":checkpoint"));if(e){var t=new Date;(e=JSON.parse(e)).createdAt=new Date(e.createdAt),e.createdAt.getYear()===t.getYear()&&e.createdAt.getMonth()===t.getMonth()&&e.createdAt.getDay()===t.getDay()&&(delete e.createdAt,this.attributes=e)}}}},{key:"scoreUrl",value:function(e){var t=this;if(c("[scoreUrl]: ",{id:this.id,url:e}),"string"!=typeof e)throw new Error("url must be a string");var n={};return this.isActive()&&this.filterSites?(c("[scoreUrl] active and filtering sites\nAllow when done: ",{allow:this.allowWhenDone,state:this.attributes.state}),n.allowed=this.blockSites,this.allowWhenDone&&"done"===this.attributes.state?n.allowed=!0:this.sites.some((function(r){if(c("[scoreUrl.sites] check using filter ->",r),Array.isArray(r)){c("[scoreUrl.sites] check using hostname checking");var o=document.createElement("A");o.href=e;var i=o.hostname.split("."),a=r.length,s=i.length;if(a<=s){for(var u=0;u<a;u++)if(r[a-1-u]!==i[s-1-u])return!1;return n.allowed=!t.blockSites,!0}}else if(c("[scoreUrl.sites] check using regex"),e.match(r))return c("[scoreUrl.sites] check match using filter ->",r),n.allowed=!t.blockSites,!0}))):c("[scoreUrl] disabled, active: ",{active:this.isActive(),filterSites:this.filterSites}),c("[scoreUrl] returning ->",n),n}},{key:"addUrl",value:function(e){if("string"!=typeof e)throw new Error("url must be a string");this.filterSites=!0,e.match(/\//)?this.sites.push(new RegExp(e.replace(/[\]{}?^$().*\\+|[]/g,"\\$&").replace(/^[^:]+:/,"^[^:]+:")+".*","i")):this.sites.push(e.split("."))}},{key:"updateInsight",value:function(e){if("string"!=typeof e)throw new Error("hostname must be a string");this.isActive()&&(this.setAttrs({insightHost:e}),this.sendUpdate())}},{key:"reconfigure",value:function(e){var t=this;if("object"!==s(e))throw new Error("attributes required");if(this.id!==e.id)throw new Error("group ID mismatch");if(this.filterSites=!1,this.allowWhenDone=!1,this.blockSites=!1,this.encryptedUserEmail=void 0,delete this.quickPoll,this.sites=[],e.web_rules)for(var n=0,o=Object.entries(e.web_rules);n<o.length;n++){var i=r(o[n],2),a=i[0],c=i[1];switch(a){case"sites":this.filterSites=!0,Array.isArray(c)&&c.forEach((function(e){t.addUrl(e)}));break;case"allow_when_done":this.allowWhenDone=c;break;case"blocked":this.blockSites=c;break;case"encryptedUserEmail":this.encryptedUserEmail=c;break;case"encryptedCustomerId":this.encryptedCustomerId=c}}this.pausedInternetCheck()}},{key:"selectQuickPollOption",value:function(e){if(void 0===e)throw new Error("option required");if(void 0===this.quickPoll)throw new Error("no poll active");if(-1===this.quickPoll.options.indexOf(e))throw new Error("invalid quickPoll option");this.setAttrs({selectedQuickPollOption:e})}},{key:"pausedInternetCheck",value:function(){this.isActive()&&this.policy&&this.filterSites&&!this.blockSites&&0===this.sites.length&&(c("[pausedInternetCheck] internet paused ->",this.id),this.policy.internetPaused=this.id)}}])&&i(t.prototype,n),o&&i(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.exports=p},{"./debug":3,"./insights":7}],5:[function(e,t,n){"use strict";function r(e){Object.keys(e).forEach((function(t){var n=e[t];"function"==typeof n&&Object.defineProperty(e,t,{value:n,writable:!1,configurable:!1})}))}window.LSClassroom=e("./config"),r(chrome.identity),r(window.LSClassroom),window.LSClassroom.Setup(),window.LSClassroomWASM=e("./wasm"),e("./telemetry"),e("./real_time")},{"./config":2,"./real_time":9,"./telemetry":17,"./wasm":19}],6:[function(e,t,n){"use strict";t.exports={threshold:5,sites:["abcmouse.com","abcnews.go.com","abcya.com","acceleratelearning.com","accounts.google.com","aceable.com","achieve3000.com","activeclassroom.com","activelylearn.com","actstudent.org","adobe.com","adobelogin.com","adrift.org.au","aeseducation.com","agilixbuzz.com","airast.org","aleks.com","allinlearning.com","amazonaws.com","amplify.com","analyze-ed.com","aohghmighlieiainnegkcijnfilokake","apexlearning.com","app.typingagent.com","appengine.google.com","apple.com","applytexas.org","arcbookshelf.com","arizona.edu","assessmenttechnology.com","ati-online.com","auth0.com","avantassessment.com","beinternetawesome.withgoogle.com","bibliocommons.com","biblionasium.com","bibme.org","bigideaslearning.magicsw.com","bigideasmath.com","bing.com","biography.com","bit.ly","blackboard.com","bls.gov","bookcreator.com","books.google.com","boomlearning.com","bpmcpldpdmajfigpchkicefoigmkfalc","brainly.com","brainpop.com","brightspace.com","britannica.com","burlesonisd.net","calendar.google.com","calorieking.com","cambridge.org","canva.com","canvaslms.com","careercruising.com","castlelearning.com","cdc.gov","charmsoffice.com","checkology.org","choosemyplate.gov","chrome.google.com","cia.gov","citationmachine.net","ck12.org","ckschools.org","classcraft.com","classflow.com","classkick.com","classlink.com","classroom.google.com","classzone.com","clever.com","cliffsnotes.com","code.org","codehs.com","collegefortn.org","colorado.edu","commonapp.org","commoncoresheets.com","commonlit.org","conjuguemos.com","connexus.com","coolmath-games.com","coolmath.com","coolmathgames.com","coursekit.google.com","cpm.org","craighighschool.org","creektube.net","cse.google.com","culturegrams.com","deck.toys","deltamath.com","desire2learn.com","desmos.com","dictionary.com","discoveryeducation.com","dochub.com","docs.google.com","doubleclick.net","drawn.digifi.ca","drcedirect.com","dreambox.com","drive.google.com","driversed.com","duckduckgo.com","ducksters.com","duolingo.com","eadms.com","earth.google.com","easybib.com","easycbm.com","eb.com","ecnphlgnajanjnkcmbpancdjoidceilk","ecollege.com","ed.gov","edgenuity.com","edmentum.com","edmodo.com","edpuzzle.com","edready.org","education.com","educationgalaxy.com","edugence.com","edulastic.com","edutyping.com","eia.gov","enotes.com","eventbrite.com","everfi.net","explorelearning.com","exploros.com","fanfox.net","fcboe.org","firstinmath.com","flipgrid.com","fliphtml5.com","flocabulary.com","follettdestiny.com","follettsoftware.com","freckle.com","freerice.com","frontrowed.com","g-wonlinetextbooks.com","gadoe.org","gafutures.org","gale.com","galegroup.com","gavirtualschool.org","gcaconnect.org","geniussis.com","getepic.com","getfueled.com","gimkit.com","gmc.mrooms3.net","goformative.com","goo.gl","goodreads.com","googletune.com","googleusercontent.com","grammarly.com","gstatic.com","hacksawengineering.com","hangouts.google.com","healthline.com","hillcollege.edu","history.google.com","hmhco.com","hoodamath.com","hrw.com","hudl.com","i-ready.com","icevonline.com","icivics.org","infinitecampus.com","inkling.com","inscloudgate.net","instructure.com","ipv4.google.com","istation.com","isteepdata.com","ivytech.edu","ixl.com","janesvilleparker.org","jlab.org","jostens.com","jstor.org","k12.al.us","k12.az.us","k12.ca.us","k12.co.us","k12.com","k12.de.us","k12.fl.us","k12.ga.us","k12.ia.us","k12.id.us","k12.il.us","k12.in.us","k12.ks.us","k12.ky.us","k12.la.us","k12.ma.us","k12.mi.us","k12.mn.us","k12.mo.us","k12.ms.us","k12.mt.us","k12.nc.us","k12.nh.us","k12.nj.us","k12.nm.us","k12.nv.us","k12.ny.us","k12.oh.us","k12.ok.us","k12.or.us","k12.pa.us","k12.ri.us","k12.sd.us","k12.tn.us","k12.tx.us","k12.va.us","k12.wi.us","k12.wv.us","k12.wy.us","kahoot.com","kahoot.it","kamihq.com","keep.google.com","khanacademy.org","kidsa-z.com","kidshealth.org","kidzsearch.com","knowledgematters.com","kwtears.com","learn4good.com","learningally.org","learnzillion.com","legendsoflearning.com","lexiacore5.com","lexiapowerup.com","libraryreserve.com","linustechtips.com","littlealchemy.com","live.com","livescience.com","livestrong.com","lpss.int","lpssonline.com","lsclassroom.com","lucidchart.com","lumoslearning.com","mail.google.com","maps.google.com","masteringchemistry.com","masteringphysics.com","mathgames.com","mathplayground.com","mathsisfun.com","mathxlforschool.com","mayoclinic.org","mcgraw-hill.com","membean.com","mentoringminds.com","merriam-webster.com","mheducation.com","microbit.org","microsoftonline.com","mindplayvirtualreadingcoach.com","minnstate.edu","missouriconnections.org","mit.edu","mobymax.com","mrdowling.com","multiplication.com","musiclab.chromeexperiments.com","myaccount.google.com","mycapstonelibrary.com","myhaikuclass.com","mylexia.com","myngconnect.com","myon.com","mypearson.com","mysteryscience.com","n2y.com","nasa.gov","nationalgeographic.com","naviance.com","nearpod.com","newsela.com","nhd.weebly.com","nightzookeeper.com","nih.gov","nitrotype.com","noodletools.com","noredink.com","nps.gov","nwtoolbox.org","oaksportal.org","olympic.org","onetonline.org","oregon.gov","oregonstudentaid.gov","oslis.org","overdrive.com","padlet.com","parentlink.net","pbisrewards.com","pbs.org","pbskids.org","pcc.edu","pcpartpicker.com","peardeck.com","pearson.com","pearsonapi.com","pearsoncmg.com","pearsoned.com","pearsonrealize.com","pearsonsuccessnet.com","pebblego.com","pegwriting.com","photos.google.com","physicsclassroom.com","piktochart.com","pixilart.com","pixton.com","planbook.com","play.google.com","playbuzz.com","plus.google.com","poets.org","powerschool.com","precisionexams.com","prepfactory.com","prezi.com","pridesurveys.com","primarygames.com","procon.org","prodigygame.com","productforums.google.com","proprofs.com","psychologytoday.com","purdue.edu","quavermusic.com","quia.com","quill.org","quizizz.com","quizlet.com","ratatype.com","raz-kids.com","rcsdk12.org","readingeggs.com","readingplus.com","readtheory.org","readworks.org","realtor.com","remind.com","renaissance-go.com","renaissance.com","renlearn.com","rezzly.com","roblox.com","rosettastone.com","rosettastoneclassroom.com","sb.school","scholar.google.com","scholastic.com","schoolmessenger.com","schoology.com","sciencebuddies.org","sciencing.com","scilearn.com","scootpad.com","search.yahoo.com","seesaw.me","senorwooly.com","sheppardsoftware.com","shmoop.com","sites.google.com","sketch.io","smartyants.com","smore.com","socratic.org","socrative.com","soraapp.com","soundcloud.com","sp2.org","space.com","spanishdict.com","sparknotes.com","spellingcity.com","sporcle.com","spotify.com","springboardonline.org","starfall.com","stemscopes.com","storybird.com","storylineonline.net","student.works.kutasoftware.com","studiesweekly.com","study.com","studyisland.com","studyladder.com","studystack.com","sumdog.com","support.google.com","surveymonkey.com","symbaloo.com","talentlms.com","teachbanzai.com","ted.com","tenmarks.com","thebalance.com","thecopia.com","thesaurus.com","thinkcentral.com","thinkcerca.com","thinkthroughmath.com","thoughtco.com","thrivistlms.com","time.com","timeanddate.com","tinkercad.com","tourbuilder.withgoogle.com","translate.google.com","traveloregon.com","tumblemobile.com","turnitin.com","tynker.com","typetastic.com","typing.com","typingclub.com","typingmaster.com","typingtest.com","ucertify.com","uoregon.edu","usatestprep.com","usg.edu","usgs.gov","ushmm.org","varsitylearning.com","vhlcentral.com","vitalsource.com","vjsjunior.com","vocabulary.com","voice.google.com","volstate.edu","vsco.co","watercalculator.org","waysidepublishing.com","wceruw.org","wcschools.com","weather.com","webassign.net","webmd.com","webreader.io","wevideo.com","whooosreading.org","wikihow.com","wikipedia.org","wileyplus.com","wordreference.com","world-geography-games.com","worldbookonline.com","wowzers.com","www.audiotool.com","www.bbc.co.uk","www.bbc.com","www.businessinsider.com","www.cnn.com","www.forbes.com","www.foxnews.com","www.google.com","www.googleadservices.com","www.history.com","www.independent.co.uk","www.kiddle.co","www.npr.org","www.nytimes.com","www.oregonlive.com","www.pandora.com","www.theatlantic.com","www.theguardian.com","www.usatoday.com","www.usnews.com","www.washingtonpost.com","xello.world","xtramath.org","yourchildlearns.com","youtu.be","youtube.com","zearn.org","zillow.com","zinclearninglabs.com","zoom.us"]}},{}],7:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}var a=e("./insight_settings"),s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onInsight=[],this.Reset()}var t,n,r;return t=e,(n=[{key:"Observe",value:function(e){if("string"!=typeof e)throw new Error("hostname must be a string");a.sites.some((function(t){return e.endsWith(t)}))?""===this.offender&&(this.hits=0):(this.hits++,this.hits===a.threshold&&(this.offender=e,this.triggerCallbacks()))}},{key:"Reset",value:function(){this.hits=0,this.offender="",this.triggerCallbacks()}},{key:"addListener",value:function(e){if("function"!=typeof e)throw new Error("callback must be a function");this.onInsight.push(e)}},{key:"triggerCallbacks",value:function(){var e=this;this.onInsight.forEach((function(t){t(e.offender,e.hits)}))}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.exports=s},{"./insight_settings":6}],8:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}var c=e("./debug"),u=c.polLog,l=c.errLog,f=e("axios").default,h=e("./config"),p=e("./group"),d=e("./user"),v=new(e("./commands")),y=new(e("./scheduler")),g=e("./telemetry");document.IsGroupActive=y.isGroupActive.bind(y);var m=!1;function b(e){var t=e.split(".").map((function(e){return parseInt(e,10)}));return(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3]}function w(e){var t=~parseInt(0,10);return t<<=32-parseInt(e,10)}var k=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),v.activePolicy=this,this.groups={},this.campus_networks=[],this.onCampus=!0,this.onCampusOnly=!1,this.currentIP=void 0,this.chromebookOnly=!1,this.osPlatform="cros",this.bitrate=6e3,this.lastPolicyCheck=Date.now(),this.rawPolicy={}}return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"setReplaced",value:function(e){if("boolean"!=typeof e)throw new Error("replaced must be a boolean");m=e}},{key:"isChromebookOnly",value:function(){return this.chromebookOnly&&this.osPlatform!==chrome.runtime.PlatformOs.CROS||m}},{key:"isClassroomActive",value:function(){return!this.isChromebookOnly()&&!(!this.onCampus&&this.onCampusOnly)}},{key:"updateCampusNetworkState",value:function(){try{if(!this.currentIP||"127.0.0.1"===this.currentIP||!this.campus_networks||0===this.campus_networks.length)return void(this.onCampus=!0);if(-1!==this.campus_networks.indexOf(this.currentIP))return void(this.onCampus=!0);var e,t=b(this.currentIP),n=o(this.campus_networks);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.match("/")){var i=r.split("/"),a=b(i[0]),s=w(i[1]);if((a&s)===(t&s))return void(this.onCampus=!0)}}}catch(e){n.e(e)}finally{n.f()}this.onCampus=!1}finally{v.onCampus=this.onCampus}}},{key:"updateIP",value:function(e,t){(this.currentIP!==e||t)&&(this.currentIP=e,void 0!==this.user&&(this.user.currentIP=this.currentIP)),this.updateCampusNetworkState()}},{key:"returnPass",value:function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;u("[returnPass] ->",r),f({method:"post",url:this.settings.apiUri+"/classpass/return_pass",headers:{"x-api-key":this.settings.apiKey,"Content-Type":"application/json",customerid:this.settings.customerId},data:{passId:r.passId}}).then((function(e){u("[returnPass] ->",e.data)})).catch((function(e){l("[returnPass] error -> ",e)}))}}catch(e){n.e(e)}finally{n.f()}}},{key:"activePasses",value:function(){f({method:"get",url:this.settings.apiUri+"/classpass/active_passes?student_guid="+this.user.attributes.user_guid,headers:{"x-api-key":this.settings.apiKey,"Content-Type":"application/json",customerid:this.settings.customerId}}).then((function(e){v.activePasses(e.data)})).catch((function(e){l("[activePasses] error -> ",e)}))}},{key:"Configure",value:function(e){if("object"!==r(e))throw new Error("settings required");if("string"!=typeof e.apiUri)throw new Error("settings.apiUri must be a string");if("string"!=typeof e.apiKey)throw new Error("settings.apiKey must be a string");if("string"!=typeof e.customerId)throw new Error("settings.customerId must be a string");if("object"!==r(e.ably))throw new Error("settings.ably must be provided");this.settings={ably:e.ably,apiKey:e.apiKey,apiUri:e.apiUri,customerId:e.customerId},this.osPlatform=e.osPlatform}},{key:"SetCurrentUser",value:function(e){if("string"!=typeof e)throw new Error("username must be a string");this.currentUser=e}},{key:"convertDataVarNames",value:function(e){e.id=e.user_guid;for(var t=0;t<e.groups.length;++t){var n=e.groups[t].group_guid;e.groups[t].id=n}}},{key:"LoadPolicy",value:function(){var e=this;if(void 0===this.settings||"string"!=typeof this.settings.apiUri||"string"!=typeof this.settings.apiKey||"string"!=typeof this.settings.customerId||"object"!==r(this.settings.ably))throw new Error("please configure the API settings before calling LoadPolicy");if("string"!=typeof this.currentUser)throw new Error("please set the CurrentUser before calling LoadPolicy");return this.LoadPolicyInt&&(clearInterval(this.LoadPolicyInt),this.LoadPolicyInt=void 0),new Promise((function(t){var n=chrome.runtime.getManifest().version,r=function(){return f({method:"post",url:e.settings.apiUri+"/policy",headers:{"x-api-key":e.settings.apiKey,"Content-Type":"application/json",customerid:e.settings.customerId,version:"chrome-".concat(n)},data:{username:e.currentUser}}).then((function(n){var r=n.data;if(e.rawPolicy=n.data,e.rawPolicy.jwt="REDACTED",0===Object.keys(r).length){u("[LoadPolicy] no policy for ->",e.currentUser),e.LoadPolicyInt&&(clearInterval(e.LoadPolicyInt),e.LoadPolicyInt=void 0);var o={email:e.currentUser};return t(o),o}for(var i in u("[LoadPolicy] policy for ->",r.email),e.lastPolicyCheck=Date.now(),LSClassroomWASM.PolicyData(r.jwt,r.email,r.user_guid),e.convertDataVarNames(r),void 0===e.user?e.user=new d(r,e.settings.ably,e.settings.customerId,v):e.user.attributes=r,e.user.policy=e,e.campus_networks=r.district.campus_networks||[],e.onCampusOnly=Boolean(r.on_campus_only),e.chromebookOnly=r.district.chromebook_only,e.encryptedCustomerId=r.district.encrypted_customer_id,e.bitrate=r.bitrate,h.SetBitrate(e.bitrate),e.autoClose=r.district.auto_close||5e3,e.hpEnabled=Boolean(r.district.hp_enabled),y.setGroups(r.groups),e.internetPaused=!1,r.groups.forEach((function(t){void 0!==e.groups[t.id]?e.groups[t.id].reconfigure(t):e.groups[t.id]=new p(t,e.settings.ably,e.settings.customerId)})),e.groups)e.groups[i].policy=e;var a=r.groups.map((function(e){return parseInt(e.id,10)})),s=[];if(Object.keys(e.groups).forEach((function(e){var t=parseInt(e,10);-1===a.indexOf(t)&&s.push(t)})),s.forEach((function(t){delete e.groups[t]})),e.LoadPolicyInt&&(clearInterval(e.LoadPolicyInt),e.LoadPolicyInt=void 0),e.updateCampusNetworkState(),g.SetClassroomEnabled(!e.isChromebookOnly()),e.user.policy=e,setTimeout((function(){e.user.sendTabs()}),1e3),v.activePolicy.lockExpiration=r.screen_lock_expire||-1,(new Date).getTime()<1e3*r.screen_lock_expire)var c=setTimeout((function(){clearTimeout(c),v.lock({data:{lockMessage:"This screen is locked"}})}),1e3);else var l=setTimeout((function(){clearTimeout(l),v.unlock({})}),1e3);return e.activePasses(),t(n.data),n.data})).catch((function(e){l("Error loading policy: ",e)}))};e.LoadPolicyInt=setInterval(r,31e3),r()}))}}]),e}();t.exports=k},{"./commands":1,"./config":2,"./debug":3,"./group":4,"./scheduler":13,"./telemetry":17,"./user":18,axios:48}],9:[function(e,t,n){(function(t){(function(){"use strict";function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */n=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),s=new I(r||[]);return a(i,"_invoke",{value:C(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",v="executing",y="completed",g={};function m(){}function b(){}function w(){}var k={};f(k,c,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==r&&o.call(E,c)&&(k=E);var O=w.prototype=m.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(r,a,s,c){var u=p(e[r],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==i(f)&&o.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var r;a(this,"_invoke",{value:function(e,o){function i(){return new t((function(t,r){n(e,o,t,r)}))}return r=r?r.then(i,i):i()}})}function C(t,n,r){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var u=p(t,n,r);if("normal"===u.type){if(o=r.done?y:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(o.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(i(t)+" is not iterable")}return b.prototype=w,a(O,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),f(x.prototype,u,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),f(O,l,"Generator"),f(O,c,(function(){return this})),f(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function r(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function s(e){r(a,o,i,s,c,"next",e)}function c(e){r(a,o,i,s,c,"throw",e)}s(void 0)}))}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=e("./debug"),s=a.rltLog,c=a.errLog,u=chrome.runtime.getManifest(),l=e("./config"),f=e("ably"),h=e("./policy"),p=new(e("./tab_capture")),d=new h,v=e("./tab_reporter"),y=e("./telemetry"),g=e("../utilities/groups").setCurrentHost,m=e("../utilities/tabs").filterTabs;t.sessionId=Math.floor(1e5*Math.random()).toString(36),document.TabCapture=p,v.Configure({policy:d}),p.policy=d;var b,w,k,_,E="https://ably.lightspeedsystems.app/",O="https://devices.classroom.relay.school",S="G52kOXvb7p7UbwFRV3ahn74m6xklosio2XUdLlTL",x=["60-8732-A000","55-4551-A000","74-1335-F000"],C=!1,A=!1,T=function(e,t){if((w!==e||t)&&(w=e,void 0!==d)){void 0!==d.groups&&Object.keys(d.groups).forEach((function(e){d.groups[e].setState(w)}));var n=y.GetSerialNumber();void 0!==d.user&&(d.user.currentState={state:w,active_pass:C,ip:d.user.currentIP,recording:d.user.recording,agent_platform:"cros",agent_version:u.version,device_serial:n},d.user.channel.presence.update({state:w,active_pass:C,ip:d.user.currentIP,recording:d.user.recording,agent_platform:"cros",agent_version:u.version,device_serial:n},(function(e){e&&returnrltLog("[updateState] error ->",e)})))}};LSClassroomWASM.SetTabCB((function(e){s("[sendTabs] ->",e),d.user.channel.publish("tabs",JSON.parse(e))}));var P=function(){if(!A){T("working"),chrome.webRequest.onCompleted.addListener((function(e){if(d.isClassroomActive()){var t=document.createElement("a");t.href=e.url,t.protocol.match(/^chrome/)||Object.keys(d.groups).forEach((function(e){var n=d.groups[e];n.isActive()&&n.insights.Observe(t.hostname)}))}}),{types:["main_frame"],urls:["<all_urls>"]});var e,t=function(){e=Date.now(),d.isClassroomActive()&&(s("[tabTrigger]"),Promise.all([new Promise((function(e){return chrome.tabs.query({active:!0,lastFocusedWindow:!0},(function(t){if(d.isClassroomActive()){var n=t[0];n&&Object.keys(d.groups).forEach((function(e){var t=d.groups[e];g(t,n)})),e()}}))})),m(d)]).then((function(){void 0!==d&&void 0!==d.user&&d.user.sendTabs()})).catch((function(e){c("[tabTrigger] error ->",e)})))},n={};["onActivated","onHighlighted","onDetached","onAttached","onRemoved","onUpdated","onCreated"].forEach((function(e){s("[tabEvents] ->",e),chrome.tabs[e].addListener((function(){s("[tabEvents] event fired ->",e),t()}))})),["onCreated","onRemoved","onFocusChanged"].forEach((function(e){s("[windowEvents] ->",e),chrome.windows[e].addListener((function(r){s("[windowEvents] event fired ->",e),r>-1&&("onRemoved"===e?delete n[r]:chrome.windows.get(r,{populate:!0},(function(e){e&&(n[e.id]=e)}))),t()}))}));setInterval((function(){chrome.windows.getAll({populate:!0},(function(r){var o=!1;r.forEach((function(e){var t=n[e.id];t&&(e.focused===t.focused&&e.state===t.state||(n[e.id]=e,o=!0))})),o&&Date.now()-e>2e3&&(s("[checkWindowFocus] window change detected"),t())}))}),2e3),t(),chrome.runtime.onMessage.addListener((function(e,t,n){var r={};return e.newState?T(e.newState,!0):"getState"===e.query?(d.isChromebookOnly()?r.disabled=!0:(r={currentState:w,groups:[],hpEnabled:d.hpEnabled},void 0!==d&&void 0!==d.groups&&Object.keys(d.groups).forEach((function(e){var t=d.groups[e];t.isActive()&&"object"===i(t.quickPoll)&&r.groups.push({id:t.id,name:t.id,quickPoll:{selectedOption:t.attributes.selectedQuickPollOption,options:t.quickPoll.options}})}))),s("[getState] ->",r)):"quickPollUpdate"===e.query?s("[quickPollUpdate] ->",e):e.incHit&&e.host&&Object.keys(d.groups).forEach((function(t){d.groups[t].incrementVisits(e.host)})),n(r),!0}));setInterval((function(){chrome.tabs.query({active:!0},(function(e){e.forEach((function(e){var t=document.createElement("a");t.href=e.url,Object.keys(d.groups).forEach((function(e){d.groups[e].incrementHostTime(t.hostname,1)}))}))}))}),1e3),LSClassroomWASM.FetchIP(),A=!0,chrome.bookmarks.onCreated.addListener((function(e,t){t.url&&t.url.match(/^javascript:/i)&&chrome.bookmarks.remove(t.id)})),setTimeout(I,2e3)}};function I(){chrome.runtime.sendMessage("oabgjilkcpjhblbghejemfighgjhecjl",{action:"ping"},(function(e){chrome.runtime.lastError||"object"!==i(e)||"pong"!==e.action?setTimeout(I,5e3):(s("[checkInstalled] extension detected ->",e),d.setReplaced(!0))}))}var j,R,L;function M(){if(b)if(navigator.onLine)switch(s("[AblyHealthCheck] current state ->",b.connection.state),b.connection.state){case"closed":case"disconnected":case"suspended":case"failed":s("[AblyHealthCheck] state is bad, starting reconnect process"),function(){if(R)try{clearTimeout(R),s("[ForceAblyReconnect] previous reconnect timer cleared"),R=void 0}catch(e){}if(L){s("[ForceAblyReconnect] previous health check timer cleared");try{clearTimeout(L),L=void 0}catch(e){}}R=setTimeout((function(){switch(b.connection.state){case"closed":case"disconnected":case"suspended":case"failed":s("[ForceAblyReconnect] telling library to connect");break;default:return void s("[ForceAblyReconnect] the client reconnected, exiting")}s("[ForceAblyReconnect] forcing reconnect"),l.SetStorage({lastIdentCheck:Date.now()-864e5})}),250),L=setTimeout(M,3e4),s("[ForceAblyReconnect] connection will be re-tried in 250ms, health will be verified in 30 seconds")}();break;default:s("[AblyHealthCheck] state is connected/connecting, health check seems okay")}else s("[AblyHealthCheck] currently offline, skipping");else s("]AblyHealthCheck] no connection yet")}function U(e){return new Promise((function(t){setTimeout(t,e)}))}document.addEventListener("setState",(function(e){"string"==typeof e.newState?(s("[updateStateFromSocket] ->",e),"string"==typeof e.activePass&&(C="true"===e.activePass),T(e.newState,!0)):e.updateRecording&&T(w,!0)})),setInterval(M,6e4);var N=0,D=void 0,G=function(){var e=o(n().mark((function e(t){var r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t&&("function"==typeof t.stopPropagation&&t.stopPropagation(),"function"==typeof t.preventDefault&&t.preventDefault()),e.prev=1,!A){e.next=5;break}return e.next=5,U(5e3);case 5:if(r=(new Date).getTime(),!D){e.next=11;break}return e.next=9,D;case 9:e.next=19;break;case 11:if(!(N<r)){e.next=19;break}return D=this,e.next=15,d.LoadPolicy();case 15:p.policy=d,m(d),N=(new Date).getTime(),D=void 0;case 19:s("[reloadPolicy] loaded ->",d.rawPolicy),P(),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(1),c("[reloadPolicy] load error ->",e.t0);case 26:case"end":return e.stop()}}),e,this,[[1,23]])})));return function(t){return e.apply(this,arguments)}}();function B(){return F.apply(this,arguments)}function F(){return(F=o(n().mark((function e(){var t,r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.GetIdentInt();case 2:return t=e.sent,e.next=5,l.GetStorage("lastIdentCheck");case 5:if(r=e.sent,!(Date.now()-r>t)){e.next=11;break}return s("[checkIdentityInterval] time for ident"),LSClassroomWASM.GetIdent(),e.abrupt("return");case 11:s("[checkIdentityInterval] next ident ->",new Date(r+t).toLocaleString());case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(){l.SetStorage({lastIdentCheck:Date.now()-864e5})}function H(){l.SetStorage({lastIdentCheck:Date.now()})}function W(){return(W=o(n().mark((function e(t){var r,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s("[checkIdentity] ->",t.chromeUser,t.osPlatform),k=t.chromeUser,r=k.toLowerCase(),o={authHeaders:{"Content-Type":"application/json","x-api-key":S,jwt:t.jwt,exp:10},authUrl:E,autoConnect:!1,clientId:r,echoMessages:!1,environment:"lightspeed",fallbackHosts:["a-fallback-lightspeed.ably.io","b-fallback-lightspeed.ably.io","c-fallback-lightspeed.ably.io"],recover:function(e,t){t(!0)}},-1!==x.indexOf("61-6373-A000")&&(o.logLevel=4),b&&(s("[checkIdentity] closing ably"),b.close(),b=void 0),(b=new f.Realtime(o)).connection.on((function(e){s("[checkIdentity] Ably connection state change event ->",e)})),d.Configure({ably:b,apiKey:S,apiUri:O,customerId:"61-6373-A000",osPlatform:t.osPlatform}),d.currentUser!==k){e.next=13;break}d.user.setAbly(b,"61-6373-A000"),e.next=16;break;case 13:return d.SetCurrentUser(r),e.next=16,G();case 16:p.setUser(d.user,!0),LSClassroomWASM.FetchIP(),d.isChromebookOnly()||b.connection.connect(),H(),_&&(clearInterval(_),_=void 0),_=setInterval(B,1e4);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}document.addEventListener("policyUpdate",G),LSClassroomWASM.SetIPCB((function(e){d.updateIP(e),T(w,!0)})),LSClassroomWASM.SetIdentCB((function(e){return W.apply(this,arguments)})),window.addEventListener("offline",(function(){if(s("[offline]"),b)try{b.connection.connectionManager.disconnectAllTransports()}catch(e){s("[offline] error when attempting to close Ably connection ->",e)}})),window.addEventListener("online",(function(){if(s("[online]"),j)try{clearTimeout(j),j=void 0}catch(e){}q()})),chrome.runtime.onUpdateAvailable.addListener((function(){chrome.runtime.reload()}));function V(){return(V=o(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d.isChromebookOnly()){e.next=8;break}if(b&&b.connection&&"connected"===b.connection.state&&(s("[checkIdentity] closing ably"),b.close()),b=void 0,t=Date.now(),!(d.lastPolicyCheck<t-36e5)){e.next=8;break}return e.next=7,d.LoadPolicy();case 7:d.isChromebookOnly()||q();case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}chrome.notifications.onButtonClicked.addListener((function(e,t){s("[onButtonClicked] ->",e,t);var n=e.match(/mtype-(\d+)/);if(n)switch(parseInt(n[1],10)){case 3:if(chrome.notifications.clear(e),0!==t)break;T("done");break;case 2:if(chrome.notifications.clear(e),0!==t)break;T("need help")}})),document.addEventListener("GroupSchedule",(function(e){s("[GroupSchedule] ->",e)})),setInterval((function(){return V.apply(this,arguments)}),5e3),console.log(u.description,"version:",u.version)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utilities/groups":22,"../utilities/tabs":23,"./config":2,"./debug":3,"./policy":8,"./tab_capture":15,"./tab_reporter":16,"./telemetry":17,ably:47}],10:[function(e,t,n){"use strict";function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),s=new I(r||[]);return a(i,"_invoke",{value:C(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",v="executing",y="completed",g={};function m(){}function b(){}function w(){}var k={};f(k,c,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==n&&o.call(E,c)&&(k=E);var O=w.prototype=m.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(r,a,s,c){var u=p(e[r],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==i(f)&&o.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var r;a(this,"_invoke",{value:function(e,o){function i(){return new t((function(t,r){n(e,o,t,r)}))}return r=r?r.then(i,i):i()}})}function C(t,n,r){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var u=p(t,n,r);if("normal"===u.type){if(o=r.done?y:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(o.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(i(t)+" is not iterable")}return b.prototype=w,a(O,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),f(x.prototype,u,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),f(O,l,"Generator"),f(O,c,(function(){return this})),f(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function o(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}var c,u,l=e("./debug"),f=l.rtcLog,h=l.errLog,p=e("./telemetry"),d=[{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"},{url:"stun:stun2.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"},{url:"stun:stun4.l.google.com:19302"},{url:"turn:turn.bistri.com:80",credential:"homeo",username:"homeo"},{url:"turn:turn.anyfirewall.com:443?transport=tcp",credential:"webrtc",username:"webrtc"}],v={turn:{max:2500,min:1e3,start:2500},stun:{max:1e5,min:1e4,start:5e4}},y=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=d;if("object"===i(t)){if(void 0!==t.customIce){if(!Array.isArray(t.customIce))throw new Error("custom ice must be an array");this.customIce=t.customIce,r=this.customIce}}else if(void 0!==t)throw new Error("args must be an object when provided");this.sessionId=t.sessionId,this.ice=[],this.onIceCallbacks=[],this.onOfferCallbacks=[],this.haveAllIce=!1,"undefined"!=typeof RTCPeerConnection&&(this.rtc=new RTCPeerConnection({iceServers:r}),this.rtc.onicecandidate=this.onIce.bind(this),c&&clearInterval(c),c=setInterval((function(){n.getStats()}),5e3))}var t,n;return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"createOffer",value:function(){return this.rtc.createOffer()}},{key:"onIce",value:function(e){if(f("[onIce] ->",e),void 0===e)throw new Error("rtc event required");e.candidate?(this.haveAllIce=!1,this.ice.push(e.candidate),this.onIceCallbacks.forEach((function(t){t(e.candidate)}))):(this.haveAllIce=!0,this.onIceCallbacks.forEach((function(e){e(null)})))}},{key:"setStream",value:function(e){var t=this;if("object"!==i(e))throw new Error("stream must be an object");this.stream=e,void 0!==this.rtc&&e.getTracks().forEach((function(n){u=t.rtc.addTrack(n,e)}))}},{key:"setOffer",value:function(e,t){if("object"!==i(e))throw new Error("offer must be an object");void 0!==this.rtc&&(e.sdp=g(e.sdp),e.sdp=m(e.sdp),e.sdp=b(e.sdp),e.sdp=w(e.sdp),f("[setOffer] offer ->",e),this.rtc.setLocalDescription(e).catch((function(e){h("[setLocalDescription] error ->",e),t.publish("webrtc_error",e.message)})),this.offer=e,this.onOfferCallbacks.forEach((function(e){f("[onOfferCallbacks] calling offer callback"),e()})),this.onOfferCallbacks=[])}},{key:"setAnswer",value:function(e,t){if(void 0===e)throw new Error("answer required");e.sdp=g(e.sdp),e.sdp=m(e.sdp),e.sdp=b(e.sdp),e.sdp=w(e.sdp),f("[setAnswer] answer ->",e),this.rtc.setRemoteDescription(e).catch((function(e){h("[setRemoteDescription] error ->",e),t.publish("webrtc_error",e.message)})),f("[setAnswer] rtc ->",this.rtc)}},{key:"addIce",value:function(e,t){if(f("[addIce] ->",e),void 0===e)throw new Error("ice required");this.rtc.addIceCandidate(e).catch((function(e){h("[addIceCandidate] error ->",e),t.publish("webrtc_error",e.message)})),f("[addIce] rtc ->",this.rtc)}},{key:"addIceCallback",value:function(e){if("function"!=typeof e)throw new Error("callback function requred");this.onIceCallbacks.push(e)}},{key:"getStats",value:(t=r().mark((function e(){var t,n,o,i,a,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.rtc){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.rtc.getStats();case 4:(a=e.sent).forEach((function(e){"outbound-rtp"===e.type&&"video"===e.kind&&(i=e),"candidate-pair"===e.type&&"succeeded"===e.state&&(t=e)})),t&&(a.forEach((function(e){"local-candidate"===e.type&&e.id===t.localCandidateId&&(n=e),"remote-candidate"===e.type&&e.id===t.remoteCandidateId&&(o=e)})),n&&o&&(s="relay"===n.candidateType||"relay"===o.candidateType?"turn":"stun",f("[getStats] type ->",s),this.setSenderBitrate(s),p.AddWebRTCData(this.sessionId,s,i.bytesSent)));case 7:case"end":return e.stop()}}),e,this)})),n=function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function s(e){o(a,r,i,s,c,"next",e)}function c(e){o(a,r,i,s,c,"throw",e)}s(void 0)}))},function(){return n.apply(this,arguments)})},{key:"setSenderBitrate",value:function(e){var t=u.getParameters();if(t.encodings){var n=v[e];t.encodings[0].maxBitrate!==1e3*n.max?(t.encodings[0].maxBitrate=1e3*n.max,t.encodings[0].minBitrate=1e3*n.min,t.encodings[0].startBitrate=1e3*n.start,u.setParameters(t).then((function(){f("[setSenderBitrate] bitrate set ->",n)})).catch((function(e){h("[setSenderBitrate] error setting bitrate ->",e)}))):f("[setSenderBitrate] bitrate already set")}else f("[setSenderBitrate] No encodings found")}}]),e}();function g(e){var t=new RegExp("a=rtpmap:(\\d+) ".concat("VP8","/\\d+")),n=e.match(t);if(!n)return console.warn("Codec ".concat("VP8"," not found in SDP")),e;var r=n[1];f("[setCodec] codecPayloadType -> ".concat(r));for(var o=e.split("\r\n"),i=0;i<o.length;i++)if(o[i].startsWith("m=video")){f("[setCodec] m=video -> ".concat(o[i]));var a=o[i].split(" "),s=a.slice(0,3).concat([r]).concat(a.slice(3).filter((function(e){return e!==r})));o[i]=s.join(" "),f("[setCodec] m=video -> ".concat(o[i]));break}return o.join("\r\n")}function m(e){for(var t=e.split("\r\n"),n=-1,r=0;r<t.length;r++)if(t[r].startsWith("m=video")){n=r;break}return-1===n?(console.warn("m=video line not found in SDP"),e):(t.splice(n+1,0,"b=AS:".concat(v.stun.max)),t.splice(n+1,0,"a=fmtp:".concat(t[n].split(" ")[3]," x-google-start-bitrate=").concat(v.stun.start,";x-google-min-bitrate=").concat(v.stun.min,";x-google-max-bitrate=").concat(v.stun.max)),t.join("\r\n"))}function b(e){return e.split("\r\n").map((function(e){return e.startsWith("a=fmtp:")?"".concat(e,";x-google-min-interval=").concat(1e4):e})).join("\r\n")}function w(e){return e.split("\r\n").map((function(e){return e.startsWith("a=fmtp:")?"".concat(e,";max-fr=").concat(1):e})).join("\r\n")}t.exports=y},{"./debug":3,"./telemetry":17}],11:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}var a=e("./debug"),s=a.rthLog,c=a.errLog,u=a.debugIceServers,l=e("./rtc_connection"),f=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"object"!==r(t))throw new Error("stream required");if("object"!==r(n))throw new Error("channel required");this.stream=t,this.channel=n,this.connections={},this.presentSessionIds=[],this.applyBindings(),this.cleanConnectionsInt=setInterval(this.cleanConnections.bind(this),3e4)}var t,n,i;return t=e,(n=[{key:"applyBindings",value:function(){this.channel.subscribe("request_rtc",this.onRequestRtc.bind(this)),this.channel.subscribe("answer_rtc",this.onAnswerRtc.bind(this)),this.channel.subscribe("answer_rtc_ice",this.onAnswerIce.bind(this))}},{key:"onRequestRtc",value:function(e){var t=this;s("[onRequestRtc] msg ->",e);try{if("object"!==r(e))throw new Error("message required");if("object"!==r(e.data))throw new Error("message data must be an object");if(void 0===e.data.sessionId)throw new Error("sessionId required");if(this.policy&&!this.policy.isClassroomActive())return;var n=e.data.sessionId;this.addPresence(n);var o=this.connections[n];if(void 0===o){var i={sessionId:n};Array.isArray(e.data.customIce)&&(i.customIce=e.data.customIce,u(i.customIce)),(o=this.connections[n]=new l(i)).setStream(this.stream),s("[onRequestRtc] no rtc for session id, creating new one ->",this.connections)}o.addIceCallback((function(e){e&&t.sendIce(n,e)})),o.createOffer().then(this.onRtcOffer.bind(this,n))}catch(e){throw c("[onRequestRtc] error ->",e),e}}},{key:"onRtcOffer",value:function(e,t){if(s("[onRtcOffer] sessionId:",e," offer:",t),void 0===e)throw new Error("sessionId required");if("object"!==r(t))throw new Error("offer required");if(!this.policy||this.policy.isClassroomActive()){var n=this.connections[e];if(void 0===n)throw new Error("no RTC for sessionId: ".concat(e));n.setOffer(t,this.channel),this.sendOffer(e,t)}}},{key:"sendOffer",value:function(e,t){if(void 0===e)throw new Error("sessionId required");if(void 0===t)throw new Error("offer required");var n={sessionId:e,offer:t};this.policy&&!this.policy.isClassroomActive()||this.channel.publish("offer_rtc",n)}},{key:"sendIce",value:function(e,t){if(void 0===e)throw new Error("sessionId required");if(void 0===t)throw new Error("ice required");var n={sessionId:e,ice:t};this.policy&&!this.policy.isClassroomActive()||this.channel.publish("offer_rtc_ice",n)}},{key:"onAnswerRtc",value:function(e){if(s("[onAnswerRtc] msg ->",e),"object"!==r(e))throw new Error("message required");if("object"!==r(e.data))throw new Error("message data must be an object");if(void 0===e.data.sessionId)throw new Error("sessionId required");if(void 0===e.data.answer)throw new Error("answer required");if(!this.policy||this.policy.isClassroomActive()){var t=e.data.sessionId,n=this.connections[t];if(void 0===n)throw new Error("sessionId ".concat(t," does not have a rtc connection"));n.setAnswer(e.data.answer,this.channel)}}},{key:"onAnswerIce",value:function(e){if(s("[onAnswerIce] msg ->",e),"object"!==r(e))throw new Error("message required");if("object"!==r(e.data))throw new Error("message data must be an object");if(void 0===e.data.sessionId)throw new Error("sessionId required");if(void 0===e.data.ice)throw new Error("ice required");if(!this.policy||this.policy.isClassroomActive()){var t=e.data.sessionId,n=this.connections[t];if(void 0===n)throw new Error("sessionId ".concat(t," does not have a rtc connection"));n.addIce(e.data.ice,this.channel)}}},{key:"updatePresence",value:function(e){if(!Array.isArray(e))throw new Error("sessionIds required");this.presentSessionIds=e}},{key:"addPresence",value:function(e){if(void 0===e)throw new Error("sessionId required");-1===this.presentSessionIds.indexOf(e)&&this.presentSessionIds.push(e)}},{key:"cleanConnections",value:function(){var e=this;Object.keys(this.connections).forEach((function(t){if(-1===e.presentSessionIds.indexOf(t)){var n=e.connections[t];void 0!==n&&void 0!==n.rtc&&(n.rtc.close(),delete n.rtc),delete e.connections[t]}}))}}])&&o(t.prototype,n),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.exports=f},{"./debug":3,"./rtc_connection":10}],12:[function(e,t,n){"use strict";var r,o=e("./debug"),i=o.s3Log,a=o.errLog,s=e("axios").default,c={},u=!1,l=[],f=function(){return i("[fetchPresignedConfig] presignedConfig ->",r),new Promise((function(e){void 0===r?(i("[updatePresignedConfig]"),u?new Promise((function(e){l.push(e)})):(u=!0,s({method:"post",url:"https://devices.classroom.relay.school/pre",headers:{"x-api-key":"G52kOXvb7p7UbwFRV3ahn74m6xklosio2XUdLlTL","Content-Type":"application/json",customerId:"61-6373-A000"},data:{}}).then((function(e){return i("[updatePresignedConfig] success ->",e),u=!1,r=e.data,l.forEach((function(e){e(r)})),l=[],setTimeout((function(){u=!1,r=void 0}),36e5),r})).catch((function(e){u=!1,a("[updatePresignedConfig] error ->",e)})))).then(e):e(r)}))},h=function(e,t,n){return f().then((function(r){return new Promise((function(o,i){var a=r.prefix+e,s=new FormData;s.append("key",a),Object.keys(r.presigned.fields).forEach((function(e){s.append(e,r.presigned.fields[e])})),s.append("file",t);var c=new XMLHttpRequest;void 0!==n&&(c.responseType=n),c.open("POST",r.presigned.url,!0),c.send(s),c.onload=function(){o(a)},c.onerror=i,c.ontimeout=i}))}))};c.SaveText=function(e,t){if(i("[SaveText] key: ",e," body: ",t),"string"!=typeof e)throw new Error("key must be a string");if("string"!=typeof t)throw new Error("body must be a string");return h(e,t)},c.SaveImage=function(e,t){if(i("[SaveImage] key: ",e),"string"!=typeof e)throw new Error("key must be a string");if("string"!=typeof t)throw new Error("body must be a dataURL string");return h(e,function(e){var t;if(-1===e.indexOf(";base64,"))return t=e.split(","),new Blob([decodeURIComponent(t[1])],{type:t[0].split(":")[1]});t=e.split(";base64,");for(var n=window.atob(t[1]),r=n.length,o=0,i=new Uint8Array(r);o<r;++o)i[o]=n.charCodeAt(o);return new Blob([i],{type:t[0].split(":")[1]})}(t),"blob")},t.exports=c},{"./debug":3,axios:48}],13:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}var a=e("./debug").schLog,s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.groupSchedules={},this.groupStates={},this.checkInt=setInterval(this.updateActive.bind(this),15e3)}var t,n,i;return t=e,(n=[{key:"setGroups",value:function(e){if(!Array.isArray(e))throw new Error("groups required");var t={};e.forEach((function(e){t[e.id]={},e.class_schedule&&"object"===r(e.class_schedule)&&Object.keys(e.class_schedule).forEach((function(n){n.split("").map((function(e){return parseInt(e,10)})).forEach((function(r){t[e.id][r]=e.class_schedule[n]}))}))})),this.groupSchedules=t,this.updateActive()}},{key:"isGroupActive",value:function(e){if(void 0===e)throw new Error("groupId required");var t=new Date,n=t.getHours()+t.getMinutes()/100,r=this.groupSchedules[e];if(void 0!==r){var o=r[t.getDay()];if(void 0!==o&&o.s<=n&&n<o.e)return!0}return!1}},{key:"updateActive",value:function(){var e=this;a("[updateActive]");var t={},n=[],r=[];Object.keys(this.groupSchedules).forEach((function(o){t[o]=e.isGroupActive(o),t[o]&&!e.groupStates[o]?r.push(o):!t[o]&&e.groupStates[o]&&n.push(o)})),Object.keys(this.groupStates).forEach((function(e){void 0===t[e]&&n.push(e)})),"undefined"!=typeof document&&"function"==typeof document.dispatchEvent&&(r.forEach((function(e){var t=new Event("GroupSchedule");t.groupId=e,t.newState="online",document.dispatchEvent(t)})),n.forEach((function(e){var t=new Event("GroupSchedule");t.groupId=e,t.newState="offline",document.dispatchEvent(t)}))),this.groupStates=t}},{key:"addListener",value:function(){}}])&&o(t.prototype,n),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.exports=s},{"./debug":3}],14:[function(e,t,n){(function(n){(function(){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),s=new I(r||[]);return a(i,"_invoke",{value:C(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",v="executing",y="completed",g={};function m(){}function b(){}function w(){}var k={};f(k,c,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==n&&i.call(E,c)&&(k=E);var O=w.prototype=m.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,a,s,c){var u=p(e[o],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==r(f)&&i.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var u=p(t,n,r);if("normal"===u.type){if(o=r.done?y:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(i.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(r(t)+" is not iterable")}return b.prototype=w,a(O,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),f(x.prototype,u,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),f(O,l,"Generator"),f(O,c,(function(){return this})),f(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function i(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)}))}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function c(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}var u=e("./debug"),l=u.sshLog,f=u.errLog,h=e("./s3"),p=function(){function e(t,r){var o=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"!=typeof t)throw new Error("dataURL required");this.user=r,this.username=this.user.attributes.username,this.dataComplete=!1,this.at=new Date;var i=this.at.getTime().toString(36);this.dataURL=t,this.TabsKey="".concat(i,"/").concat(this.username,"/").concat(n.sessionId,"/tabs.json"),this.ImageKey="".concat(i,"/").concat(this.username,"/").concat(n.sessionId,"/image.jpg"),this.MetaKey="".concat(i,"/").concat(this.username,"/").concat(n.sessionId,"/meta.json"),this.getCurrentTabs().then((function(e){o.tabs=e,o.dataComplete=!0})).catch((function(e){f("[snapshot] error ->",e)}))}var t,r,i,c;return t=e,(r=[{key:"getCurrentTabs",value:function(){return new Promise((function(e,t){if("undefined"!=typeof chrome&&void 0!==chrome.tabs&&"function"==typeof chrome.tabs.query)return chrome.tabs.query({},(function(t){var n=t.map((function(e){return{active:e.active,id:e.id,title:e.title,url:e.url,windowId:e.windowId,favico:e.favIconUrl}}));e(n)}));t(new Error("error querying chrome tabs api"))}))}},{key:"Save",value:(c=a(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.dataComplete){e.next=2;break}return e.abrupt("return",h.SaveText(this.TabsKey,JSON.stringify(this.tabs)).then(function(){var e=a(o().mark((function e(r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.SaveImage(t.ImageKey,t.dataURL).then((function(e){l("[Save] tabs: ",r," imageKey: ",e);var o={un:t.username,at:t.at.toISOString(),tKey:r,iKey:e,sId:n.sessionId};return h.SaveText(t.MetaKey,JSON.stringify(o))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return e.abrupt("return",new Promise((function(e){var n=setInterval((function(){if(t.dataComplete)return clearInterval(n),t.Save().then(e)}),100)})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})}])&&s(t.prototype,r),i&&s(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.exports=p}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./debug":3,"./s3":12}],15:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}var a=e("./debug"),s=a.tbcLog,c=a.errLog,u=e("./snapshot"),l=e("./rtc_connection_handler"),f=e("../utilities/groups").getAllActiveGroupGuids,h=e("../utilities/capture"),p=h.isValidTabs,d=h.checkListenerQuality,v=h.getCurrentCaptureInfo,y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s("[TabCapture] init"),this.createCanvas(),this.snapshots=[],this.listenerQuality=null,this.capturingInterval=null,this.policy=null;var t=this.captureRecording.bind(this),n=this.captureActiveTab.bind(this,t);setInterval(n,1e4),setInterval(this.checkCaptureStatus.bind(this),1e3)}var t,n,i;return t=e,(n=[{key:"createCanvas",value:function(){void 0===this.canvas&&(this.canvas=document.createElement("canvas"),this.canvasCtx=this.canvas.getContext("2d"))}},{key:"checkCaptureStatus",value:function(){var e=d(this.user);if(e!==this.listenerQuality){this.listenerQuality=e,s("[checkCaptureStatus] capturing on ->",e);var t=this.captureImageToStream.bind(this),n=this.captureActiveTab.bind(this,t);this.capturingInterval&&clearInterval(this.capturingInterval),this.capturingInterval=setInterval(n,2e3)}}},{key:"captureActiveTab",value:function(e){if(!this.policy||this.policy.isClassroomActive()){if(!this.policy||0!==f(this.policy).length){var t=v(this.listenerQuality).jpegQuality;s("[captureActiveTab] jpegQuality: ".concat(t));try{chrome.tabs.query({active:!0,lastFocusedWindow:!0},(function(n){p(n)?chrome.tabs.captureVisibleTab({quality:t},(function(t){if("string"!=typeof t)throw new Error("dataUrl required");if(!t.match(/^data:image\/jpeg;base64/))throw new Error("invalid dataUrl");e(t)})):s("[captureActiveTab] invalid tab")}))}catch(e){c("[captureActiveTab] error ->",e)}}}else s("[captureActiveTab] policy not active")}},{key:"captureImageToStream",value:function(e){var t=this;e?(void 0===this.img&&(this.img=document.createElement("img"),this.img.addEventListener("load",(function(){s("[captureImageToStream] img width: ".concat(t.img.width,", img height: ").concat(t.img.height)),t.img.width>0&&t.img.height>0&&(t.canvas.width=t.img.width,t.canvas.height=t.img.height,t.canvasCtx.drawImage(t.img,0,0,t.canvas.width,t.canvas.height),s("[captureActiveTab] drawing image to canvas: ".concat(t.canvas.width," x ").concat(t.canvas.height)))}))),s("[captureImageToStream] setting img src"),this.img.setAttribute("src",e)):s("[captureImageToStream] no dataUrl")}},{key:"captureRecording",value:function(e){this.snapshots.push(new u(e,this.user)),this.snapshots.length>10&&(this.snapshots=this.snapshots.slice(this.snapshots.length-10,this.snapshots.length),this.snapshots=this.snapshots.slice(this.snapshots.length-10,this.snapshots.length)),void 0!==this.user&&this.user.recording&&this.saveRecordings()}},{key:"saveRecordings",value:function(){var e=this.snapshots;this.snapshots=[],e.forEach((function(e){return e.Save()}))}},{key:"setUser",value:function(e,t){var n=this;if("object"!==r(e))throw new Error("user object required");if(this.user=e,void 0!==e.channel&&(void 0===this.connectionHandler||t)){var o=v("high").fps,i=this.canvas.captureStream(o);this.connectionHandler=new l(i,this.user.channel),this.policy?this.connectionHandler.policy=this.policy:this.user&&this.user.policy&&(this.connectionHandler.policy=this.user.policy),s("[setUser] connectionHandler"),this.rtcPresenceInt=setInterval((function(){var e=[];Object.keys(n.user.presence).forEach((function(t){if(n.user.presence[t]){var r=n.user.presence[t].sessionId;void 0!==r&&-1===e.indexOf(r)&&e.push(r)}})),n.connectionHandler.updatePresence(e)}),3e4)}}}])&&o(t.prototype,n),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.exports=y},{"../utilities/capture":21,"../utilities/groups":22,"./debug":3,"./rtc_connection_handler":11,"./snapshot":14}],16:[function(e,t,n){"use strict";function r(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var i,a=e("./debug"),s=a.tbrLog,c=a.errLog,u=e("../utilities/groups"),l=u.getAllActiveGroupGuids,f=u.setCurrentHost,h=[],p=[],d=null;setInterval((function(){if(i)if(i.isClassroomActive()){var e=!1;for(var t in i.groups)if(i.groups[t].isActive()){e=!0;break}if(e){var n=r(p);p=[],0!==n.length&&(s("[reportSessionTabs] sending report ->",n),LSClassroomWASM.SendReport(n))}else s("[reportSessionTabs] no active groups detected, not reporting")}else s("[reportSessionTabs] Classroom is not active, not reporting");else c("[reportSessionTabs]",new Error("Unable to report visited urls, policy was not provided to TabReporter.Configure."))}),45e3),chrome.tabs.onUpdated.addListener((function(e,t){var n=t.url;n&&l(i).forEach((function(e,t){var r=Date.now()+t;p.push({gguid:e,url:n,at:r})}))})),chrome.tabs.onActivated.addListener((function(e){var t=e.tabId;d=t,t&&!h.includes(t)&&h.push(t)})),document.addEventListener("GroupSchedule",(function(e){if("online"===e.newState){var t=e.groupId,n=i.groups[t];if(n){var r=n.id;h.forEach((function(e){chrome.tabs.get(e,(function(t){if(!chrome.runtime.lastError){var o=t.url;p.push({gguid:r,url:o,at:Date.now()}),d===e&&f(n,t)}}))}))}}})),t.exports.Configure=function(e){e.policy&&(i=e.policy)}},{"../utilities/groups":22,"./debug":3}],17:[function(e,t,n){(function(n){(function(){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),s=new I(r||[]);return a(i,"_invoke",{value:C(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",v="executing",y="completed",g={};function m(){}function b(){}function w(){}var k={};f(k,c,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==n&&i.call(E,c)&&(k=E);var O=w.prototype=m.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,a,s,c){var u=p(e[o],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==r(f)&&i.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var u=p(t,n,r);if("normal"===u.type){if(o=r.done?y:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(i.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(r(t)+" is not iterable")}return b.prototype=w,a(O,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),f(x.prototype,u,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),f(O,l,"Generator"),f(O,c,(function(){return this})),f(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function i(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)}))}}var s,c,u,l=e("./debug").telLog,f=e("ls-telemetry-js"),h=e("./config"),p=chrome.runtime.getManifest(),d="agent-backend-api-production.lightspeedsystems.com",v=n.env.LS_TELEMETRY_INT||36e5,y="l4glwgbrumye5fll6q2yxp38lmb2hd39wrioqp9a",g=[30,60,120,300],m=0;function b(){return(b=a(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.Init({agent_type:"classroom",agent_version:p.version,customer_id:"61-6373-A000",ls_telemetry_host:d,ls_telemetry_key:y,product:"classroom"}),e.next=3,h.GetStorage("webrtcData");case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0={};case 6:u=e.t0;case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return(w=a(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.chromeUser!==s){e.next=3;break}return l("[SetUser] no user change ->",t.chromeUser),e.abrupt("return");case 3:return s=t.chromeUser,e.next=6,h.GetStorage("ls_udid");case 6:(n=e.sent)||(n=f.GetUDID(),h.SetStorage({ls_udid:n})),f.SetAgentUser({email:s,udid:n,username:s}),r=k(5,30),l("[SetUser] report delay ->",r),setTimeout(E,r);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t){return 1e3*Math.floor(Math.random()*(t-e+1)+e)}function _(e){var t=g.length;return e>=t?g[t-1]:g[e-1]}function E(){return O.apply(this,arguments)}function O(){return(O=a(o().mark((function e(){var t,n,r,i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.GetStorage("lastTelemetryReport");case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0="0:0";case 5:if(t=e.t0,n=t.split(":"),l("[telemetryReport] lastReport ->",n),r=p.version.split(".").slice(0,-1).join("."),i=S(),a=v,n[0]===i.toString()&&n[1]===r){e.next=20;break}return e.next=14,x(i);case 14:return e.next=16,f.SendReport();case 16:e.sent.ok?(h.SetStorage({lastTelemetryReport:"".concat(i,":").concat(r)}),m=0,l("[telemetryReport] report successful")):(m++,s=1e3*_(m),l("[telemetryReport] report retry ->",s),a=s),e.next=21;break;case 20:l("[telemetryReport] already reported for today");case 21:c&&clearTimeout(c),c=setTimeout(E,a);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){var e=new Date,t=e.getFullYear(),n="0"+(e.getMonth()+1),r="0"+e.getDate();return"".concat(t,"-").concat(n.slice(-2),"-").concat(r.slice(-2))}function x(e){return C.apply(this,arguments)}function C(){return(C=a(o().mark((function e(t){var n,r,i,a,s,c,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={stun:{bytes:0,sessions:0},turn:{bytes:0,sessions:0}},r=u,e.t0=o().keys(r);case 3:if((e.t1=e.t0()).done){e.next=11;break}if((i=e.t1.value)!==t){e.next=7;break}return e.abrupt("continue",3);case 7:for(a in r[i])s=r[i][a],c=s.turn,l=s.stun,c>0&&(n.turn.bytes+=c,n.turn.sessions++),l>0&&(n.stun.bytes+=l,n.stun.sessions++);delete r[i],e.next=3;break;case 11:u=r,h.SetStorage({webrtcData:u}),f.SetWebRTCData(n);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){b.apply(this,arguments)}(),LSClassroomWASM.SetIdentCB((function(e){return w.apply(this,arguments)})),LSClassroomWASM.SetIPCB(f.SetPublicIp),t.exports.AddWebRTCData=function(e,t,n){l("[webrtcData] sessionId -> ".concat(e,", type -> ").concat(t,", bytes -> ").concat(n));var r=S(),o=u[r]||{},i=o[e]||{turn:0,stun:0};i[t]+=n,o[e]=i,u[r]=o,h.SetStorage({webrtcData:u})},t.exports.GetSerialNumber=function(){var e=f.GetConfig().serial_number||"unknown";return l("[getSerialNumber] serial_number ->",e),e},t.exports.SetClassroomEnabled=function(e){f.SetClassroomEnabled(e)}}).call(this)}).call(this,e("_process"))},{"./config":2,"./debug":3,_process:108,"ls-telemetry-js":105}],18:[function(e,t,n){"use strict";function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,a=Object.create(o.prototype),s=new I(r||[]);return i(a,"_invoke",{value:C(e,n,s)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",v="executing",y="completed",g={};function m(){}function b(){}function w(){}var k={};f(k,c,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==n&&o.call(E,c)&&(k=E);var O=w.prototype=m.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(r,i,a,c){var u=p(e[r],e,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==s(f)&&o.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):t.resolve(f).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,c)}))}c(u.arg)}var r;i(this,"_invoke",{value:function(e,o){function i(){return new t((function(t,r){n(e,o,t,r)}))}return r=r?r.then(i,i):i()}})}function C(t,n,r){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var u=p(t,n,r);if("normal"===u.type){if(o=r.done?y:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function n(){for(;++r<t.length;)if(o.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(s(t)+" is not iterable")}return b.prototype=w,i(O,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),f(x.prototype,u,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),f(O,l,"Generator"),f(O,c,(function(){return this})),f(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function o(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function s(e){o(a,r,i,s,c,"next",e)}function c(e){o(a,r,i,s,c,"throw",e)}s(void 0)}))}}function a(e,t,n){return(t=u(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function u(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}var l=e("./debug"),f=l.usrLog,h=l.errLog,p=l.debugSetAbly,d=l.remoteDebug,v=l.twilioDiagnostics,y=chrome.runtime.getManifest(),g=e("./telemetry");function m(e,t){return new Promise((function(n,r){e.presence.get({clientId:t},(function(e,t){if(e)return f("[getUserPresence] error retrieving list ->",e),void r(e);n(t)}))}))}var b=function(){function e(t,n,r,o){var i=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"object"!==s(t))throw new Error("user attributes required");if("string"!=typeof t.email)throw new Error("email must be a string");if("object"!==s(n))throw new Error("ably object required");if("string"!=typeof r)throw new Error("customerId required");if("object"!==s(o))throw new Error("commands object required");this.attributes=t,this.presence={},this.lastGroupMsg={},this.recording=!1,this.recordUntil=0,this.commands=o,this.setAbly(n,r),"undefined"!=typeof document&&"function"==typeof document.addEventListener&&(document.addEventListener("GroupUpdate",(function(e){f("[GroupUpdate] ->",e),e.stopPropagation();var t={agentType:"chrome"};t.currentHost=e.attributes.currentHost,t.favico=e.attributes.favico,t.visits=e.attributes.visits,t.top=e.attributes.top,t.topTime=e.attributes.topTime,t.insightHost=e.attributes.insightHost,i.lastGroupMsg[e.groupId]=t,i.publishGroupUpdate(a({},e.groupId,t))})),document.addEventListener("startRecording",(function(e){e.stopPropagation(),f("[startRecording] ->",e);var t=(new Date).getTime()+e.duration;i.recording=!0;var n=new Event("setState");if(n.updateRecording=!0,document.dispatchEvent(n),i.recordUntil<t){if(f("[startRecording] duration is longer than current recording duration, updating"),i.recordUntil=t,void 0!==i.clearRecordTimeoutID)try{clearTimeout(i.clearRecordTimeoutID),delete i.clearRecordTimeoutID}catch(e){h("[startRecording] error ->",e)}i.clearRecordTimeoutID=setTimeout((function(){f("[clearRecordTimeoutID] setting recording to false\nthis ->",i),i.recording=!1,(n=new Event("setState")).updateRecording=!0,document.dispatchEvent(n)}),e.duration),f("[startRecording] new recordUntil: ",i.recordUntil," timeoutID: ",i.clearRecordTimeoutID,"\nthis:",i)}}))),this.watchUserPresence()}var t,n;return function(e,t,n){t&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"setAbly",value:function(e,t){var n=this;p(e,this.attributes.email,t),this.channel=e.channels.get("".concat(t,":").concat(this.attributes.email));try{this.channel.presence.get((function(e,t){if(e)return f("[presence] get presence error ->",e);t.forEach(n.updatePresence.bind(n))}))}catch(e){h("[presence] get error ->",e)}this.channel.presence.subscribe(this.updatePresence.bind(this)),this.channel.presence.enter(this.currentState||{state:"working",recording:!1,agent_platform:"cros",agent_version:y.version,device_serial:g.GetSerialNumber(),clientId:this.attributes.email},(function(e){e&&(h("[presence] enter presence error ->",e),n.refreshPresence())})),this.channel.subscribe("remoteDebug",this.onRemoteDebug.bind(this)),this.channel.subscribe("closeTab",this.onCloseTab.bind(this)),this.channel.subscribe("focusTab",this.onFocusTab.bind(this)),this.channel.subscribe("sendGroupUpdate",(function(e){if(f("[sendGroupUpdate] msg ->",e),"object"===s(e.data)&&e.data.groupGuid){var t=n.lastGroupMsg[e.data.groupGuid]||{};n.publishGroupUpdate(a({},e.data.groupGuid,t),!0)}})),this.commands.applyBindings(this.channel)}},{key:"refreshPresence",value:function(){var e=this.currentState||{state:"working",recording:!1,agent_platform:"cros",agent_version:y.version,device_serial:g.GetSerialNumber(),clientId:this.attributes.email};f("[refreshPresence] setting presence state ->",e),this.channel.presence.update(e)}},{key:"watchUserPresenceCheck",value:(n=i(r().mark((function e(){var t,n,o,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.policy||!this.policy.isChromebookOnly()){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,m(this.channel,this.attributes.email);case 5:t=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),f("[watchUserPresenceCheck] error obtaining presence ->",e.t0),e.abrupt("return");case 12:if(f("[watchUserPresenceCheck] checking presence state using email: ",this.attributes.email," got: ",t),0!==t.length){e.next=17;break}return f("[watchUserPresenceCheck] refreshing empty presence list"),this.refreshPresence(),e.abrupt("return");case 17:n=0,o=t.length;case 18:if(!(n<o)){e.next=26;break}if((i=t[n]).clientId!==this.attributes.email||void 0===i.data.state){e.next=23;break}return f("[watchUserPresenceCheck] We have a presence, no need to refresh."),e.abrupt("return");case 23:n++,e.next=18;break;case 26:f("[watchUserPresenceCheck] no valid presence found, refreshing"),this.refreshPresence();case 28:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(){return n.apply(this,arguments)})},{key:"watchUserPresence",value:function(){this.watchUserPresenceIntId&&(clearInterval(this.watchUserPresenceIntId),this.watchUserPresenceIntId=void 0),f("[watchUserPresence] starting timer"),this.watchUserPresenceIntId=setInterval(this.watchUserPresenceCheck.bind(this),3e4)}},{key:"groupHasListener",value:function(e){var t=this,n=!1;return Object.keys(this.presence).some((function(r){var o=t.presence[r];if(f("[groupHasListener] presence data ->",o),void 0!==o.groupGuid&&o.groupGuid===e)return n=!0,!0})),f("[groupHasListener] group: ",e," is ",n),n}},{key:"getActiveWindowActiveTabUrl",value:function(){return new Promise((function(e,t){try{chrome.tabs.query({active:!0,lastFocusedWindow:!0},(function(t){var n=t[0]&&t[0].url?t[0].url:null;e(n)}))}catch(e){t(e)}}))}},{key:"publishGroupUpdate",value:(t=i(r().mark((function e(t,n){var o,i,a,s,c,u=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=Object.keys(t)[0],!this.policy||this.policy.isClassroomActive()){e.next=7;break}f("[Classroom] IS NOT active"),i=Object.values(t)[0],t[o]=Object.assign({},i,{activeWindowActiveTabUrl:null,currentHost:null,favico:null,top:null}),e.next=13;break;case 7:return f("[Classroom] is active"),e.next=10,this.getActiveWindowActiveTabUrl();case 10:a=e.sent,t[o].activeWindowActiveTabUrl=a,t[o].currentHost||(s=new URL(a),t[o].currentHost=s.host);case 13:if(f("[publishGroupUpdate] sending: ",{data:t,force:n}),!n){e.next=19;break}if(!this.policy||this.policy.isClassroomActive()){e.next=17;break}return e.abrupt("return");case 17:return this.channel.publish("groupUpdate",t),e.abrupt("return");case 19:if(c={},Object.keys(t).forEach((function(e){u.groupHasListener(e)&&(c[e]=t[e])})),f("[publishGroupUpdate] sending ->",c),!(Object.keys(c).length>0)){e.next=26;break}if(!this.policy||this.policy.isClassroomActive()){e.next=25;break}return e.abrupt("return");case 25:this.channel.publish("groupUpdate",t);case 26:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"updatePresence",value:function(e){if("object"!==s(e))throw new Error("presence event required");if(f("[updatePresence] presence new event ->",e),"leave"===e.action)delete this.presence[e.connectionId];else{var t=this.presence[e.connectionId]||{};if(this.presence[e.connectionId]=e.data,this.presence[e.connectionId].clientId=e.clientId,!t.viewingTabs&&e.data&&e.data.viewingTabs&&this.sendTabs(),t.groupId!==e.data.groupId){var n=e.data.groupId,r=this.lastGroupMsg[n];f("[updatePresence] connectionId ".concat(e.connectionId," joined a new group, resending last packet")),void 0!==r&&this.publishGroupUpdate(a({},n,r),!0)}}f("[updatePresence] updated presence list ->",this.presence)}},{key:"listenerHasFlag",value:function(e){var t=this;if("string"!=typeof e)throw new Error("flagName must be a string");var n=!1;return Object.keys(this.presence).some((function(r){if("object"===s(t.presence[r])&&Boolean(t.presence[r][e]))return n=!0,!0})),n}},{key:"sendTabs",value:function(){!this.policy||this.policy.isClassroomActive()?this.listenerHasFlag("viewingTabs")&&LSClassroomWASM.SendTabs():this.channel.publish("tabs",[])}},{key:"onRemoteDebug",value:function(e){if(f("[onRemoteDebug] msg ->",e),"object"===s(e)){var t=e.data;"string"==typeof t&&(t=JSON.parse(t)),"string"==typeof t.scope&&d(t.scope),"string"==typeof t.twilio&&v(t.twilio)}}},{key:"onCloseTab",value:function(e){f("[onCloseTab] msg ->",e),this.policy&&!this.policy.isClassroomActive()||"object"===s(e)&&"object"===s(e.data)&&("number"==typeof e.data.tabId?chrome.tabs.remove(e.data.tabId):"string"==typeof e.data.url&&chrome.tabs.query({},(function(t){t.forEach((function(t){t.url===e.data.url&&chrome.tabs.remove(t.id)}))})))}},{key:"onFocusTab",value:function(e){f("[onFocusTab] ->",e),this.policy&&!this.policy.isClassroomActive()||"object"===s(e)&&"object"===s(e.data)&&"number"==typeof e.data.windowId&&"number"==typeof e.data.tabId&&chrome.windows.update(e.data.windowId,{focused:!0},(function(){chrome.tabs.update(e.data.tabId,{active:!0})}))}}]),e}();t.exports=b},{"./debug":3,"./telemetry":17}],19:[function(e,t,n){"use strict";function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}e("./wasm_exec");var i,a=e("./debug"),s=a.wsmLog,c=a.errLog,u=chrome.runtime.getManifest(),l={ident:[],ip:[],tab:[]};!function e(){var t=new Go;WebAssembly.instantiateStreaming(fetch(chrome.runtime.getURL("classroom.wasm")),t.importObject).then((function(e){t.run(e.instance),LSClassroomWASM.Setup("61-6373-A000",u.version)})).catch((function(t){c("[setup] error ->",t),i&&clearTimeout(i),i=setTimeout(e,5e3)}))}(),t.exports.Debug=s,t.exports.GetPolicy=function(){if("undefined"!=typeof Event){var e=new Event("policyUpdate");e.triggeredAt=Date.now(),document.dispatchEvent(e)}},t.exports.SetIdentCB=function(e){l.ident.push(e)},t.exports.SendIdentCB=function(e){var t,n=r(l.ident);try{for(n.s();!(t=n.n()).done;){var o=t.value;try{o(e)}catch(e){c("[SendIdentCB] Error triggering callback ->",e)}}}catch(e){n.e(e)}finally{n.f()}},t.exports.SetIPCB=function(e){l.ip.push(e)},t.exports.SendIPCB=function(e){var t,n=r(l.ip);try{for(n.s();!(t=n.n()).done;){var o=t.value;try{o(e)}catch(e){c("[SendIPCB] Error triggering callback ->",e)}}}catch(e){n.e(e)}finally{n.f()}},t.exports.SetTabCB=function(e){l.tab.push(e)},t.exports.SendTabCB=function(e){var t,n=r(l.tab);try{for(n.s();!(t=n.n()).done;){var o=t.value;try{o(e)}catch(e){c("[SendTabCB] Error triggering callback ->",e)}}}catch(e){n.e(e)}finally{n.f()}}},{"./debug":3,"./wasm_exec":20}],20:[function(e,t,n){"use strict";function r(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),s=new I(r||[]);return a(i,"_invoke",{value:C(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",v="executing",y="completed",g={};function m(){}function b(){}function w(){}var k={};f(k,c,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==n&&o.call(E,c)&&(k=E);var O=w.prototype=m.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(r,a,s,c){var u=p(e[r],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==i(f)&&o.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var r;a(this,"_invoke",{value:function(e,o){function i(){return new t((function(t,r){n(e,o,t,r)}))}return r=r?r.then(i,i):i()}})}function C(t,n,r){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var u=p(t,n,r);if("normal"===u.type){if(o=r.done?y:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(o.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(i(t)+" is not iterable")}return b.prototype=w,a(O,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),f(x.prototype,u,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),f(O,l,"Generator"),f(O,c,(function(){return this})),f(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function o(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}!function(){var e=function(){var e=new Error("not implemented");return e.code="ENOSYS",e};if(!globalThis.fs){var t="";globalThis.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1},writeSync:function(e,n){var r=(t+=s.decode(n)).lastIndexOf("\n");return-1!==r&&(console.log(t.substring(0,r)),t=t.substring(r+1)),n.length},write:function(t,n,r,o,i,a){0===r&&o===n.length&&null===i?a(null,this.writeSync(t,n)):a(e())},chmod:function(t,n,r){r(e())},chown:function(t,n,r,o){o(e())},close:function(t,n){n(e())},fchmod:function(t,n,r){r(e())},fchown:function(t,n,r,o){o(e())},fstat:function(t,n){n(e())},fsync:function(e,t){t(null)},ftruncate:function(t,n,r){r(e())},lchown:function(t,n,r,o){o(e())},link:function(t,n,r){r(e())},lstat:function(t,n){n(e())},mkdir:function(t,n,r){r(e())},open:function(t,n,r,o){o(e())},read:function(t,n,r,o,i,a){a(e())},readdir:function(t,n){n(e())},readlink:function(t,n){n(e())},rename:function(t,n,r){r(e())},rmdir:function(t,n){n(e())},stat:function(t,n){n(e())},symlink:function(t,n,r){r(e())},truncate:function(t,n,r){r(e())},unlink:function(t,n){n(e())},utimes:function(t,n,r,o){o(e())}}}if(globalThis.process||(globalThis.process={getuid:function(){return-1},getgid:function(){return-1},geteuid:function(){return-1},getegid:function(){return-1},getgroups:function(){throw e()},pid:-1,ppid:-1,umask:function(){throw e()},cwd:function(){throw e()},chdir:function(){throw e()}}),!globalThis.crypto)throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");if(!globalThis.performance)throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");if(!globalThis.TextEncoder)throw new Error("globalThis.TextEncoder is not available, polyfill required");if(!globalThis.TextDecoder)throw new Error("globalThis.TextDecoder is not available, polyfill required");var n=new TextEncoder("utf-8"),s=new TextDecoder("utf-8");globalThis.Go=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.argv=["js"],this.env={},this.exit=function(e){0!==e&&console.warn("exit code:",e)},this._exitPromise=new Promise((function(e){t._resolveExitPromise=e})),this._pendingEvent=null,this._scheduledTimeouts=new Map,this._nextCallbackTimeoutID=1;var r=function(e,n){t.mem.setUint32(e+0,n,!0),t.mem.setUint32(e+4,Math.floor(n/4294967296),!0)},o=function(e){return t.mem.getUint32(e+0,!0)+4294967296*t.mem.getInt32(e+4,!0)},a=function(e){var n=t.mem.getFloat64(e,!0);if(0!==n){if(!isNaN(n))return n;var r=t.mem.getUint32(e,!0);return t._values[r]}},c=function(e,n){if("number"==typeof n&&0!==n)return isNaN(n)?(t.mem.setUint32(e+4,2146959360,!0),void t.mem.setUint32(e,0,!0)):void t.mem.setFloat64(e,n,!0);if(void 0!==n){var r=t._ids.get(n);void 0===r&&(void 0===(r=t._idPool.pop())&&(r=t._values.length),t._values[r]=n,t._goRefCounts[r]=0,t._ids.set(n,r)),t._goRefCounts[r]++;var o=0;switch(i(n)){case"object":null!==n&&(o=1);break;case"string":o=2;break;case"symbol":o=3;break;case"function":o=4}t.mem.setUint32(e+4,2146959360|o,!0),t.mem.setUint32(e,r,!0)}else t.mem.setFloat64(e,0,!0)},u=function(e){var n=o(e+0),r=o(e+8);return new Uint8Array(t._inst.exports.mem.buffer,n,r)},l=function(e){for(var t=o(e+0),n=o(e+8),r=new Array(n),i=0;i<n;i++)r[i]=a(t+8*i);return r},f=function(e){var n=o(e+0),r=o(e+8);return s.decode(new DataView(t._inst.exports.mem.buffer,n,r))},h=Date.now()-performance.now();this.importObject={_gotest:{add:function(e,t){return e+t}},gojs:{"runtime.wasmExit":function(e){e>>>=0;var n=t.mem.getInt32(e+8,!0);t.exited=!0,delete t._inst,delete t._values,delete t._goRefCounts,delete t._ids,delete t._idPool,t.exit(n)},"runtime.wasmWrite":function(e){var n=o((e>>>=0)+8),r=o(e+16),i=t.mem.getInt32(e+24,!0);fs.writeSync(n,new Uint8Array(t._inst.exports.mem.buffer,r,i))},"runtime.resetMemoryDataView":function(e){t.mem=new DataView(t._inst.exports.mem.buffer)},"runtime.nanotime1":function(e){r((e>>>=0)+8,1e6*(h+performance.now()))},"runtime.walltime":function(e){e>>>=0;var n=(new Date).getTime();r(e+8,n/1e3),t.mem.setInt32(e+16,n%1e3*1e6,!0)},"runtime.scheduleTimeoutEvent":function(e){e>>>=0;var n=t._nextCallbackTimeoutID;t._nextCallbackTimeoutID++,t._scheduledTimeouts.set(n,setTimeout((function(){for(t._resume();t._scheduledTimeouts.has(n);)console.warn("scheduleTimeoutEvent: missed timeout event"),t._resume()}),o(e+8))),t.mem.setInt32(e+16,n,!0)},"runtime.clearTimeoutEvent":function(e){e>>>=0;var n=t.mem.getInt32(e+8,!0);clearTimeout(t._scheduledTimeouts.get(n)),t._scheduledTimeouts.delete(n)},"runtime.getRandomData":function(e){e>>>=0,crypto.getRandomValues(u(e+8))},"syscall/js.finalizeRef":function(e){e>>>=0;var n=t.mem.getUint32(e+8,!0);if(t._goRefCounts[n]--,0===t._goRefCounts[n]){var r=t._values[n];t._values[n]=null,t._ids.delete(r),t._idPool.push(n)}},"syscall/js.stringVal":function(e){c((e>>>=0)+24,f(e+8))},"syscall/js.valueGet":function(e){e>>>=0;var n=Reflect.get(a(e+8),f(e+16));e=t._inst.exports.getsp()>>>0,c(e+32,n)},"syscall/js.valueSet":function(e){e>>>=0,Reflect.set(a(e+8),f(e+16),a(e+32))},"syscall/js.valueDelete":function(e){e>>>=0,Reflect.deleteProperty(a(e+8),f(e+16))},"syscall/js.valueIndex":function(e){c((e>>>=0)+24,Reflect.get(a(e+8),o(e+16)))},"syscall/js.valueSetIndex":function(e){e>>>=0,Reflect.set(a(e+8),o(e+16),a(e+24))},"syscall/js.valueCall":function(e){e>>>=0;try{var n=a(e+8),r=Reflect.get(n,f(e+16)),o=l(e+32),i=Reflect.apply(r,n,o);e=t._inst.exports.getsp()>>>0,c(e+56,i),t.mem.setUint8(e+64,1)}catch(n){e=t._inst.exports.getsp()>>>0,c(e+56,n),t.mem.setUint8(e+64,0)}},"syscall/js.valueInvoke":function(e){e>>>=0;try{var n=a(e+8),r=l(e+16),o=Reflect.apply(n,void 0,r);e=t._inst.exports.getsp()>>>0,c(e+40,o),t.mem.setUint8(e+48,1)}catch(n){e=t._inst.exports.getsp()>>>0,c(e+40,n),t.mem.setUint8(e+48,0)}},"syscall/js.valueNew":function(e){e>>>=0;try{var n=a(e+8),r=l(e+16),o=Reflect.construct(n,r);e=t._inst.exports.getsp()>>>0,c(e+40,o),t.mem.setUint8(e+48,1)}catch(n){e=t._inst.exports.getsp()>>>0,c(e+40,n),t.mem.setUint8(e+48,0)}},"syscall/js.valueLength":function(e){r((e>>>=0)+16,parseInt(a(e+8).length))},"syscall/js.valuePrepareString":function(e){e>>>=0;var t=n.encode(String(a(e+8)));c(e+16,t),r(e+24,t.length)},"syscall/js.valueLoadString":function(e){var t=a((e>>>=0)+8);u(e+16).set(t)},"syscall/js.valueInstanceOf":function(e){e>>>=0,t.mem.setUint8(e+24,a(e+8)instanceof a(e+16)?1:0)},"syscall/js.copyBytesToGo":function(e){var n=u((e>>>=0)+8),o=a(e+32);if(o instanceof Uint8Array||o instanceof Uint8ClampedArray){var i=o.subarray(0,n.length);n.set(i),r(e+40,i.length),t.mem.setUint8(e+48,1)}else t.mem.setUint8(e+48,0)},"syscall/js.copyBytesToJS":function(e){var n=a((e>>>=0)+8),o=u(e+16);if(n instanceof Uint8Array||n instanceof Uint8ClampedArray){var i=o.subarray(0,n.length);n.set(i),r(e+40,i.length),t.mem.setUint8(e+48,1)}else t.mem.setUint8(e+48,0)},debug:function(e){console.log(e)}}}}var t,c;return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"run",value:(t=r().mark((function e(t){var o,i,a,s,c,u=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof WebAssembly.Instance){e.next=2;break}throw new Error("Go.run: WebAssembly.Instance expected");case 2:if(this._inst=t,this.mem=new DataView(this._inst.exports.mem.buffer),this._values=[NaN,0,null,!0,!1,globalThis,this],this._goRefCounts=new Array(this._values.length).fill(1/0),this._ids=new Map([[0,1],[null,2],[!0,3],[!1,4],[globalThis,5],[this,6]]),this._idPool=[],this.exited=!1,o=4096,i=function(e){var t=o,r=n.encode(e+"\0");return new Uint8Array(u.mem.buffer,o,r.length).set(r),(o+=r.length)%8!=0&&(o+=8-o%8),t},a=this.argv.length,s=[],this.argv.forEach((function(e){s.push(i(e))})),s.push(0),Object.keys(this.env).sort().forEach((function(e){s.push(i("".concat(e,"=").concat(u.env[e])))})),s.push(0),c=o,s.forEach((function(e){u.mem.setUint32(o,e,!0),u.mem.setUint32(o+4,0,!0),o+=8})),!(o>=12288)){e.next=23;break}throw new Error("total length of command line and environment variables exceeds limit");case 23:return this._inst.exports.run(a,c),this.exited&&this._resolveExitPromise(),e.next=27,this._exitPromise;case 27:case"end":return e.stop()}}),e,this)})),c=function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function s(e){o(a,r,i,s,c,"next",e)}function c(e){o(a,r,i,s,c,"throw",e)}s(void 0)}))},function(e){return c.apply(this,arguments)})},{key:"_resume",value:function(){if(this.exited)throw new Error("Go program has already exited");this._inst.exports.resume(),this.exited&&this._resolveExitPromise()}},{key:"_makeFuncWrapper",value:function(e){var t=this;return function(){var n={id:e,this:this,args:arguments};return t._pendingEvent=n,t._resume(),n.result}}}]),e}()}()},{}],21:[function(e,t,n){"use strict";var r=e("../src/config"),o=e("../src/debug").tbcLog;var i={high:{fps:1,jpegQuality:100},medium:{fps:1,jpegQuality:60},low:{fps:1,jpegQuality:20}};t.exports={isValidTabs:function(e){if(!Array.isArray(e)||0===e.length)return!1;var t=e[0],n=document.createElement("a");return n.href=t.url,!n.protocol||!n.protocol.match(/^chrome|^about/i)},checkListenerQuality:function(e){return void 0===e?(o("[checkListenerQuality] user is undefined"),null):e.listenerHasFlag("viewingBroadcast")?"high":e.listenerHasFlag("viewingFlyout")?"medium":e.listenerHasFlag("viewingThumbnail")?"low":"medium"},getCurrentCaptureInfo:function(e){var t=r.GetJpegQuality();return t&&t>0&&t<=100?{fps:1,jpegQuality:t}:i[e]||i.medium}}},{"../src/config":2,"../src/debug":3}],22:[function(e,t,n){"use strict";t.exports={getAllActiveGroupGuids:function(e){if(!e||!e.isClassroomActive())return[];var t=[];for(var n in e.groups)e.groups[n].isActive()&&t.push(e.groups[n].id);return t},getAllActiveWebRulesGroupGuids:function(e){if(!e||!e.isClassroomActive())return[];var t=[];for(var n in e.groups){var r=e.groups[n];r.isActive()&&r.sites.length>0&&t.push(e.groups[n].id)}return t},setCurrentHost:function(e,t){if(t&&e){var n=t.favIconUrl||null,r=document.createElement("a");r.href=t.url,e.setCurrent(r.hostname,n)}}}},{}],23:[function(e,t,n){"use strict";var r=e("../src/debug").tbsLog,o=e("./groups").getAllActiveWebRulesGroupGuids,i="https://devices.classroom.relay.school/block",a={};var s={};function c(){Object.keys(a).forEach((function(e){var t=a[e];chrome.tabs.get(t.id,(function(e){e.url.startsWith(i)&&(r("[restoreTabs] restoring tab:",e.id),chrome.tabs.update(e.id,{url:t.url}))}))})),a={}}t.exports={filterTabs:function(e){if(e.isClassroomActive())return new Promise((function(t,n){return chrome.tabs.query({},(function(u){e.internetPaused||c();var l=[];return u.forEach((function(t){if(r("[filterTabs] tab: ",t),t.url&&!t.url.startsWith(i)&&!t.url.match(/^chrome[^:]*:/i)&&t.url.match(/^https?:\/\//i)){var n,c;e.internetPaused&&(r("[filterTabs] saving tab url: ",t.url),a[t.id]={id:t.id,url:t.url});var u=Object.keys(e.groups).map((function(r){var o=e.groups[r],i=o.scoreUrl(t.url).allowed;return!1===i&&(n=o.id,c=o.encryptedUserEmail),i}));if(r("[filterTabs] decisions: ",{tab:t,decisions:u}),-1!==u.indexOf(!1)&&-1===u.indexOf(!0)){var f=i;n&&(f+="?guid=".concat(n,"&cId=").concat(e.encryptedCustomerId,"&encryptedUserEmail=").concat(c)),l.push(function(e,t,n){if(n.isClassroomActive())return new Promise((function(n){return chrome.tabs.update(e,{url:t},(function(){n()}))}))}(t.id,f,e))}}"about:blank"===t.url&&function(e,t){if(!e||s[e])return;if(0===o(t).length)return;s[e]=setTimeout((function(){try{chrome.tabs.get(e,(function(t){"about:blank"===t.url?(r("[closeAboutBlankTab] closing:",e),chrome.tabs.remove(e)):r("[closeAboutBlankTab] not closing:",e,t.url)}))}catch(e){r("[closeAboutBlankTab] error ->",e)}delete s[e]}),t.autoClose)}(t.id,e)})),Promise.all(l).then(t).catch(n)}))}));c()}}},{"../src/debug":3,"./groups":22}],24:[function(e,t,n){"use strict";var r,o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("events"),u=e("./constants"),l=e("./errors"),f=e("./polyfills"),h=e("./recorder/audio"),p=e("./utils/optionValidation"),d=function(e){function t(n){var r=e.call(this)||this;return r.activeWarnings=new Set,r._audioContext=null,r._audioRecorder=null,r._cleanupAudio=null,r._defaultDevices={},r._endTime=null,r._errors=[],r._mediaStream=null,r._volumeStats={timestamps:[],values:[]},r._volumeTimeout=null,r._options=i(i({},t.defaultOptions),n),setTimeout((function(){return r._startTest()})),r}return o(t,e),t.prototype.stop=function(){var e=this;if("number"!=typeof this._endTime){this._endTime=Date.now();var n={deviceId:this._options.deviceId||this._defaultDevices.audioinput&&this._defaultDevices.audioinput.deviceId,errors:this._errors,testName:t.testName,values:this._volumeStats.values};this._startTime&&(n.testTiming={duration:this._endTime-this._startTime,end:this._endTime,start:this._startTime});var r=function(){e._cleanup(),e.emit(t.Events.End,n)};this._options.enableRecording&&this._audioRecorder?this._audioRecorder.stop().then((function(){n.recordingUrl=e._audioRecorder.url})).catch((function(t){e._onError(t)})).finally(r):r()}else this._onWarning(new l.AlreadyStoppedError)},t.prototype._cleanup=function(){this._volumeTimeout&&clearTimeout(this._volumeTimeout),this._cleanupAudio&&this._cleanupAudio(),this._mediaStream&&this._mediaStream.getTracks().forEach((function(e){return e.stop()})),this._audioContext&&this._audioContext.close()},t.prototype._onError=function(e){this._errors.push(e),this.emit(t.Events.Error,e)},t.prototype._onVolume=function(e){var n=Date.now();(!this._volumeStats.max||e>this._volumeStats.max)&&(this._volumeStats.max=e),this._volumeStats.values.push(e),this._volumeStats.timestamps.push(n),this.emit(t.Events.Volume,e);var r=this._volumeStats.timestamps.findIndex((function(e){return n-e<=3e3}));if(!(r<1)){var o=this._volumeStats.values.slice(r>0?r:0),i=o.reduce((function(e,t){return e+t}),0)/o.length,a=o.map((function(e){return Math.pow(e-i,2)}));Math.sqrt(a.reduce((function(e,t){return e+t}),0)/o.length)<=2.55&&i<=2.55?this.activeWarnings.has(u.WarningName.LowAudioLevel)||(this.activeWarnings.add(u.WarningName.LowAudioLevel),this.emit(t.Events.Warning,u.WarningName.LowAudioLevel)):this.activeWarnings.has(u.WarningName.LowAudioLevel)&&(this.activeWarnings.delete(u.WarningName.LowAudioLevel),this.emit(t.Events.WarningCleared,u.WarningName.LowAudioLevel))}},t.prototype._onWarning=function(e){this._options.debug&&console.warn(e)},t.prototype._startTest=function(){return a(this,void 0,void 0,(function(){var e,t,n,r,o,i,a,c,u,h=this;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,4,,5]),[4,p.validateOptions(this._options,{deviceId:p.validateDeviceId,duration:p.validateTime,volumeEventIntervalMs:p.validateTime})];case 1:if(e=s.sent())throw new l.InvalidOptionsError(e);if(!this._options.getUserMedia)throw f.GetUserMediaUnsupportedError;return t=this,[4,this._options.getUserMedia({audio:{deviceId:this._options.deviceId}})];case 2:if(t._mediaStream=s.sent(),!this._options.audioContextFactory)throw f.AudioContextUnsupportedError;if(this._audioContext=new this._options.audioContextFactory,this._options.enableRecording&&(this._audioRecorder=new this._options.audioRecorderFactory({audioContext:this._audioContext,stream:this._mediaStream})),!this._options.enumerateDevices)throw f.EnumerateDevicesUnsupportedError;return n=this,r=f.getDefaultDevices,[4,this._options.enumerateDevices()];case 3:return n._defaultDevices=r.apply(void 0,[s.sent()]),this._startTime=Date.now(),(o=this._audioContext.createAnalyser()).smoothingTimeConstant=.4,o.fftSize=64,(i=this._audioContext.createMediaStreamSource(this._mediaStream)).connect(o),this._cleanupAudio=function(){o.disconnect(),i.disconnect()},a=new Uint8Array(o.frequencyBinCount),c=function(){if(!h._endTime){o.getByteFrequencyData(a);var e=a.reduce((function(e,t){return e+t}),0)/a.length;h._onVolume(e),Date.now()-h._startTime>h._options.duration?h.stop():h._volumeTimeout=setTimeout(c,h._options.volumeEventIntervalMs)}},this._volumeTimeout=setTimeout(c,this._options.volumeEventIntervalMs),[3,5];case 4:return(u=s.sent())instanceof l.DiagnosticError?this._onError(u):"undefined"!=typeof DOMException&&u instanceof DOMException?this._onError(new l.DiagnosticError(u,"A `DOMException` has occurred.")):"undefined"!=typeof DOMError&&u instanceof DOMError?this._onError(new l.DiagnosticError(u,"A `DOMError` has occurred.")):"undefined"!=typeof Error&&u instanceof Error?this._onError(new l.DiagnosticError(u,"An error has occurred.")):(this._onError(new l.DiagnosticError(void 0,"Unknown error occurred.")),this._onWarning(u)),this.stop(),[3,5];case 5:return[2]}}))}))},t.testName="audio-input-test",t.defaultOptions={audioContextFactory:f.AudioContext,audioRecorderFactory:h.AudioRecorder,debug:!1,duration:1/0,enableRecording:!1,enumerateDevices:f.enumerateDevices,getUserMedia:f.getUserMedia,volumeEventIntervalMs:100},t}(c.EventEmitter);n.AudioInputTest=d,function(e){!function(e){e.End="end",e.Error="error",e.Volume="volume",e.Warning="warning",e.WarningCleared="warning-cleared"}(e.Events||(e.Events={}))}(d=n.AudioInputTest||(n.AudioInputTest={})),n.AudioInputTest=d,n.testAudioInputDevice=function(e){return new d(e)}},{"./constants":28,"./errors":35,"./polyfills":40,"./recorder/audio":41,"./utils/optionValidation":45,events:102}],25:[function(e,t,n){"use strict";var r,o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("events"),u=e("./constants"),l=e("./errors"),f=e("./polyfills"),h=e("./utils/optionValidation"),p=function(e){function t(n){var r=e.call(this)||this;return r._audio=[],r._audioContext=null,r._defaultDevices={},r._endTime=null,r._errors=[],r._values=[],r._volumeTimeout=null,r._options=i(i({},t.defaultOptions),n),r._startTime=Date.now(),setTimeout((function(){return r._startTest()})),r}return o(t,e),t.prototype.stop=function(){if(this._endTime)this._onWarning(new l.AlreadyStoppedError);else{this._cleanup(),this._endTime=Date.now();var e={deviceId:this._options.deviceId||this._defaultDevices.audiooutput&&this._defaultDevices.audiooutput.deviceId,errors:this._errors,testName:t.testName,testTiming:{duration:this._endTime-this._startTime,end:this._endTime,start:this._startTime},testURI:this._options.testURI,values:this._values};this.emit(t.Events.End,e)}},t.prototype._cleanup=function(){this._volumeTimeout&&clearTimeout(this._volumeTimeout),this._audioContext&&this._audioContext.close(),this._audio.forEach((function(e){e.pause()}))},t.prototype._onError=function(e){this._errors.push(e),this.emit(t.Events.Error,e)},t.prototype._onVolume=function(e){this._values.push(e),this.emit(t.Events.Volume,e)},t.prototype._onWarning=function(e){this._options.debug&&console.warn(e)},t.prototype._startTest=function(){var e,t;return a(this,void 0,void 0,(function(){var n,r,o,i,a,c,u,p,d,v,y,g=this;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,9,,10]),[4,h.validateOptions(this._options,{deviceId:h.validateDeviceId,duration:h.validateTime,volumeEventIntervalMs:h.validateTime})];case 1:if(n=s.sent())throw new l.InvalidOptionsError(n);if(!this._options.audioElementFactory)throw f.AudioUnsupportedError;if(!this._options.audioContextFactory)throw f.AudioContextUnsupportedError;if(!(r="function"==typeof this._options.audioElementFactory.prototype.setSinkId))return[3,3];if(!this._options.enumerateDevices)throw f.EnumerateDevicesUnsupportedError;return[4,this._options.enumerateDevices()];case 2:if(o=s.sent(),0===o.filter((function(e){return"audiooutput"===e.kind})).length)throw new l.DiagnosticError(void 0,"No output devices found.");this._defaultDevices=f.getDefaultDevices(o),s.label=3;case 3:return this._audioContext=new this._options.audioContextFactory,(i=new this._options.audioElementFactory(this._options.testURI)).setAttribute("crossorigin","anonymous"),i.loop=!!this._options.doLoop,a=this._audioContext.createMediaElementSource(i),(c=this._audioContext.createAnalyser()).smoothingTimeConstant=.4,c.fftSize=64,a.connect(c),u=new Uint8Array(c.frequencyBinCount),p=function(){if(!g._endTime){c.getByteFrequencyData(u);var e=u.reduce((function(e,t){return e+t}),0)/u.length;g._onVolume(e);var t=Date.now()-g._startTime>g._options.duration;(g._options.doLoop?t:i.ended||t)?g.stop():g._volumeTimeout=setTimeout(p,g._options.volumeEventIntervalMs)}},this._options.deviceId&&r?(d=this._audioContext.createMediaStreamDestination(),c.connect(d),(v=new this._options.audioElementFactory).loop=!!this._options.doLoop,v.srcObject=d.stream,[4,null===(t=(e=v).setSinkId)||void 0===t?void 0:t.call(e,this._options.deviceId)]):[3,6];case 4:return s.sent(),[4,v.play()];case 5:return s.sent(),this._audio.push(v),[3,7];case 6:if(this._options.deviceId&&!r)throw new l.UnsupportedError("A `deviceId` was passed to the `AudioOutputTest` but `setSinkId` is not supported in this browser.");c.connect(this._audioContext.destination),s.label=7;case 7:return[4,i.play()];case 8:return s.sent(),this._audio.push(i),this._volumeTimeout=setTimeout(p,this._options.volumeEventIntervalMs),[3,10];case 9:return(y=s.sent())instanceof l.DiagnosticError?this._onError(y):"undefined"!=typeof DOMException&&y instanceof DOMException?this._onError(new l.DiagnosticError(y,"A DOMException has occurred.")):"undefined"!=typeof DOMError&&y instanceof DOMError?this._onError(new l.DiagnosticError(y,"A DOMError has occurred.")):"undefined"!=typeof Error&&y instanceof Error?this._onError(new l.DiagnosticError(y,"An error has occurred.")):(this._onError(new l.DiagnosticError(void 0,"Unknown error occurred.")),this._onWarning(y)),this.stop(),[3,10];case 10:return[2]}}))}))},t.testName="audio-output-test",t.defaultOptions={audioContextFactory:f.AudioContext,audioElementFactory:f.Audio,debug:!1,doLoop:!0,duration:1/0,enumerateDevices:f.enumerateDevices,testURI:u.INCOMING_SOUND_URL,volumeEventIntervalMs:100},t}(c.EventEmitter);n.AudioOutputTest=p,function(e){!function(e){e.End="end",e.Error="error",e.Volume="volume"}(e.Events||(e.Events={}))}(p=n.AudioOutputTest||(n.AudioOutputTest={})),n.AudioOutputTest=p,n.testAudioOutputDevice=function(e){return new p(e)}},{"./constants":28,"./errors":35,"./polyfills":40,"./utils/optionValidation":45,events:102}],26:[function(e,t,n){"use strict";var r,o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(n,"__esModule",{value:!0});var a=e("events"),s=e("./constants"),c=e("./errors/DiagnosticError"),u=e("./utils/candidate"),l=function(e){function t(t){var n=e.call(this)||this;n.activeWarnings=new Set,n._endTime=null,n._errors=[],n._iceCandidateStats=[],n._lastBytesChecked=0,n._lastCheckedTimestamp=0,n._totalBytesReceived=0,n._values=[],n._options=i({},t);var r=n._options.iceServers;return n._pcReceiver=new RTCPeerConnection({iceServers:r,iceTransportPolicy:"relay"}),n._pcSender=new RTCPeerConnection({iceServers:r}),n._pcReceiver.onicecandidate=function(e){return n._onIceCandidate(n._pcSender,e)},n._pcSender.onicecandidate=function(e){return n._onIceCandidate(n._pcReceiver,e)},n._setupNetworkListeners(n._pcSender),n._startTime=Date.now(),setTimeout((function(){n._setupDataChannel(),n._startTest()})),n._timeout=setTimeout((function(){n._onError("Network timeout; exceeded limit of "+s.BITRATE_TEST_TIMEOUT_MS+"ms")}),s.BITRATE_TEST_TIMEOUT_MS),n}return o(t,e),t.prototype.stop=function(){clearTimeout(this._timeout),clearInterval(this._sendDataIntervalId),clearInterval(this._checkBitrateIntervalId),"number"==typeof this._endTime&&0!==this._endTime||(this._pcSender.close(),this._pcReceiver.close(),this._endTime=Date.now(),this.emit(t.Events.End,this._getReport()))},t.prototype._checkBitrate=function(){if(!this._lastCheckedTimestamp||!this._lastBytesChecked)return this._lastCheckedTimestamp=Date.now(),void(this._lastBytesChecked=this._totalBytesReceived);var e=Date.now(),n=8*(this._totalBytesReceived-this._lastBytesChecked)/(e-this._lastCheckedTimestamp);n>0&&clearTimeout(this._timeout),this._lastCheckedTimestamp=e,this._lastBytesChecked=this._totalBytesReceived,this._values.push(n),this.emit(t.Events.Bitrate,n),this._maybeEmitWarning()},t.prototype._getReport=function(){var e=this._values.reduce((function(e,t){return e+t}),0)/this._values.length;e=isNaN(e)?0:e;var n={start:this._startTime};this._endTime&&(n.end=this._endTime,n.duration=this._endTime-this._startTime);var r={averageBitrate:e,errors:this._errors,iceCandidateStats:this._iceCandidateStats,testName:t.testName,testTiming:n,values:this._values};return this._selectedIceCandidatePairStats&&(r.selectedIceCandidatePairStats=this._selectedIceCandidatePairStats),r},t.prototype._maybeEmitWarning=function(){var e=this;this._values.length<s.MIN_BITRATE_SAMPLE_COUNT||(this._values.slice(this._values.length-s.MIN_BITRATE_SAMPLE_COUNT).filter((function(t){var n;return t<(null!=(n=e._options.minBitrateThreshold)?n:s.MIN_BITRATE_THRESHOLD)})).length>s.MIN_BITRATE_FAIL_COUNT?this.activeWarnings.has(s.WarningName.LowBitrate)||(this.activeWarnings.add(s.WarningName.LowBitrate),this.emit(t.Events.Warning,s.WarningName.LowBitrate)):this.activeWarnings.has(s.WarningName.LowBitrate)&&(this.activeWarnings.delete(s.WarningName.LowBitrate),this.emit(t.Events.WarningCleared,s.WarningName.LowBitrate)))},t.prototype._onError=function(e,n){var r=new c.DiagnosticError(n,e);this._errors.push(r),this.emit(t.Events.Error,r),this.stop()},t.prototype._onIceCandidate=function(e,t){var n=this;t.candidate&&e.addIceCandidate(t.candidate).catch((function(e){return n._onError("Unable to add candidate",e)}))},t.prototype._onMessageReceived=function(e){this._totalBytesReceived+=e.data.length},t.prototype._onReceiverAnswerCreated=function(e){var t=this;return Promise.all([this._pcReceiver.setLocalDescription(e),this._pcSender.setRemoteDescription(e)]).catch((function(e){return t._onError("Unable to set local or remote description from createAnswer",e)}))},t.prototype._onSenderOfferCreated=function(e){var t=this;return Promise.all([this._pcSender.setLocalDescription(e),this._pcReceiver.setRemoteDescription(e)]).catch((function(e){return t._onError("Unable to set local or remote description from createOffer",e)}))},t.prototype._sendData=function(){if(this._rtcDataChannel&&"open"===this._rtcDataChannel.readyState)for(var e=0;e<s.MAX_NUMBER_PACKETS&&!(this._rtcDataChannel.bufferedAmount>=s.BYTES_KEEP_BUFFERED);++e)this._rtcDataChannel.send(s.TEST_PACKET)},t.prototype._setupDataChannel=function(){var e=this;try{this._rtcDataChannel=this._pcSender.createDataChannel("sender")}catch(e){return void this._onError("Error creating data channel",e)}this._rtcDataChannel.onopen=function(){e._sendDataIntervalId=setInterval((function(){return e._sendData()}),1),e._checkBitrateIntervalId=setInterval((function(){return e._checkBitrate()}),1e3)},this._pcReceiver.ondatachannel=function(t){t.channel.onmessage=function(t){return e._onMessageReceived(t)}}},t.prototype._setupNetworkListeners=function(e){var t=this;e.oniceconnectionstatechange=function(){"connected"===e.iceConnectionState&&(t._options.getRTCIceCandidateStatsReport||u.getRTCIceCandidateStatsReport)(t._pcSender).then((function(e){t._iceCandidateStats=e.iceCandidateStats,t._selectedIceCandidatePairStats=e.selectedIceCandidatePairStats})).catch((function(e){t._onError("Unable to generate WebRTC stats report",e)}))}},t.prototype._startTest=function(){var e=this;if(!this._options.iceServers)return this._onError("No iceServers found",void 0);this._pcSender.createOffer().then((function(t){return e._onSenderOfferCreated(t)})).then((function(){return e._pcReceiver.createAnswer().then((function(t){return e._onReceiverAnswerCreated(t)})).catch((function(t){return e._onError("Unable to create answer",t)}))})).catch((function(t){return e._onError("Unable to create offer",t)}))},t.testName="media-connection-bitrate-test",t}(a.EventEmitter);n.MediaConnectionBitrateTest=l,function(e){!function(e){e.Bitrate="bitrate",e.End="end",e.Error="error",e.Warning="warning",e.WarningCleared="warning-cleared"}(e.Events||(e.Events={}))}(l=n.MediaConnectionBitrateTest||(n.MediaConnectionBitrateTest={})),n.MediaConnectionBitrateTest=l,n.testMediaConnectionBitrate=function(e){return new l(e)}},{"./constants":28,"./errors/DiagnosticError":31,"./utils/candidate":44,events:102}],27:[function(e,t,n){"use strict";var r,o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("events"),u=e("./errors"),l=e("./polyfills"),f=e("./utils/optionValidation"),h=function(e){function t(n){var r=e.call(this)||this;return r._endTime=null,r._errors=[],r._playPromise=null,r._timeoutId=null,r._userMediaStream=null,r._options=i(i({},t.defaultOptions),n),setTimeout((function(){return r._startTest()})),r}return o(t,e),t.prototype.stop=function(){var e;if("number"!=typeof this._endTime){this._endTime=Date.now();var n=(null===(e=this._userMediaStream)||void 0===e?void 0:e.getVideoTracks()[0].getSettings())||{},r=n.width,o=n.height,i={deviceId:n.deviceId,errors:this._errors,resolution:{width:r||0,height:o||0},testName:t.testName};this._startTime&&(i.testTiming={duration:this._endTime-this._startTime,end:this._endTime,start:this._startTime}),this.emit(t.Events.End,i),this._cleanup()}else this._onWarning(new u.AlreadyStoppedError)},t.prototype._cleanup=function(){if(this._userMediaStream&&(this._userMediaStream.getTracks().forEach((function(e){e.stop()})),this._userMediaStream=null,this._options.element)){var e=this._options.element;(this._playPromise?this._playPromise.then((function(){e.pause()})):Promise.resolve()).finally((function(){e.srcObject=null,e.src="",e.load()}))}this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)},t.prototype._onError=function(e){this._errors.push(e),this.emit(t.Events.Error,e)},t.prototype._onWarning=function(e){this._options.debug&&console.warn(e)},t.prototype._startTest=function(){return a(this,void 0,void 0,(function(){var e,t,n,r=this;return s(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,f.validateOptions(this._options,{deviceId:f.validateDeviceId,duration:f.validateTime})];case 1:if(e=o.sent())throw new u.InvalidOptionsError(e);if(!this._options.getUserMedia)throw l.GetUserMediaUnsupportedError;return t=this,[4,this._options.getUserMedia({video:i({deviceId:this._options.deviceId},this._options.resolution)})];case 2:return t._userMediaStream=o.sent(),this._startTime=Date.now(),this._options.element&&(this._options.element.srcObject=this._userMediaStream,this._playPromise=this._options.element.play()),this._options.duration&&this._options.duration!==1/0&&(this._timeoutId=setTimeout((function(){return r.stop()}),this._options.duration)),[3,4];case 3:return(n=o.sent())instanceof u.DiagnosticError?this._onError(n):"undefined"!=typeof DOMException&&n instanceof DOMException?this._onError(new u.DiagnosticError(n,"A `DOMException` has occurred.")):"undefined"!=typeof DOMError&&n instanceof DOMError?this._onError(new u.DiagnosticError(n,"A `DOMError` has occurred.")):"undefined"!=typeof Error&&n instanceof Error?this._onError(new u.DiagnosticError(n,"An error has occurred.")):(this._onError(new u.DiagnosticError(void 0,"Unknown error occurred.")),this._onWarning(n)),this.stop(),[3,4];case 4:return[2]}}))}))},t.testName="video-input-test",t.defaultOptions={debug:!1,duration:1/0,getUserMedia:l.getUserMedia},t}(c.EventEmitter);n.VideoInputTest=h,function(e){!function(e){e.End="end",e.Error="error"}(e.Events||(e.Events={}))}(h=n.VideoInputTest||(n.VideoInputTest={})),n.VideoInputTest=h,n.testVideoInputDevice=function(e){return new h(e)}},{"./errors":35,"./polyfills":40,"./utils/optionValidation":45,events:102}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../package.json");n.ENCODER_PARAMS=[2048,1,1],n.MAX_NUMBER_PACKETS=100,n.MIN_BITRATE_THRESHOLD=100,n.MIN_BITRATE_SAMPLE_COUNT=5,n.MIN_BITRATE_FAIL_COUNT=3,n.BYTES_KEEP_BUFFERED=1024*n.MAX_NUMBER_PACKETS,n.TEST_PACKET=Array(1024).fill("h").join(""),n.INCOMING_SOUND_URL="https://sdk.twilio.com/js/client/sounds/releases/1.0.0/incoming.mp3?cache="+r.name+"+"+r.version,n.BITRATE_TEST_TIMEOUT_MS=15e3,function(e){e.AlreadyStoppedError="already-stopped",e.DiagnosticError="diagnostic",e.InvalidOptionsError="invalid-options",e.InvalidStateError="invalid-state",e.UnsupportedError="unsupported"}(n.ErrorName||(n.ErrorName={})),function(e){e.LowAudioLevel="low-audio-level",e.LowBitrate="low-bitrate"}(n.WarningName||(n.WarningName={}))},{"../package.json":46}],29:[function(e,t,n){"use strict";var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./AudioInputTest");n.AudioInputTest=o.AudioInputTest,n.testAudioInputDevice=o.testAudioInputDevice;var i=e("./AudioOutputTest");n.AudioOutputTest=i.AudioOutputTest,n.testAudioOutputDevice=i.testAudioOutputDevice;var a=e("./constants");n.ErrorName=a.ErrorName,n.WarningName=a.WarningName;var s=e("./errors/DiagnosticError");n.DiagnosticError=s.DiagnosticError;var c=e("./MediaConnectionBitrateTest");n.MediaConnectionBitrateTest=c.MediaConnectionBitrateTest,n.testMediaConnectionBitrate=c.testMediaConnectionBitrate;var u=e("./VideoInputTest");n.testVideoInputDevice=u.testVideoInputDevice,n.VideoInputTest=u.VideoInputTest,window.Twilio=window.Twilio||{},window.Twilio.Diagnostics=r(r({},window.Twilio.Diagnostics),{testAudioInputDevice:o.testAudioInputDevice,testAudioOutputDevice:i.testAudioOutputDevice,testMediaConnectionBitrate:c.testMediaConnectionBitrate,testVideoInputDevice:u.testVideoInputDevice})},{"./AudioInputTest":24,"./AudioOutputTest":25,"./MediaConnectionBitrateTest":26,"./VideoInputTest":27,"./constants":28,"./errors/DiagnosticError":31}],30:[function(e,t,n){"use strict";var r,o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var i=e("../constants"),a=function(e){function t(){var t=e.call(this,"This test already has a defined end timestamp. Tests should not be run multiple times, instead start a new one.")||this;return t.name=i.ErrorName.AlreadyStoppedError,t}return o(t,e),t}(e("./InvalidStateError").InvalidStateError);n.AlreadyStoppedError=a},{"../constants":28,"./InvalidStateError":33}],31:[function(e,t,n){"use strict";var r,o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var i=e("../constants"),a=function(e){function t(n,r){var o=e.call(this,r)||this;return o.timestamp=Date.now(),o.domError=n,Object.setPrototypeOf(o,t.prototype),o.name=i.ErrorName.DiagnosticError,o}return o(t,e),t}(Error);n.DiagnosticError=a},{"../constants":28}],32:[function(e,t,n){"use strict";var r,o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var i=e("../constants"),a=function(e){function t(t){var n=e.call(this,void 0,"Some of the options passed to this test were unable to be validated.")||this;return n.reasons={},n.reasons=t,n.name=i.ErrorName.InvalidOptionsError,n}return o(t,e),t}(e("./DiagnosticError").DiagnosticError);n.InvalidOptionsError=a},{"../constants":28,"./DiagnosticError":31}],33:[function(e,t,n){"use strict";var r,o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var i=e("../constants"),a=function(e){function t(t){var n=e.call(this,void 0,t)||this;return n.name=i.ErrorName.InvalidStateError,n}return o(t,e),t}(e("./DiagnosticError").DiagnosticError);n.InvalidStateError=a},{"../constants":28,"./DiagnosticError":31}],34:[function(e,t,n){"use strict";var r,o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var i=e("../constants"),a=function(e){function t(t){var n=e.call(this,void 0,t)||this;return n.name=i.ErrorName.UnsupportedError,n}return o(t,e),t}(e("./DiagnosticError").DiagnosticError);n.UnsupportedError=a},{"../constants":28,"./DiagnosticError":31}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./AlreadyStoppedError");n.AlreadyStoppedError=r.AlreadyStoppedError;var o=e("./DiagnosticError");n.DiagnosticError=o.DiagnosticError;var i=e("./InvalidOptionsError");n.InvalidOptionsError=i.InvalidOptionsError;var a=e("./InvalidStateError");n.InvalidStateError=a.InvalidStateError;var s=e("./UnsupportedError");n.UnsupportedError=s.UnsupportedError},{"./AlreadyStoppedError":30,"./DiagnosticError":31,"./InvalidOptionsError":32,"./InvalidStateError":33,"./UnsupportedError":34}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../errors");n.AudioUnsupportedError=new r.UnsupportedError("The `HTMLAudioElement` constructor `Audio` is not supported."),n.AudioPolyfill="undefined"!=typeof window?window.Audio:void 0},{"../errors":35}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../errors");n.AudioContextUnsupportedError=new r.UnsupportedError("AudioContext is not supported by this browser."),n.AudioContextPolyfill="undefined"!=typeof window?window.AudioContext||window.webkitAudioContext:void 0},{"../errors":35}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../errors");n.enumerateDevicesUnsupportedMessage="The function `enumerateDevices` is not supported.",n.EnumerateDevicesUnsupportedError=new r.UnsupportedError(n.enumerateDevicesUnsupportedMessage),n.enumerateDevicesPolyfill="undefined"!=typeof navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices):void 0,n.getDefaultDevices=function(e){for(var t={},n=0,r=e.reverse();n<r.length;n++){var o=r[n];t[o.kind]=o}return t}},{"../errors":35}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../errors");n.GetUserMediaUnsupportedError=new r.UnsupportedError("The function `getUserMedia` is not supported."),n.getUserMediaPolyfill="undefined"!=typeof window&&void 0!==window.navigator&&void 0!==window.navigator.mediaDevices&&void 0!==window.navigator.mediaDevices.getUserMedia?window.navigator.mediaDevices.getUserMedia.bind(window.navigator.mediaDevices):void 0},{"../errors":35}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./Audio");n.Audio=r.AudioPolyfill,n.AudioUnsupportedError=r.AudioUnsupportedError;var o=e("./AudioContext");n.AudioContext=o.AudioContextPolyfill,n.AudioContextUnsupportedError=o.AudioContextUnsupportedError;var i=e("./enumerateDevices");n.enumerateDevices=i.enumerateDevicesPolyfill,n.enumerateDevicesUnsupportedMessage=i.enumerateDevicesUnsupportedMessage,n.EnumerateDevicesUnsupportedError=i.EnumerateDevicesUnsupportedError,n.getDefaultDevices=i.getDefaultDevices;var a=e("./getUserMedia");n.getUserMedia=a.getUserMediaPolyfill,n.GetUserMediaUnsupportedError=a.GetUserMediaUnsupportedError},{"./Audio":36,"./AudioContext":37,"./enumerateDevices":38,"./getUserMedia":39}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../errors"),o=e("./encoder"),i=function(){function e(e){var t,n,r=this;this._audioData=[],this._stopPromise=null,this._url="";var i=null!=(n=null!=(t=e.MediaRecorderFactory)?t:window.MediaRecorder)?n:o.Encoder;this._stream=e.stream.clone(),this._mediaRecorder=new i(this._stream,e.audioContext),this._mediaRecorder.ondataavailable=function(e){return r._audioData.push(e.data)},this._mediaRecorder.start()}return e.prototype.stop=function(){var e=this;return this._stopPromise?Promise.reject(new r.DiagnosticError(void 0,"MediaRecorder has already stopped")):(this._stopPromise=new Promise((function(t,n){e._mediaRecorder.onstop=function(){try{e._stream.getTracks().forEach((function(e){return e.stop()})),e._generateObjectUrl()}catch(e){return void n(new r.DiagnosticError(e,"Unable to generate Object URL"))}t()},e._mediaRecorder.stop()})),this._stopPromise)},e.prototype._generateObjectUrl=function(){var e=this._mediaRecorder&&this._mediaRecorder.mimeType?this._mediaRecorder.mimeType:"audio/wav",t=new Blob(this._audioData,{type:e});this._url=URL.createObjectURL(t),this._audioData=[]},Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),e}();n.AudioRecorder=i},{"../errors":35,"./encoder":42}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../constants"),o=e("./worker"),i=function(){function e(e,t,n){var r;void 0===n&&(n=o.waveEncoder),this.ondataavailable=function(){},this.onstop=function(){},this._encoder=(r=n,new Worker(URL.createObjectURL(new Blob([r.toString().replace(/^(\(\)\s*=>|function\s*\(\))\s*{/,"").replace(/}$/,"")])))),this._audioContext=t,this._stream=e}return e.prototype.start=function(){var e,t=this,n=this._audioContext.createMediaStreamSource(this._stream),o=(e=this._audioContext).createScriptProcessor.apply(e,r.ENCODER_PARAMS);o.onaudioprocess=function(e){return t._encoder.postMessage(["encode",e.inputBuffer.getChannelData(0)])},n.connect(o),o.connect(this._audioContext.destination)},e.prototype.stop=function(){var e=this;this._encoder.addEventListener("message",(function(t){e.ondataavailable(t),e.onstop()})),this._encoder.postMessage(["dump",this._audioContext.sampleRate])},e}();n.Encoder=i},{"../../constants":28,"./worker":43}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.waveEncoder=function(){var e=[];onmessage=function(t){"encode"===t.data[0]?function(t){for(var n=t.length,r=new Uint8Array(2*n),o=0;o<n;o++){var i=2*o,a=t[o];a>1?a=1:a<-1&&(a=-1),a*=32768,r[i]=a,r[i+1]=a>>8}e.push(r)}(t.data[1]):"dump"===t.data[0]&&function(t){var n=e.length?e[0].length:0,r=e.length*n,o=new Uint8Array(44+r),i=new DataView(o.buffer);i.setUint32(0,1380533830,!1),i.setUint32(4,36+r,!0),i.setUint32(8,1463899717,!1),i.setUint32(12,1718449184,!1),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,1,!0),i.setUint32(24,t,!0),i.setUint32(28,2*t,!0),i.setUint16(32,2,!0),i.setUint16(34,16,!0),i.setUint32(36,1684108385,!1),i.setUint32(40,r,!0);for(var a=0;a<e.length;a++)o.set(e[a],a*n+44);e=[],postMessage(o.buffer,[o.buffer])}(t.data[1])}}},{}],44:[function(e,t,n){"use strict";var r=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};Object.defineProperty(n,"__esModule",{value:!0}),n.getRTCIceCandidateStatsReport=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,s,c,u,l;return o(this,(function(o){switch(o.label){case 0:return[4,e.getStats()];case 1:return t=o.sent(),n=Array.from(t.values()).reduce((function(e,t){switch(t.type){case"candidate-pair":e.candidatePairs.push(t);break;case"local-candidate":e.localCandidates.push(t);break;case"remote-candidate":e.remoteCandidates.push(t);break;case"transport":t.selectedCandidatePairId&&(e.transport=t)}return e}),{candidatePairs:[],localCandidates:[],remoteCandidates:[]}),r=n.candidatePairs,a=n.localCandidates,s=n.remoteCandidates,c=n.transport,(u=r.find((function(e){return e.selected||c&&e.id===c.selectedCandidatePairId})))&&(l={localCandidate:a.find((function(e){return e.id===u.localCandidateId})),remoteCandidate:s.find((function(e){return e.id===u.remoteCandidateId}))}),[2,{iceCandidateStats:i(a,s),selectedIceCandidatePairStats:l}]}}))}))}},{}],45:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../polyfills");function c(e){if(null==e)return'Option cannot be "'+String(e)+'".'}n.createAudioDeviceValidator=function(e){var t=this;void 0===e&&(e={});var n=o({enumerateDevices:s.enumerateDevices},e);return function(e){return i(t,void 0,void 0,(function(){var t,r,o;return a(this,(function(i){switch(i.label){case 0:return(r=n.enumerateDevices)?[4,n.enumerateDevices()]:[3,2];case 1:r=i.sent(),i.label=2;case 2:if(!(t=r))throw s.EnumerateDevicesUnsupportedError;return t.length?void 0===e?n.kind&&!t.filter((function(e){return e.kind===n.kind})).length?[2,'No devices found with the correct kind "'+n.kind+'".']:[2]:(o=t.filter((function(t){return t.deviceId===e}))).length?n.kind&&!o.filter((function(e){return e.kind===n.kind})).length?[2,'Device ID "'+e+'" is not the correct "kind", expected "'+n.kind+'".']:[2]:[2,'Device ID "'+e+'" not found within list of available devices.']:[2,"No audio devices available."]}}))}))}},n.validateDeviceId=function(e){if(!["string","undefined"].includes(r(e))&&null!==e)return'If "deviceId" is defined, it must be a "string".'},n.validateString=function(e){var t=r(e);if("string"!==t)return'Option cannot have type "'+t+'", must be "string".'},n.validateTime=function(e){var t=c(e);return t||("number"!=typeof e?"Time must be a number.":e<0?"Time must always be non-negative.":void 0)},n.validateExists=c,n.validateBoolean=function(e){if("boolean"!=typeof e)return'Option must be "boolean".'},n.validateOptions=function(e,t){return i(this,void 0,void 0,(function(){var n,r=this;return a(this,(function(o){switch(o.label){case 0:return n={},[4,Promise.all(Object.entries(t).map((function(t){var o=t[0],s=t[1];return i(r,void 0,void 0,(function(){var t,r,c=this;return a(this,(function(u){switch(u.label){case 0:return s?(t=e[o],r=Array.isArray(s)?s:[s],[4,Promise.all(r.map((function(e){return i(c,void 0,void 0,(function(){var r,i;return a(this,(function(a){switch(a.label){case 0:return[4,e(t)];case 1:return(r=a.sent())&&((i=n[o])?i.push(r):n[o]=[r]),[2]}}))}))})))]):[2];case 1:return u.sent(),[2]}}))}))})))];case 1:return o.sent(),Object.keys(n).length?[2,n]:[2]}}))}))}},{"../polyfills":40}],46:[function(e,t,n){t.exports={name:"@twilio/rtc-diagnostics",version:"1.0.1",description:"Various diagnostics functions to help analyze connections to Twilio",main:"./es5/lib/diagnostics.js",types:"./es5/lib/diagnostics.d.ts",scripts:{build:"npm-run-all clean docs build:es5 build:dist build:dist-min","build:dist":"rimraf ./dist && node ./scripts/build.js ./LICENSE.md ./dist/rtc-diagnostics.js","build:dist-min":'uglifyjs ./dist/rtc-diagnostics.js -o ./dist/rtc-diagnostics.min.js --comments "/^! rtc-diagnostics.js/" -b beautify=false,ascii_only=true',"build:es5":"rimraf ./es5 && tsc","build:release":"npm-run-all lint build status",clean:"rimraf ./dist ./coverage ./es5 ./docs",docs:"rimraf ./docs && typedoc --internal-aliases internal,publicapi --external-aliases external,internalapi --excludePrivate --excludeProtected --theme ./node_modules/typedoc-twilio-theme/bin/default",lint:"tslint -c ./tslint.json --project ./tsconfig.json -t stylish",release:"release",status:"git status",test:"npm-run-all lint build test:unit test:integration","test:unit":"nyc mocha -r ts-node/register ./tests/unit/index.ts","test:integration":"node ./scripts/env.js && karma start"},contributors:["Michael Huynh","Ryan Rowland","Charlie Santos"],license:"Apache-2.0",keywords:["client","diagnostics","twilio","video","voice","voip"],dependencies:{"@types/events":"3.0.0","@types/node":"12.12.11",events:"3.0.0"},devDependencies:{"@types/mime":"2.0.2","@types/mocha":"5.2.7","@types/request":"^2.48.5","@types/sinon":"9.0.4",browserify:"16.5.0","is-docker":"2.0.0",karma:"4.4.1","karma-chrome-launcher":"3.1.0","karma-env-preprocessor":"^0.1.1","karma-firefox-launcher":"1.2.0","karma-mocha":"1.3.0","karma-spec-reporter":"0.0.32","karma-typescript":"4.1.1",mocha:"6.2.2","npm-run-all":"4.1.5",nyc:"15.0.0",request:"^2.88.2",sinon:"9.0.2","travis-multirunner":"4.6.0","ts-node":"8.5.2",tsify:"4.0.1",tslint:"5.20.1",twilio:"3.39.1","twilio-release-tool":"1.0.1",typedoc:"0.16.11","typedoc-plugin-as-member-of":"1.0.2","typedoc-plugin-external-module-name":"4.0.6","typedoc-plugin-internal-external":"2.1.1","typedoc-twilio-theme":"1.0.1",typescript:"3.7.2","vinyl-fs":"3.0.3","vinyl-source-stream":"2.0.0"}}},{}],47:[function(e,t,n){(function(e){(function(){"use strict";function r(e){return function(e){if(Array.isArray(e))return _(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||k(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),s=new I(r||[]);return i(a,"_invoke",{value:C(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var p="suspendedStart",d="executing",v="completed",y={};function g(){}function m(){}function b(){}var w={};l(w,s,(function(){return this}));var k=Object.getPrototypeOf,_=k&&k(k(j([])));_&&_!==n&&r.call(_,s)&&(w=_);var O=b.prototype=g.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,i,a,s){var c=h(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==E(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var o=p;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=h(t,n,r);if("normal"===u.type){if(o=r.done?v:"suspendedYield",u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=v,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=h(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(E(t)+" is not iterable")}return m.prototype=b,i(O,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:m,configurable:!0}),m.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),l(x.prototype,c,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(f(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),l(O,u,"Generator"),l(O,s,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}function i(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)}))}}function s(e,t,n){return t=d(t),function(e,t){if(t&&("object"==E(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}(e,h()?Reflect.construct(t,n||[],d(e).constructor):t.apply(e,n))}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function l(e){var t="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return f(e,arguments,d(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),p(n,e)})(e)}function f(e,t,n){if(h())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var o=new(e.bind.apply(e,r));return n&&p(o,n.prototype),o}function h(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(h=function(){return!!e})()}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||k(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,m(r.key),r)}}function g(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e){var t=function(e,t){if("object"!=E(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=E(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==E(t)?t:t+""}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=k(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function k(e,t){if(e){if("string"==typeof e)return _(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}
/*@license Copyright 2015-2022 Ably Real-time Ltd (ably.com)

Ably JavaScript Library v2.4.0
https://github.com/ably/ably-js

Released under the Apache Licence v2.0*/var O;O=function(){var t,n={},i={exports:n},f=Object.defineProperty,h=Object.defineProperties,p=Object.getOwnPropertyDescriptor,d=Object.getOwnPropertyDescriptors,y=Object.getOwnPropertyNames,m=Object.getOwnPropertySymbols,k=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable,O=function(e,t,n){return t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},S=function(e,t){for(var n in t||(t={}))k.call(t,n)&&O(e,n,t[n]);if(m){var r,o=w(m(t));try{for(o.s();!(r=o.n()).done;)n=r.value,_.call(t,n)&&O(e,n,t[n])}catch(e){o.e(e)}finally{o.f()}}return e},x=function(e,t){return h(e,d(t))},C=function(e,t){for(var n in t)f(e,n,{get:t[n],enumerable:!0})},A={};C(A,{ErrorInfo:function(){return N},Realtime:function(){return Sr},Rest:function(){return On},default:function(){return Ao},msgpack:function(){return mo},protocolMessageFromDeserialized:function(){return Un}}),i.exports=(t=A,function(e,t,n,r){if(t&&"object"===E(t)||"function"==typeof t){var o,i=w(y(t));try{var a=function(){var i=o.value;k.call(e,i)||i===n||f(e,i,{get:function(){return t[i]},enumerable:!(r=p(t,i))||r.enumerable})};for(i.s();!(o=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}return e}(f({},"__esModule",{value:!0}),t));var T=g((function e(){b(this,e)})),P=void 0!==e?e:"undefined"!=typeof window?window:self;function I(e,t){return"".concat(e).padStart(t?3:2,"0")}function j(e){return T.Config.logTimestamps?function(t){var n=new Date;e(I(n.getHours())+":"+I(n.getMinutes())+":"+I(n.getSeconds())+"."+I(n.getMilliseconds(),1)+" "+t)}:function(t){e(t)}}var R=function(){function e(){var t=this;b(this,e),this.deprecated=function(e,n){t.deprecationWarning("".concat(e," is deprecated and will be removed in a future version. ").concat(n))},this.shouldLog=function(e){return e<=t.logLevel},this.setLog=function(e,n){void 0!==e&&(t.logLevel=e),void 0!==n&&(t.logHandler=t.logErrorHandler=n)},this.logLevel=e.defaultLogLevel,this.logHandler=e.defaultLogHandler,this.logErrorHandler=e.defaultLogErrorHandler}return g(e,[{key:"logAction",value:function(e,t,n){this.shouldLog(e)&&(1===e?this.logErrorHandler:this.logHandler)("Ably: "+t+": "+n,e)}},{key:"renamedClientOption",value:function(e,t){this.deprecationWarning("The `".concat(e,"` client option has been renamed to `").concat(t,"`. Please update your code to use `").concat(t,"` instead. `").concat(e,"` will be removed in a future version."))}},{key:"renamedMethod",value:function(e,t,n){this.deprecationWarning("`".concat(e,"`’s `").concat(t,"` method has been renamed to `").concat(n,"`. Please update your code to use `").concat(n,"` instead. `").concat(t,"` will be removed in a future version."))}},{key:"deprecationWarning",value:function(e){this.shouldLog(1)&&this.logErrorHandler("Ably: Deprecation warning - ".concat(e),1)}}],[{key:"initLogHandlers",value:function(){var t,n,r,o=v(("function"==typeof(null==(t=null==P?void 0:P.console)?void 0:t.log)?(n=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log.apply(console,t)},r=console.warn?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.warn.apply(console,t)}:n):n=r=function(){},[n,r].map(j)),2),i=o[0],a=o[1];this.defaultLogHandler=i,this.defaultLogErrorHandler=a,this.defaultLogger=new e}},{key:"logActionNoStrip",value:function(e,t,n,r){e.logAction(t,n,r)}}]),e}();R.defaultLogLevel=1,R.LOG_NONE=0,R.LOG_ERROR=1,R.LOG_MAJOR=2,R.LOG_MINOR=3,R.LOG_MICRO=4,R.logAction=function(e,t,n,r){R.logActionNoStrip(e,t,n,r)};var L=R,M={};function U(e){var t="["+e.constructor.name;return e.message&&(t+=": "+e.message),e.statusCode&&(t+="; statusCode="+e.statusCode),e.code&&(t+="; code="+e.code),e.cause&&(t+="; cause="+le(e.cause)),!e.href||e.message&&e.message.indexOf("help.ably.io")>-1||(t+="; see "+e.href+" "),t+="]"}C(M,{Format:function(){return ie},allSame:function(){return oe},allToLowerCase:function(){return be},allToUpperCase:function(){return we},arrChooseN:function(){return ve},arrDeleteValue:function(){return Z},arrEquals:function(){return Ae},arrIntersect:function(){return Y},arrIntersectOb:function(){return X},arrPopRandomElement:function(){return ae},arrSubtract:function(){return $},arrWithoutValue:function(){return ee},cheapRandStr:function(){return pe},containsValue:function(){return K},copy:function(){return B},createMissingPluginError:function(){return Te},dataSizeBytes:function(){return he},decodeBody:function(){return ge},encodeBody:function(){return me},ensureArray:function(){return F},forInOwnNonNullProperties:function(){return re},getBackoffCoefficient:function(){return ke},getGlobalObject:function(){return Oe},getJitterCoefficient:function(){return _e},getRetryTime:function(){return Ee},inherits:function(){return J},inspectBody:function(){return fe},inspectError:function(){return le},intersect:function(){return Q},isEmpty:function(){return H},isErrorInfoOrPartialErrorInfo:function(){return ue},isNil:function(){return W},isObject:function(){return q},keysArray:function(){return te},matchDerivedChannel:function(){return xe},mixin:function(){return G},parseQueryString:function(){return ce},prototypicalClone:function(){return z},randomString:function(){return de},shallowClone:function(){return V},shallowEquals:function(){return Se},throwMissingPluginError:function(){return Pe},toBase64:function(){return Ce},toQueryString:function(){return se},valuesArray:function(){return ne},whenPromiseSettles:function(){return ye},withTimeoutAsync:function(){return Ie}});var N=function(e){function t(e,n,r,o){var i;return b(this,t),i=s(this,t,[e]),void 0!==Object.setPrototypeOf&&Object.setPrototypeOf(c(i),t.prototype),i.code=n,i.statusCode=r,i.cause=o,i}return u(t,e),g(t,[{key:"toString",value:function(){return U(this)}}],[{key:"fromValues",value:function(e){var n=e.message,r=e.code,o=e.statusCode;if("string"!=typeof n||"number"!=typeof r||"number"!=typeof o)throw new Error("ErrorInfo.fromValues(): invalid values: "+T.Config.inspect(e));var i=Object.assign(new t(n,r,o),e);return i.code&&!i.href&&(i.href="https://help.ably.io/error/"+i.code),i}}]),t}(l(Error)),D=function(e){function t(e,n,r,o){var i;return b(this,t),i=s(this,t,[e]),void 0!==Object.setPrototypeOf&&Object.setPrototypeOf(c(i),t.prototype),i.code=n,i.statusCode=r,i.cause=o,i}return u(t,e),g(t,[{key:"toString",value:function(){return U(this)}}],[{key:"fromValues",value:function(e){var n=e.message,r=e.code,o=e.statusCode;if("string"!=typeof n||!W(r)&&"number"!=typeof r||!W(o)&&"number"!=typeof o)throw new Error("PartialErrorInfo.fromValues(): invalid values: "+T.Config.inspect(e));var i=Object.assign(new t(n,r,o),e);return i.code&&!i.href&&(i.href="https://help.ably.io/error/"+i.code),i}}]),t}(l(Error));function G(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t++){var n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if(!n)break;for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}function B(e){return G({},e)}function F(e){return W(e)?[]:Array.isArray(e)?e:[e]}function q(e){return"[object Object]"==Object.prototype.toString.call(e)}function H(e){for(var t in e)return!1;return!0}function W(e){return null==e}function V(e){var t=new Object;for(var n in e)t[n]=e[n];return t}function z(e,t){var n=g((function e(){b(this,e)}));n.prototype=e;var r=new n;return t&&G(r,t),r}var J=function(e,t){T.Config.inherits?T.Config.inherits(e,t):(e.super_=t,e.prototype=z(t.prototype,{constructor:e}))};function K(e,t){for(var n in e)if(e[n]==t)return!0;return!1}function Q(e,t){return Array.isArray(t)?Y(e,t):X(e,t)}function Y(e,t){for(var n=[],r=0;r<e.length;r++){var o=e[r];-1!=t.indexOf(o)&&n.push(o)}return n}function X(e,t){for(var n=[],r=0;r<e.length;r++){var o=e[r];o in t&&n.push(o)}return n}function $(e,t){for(var n=[],r=0;r<e.length;r++){var o=e[r];-1==t.indexOf(o)&&n.push(o)}return n}function Z(e,t){var n=e.indexOf(t),r=-1!=n;return r&&e.splice(n,1),r}function ee(e,t){var n=e.slice();return Z(n,t),n}function te(e,t){var n=[];for(var r in e)t&&!Object.prototype.hasOwnProperty.call(e,r)||n.push(r);return n}function ne(e,t){var n=[];for(var r in e)t&&!Object.prototype.hasOwnProperty.call(e,r)||n.push(e[r]);return n}function re(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&e[n]&&t(n)}function oe(e,t){if(0===e.length)return!0;var n=e[0][t];return e.every((function(e){return e[t]===n}))}var ie=function(e){return e.msgpack="msgpack",e.json="json",e}(ie||{});function ae(e){return e.splice((t=e,Math.floor(Math.random()*t.length)),1)[0];var t}function se(e){var t=[];if(e)for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.length?"?"+t.join("&"):""}function ce(e){for(var t,n=/([^?&=]+)=?([^&]*)/g,r={};t=n.exec(e);)r[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return r}function ue(e){return"object"==E(e)&&null!==e&&(e instanceof N||e instanceof D)}function le(e){var t,n;return e instanceof Error||"ErrorInfo"===(null==(t=null==e?void 0:e.constructor)?void 0:t.name)||"PartialErrorInfo"===(null==(n=null==e?void 0:e.constructor)?void 0:n.name)?e.toString():T.Config.inspect(e)}function fe(e){return T.BufferUtils.isBuffer(e)?e.toString():"string"==typeof e?e:T.Config.inspect(e)}function he(e){if(T.BufferUtils.isBuffer(e))return T.BufferUtils.byteLength(e);if("string"==typeof e)return T.Config.stringByteSize(e);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+E(e))}function pe(){return String(Math.random()).substr(2)}var de=function(){var e=a(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.Config.getRandomArrayBuffer(t);case 2:return n=e.sent,e.abrupt("return",T.BufferUtils.base64Encode(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function ve(e,t){for(var n=Math.min(t,e.length),r=e.slice(),o=[],i=0;i<n;i++)o.push(ae(r));return o}function ye(e,t){e.then((function(e){null==t||t(null,e)})).catch((function(e){null==t||t(e)}))}function ge(e,t,n){return"msgpack"==n?(t||Pe("MsgPack"),t.decode(e)):JSON.parse(String(e))}function me(e,t,n){return"msgpack"==n?(t||Pe("MsgPack"),t.encode(e,!0)):JSON.stringify(e)}function be(e){return e.map((function(e){return e&&e.toLowerCase()}))}function we(e){return e.map((function(e){return e&&e.toUpperCase()}))}function ke(e){return Math.min((e+2)/3,2)}function _e(){return 1-.2*Math.random()}function Ee(e,t){return e*ke(t)*_e()}function Oe(){return void 0!==e?e:"undefined"!=typeof window?window:self}function Se(e,t){return Object.keys(e).every((function(n){return e[n]===t[n]}))&&Object.keys(t).every((function(n){return t[n]===e[n]}))}function xe(e){var t=e.match(/^(\[([^?]*)(?:(.*))\])?(.+)$/);if(!t||!t.length||t.length<5)throw new N("regex match failed",400,40010);if(t[2])throw new N("cannot use a derived option with a ".concat(t[2]," channel"),400,40010);return{qualifierParam:t[3]||"",channelName:t[4]}}function Ce(e){var t=T.BufferUtils,n=t.utf8Encode(e);return t.base64Encode(n)}function Ae(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}function Te(e){return new N("".concat(e," plugin not provided"),40019,400)}function Pe(e){throw Te(e)}function Ie(e){return je.apply(this,arguments)}function je(){return(je=a(o().mark((function e(t){var n,r,i,a=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:5e3,r=a.length>2&&void 0!==a[2]?a[2]:"Timeout expired",i=new N(r,5e4,500),e.abrupt("return",Promise.race([t,new Promise((function(e,t){return setTimeout((function(){return t(i)}),n)}))]));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Re={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:1e4,httpMaxRetryDuration:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,webSocketConnectTimeout:1e4,webSocketSlowTimeout:4e3},httpMaxRetryCount:3,maxMessageSize:65536,version:"2.4.0",protocolVersion:3,agent:"ably-js/2.4.0",getHost:Le,getPort:function(e,t){return t||e.tls?e.tlsPort:e.port},getHttpScheme:function(e){return e.tls?"https://":"http://"},environmentFallbackHosts:Me,getFallbackHosts:Ue,getHosts:function(e,t){var n=[e.restHost].concat(Ue(e));return t?n.map((function(t){return Le(e,t,!0)})):n},checkHost:Ne,objectifyOptions:function(e,t,n,r,o){if(void 0===e){var i="".concat(n,t?" must be initialized with either a client options object, an Ably API key, or an Ably Token":" must be initialized with a client options object");throw L.logAction(r,L.LOG_ERROR,"".concat(n,"()"),i),new Error(i)}var a;if("string"==typeof e)if(-1==e.indexOf(":")){if(!t){var s="".concat(n," cannot be initialized with just an Ably Token; you must provide a client options object with a `plugins` property. (Set this Ably Token as the object’s `token` property.)");throw L.logAction(r,L.LOG_ERROR,"".concat(n,"()"),s),new Error(s)}a={token:e}}else{if(!t){var c="".concat(n," cannot be initialized with just an Ably API key; you must provide a client options object with a `plugins` property. (Set this Ably API key as the object’s `key` property.)");throw L.logAction(r,L.LOG_ERROR,"".concat(n,"()"),c),new Error(c)}a={key:e}}else a=e;return o&&(a=x(S({},a),{plugins:S(S({},o),a.plugins)})),a},normaliseOptions:function(e,t,n){var r=null!=n?n:L.defaultLogger;"function"==typeof e.recover&&!0===e.closeOnUnload&&(L.logAction(r,L.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),e.recover=void 0),"closeOnUnload"in e||(e.closeOnUnload=!e.recover),"queueMessages"in e||(e.queueMessages=!0);var o=e.environment&&String(e.environment).toLowerCase()||Re.ENVIRONMENT,i=!o||"production"===o;e.fallbackHosts||e.restHost||e.realtimeHost||e.port||e.tlsPort||(e.fallbackHosts=i?Re.FALLBACK_HOSTS:Me(o));var a=e.restHost||(i?Re.REST_HOST:o+"-"+Re.REST_HOST),s=function(e,t,n,r){return e.realtimeHost?e.realtimeHost:e.restHost?(L.logAction(r,L.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+e.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+e.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),e.restHost):t?Re.REALTIME_HOST:n+"-"+Re.REALTIME_HOST}(e,i,o,r);(e.fallbackHosts||[]).concat(a,s).forEach(Ne),e.port=e.port||Re.PORT,e.tlsPort=e.tlsPort||Re.TLS_PORT,"tls"in e||(e.tls=!0);var c=function(e){var t={};for(var n in Re.TIMEOUTS)t[n]=e[n]||Re.TIMEOUTS[n];return t}(e);e.useBinaryProtocol=!!t&&("useBinaryProtocol"in e?T.Config.supportsBinary&&e.useBinaryProtocol:T.Config.preferBinary);var u={};e.clientId&&(u["X-Ably-ClientId"]=T.BufferUtils.base64Encode(T.BufferUtils.utf8Encode(e.clientId))),"idempotentRestPublishing"in e||(e.idempotentRestPublishing=!0);var l=null,f=e.connectivityCheckUrl;if(e.connectivityCheckUrl){var h=v(e.connectivityCheckUrl.split("?"),2),p=h[0],d=h[1];l=d?ce(d):{},-1===p.indexOf("://")&&(p="https://"+p),f=p}var y=e.wsConnectivityCheckUrl;return y&&-1===y.indexOf("://")&&(y="wss://"+y),x(S({},e),{realtimeHost:s,restHost:a,maxMessageSize:e.maxMessageSize||Re.maxMessageSize,timeouts:c,connectivityCheckParams:l,connectivityCheckUrl:f,wsConnectivityCheckUrl:y,headers:u})},defaultGetHeaders:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.format,r=void 0===n?Fe.format:n,o=t.protocolVersion,i=void 0===o?Fe.protocolVersion:o,a=Be[r];return{accept:a,"X-Ably-Version":i.toString(),"Ably-Agent":De(e)}},defaultPostHeaders:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.format,o=void 0===r?Fe.format:r,i=n.protocolVersion,a=void 0===i?Fe.protocolVersion:i,s=t=Be[o];return{accept:s,"content-type":t,"X-Ably-Version":a.toString(),"Ably-Agent":De(e)}}};function Le(e,t,n){return t=n?t==e.restHost&&e.realtimeHost||t||e.realtimeHost:t||e.restHost}function Me(e){return[e+"-a-fallback.ably-realtime.com",e+"-b-fallback.ably-realtime.com",e+"-c-fallback.ably-realtime.com",e+"-d-fallback.ably-realtime.com",e+"-e-fallback.ably-realtime.com"]}function Ue(e){var t=e.fallbackHosts,n=void 0!==e.httpMaxRetryCount?e.httpMaxRetryCount:Re.httpMaxRetryCount;return t?ve(t,n):[]}function Ne(e){if("string"!=typeof e)throw new N("host must be a string; was a "+E(e),4e4,400);if(!e.length)throw new N("host must not be zero-length",4e4,400)}function De(e){var t=Re.agent;if(e.agents)for(var n in e.agents)t+=" "+n+"/"+e.agents[n];return t}function Ge(e,t,n){var r=n||{};if(r.cipher){e||Pe("Crypto");var o=e.getCipher(r.cipher,t);r.cipher=o.cipherParams,r.channelCipher=o.cipher}else"cipher"in r&&(r.cipher=void 0,r.channelCipher=null);return r}var Be={json:"application/json",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack",text:"text/plain"},Fe={format:"json",protocolVersion:Re.protocolVersion},qe=Re,He=function(){function e(t,n){b(this,e),this.logger=t,this.members=n||[]}return g(e,[{key:"call",value:function(e,t){var n,r=w(this.members);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(o)try{o(e,t)}catch(e){L.logAction(this.logger,L.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+e+"; stack = "+e.stack)}}}catch(e){r.e(e)}finally{r.f()}}},{key:"push",value:function(){var e;(e=this.members).push.apply(e,arguments)}},{key:"createPromise",value:function(){var e=this;return new Promise((function(t,n){e.push((function(e,r){e?n(e):t(r)}))}))}},{key:"resolveAll",value:function(e){this.call(null,e)}},{key:"rejectAll",value:function(e){this.call(e)}}],[{key:"create",value:function(t,n){var r=new e(t,n);return Object.assign((function(e,t){return r.call(e,t)}),{push:function(e){return r.push(e)},createPromise:function(){return r.createPromise()},resolveAll:function(e){return r.resolveAll(e)},rejectAll:function(e){return r.rejectAll(e)}})}}]),e}(),We=function(e){return e.Get="get",e.Delete="delete",e.Post="post",e.Put="put",e.Patch="patch",e}(We||{}),Ve=We,ze=function(e){return e[e.Success=200]="Success",e[e.NoContent=204]="NoContent",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.Forbidden=403]="Forbidden",e[e.RequestTimeout=408]="RequestTimeout",e[e.InternalServerError=500]="InternalServerError",e}(ze||{}),Je=ze,Ke=Math.pow(2,17);function Qe(e){return ue(e)?(e.code||(403===e.statusCode?e.code=40300:(e.code=40170,e.statusCode=401)),e):new N(le(e),e.code||40170,e.statusCode||401)}var Ye=function(e,t){var n=T.BufferUtils,r=n.utf8Encode(e),o=n.utf8Encode(t),i=n.hmacSha256(r,o);return n.base64Encode(i)};function Xe(e){if(!e)return"";"string"==typeof e&&(e=JSON.parse(e));var t=Object.create(null),n=te(e,!0);if(!n)return"";n.sort();for(var r=0;r<n.length;r++)t[n[r]]=e[n[r]].sort();return JSON.stringify(t)}function $e(e,t){if(e.authCallback)L.logAction(t,L.LOG_MINOR,"Auth()","using token auth with authCallback");else if(e.authUrl)L.logAction(t,L.LOG_MINOR,"Auth()","using token auth with authUrl");else if(e.key)L.logAction(t,L.LOG_MINOR,"Auth()","using token auth with client-side signing");else{if(!e.tokenDetails){var n="authOptions must include valid authentication parameters";throw L.logAction(t,L.LOG_ERROR,"Auth()",n),new Error(n)}L.logAction(t,L.LOG_MINOR,"Auth()","using token auth with supplied token only")}}function Ze(e){return e.useTokenAuth||!function(e){return"useTokenAuth"in e&&!e.useTokenAuth}(e)&&(e.authCallback||e.authUrl||e.token||e.tokenDetails)}var et=0,tt=function(){function e(t,n){if(b(this,e),this.authOptions={},this.client=t,this.tokenParams=n.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,Ze(n))(function(e){return!e.key&&!e.authCallback&&!e.authUrl})(n)&&L.logAction(this.logger,L.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(n.defaultTokenParams,n),$e(this.authOptions,this.logger);else{if(!n.key){var r="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw L.logAction(this.logger,L.LOG_ERROR,"Auth()",r),new N(r,40160,401)}L.logAction(this.logger,L.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(n)}}var t,n,r,i,s,c,u,l;return g(e,[{key:"logger",get:function(){return this.client.logger}},{key:"authorize",value:(l=a(o().mark((function e(t,n){var r,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||!n.key||this.authOptions.key===n.key){e.next=2;break}throw new N("Unable to update auth options with incompatible key",40102,401);case 2:return e.prev=2,e.next=5,this._forceNewToken(null!=t?t:null,null!=n?n:null);case 5:if(r=e.sent,!this.client.connection){e.next=10;break}return e.abrupt("return",new Promise((function(e,t){i.client.connection.connectionManager.onAuthUpdated(r,(function(n,r){return n?t(n):e(r)}))})));case 10:return e.abrupt("return",r);case 11:e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(2),this.client.connection&&e.t0.statusCode===Je.Forbidden&&this.client.connection.connectionManager.actOnErrorFromAuthorize(e.t0),e.t0;case 17:case"end":return e.stop()}}),e,this,[[2,13]])}))),function(e,t){return l.apply(this,arguments)})},{key:"_forceNewToken",value:(u=a(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.tokenDetails=null,this._saveTokenOptions(t,n),$e(this.authOptions,this.logger),e.prev=3,e.abrupt("return",this._ensureValidAuthCredentials(!0));case 5:return e.prev=5,delete this.tokenParams.timestamp,delete this.authOptions.queryTime,e.finish(5);case 9:case"end":return e.stop()}}),e,this,[[3,,5,9]])}))),function(e,t){return u.apply(this,arguments)})},{key:"requestToken",value:(c=a(o().mark((function e(t,n){var r,i,a,s,c,u=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n||this.authOptions,i=t||B(this.tokenParams),s=this.client,!r.authCallback){e.next=8;break}L.logAction(this.logger,L.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),a=r.authCallback,e.next=21;break;case 8:if(!r.authUrl){e.next=13;break}L.logAction(this.logger,L.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),a=function(e,t){var n,o=G({accept:"application/json, text/plain"},r.authHeaders),i=r.authMethod&&"post"===r.authMethod.toLowerCase(),a=r.authUrl.indexOf("?");a>-1&&(n=ce(r.authUrl.slice(a)),r.authUrl=r.authUrl.slice(0,a),i||(r.authParams=G(n,r.authParams)));var s=G({},r.authParams||{},e),c=function(e){var n,r,o=null!=(n=e.body)?n:null,i=null;if(e.error)L.logAction(u.logger,L.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+le(e.error));else{var a=null!=(r=e.headers["content-type"])?r:null;i=Array.isArray(a)?a.join(", "):a,L.logAction(u.logger,L.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+i+"; body: "+fe(o))}if(e.error)t(e.error,null);else if(e.unpacked)t(null,o);else if(T.BufferUtils.isBuffer(o)&&(o=o.toString()),i){var s=i.indexOf("application/json")>-1,c=i.indexOf("text/plain")>-1||i.indexOf("application/jwt")>-1;if(s||c){if(s){if(o.length>Ke)return void t(new N("authUrl response exceeded max permitted length",40170,401),null);try{o=JSON.parse(o)}catch(e){return void t(new N("Unexpected error processing authURL response; err = "+e.message,40170,401),null)}}t(null,o,i)}else t(new N("authUrl responded with unacceptable content-type "+i+", should be either text/plain, application/jwt or application/json",40170,401),null)}else t(new N("authUrl response is missing a content-type header",40170,401),null)};if(L.logAction(u.logger,L.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+r.authUrl+"; Params: "+JSON.stringify(s)+"; method: "+(i?"POST":"GET")),i){var l=o||{};l["content-type"]="application/x-www-form-urlencoded";var f=se(s).slice(1);ye(u.client.http.doUri(Ve.Post,r.authUrl,l,f,n),(function(e,t){return c(e||t)}))}else ye(u.client.http.doUri(Ve.Get,r.authUrl,o||{},null,s),(function(e,t){return c(e||t)}))},e.next=21;break;case 13:if(!r.key){e.next=18;break}L.logAction(this.logger,L.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),a=function(e,t){ye(u.createTokenRequest(e,r),(function(e,n){return t(e,null!=n?n:null)}))},e.next=21;break;case 18:throw L.logAction(this.logger,L.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),new N("Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)",40171,403);case 21:return"capability"in i&&(i.capability=Xe(i.capability)),c=function(e,t){var n="/keys/"+e.keyName+"/requestToken",o=qe.defaultPostHeaders(u.client.options);r.requestHeaders&&G(o,r.requestHeaders),L.logAction(u.logger,L.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+n+"; Token params: "+JSON.stringify(e)),ye(u.client.http.do(Ve.Post,(function(e){return s.baseUri(e)+n}),o,JSON.stringify(e),null),(function(e,n){return e?t(e):t(n.error,n.body,n.unpacked)}))},e.abrupt("return",new Promise((function(e,t){var n=!1,o=u.client.options.timeouts.realtimeRequestTimeout,s=setTimeout((function(){n=!0;var e="Token request callback timed out after "+o/1e3+" seconds";L.logAction(u.logger,L.LOG_ERROR,"Auth.requestToken()",e),t(new N(e,40170,401))}),o);a(i,(function(o,i,a){if(!n){if(clearTimeout(s),o)return L.logAction(u.logger,L.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+le(o)),void t(Qe(o));if("string"!=typeof i){if("object"!==E(i)||null===i){var l="Expected token request callback to call back with a token string or token request/details object, but got a "+E(i);return L.logAction(u.logger,L.LOG_ERROR,"Auth.requestToken()",l),void t(new N(l,40170,401))}var f=JSON.stringify(i).length;if(f>Ke&&!r.suppressMaxLengthCheck)t(new N("Token request/details object exceeded max permitted stringified size (was "+f+" bytes)",40170,401));else if("issued"in i)e(i);else{if(!("keyName"in i)){var h="Expected token request callback to call back with a token string, token request object, or token details object";return L.logAction(u.logger,L.LOG_ERROR,"Auth.requestToken()",h),void t(new N(h,40170,401))}c(i,(function(n,r,o){if(n)return L.logAction(u.logger,L.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+le(n)),void t(Qe(n));o||(r=JSON.parse(r)),L.logAction(u.logger,L.LOG_MINOR,"Auth.getToken()","token received"),e(r)}))}}else 0===i.length?t(new N("Token string is empty",40170,401)):i.length>Ke?t(new N("Token string exceeded max permitted length (was "+i.length+" bytes)",40170,401)):"undefined"===i||"null"===i?t(new N("Token string was literal null/undefined",40170,401)):"{"!==i[0]||a&&a.indexOf("application/jwt")>-1?e({token:i}):t(new N("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401))}}))})));case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"createTokenRequest",value:(s=a(o().mark((function e(t,n){var r,i,a,s,c,u,l,f,h,p,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=n||this.authOptions,t=t||B(this.tokenParams),r=n.key){e.next=5;break}throw new N("No key specified",40101,403);case 5:if(i=r.split(":"),a=i[0],s=i[1]){e.next=8;break}throw new N("Invalid key specified",40101,403);case 8:if(""!==t.clientId){e.next=10;break}throw new N("clientId can’t be an empty string",40012,400);case 10:if("capability"in t&&(t.capability=Xe(t.capability)),c=G({keyName:a},t),u=t.clientId||"",l=t.ttl||"",f=t.capability||"",c.timestamp){e.next=16;break}return e.next=15,this.getTimestamp(n&&n.queryTime);case 15:c.timestamp=e.sent;case 16:return h=c.nonce||(c.nonce=("000000"+Math.floor(1e16*Math.random())).slice(-16)),p=c.timestamp,d=c.keyName+"\n"+l+"\n"+f+"\n"+u+"\n"+p+"\n"+h+"\n",c.mac=c.mac||Ye(d,s),L.logAction(this.logger,L.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),e.abrupt("return",c);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"getAuthParams",value:(i=a(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("basic"!=this.method){e.next=4;break}return e.abrupt("return",{key:this.key});case 4:return e.next=6,this._ensureValidAuthCredentials(!1);case 6:if(t=e.sent){e.next=9;break}throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");case 9:return e.abrupt("return",{access_token:t.token});case 10:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getAuthHeaders",value:(r=a(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("basic"!=this.method){e.next=4;break}return e.abrupt("return",{authorization:"Basic "+this.basicKey});case 4:return e.next=6,this._ensureValidAuthCredentials(!1);case 6:if(t=e.sent){e.next=9;break}throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");case 9:return e.abrupt("return",{authorization:"Bearer "+Ce(t.token)});case 10:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getTimestamp",value:(n=a(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isTimeOffsetSet()||!t&&!this.authOptions.queryTime){e.next=4;break}return e.abrupt("return",this.client.time());case 4:return e.abrupt("return",this.getTimestampUsingOffset());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getTimestampUsingOffset",value:function(){return Date.now()+(this.client.serverTimeOffset||0)}},{key:"isTimeOffsetSet",value:function(){return null!==this.client.serverTimeOffset}},{key:"_saveBasicOptions",value:function(e){this.method="basic",this.key=e.key,this.basicKey=Ce(e.key),this.authOptions=e||{},"clientId"in e&&this._userSetClientId(e.clientId)}},{key:"_saveTokenOptions",value:function(e,t){this.method="token",e&&(this.tokenParams=e),t&&(t.token&&(t.tokenDetails="string"==typeof t.token?{token:t.token}:t.token),t.tokenDetails&&(this.tokenDetails=t.tokenDetails),"clientId"in t&&this._userSetClientId(t.clientId),this.authOptions=t)}},{key:"_ensureValidAuthCredentials",value:(t=a(o().mark((function e(t){var n,r,i,a,s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.tokenDetails)){e.next=9;break}if(!this._tokenClientIdMismatch(n.clientId)){e.next=4;break}throw new N("Mismatch between clientId in token ("+n.clientId+") and current clientId ("+this.clientId+")",40102,403);case 4:if(this.isTimeOffsetSet()&&n.expires&&!(n.expires>=this.getTimestampUsingOffset())){e.next=7;break}return L.logAction(this.logger,L.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+n.expires),e.abrupt("return",n);case 7:L.logAction(this.logger,L.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null;case 9:if(r=(this.waitingForTokenRequest||(this.waitingForTokenRequest=He.create(this.logger))).createPromise(),null===this.currentTokenRequestId||t){e.next=12;break}return e.abrupt("return",r);case 12:return i=this.currentTokenRequestId=et++,s=null,e.prev=14,e.next=17,this.requestToken(this.tokenParams,this.authOptions);case 17:a=e.sent,e.next=23;break;case 20:e.prev=20,e.t0=e.catch(14),s=e.t0;case 23:if(!(this.currentTokenRequestId>i)){e.next=26;break}return L.logAction(this.logger,L.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one"),e.abrupt("return",r);case 26:if(this.currentTokenRequestId=null,c=this.waitingForTokenRequest,this.waitingForTokenRequest=null,!s){e.next=32;break}return null==c||c.rejectAll(s),e.abrupt("return",r);case 32:return null==c||c.resolveAll(this.tokenDetails=a),e.abrupt("return",r);case 34:case"end":return e.stop()}}),e,this,[[14,20]])}))),function(e){return t.apply(this,arguments)})},{key:"_userSetClientId",value:function(e){if("string"!=typeof e&&null!==e)throw new N("clientId must be either a string or null",40012,400);if("*"===e)throw new N('Can’t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var t=this._uncheckedSetClientId(e);if(t)throw t}},{key:"_uncheckedSetClientId",value:function(e){if(this._tokenClientIdMismatch(e)){var t="Unexpected clientId mismatch: client has "+this.clientId+", requested "+e,n=new N(t,40102,401);return L.logAction(this.logger,L.LOG_ERROR,"Auth._uncheckedSetClientId()",t),n}return this.clientId=this.tokenParams.clientId=e,null}},{key:"_tokenClientIdMismatch",value:function(e){return!(!this.clientId||"*"===this.clientId||!e||"*"===e||this.clientId===e)}},{key:"revokeTokens",value:function(e,t){return this.client.rest.revokeTokens(e,t)}}],[{key:"isTokenErr",value:function(e){return e.code&&e.code>=40140&&e.code<40150}}]),e}();function nt(e){var t=[];if(e)for(var n in e)t.push(n+"="+e[n]);return t.join("&")}function rt(e,t){return e+(t?"?":"")+nt(t)}function ot(e,t,n,r,o){e.error?L.logActionNoStrip(o,L.LOG_MICRO,"Http."+t+"()","Received Error; "+rt(n,r)+"; Error: "+le(e.error)):L.logActionNoStrip(o,L.LOG_MICRO,"Http."+t+"()","Received; "+rt(n,r)+"; Headers: "+nt(e.headers)+"; StatusCode: "+e.statusCode+"; Body"+(T.BufferUtils.isBuffer(e.body)?" (Base64): "+T.BufferUtils.base64Encode(e.body):": "+e.body))}function it(e,t,n,r,o){o.shouldLog(L.LOG_MICRO)&&L.logActionNoStrip(o,L.LOG_MICRO,"Http."+e+"()","Sending; "+rt(t,r)+"; Body"+(T.BufferUtils.isBuffer(n)?" (Base64): "+T.BufferUtils.base64Encode(n):": "+n))}var at=function(){function e(t){var n=this;b(this,e),this.client=t,this.platformHttp=new T.Http(t),this.checkConnectivity=this.platformHttp.checkConnectivity?function(){return n.platformHttp.checkConnectivity()}:void 0}var t,n;return g(e,[{key:"logger",get:function(){var e,t;return null!=(t=null==(e=this.client)?void 0:e.logger)?t:L.defaultLogger}},{key:"supportsAuthHeaders",get:function(){return this.platformHttp.supportsAuthHeaders}},{key:"supportsLinkHeaders",get:function(){return this.platformHttp.supportsLinkHeaders}},{key:"_getHosts",value:function(e){var t=e.connection,n=t&&t.connectionManager.host;return n?[n].concat(qe.getFallbackHosts(e.options)):qe.getHosts(e.options)}},{key:"do",value:(n=a(o().mark((function e(t,n,r,i,s){var c,u,l,f,h,p,d,v=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,c=this.client){e.next=4;break}return e.abrupt("return",{error:new N("http.do called without client",5e4,500)});case 4:if(u="function"==typeof n?n:function(e){return c.baseUri(e)+n},!(l=c._currentFallback)){e.next=18;break}if(!(l.validUntil>Date.now())){e.next=17;break}return e.next=10,this.doUri(t,u(l.host),r,i,s);case 10:if(!(f=e.sent).error||!this.platformHttp.shouldFallback(f.error)){e.next=14;break}return c._currentFallback=null,e.abrupt("return",this.do(t,n,r,i,s));case 14:return e.abrupt("return",f);case 17:c._currentFallback=null;case 18:if(1!==(h=this._getHosts(c)).length){e.next=21;break}return e.abrupt("return",this.doUri(t,u(h[0]),r,i,s));case 21:return p=null,d=function(){var e=a(o().mark((function e(n,a){var l,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=n.shift(),p=null!=p?p:new Date,e.next=4,v.doUri(t,u(l),r,i,s);case 4:if(!((f=e.sent).error&&v.platformHttp.shouldFallback(f.error)&&n.length)){e.next=10;break}if(!(Date.now()-p.getTime()>c.options.timeouts.httpMaxRetryDuration)){e.next=9;break}return e.abrupt("return",{error:new N("Timeout for trying fallback hosts retries. Total elapsed time exceeded the ".concat(c.options.timeouts.httpMaxRetryDuration,"ms limit"),50003,500)});case 9:return e.abrupt("return",d(n,!0));case 10:return a&&(c._currentFallback={host:l,validUntil:Date.now()+c.options.timeouts.fallbackRetryTimeout}),e.abrupt("return",f);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.abrupt("return",d(h));case 26:return e.prev=26,e.t0=e.catch(0),e.abrupt("return",{error:new N("Unexpected error in Http.do: ".concat(le(e.t0)),500,5e4)});case 29:case"end":return e.stop()}}),e,this,[[0,26]])}))),function(e,t,r,o,i){return n.apply(this,arguments)})},{key:"doUri",value:(t=a(o().mark((function e(t,n,r,i,a){var s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,it(t,n,i,a,this.logger),e.next=4,this.platformHttp.doUri(t,n,r,i,a);case 4:return s=e.sent,this.logger.shouldLog(L.LOG_MICRO)&&ot(s,t,n,a,this.logger),e.abrupt("return",s);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",{error:new N("Unexpected error in Http.doUri: ".concat(le(e.t0)),500,5e4)});case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e,n,r,o,i){return t.apply(this,arguments)})}]),e}(),st=function(){function e(t){var n,r,o,i,a,s,c,u;b(this,e),this.Platform=T,this.ErrorInfo=N,this.Logger=L,this.Defaults=qe,this.Utils=M,this._additionalHTTPRequestImplementations=null!=(n=t.plugins)?n:null,this.logger=new L,this.logger.setLog(t.logLevel,t.logHandler),L.logAction(this.logger,L.LOG_MICRO,"BaseClient()","initialized with clientOptions "+T.Config.inspect(t)),this._MsgPack=null!=(o=null==(r=t.plugins)?void 0:r.MsgPack)?o:null;var l=this.options=qe.normaliseOptions(t,this._MsgPack,this.logger);if(l.key){var f=l.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!f){var h="invalid key parameter";throw L.logAction(this.logger,L.LOG_ERROR,"BaseClient()",h),new N(h,40400,404)}l.keyName=f[1],l.keySecret=f[2]}if("clientId"in l){if("string"!=typeof l.clientId&&null!==l.clientId)throw new N("clientId must be either a string or null",40012,400);if("*"===l.clientId)throw new N('Can’t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}L.logAction(this.logger,L.LOG_MINOR,"BaseClient()","started; version = "+qe.version),this._currentFallback=null,this.serverTimeOffset=null,this.http=new at(this),this.auth=new tt(this,l),this._rest=(null==(i=t.plugins)?void 0:i.Rest)?new t.plugins.Rest(this):null,this._Crypto=null!=(s=null==(a=t.plugins)?void 0:a.Crypto)?s:null,this.__FilteredSubscriptions=null!=(u=null==(c=t.plugins)?void 0:c.MessageInteractions)?u:null}var t,n,r;return g(e,[{key:"rest",get:function(){return this._rest||Pe("Rest"),this._rest}},{key:"_FilteredSubscriptions",get:function(){return this.__FilteredSubscriptions||Pe("MessageInteractions"),this.__FilteredSubscriptions}},{key:"channels",get:function(){return this.rest.channels}},{key:"push",get:function(){return this.rest.push}},{key:"device",get:function(){var e;return(null==(e=this.options.plugins)?void 0:e.Push)&&this.push.LocalDevice||Pe("Push"),this._device||(this._device=this.push.LocalDevice.load(this)),this._device}},{key:"baseUri",value:function(e){return qe.getHttpScheme(this.options)+e+":"+qe.getPort(this.options,!1)}},{key:"stats",value:(r=a(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rest.stats(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"time",value:(n=a(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rest.time(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"request",value:(t=a(o().mark((function e(t,n,r,i,a,s){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rest.request(t,n,r,i,a,s));case 1:case"end":return e.stop()}}),e,this)}))),function(e,n,r,o,i,a){return t.apply(this,arguments)})},{key:"batchPublish",value:function(e){return this.rest.batchPublish(e)}},{key:"batchPresence",value:function(e){return this.rest.batchPresence(e)}},{key:"setLog",value:function(e){this.logger.setLog(e.level,e.handler)}}]),e}();st.Platform=T;var ct=st,ut=function(){function e(){b(this,e)}return g(e,[{key:"toJSON",value:function(){var e,t,n;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:null==(e=this.push)?void 0:e.recipient,state:null==(t=this.push)?void 0:t.state,error:null==(n=this.push)?void 0:n.error}}}},{key:"toString",value:function(){var e,t,n,r,o="[DeviceDetails";return this.id&&(o+="; id="+this.id),this.platform&&(o+="; platform="+this.platform),this.formFactor&&(o+="; formFactor="+this.formFactor),this.clientId&&(o+="; clientId="+this.clientId),this.metadata&&(o+="; metadata="+this.metadata),this.deviceIdentityToken&&(o+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),(null==(e=this.push)?void 0:e.recipient)&&(o+="; push.recipient="+JSON.stringify(this.push.recipient)),(null==(t=this.push)?void 0:t.state)&&(o+="; push.state="+this.push.state),(null==(n=this.push)?void 0:n.error)&&(o+="; push.error="+JSON.stringify(this.push.error)),(null==(r=this.push)?void 0:r.metadata)&&(o+="; push.metadata="+this.push.metadata),o+="]"}}],[{key:"toRequestBody",value:function(e,t,n){return me(e,t,n)}},{key:"fromResponseBody",value:function(t,n,r){return r&&(t=ge(t,n,r)),Array.isArray(t)?e.fromValuesArray(t):e.fromValues(t)}},{key:"fromValues",value:function(t){return t.error=t.error&&N.fromValues(t.error),Object.assign(new e,t)}},{key:"fromLocalDevice",value:function(t){return Object.assign(new e,t)}},{key:"fromValuesArray",value:function(t){for(var n=t.length,r=new Array(n),o=0;o<n;o++)r[o]=e.fromValues(t[o]);return r}}]),e}();function lt(e,t,n,r){return ft.apply(this,arguments)}function ft(){return(ft=a(o().mark((function e(t,n,r,i){var a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.http.supportsAuthHeaders){e.next=7;break}return e.next=3,t.auth.getAuthHeaders();case 3:return a=e.sent,e.abrupt("return",i(G(a,n),r));case 7:return e.next=9,t.auth.getAuthParams();case 9:return s=e.sent,e.abrupt("return",i(n,G(s,r)));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ht(e,t,n){if(e.err&&!e.body)return{err:e.err};if(e.statusCode===Je.NoContent)return x(S({},e),{body:[],unpacked:!0});var r=e.body;if(!e.unpacked)try{r=ge(r,t,n)}catch(e){return ue(e)?{err:e}:{err:new D(le(e),null)}}if(!r)return{err:new D("unenvelope(): Response body is missing",null)};var o=r,i=o.statusCode,a=o.response,s=o.headers;if(void 0===i)return x(S({},e),{body:r,unpacked:!0});if(i<200||i>=300){var c=a&&a.error||e.err;return c||((c=new Error("Error in unenveloping "+r)).statusCode=i),{err:c,body:a,headers:s,unpacked:!0,statusCode:i}}return{err:e.err,body:a,headers:s,unpacked:!0,statusCode:i}}function pt(e,t,n,r,o){e.err?L.logAction(o,L.LOG_MICRO,"Resource."+t+"()","Received Error; "+rt(n,r)+"; Error: "+le(e.err)):L.logAction(o,L.LOG_MICRO,"Resource."+t+"()","Received; "+rt(n,r)+"; Headers: "+nt(e.headers)+"; StatusCode: "+e.statusCode+"; Body: "+(T.BufferUtils.isBuffer(e.body)?" (Base64): "+T.BufferUtils.base64Encode(e.body):": "+T.Config.inspect(e.body)))}var dt=function(){function e(){b(this,e)}var t,n,r,i,s,c;return g(e,null,[{key:"get",value:(c=a(o().mark((function t(n,r,i,a,s,c){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.do(Ve.Get,n,r,null,i,a,s,null!=c&&c));case 1:case"end":return t.stop()}}),t)}))),function(e,t,n,r,o,i){return c.apply(this,arguments)})},{key:"delete",value:(s=a(o().mark((function t(n,r,i,a,s,c){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.do(Ve.Delete,n,r,null,i,a,s,c));case 1:case"end":return t.stop()}}),t)}))),function(e,t,n,r,o,i){return s.apply(this,arguments)})},{key:"post",value:(i=a(o().mark((function t(n,r,i,a,s,c,u){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.do(Ve.Post,n,r,i,a,s,c,u));case 1:case"end":return t.stop()}}),t)}))),function(e,t,n,r,o,a,s){return i.apply(this,arguments)})},{key:"patch",value:(r=a(o().mark((function t(n,r,i,a,s,c,u){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.do(Ve.Patch,n,r,i,a,s,c,u));case 1:case"end":return t.stop()}}),t)}))),function(e,t,n,o,i,a,s){return r.apply(this,arguments)})},{key:"put",value:(n=a(o().mark((function t(n,r,i,a,s,c,u){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.do(Ve.Put,n,r,i,a,s,c,u));case 1:case"end":return t.stop()}}),t)}))),function(e,t,r,o,i,a,s){return n.apply(this,arguments)})},{key:"do",value:(t=a(o().mark((function e(t,n,r,i,s,c,u,l){var f,h,p,d,v;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p=function(){return(p=a(o().mark((function e(a,s){var c,u,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f.shouldLog(L.LOG_MICRO)){if(u=i,(null==(c=a["content-type"])?void 0:c.indexOf("msgpack"))>0)try{n._MsgPack||Pe("MsgPack"),u=n._MsgPack.decode(i)}catch(e){L.logAction(f,L.LOG_MICRO,"Resource."+t+"()","Sending MsgPack Decoding Error: "+le(e))}L.logAction(f,L.LOG_MICRO,"Resource."+t+"()","Sending; "+rt(r,s)+"; Body: "+u)}return e.next=3,n.http.do(t,r,a,i,s);case 3:if(!(l=e.sent).error||!tt.isTokenErr(l.error)){e.next=8;break}return e.next=7,n.auth.authorize(null,null);case 7:return e.abrupt("return",lt(n,a,s,h));case 8:return e.abrupt("return",{err:l.error,body:l.body,headers:l.headers,unpacked:l.unpacked,statusCode:l.statusCode});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)},h=function(e,t){return p.apply(this,arguments)},u&&((c=c||{}).envelope=u),f=n.logger,e.next=6,lt(n,s,c,h);case 6:if(d=e.sent,u&&(d=ht(d,n._MsgPack,u)),f.shouldLog(L.LOG_MICRO)&&pt(d,t,r,c,f),!l){e.next=17;break}if(!d.err){e.next=14;break}throw d.err;case 14:return delete(v=S({},d)).err,e.abrupt("return",v);case 17:return e.abrupt("return",d);case 18:case"end":return e.stop()}}),e)}))),function(e,n,r,o,i,a,s,c){return t.apply(this,arguments)})}]),e}();function vt(e){"string"==typeof e&&(e=e.split(","));for(var t,n,r={},o=0;o<e.length;o++){var i=e[o].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(i){var a=(t=i[1],n=void 0,(n=t.match(/^\.\/(\w+)\?(.*)$/))&&n[2]&&ce(n[2]));a&&(r[i[2]]=a)}}return r}var yt=function(){function e(t,n,r,o,i,a){b(this,e),this.client=t,this.path=n,this.headers=r,this.envelope=null!=o?o:null,this.bodyHandler=i,this.useHttpPaginatedResponse=a||!1}var t,n,r,i,s,c;return g(e,[{key:"logger",get:function(){return this.client.logger}},{key:"get",value:(c=a(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dt.get(this.client,this.path,this.headers,t,this.envelope,!1);case 2:return n=e.sent,e.abrupt("return",this.handlePage(n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"delete",value:(s=a(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dt.delete(this.client,this.path,this.headers,t,this.envelope,!1);case 2:return n=e.sent,e.abrupt("return",this.handlePage(n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"post",value:(i=a(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dt.post(this.client,this.path,n,this.headers,t,this.envelope,!1);case 2:return r=e.sent,e.abrupt("return",this.handlePage(r));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"put",value:(r=a(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dt.put(this.client,this.path,n,this.headers,t,this.envelope,!1);case 2:return r=e.sent,e.abrupt("return",this.handlePage(r));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"patch",value:(n=a(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dt.patch(this.client,this.path,n,this.headers,t,this.envelope,!1);case 2:return r=e.sent,e.abrupt("return",this.handlePage(r));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"handlePage",value:(t=a(o().mark((function e(t){var n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.err||(o=t.err,a=t.body,this.useHttpPaginatedResponse&&(a||"number"==typeof o.code))){e.next=3;break}throw L.logAction(this.logger,L.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+le(t.err)),t.err;case 3:if(e.prev=3,t.statusCode!=Je.NoContent){e.next=8;break}e.t0=[],e.next=11;break;case 8:return e.next=10,this.bodyHandler(t.body,t.headers||{},t.unpacked);case 10:e.t0=e.sent;case 11:n=e.t0,e.next=17;break;case 14:throw e.prev=14,e.t1=e.catch(3),t.err||e.t1;case 17:if(t.headers&&(r=t.headers.Link||t.headers.link)&&(i=vt(r)),!this.useHttpPaginatedResponse){e.next=22;break}return e.abrupt("return",new mt(this,n,t.headers||{},t.statusCode,i,t.err));case 22:return e.abrupt("return",new gt(this,n,i));case 23:case"end":return e.stop()}var o,a}),e,this,[[3,14]])}))),function(e){return t.apply(this,arguments)})}]),e}(),gt=function(){function e(t,n,r){var i=this;b(this,e),this.resource=t,this.items=n;var s=this;r&&("first"in r&&(this.first=a(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s.get(r.first));case 1:case"end":return e.stop()}}),e)})))),"current"in r&&(this.current=a(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s.get(r.current));case 1:case"end":return e.stop()}}),e)})))),this.next=a(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("next"in r)){e.next=4;break}return e.abrupt("return",s.get(r.next));case 4:return e.abrupt("return",null);case 5:case"end":return e.stop()}}),e)}))),this.hasNext=function(){return"next"in r},this.isLast=function(){var e;return!(null==(e=i.hasNext)?void 0:e.call(i))})}var t;return g(e,[{key:"get",value:(t=a(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.resource,e.next=3,dt.get(n.client,n.path,n.headers,t,n.envelope,!1);case 3:return r=e.sent,e.abrupt("return",n.handlePage(r));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),mt=function(e){function t(e,n,r,o,i,a){var c;return b(this,t),(c=s(this,t,[e,n,i])).statusCode=o,c.success=o<300&&o>=200,c.headers=r,c.errorCode=a&&a.code,c.errorMessage=a&&a.message,c}return u(t,e),g(t,[{key:"toJSON",value:function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}}}]),t}(gt),bt=yt,wt=function(){function e(){b(this,e)}return g(e,[{key:"toJSON",value:function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}}},{key:"toString",value:function(){var e="[PushChannelSubscription";return this.channel&&(e+="; channel="+this.channel),this.deviceId&&(e+="; deviceId="+this.deviceId),this.clientId&&(e+="; clientId="+this.clientId),e+="]"}}],[{key:"fromResponseBody",value:function(t,n,r){return r&&(t=ge(t,n,r)),Array.isArray(t)?e.fromValuesArray(t):e.fromValues(t)}},{key:"fromValues",value:function(t){return Object.assign(new e,t)}},{key:"fromValuesArray",value:function(t){for(var n=t.length,r=new Array(n),o=0;o<n;o++)r[o]=e.fromValues(t[o]);return r}}]),e}();wt.toRequestBody=me;var kt=wt,_t=function(){function e(t){var n;b(this,e),this.client=t,this.admin=new Et(t),T.Config.push&&(null==(n=t.options.plugins)?void 0:n.Push)&&(this.stateMachine=new t.options.plugins.Push.ActivationStateMachine(t),this.LocalDevice=t.options.plugins.Push.localDeviceFactory(ut))}var t,n;return g(e,[{key:"activate",value:(n=a(o().mark((function e(t,n){var r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,o){var i;(null==(i=r.client.options.plugins)?void 0:i.Push)?r.stateMachine?r.stateMachine.activatedCallback?o(new N("Activation already in progress",4e4,400)):(r.stateMachine.activatedCallback=function(t){t?o(t):e()},r.stateMachine.updateFailedCallback=n,r.stateMachine.handleEvent(new r.client.options.plugins.Push.CalledActivate(r.stateMachine,t))):o(new N("This platform is not supported as a target of push notifications",4e4,400)):o(Te("Push"))}));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"deactivate",value:(t=a(o().mark((function e(t){var n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,r){var o;(null==(o=n.client.options.plugins)?void 0:o.Push)?n.stateMachine?n.stateMachine.deactivatedCallback?r(new N("Deactivation already in progress",4e4,400)):(n.stateMachine.deactivatedCallback=function(t){t?r(t):e()},n.stateMachine.handleEvent(new n.client.options.plugins.Push.CalledDeactivate(n.stateMachine,t))):r(new N("This platform is not supported as a target of push notifications",4e4,400)):r(Te("Push"))}));case 2:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),Et=function(){function e(t){b(this,e),this.client=t,this.deviceRegistrations=new Ot(t),this.channelSubscriptions=new St(t)}var t;return g(e,[{key:"publish",value:(t=a(o().mark((function e(t,n){var r,i,a,s,c,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.client,i=r.options.useBinaryProtocol?"msgpack":"json",a=qe.defaultPostHeaders(r.options,{format:i}),s={},c=G({recipient:t},n),G(a,r.options.headers),r.options.pushFullWait&&G(s,{fullWait:"true"}),u=me(c,r._MsgPack,i),e.next=8,dt.post(r,"/push/publish",u,a,s,null,!0);case 8:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),Ot=function(){function e(t){b(this,e),this.client=t}var t,n,r,i,s;return g(e,[{key:"save",value:(s=a(o().mark((function e(t){var n,r,i,a,s,c,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.client,r=ut.fromValues(t),i=n.options.useBinaryProtocol?"msgpack":"json",a=qe.defaultPostHeaders(n.options,{format:i}),s={},G(a,n.options.headers),n.options.pushFullWait&&G(s,{fullWait:"true"}),c=me(r,n._MsgPack,i),e.next=8,dt.put(n,"/push/deviceRegistrations/"+encodeURIComponent(t.id),c,a,s,null,!0);case 8:return u=e.sent,e.abrupt("return",ut.fromResponseBody(u.body,n._MsgPack,u.unpacked?void 0:i));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"get",value:(i=a(o().mark((function e(t){var n,r,i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.client,r=n.options.useBinaryProtocol?"msgpack":"json",i=qe.defaultGetHeaders(n.options,{format:r}),"string"==typeof(a=t.id||t)&&a.length){e.next=3;break}throw new N("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400);case 3:return G(i,n.options.headers),e.next=6,dt.get(n,"/push/deviceRegistrations/"+encodeURIComponent(a),i,{},null,!0);case 6:return s=e.sent,e.abrupt("return",ut.fromResponseBody(s.body,n._MsgPack,s.unpacked?void 0:r));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"list",value:(r=a(o().mark((function e(t){var n,r,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.client,r=n.options.useBinaryProtocol?"msgpack":"json",i=this.client.http.supportsLinkHeaders?void 0:r,G(s=qe.defaultGetHeaders(n.options,{format:r}),n.options.headers),e.abrupt("return",new bt(n,"/push/deviceRegistrations",s,i,function(){var e=a(o().mark((function e(t,i,a){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ut.fromResponseBody(t,n._MsgPack,a?void 0:r));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()).get(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"remove",value:(n=a(o().mark((function e(t){var n,r,i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.client,r=n.options.useBinaryProtocol?"msgpack":"json",i=qe.defaultGetHeaders(n.options,{format:r}),a={},"string"==typeof(s=t.id||t)&&s.length){e.next=3;break}throw new N("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400);case 3:return G(i,n.options.headers),n.options.pushFullWait&&G(a,{fullWait:"true"}),e.next=7,dt.delete(n,"/push/deviceRegistrations/"+encodeURIComponent(s),i,a,null,!0);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"removeWhere",value:(t=a(o().mark((function e(t){var n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.client,r=n.options.useBinaryProtocol?"msgpack":"json",G(i=qe.defaultGetHeaders(n.options,{format:r}),n.options.headers),n.options.pushFullWait&&G(t,{fullWait:"true"}),e.next=5,dt.delete(n,"/push/deviceRegistrations",i,t,null,!0);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),St=function(){function e(t){b(this,e),this.remove=e.prototype.removeWhere,this.client=t}var t,n,r,i;return g(e,[{key:"save",value:(i=a(o().mark((function e(t){var n,r,i,a,s,c,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.client,r=kt.fromValues(t),i=n.options.useBinaryProtocol?"msgpack":"json",a=qe.defaultPostHeaders(n.options,{format:i}),s={},G(a,n.options.headers),n.options.pushFullWait&&G(s,{fullWait:"true"}),c=me(r,n._MsgPack,i),e.next=8,dt.post(n,"/push/channelSubscriptions",c,a,s,null,!0);case 8:return u=e.sent,e.abrupt("return",kt.fromResponseBody(u.body,n._MsgPack,u.unpacked?void 0:i));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"list",value:(r=a(o().mark((function e(t){var n,r,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.client,r=n.options.useBinaryProtocol?"msgpack":"json",i=this.client.http.supportsLinkHeaders?void 0:r,G(s=qe.defaultGetHeaders(n.options,{format:r}),n.options.headers),e.abrupt("return",new bt(n,"/push/channelSubscriptions",s,i,function(){var e=a(o().mark((function e(t,i,a){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",kt.fromResponseBody(t,n._MsgPack,a?void 0:r));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()).get(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"removeWhere",value:(n=a(o().mark((function e(t){var n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.client,r=n.options.useBinaryProtocol?"msgpack":"json",G(i=qe.defaultGetHeaders(n.options,{format:r}),n.options.headers),n.options.pushFullWait&&G(t,{fullWait:"true"}),e.next=5,dt.delete(n,"/push/channelSubscriptions",i,t,null,!0);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"listChannels",value:(t=a(o().mark((function e(t){var n,r,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.client,r=n.options.useBinaryProtocol?"msgpack":"json",i=this.client.http.supportsLinkHeaders?void 0:r,G(s=qe.defaultGetHeaders(n.options,{format:r}),n.options.headers),n.options.pushFullWait&&G(t,{fullWait:"true"}),e.abrupt("return",new bt(n,"/push/channels",s,i,function(){var e=a(o().mark((function e(t,i,a){var s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=!a&&r?ge(t,n._MsgPack,r):t,c=0;c<s.length;c++)s[c]=String(s[c]);return e.abrupt("return",s);case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()).get(t));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),xt=_t;function Ct(e){return e&&e.channelOptions?e:{channelOptions:e,plugins:{},baseEncodedPreviousPayload:void 0}}function At(e,t,n){if(n&&n.cipher){e||Pe("Crypto");var r=e.getCipher(n.cipher,t);return{cipher:r.cipherParams,channelCipher:r.cipher}}return null!=n?n:{}}function Tt(e){var t=0;return e.name&&(t+=e.name.length),e.clientId&&(t+=e.clientId.length),e.extras&&(t+=JSON.stringify(e.extras).length),e.data&&(t+=he(e.data)),t}function Pt(e,t,n,r){return It.apply(this,arguments)}function It(){return(It=a(o().mark((function e(t,n,r,i){var a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Vt(r),s=At(n,t,null!=i?i:null),e.prev=2,e.next=5,Ft(a,s);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),L.logAction(t,L.LOG_ERROR,"Message.fromEncoded()",e.t0.toString());case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,null,[[2,7]])})))).apply(this,arguments)}function jt(e,t,n,r){return Rt.apply(this,arguments)}function Rt(){return(Rt=a(o().mark((function e(t,n,r,i){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(r.map((function(e){return Pt(t,n,e,i)}))));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lt(e,t){return Mt.apply(this,arguments)}function Mt(){return(Mt=a(o().mark((function e(t,n){var r,i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.data,i=t.encoding,a=n.channelCipher,i=i?i+"/":"",T.BufferUtils.isBuffer(r)||(r=T.BufferUtils.utf8Encode(String(r)),i+="utf-8/"),e.next=5,a.encrypt(r);case 5:return s=e.sent,t.data=s,t.encoding=i+"cipher+"+a.algorithm,e.abrupt("return",t);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ut(e,t){return Nt.apply(this,arguments)}function Nt(){return(Nt=a(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof(r=t.data)||T.BufferUtils.isBuffer(r)||null==r){e.next=9;break}if(!q(r)&&!Array.isArray(r)){e.next=8;break}t.data=JSON.stringify(r),t.encoding=t.encoding?t.encoding+"/json":"json",e.next=9;break;case 8:throw new N("Data type is unsupported",40013,400);case 9:if(null==n||!n.cipher){e.next=13;break}return e.abrupt("return",Lt(t,n));case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dt(e,t){return Gt.apply(this,arguments)}function Gt(){return(Gt=a(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return Ut(e,n)}))));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Bt=me;function Ft(e,t){return qt.apply(this,arguments)}function qt(){return(qt=a(o().mark((function e(t,n){var r,i,a,s,c,u,l,f,h,p,d,v,y,g;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Ct(n),i=t.data,!(a=t.encoding)){e.next=64;break}s=a.split("/"),u=s.length,l=t.data,f="",e.prev=7;case 8:if(!((c=u)>0)){e.next=54;break}if(h=s[--u].match(/([-\w]+)(\+([\w-]+))?/)){e.next=12;break}return e.abrupt("break",54);case 12:f=h[1],e.t0=f,e.next="base64"===e.t0?16:"utf-8"===e.t0?19:"json"===e.t0?21:"cipher"===e.t0?23:"vcdiff"===e.t0?34:51;break;case 16:return l=T.BufferUtils.base64Decode(String(l)),c==s.length&&(i=l),e.abrupt("continue",8);case 19:return l=T.BufferUtils.utf8Decode(l),e.abrupt("continue",8);case 21:return l=JSON.parse(l),e.abrupt("continue",8);case 23:if(null==r.channelOptions||!r.channelOptions.cipher||!r.channelOptions.channelCipher){e.next=33;break}if(p=h[3],d=r.channelOptions.channelCipher,p==d.algorithm){e.next=27;break}throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");case 27:return e.next=29,d.decrypt(l);case 29:return l=e.sent,e.abrupt("continue",8);case 33:throw new Error("Unable to decrypt message; not an encrypted channel");case 34:if(r.plugins&&r.plugins.vcdiff){e.next=36;break}throw new N("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);case 36:if("undefined"!=typeof Uint8Array){e.next=38;break}throw new N("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);case 38:e.prev=38,"string"==typeof(v=r.baseEncodedPreviousPayload)&&(v=T.BufferUtils.utf8Encode(v)),y=T.BufferUtils.toBuffer(v),l=T.BufferUtils.toBuffer(l),l=T.BufferUtils.arrayBufferViewToBuffer(r.plugins.vcdiff.decode(l,y)),i=l,e.next=50;break;case 47:throw e.prev=47,e.t1=e.catch(38),new N("Vcdiff delta decode failed with "+e.t1,40018,400);case 50:return e.abrupt("continue",8);case 51:throw new Error("Unknown encoding");case 52:e.next=8;break;case 54:e.next=60;break;case 56:throw e.prev=56,e.t2=e.catch(7),g=e.t2,new N("Error processing the "+f+" encoding, decoder returned ‘"+g.message+"’",g.code||40013,400);case 60:return e.prev=60,t.encoding=c<=0?null:s.slice(0,c).join("/"),t.data=l,e.finish(60);case 64:r.baseEncodedPreviousPayload=i;case 65:case"end":return e.stop()}}),e,null,[[7,56,60,64],[38,47]])})))).apply(this,arguments)}function Ht(e,t,n,r,o){return Wt.apply(this,arguments)}function Wt(){return(Wt=a(o().mark((function e(t,n,r,i,a){var s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(t=ge(t,i,a)),s=0;case 2:if(!(s<t.length)){e.next=15;break}return c=t[s]=Vt(t[s]),e.prev=4,e.next=7,Ft(c,n);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),L.logAction(r,L.LOG_ERROR,"Message.fromResponseBody()",e.t0.toString());case 12:s++,e.next=2;break;case 15:return e.abrupt("return",t);case 16:case"end":return e.stop()}}),e,null,[[4,9]])})))).apply(this,arguments)}function Vt(e){return Object.assign(new Kt,e)}function zt(e){for(var t=e.length,n=new Array(t),r=0;r<t;r++)n[r]=Vt(e[r]);return n}function Jt(e){for(var t,n=0,r=0;r<e.length;r++)n+=(t=e[r]).size||(t.size=Tt(t));return n}var Kt=function(){function e(){b(this,e)}return g(e,[{key:"toJSON",value:function(){var e=this.encoding,t=this.data;return t&&T.BufferUtils.isBuffer(t)&&(arguments.length>0?(e=e?e+"/base64":"base64",t=T.BufferUtils.base64Encode(t)):t=T.BufferUtils.toBuffer(t)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:e,data:t}}},{key:"toString",value:function(){var e="[Message";return this.name&&(e+="; name="+this.name),this.id&&(e+="; id="+this.id),this.timestamp&&(e+="; timestamp="+this.timestamp),this.clientId&&(e+="; clientId="+this.clientId),this.connectionId&&(e+="; connectionId="+this.connectionId),this.encoding&&(e+="; encoding="+this.encoding),this.extras&&(e+="; extras ="+JSON.stringify(this.extras)),this.data&&("string"==typeof this.data?e+="; data="+this.data:T.BufferUtils.isBuffer(this.data)?e+="; data (buffer)="+T.BufferUtils.base64Encode(this.data):e+="; data (json)="+JSON.stringify(this.data)),this.extras&&(e+="; extras="+JSON.stringify(this.extras)),e+="]"}}]),e}(),Qt=Kt,Yt=["absent","present","enter","leave","update"];function Xt(e){return Yt.indexOf(e)}function $t(e,t,n){return Zt.apply(this,arguments)}function Zt(){return(Zt=a(o().mark((function e(t,n,r){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=nn(n,!0),e.prev=1,e.next=4,rn(i,null!=r?r:{});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),L.logAction(t,L.LOG_ERROR,"PresenceMessage.fromEncoded()",e.t0.toString());case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})))).apply(this,arguments)}function en(e,t,n){return tn.apply(this,arguments)}function tn(){return(tn=a(o().mark((function e(t,n,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(n.map((function(e){return $t(t,e,r)}))));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nn(e,t){return t&&(e.action=Yt[e.action]),Object.assign(new un,e)}var rn=Ft;function on(e,t,n,r,o){return an.apply(this,arguments)}function an(){return(an=a(o().mark((function e(t,n,r,i,a){var s,c,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=[],a&&(t=ge(t,i,a)),c=0;case 3:if(!(c<t.length)){e.next=16;break}return u=s[c]=nn(t[c],!0),e.prev=5,e.next=8,rn(u,n);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),L.logAction(r,L.LOG_ERROR,"PresenceMessage.fromResponseBody()",e.t0.toString());case 13:c++,e.next=3;break;case 16:return e.abrupt("return",s);case 17:case"end":return e.stop()}}),e,null,[[5,10]])})))).apply(this,arguments)}function sn(e){for(var t=e.length,n=new Array(t),r=0;r<t;r++)n[r]=nn(e[r]);return n}function cn(e){return e instanceof un?e:nn({data:e})}var un=function(){function e(){b(this,e)}return g(e,[{key:"isSynthesized",value:function(){return!this.id||!this.connectionId||this.id.substring(this.connectionId.length,0)!==this.connectionId}},{key:"parseId",value:function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var e=this.id.split(":");return{connectionId:e[0],msgSerial:parseInt(e[1],10),index:parseInt(e[2],10)}}},{key:"toJSON",value:function(){var e=this.data,t=this.encoding;return e&&T.BufferUtils.isBuffer(e)&&(arguments.length>0?(t=t?t+"/base64":"base64",e=T.BufferUtils.base64Encode(e)):e=T.BufferUtils.toBuffer(e)),{id:this.id,clientId:this.clientId,action:Xt(this.action),data:e,encoding:t,extras:this.extras}}},{key:"toString",value:function(){var e="[PresenceMessage";return e+="; action="+this.action,this.id&&(e+="; id="+this.id),this.timestamp&&(e+="; timestamp="+this.timestamp),this.clientId&&(e+="; clientId="+this.clientId),this.connectionId&&(e+="; connectionId="+this.connectionId),this.encoding&&(e+="; encoding="+this.encoding),this.data&&("string"==typeof this.data?e+="; data="+this.data:T.BufferUtils.isBuffer(this.data)?e+="; data (buffer)="+T.BufferUtils.base64Encode(this.data):e+="; data (json)="+JSON.stringify(this.data)),this.extras&&(e+="; extras="+JSON.stringify(this.extras)),e+="]"}}]),e}(),ln=un,fn=function(){function e(t){b(this,e),this.channel=t}var t,n;return g(e,[{key:"logger",get:function(){return this.channel.logger}},{key:"get",value:(n=a(o().mark((function e(t){var n,r,i,s,c,u=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return L.logAction(this.logger,L.LOG_MICRO,"RestPresence.get()","channel = "+this.channel.name),n=this.channel.client,r=n.options.useBinaryProtocol?"msgpack":"json",i=this.channel.client.http.supportsLinkHeaders?void 0:r,G(s=qe.defaultGetHeaders(n.options,{format:r}),n.options.headers),c=this.channel.channelOptions,e.abrupt("return",new bt(n,this.channel.client.rest.presenceMixin.basePath(this),s,i,function(){var e=a(o().mark((function e(t,i,a){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,on(t,c,u.logger,n._MsgPack,a?void 0:r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()).get(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"history",value:(t=a(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return L.logAction(this.logger,L.LOG_MICRO,"RestPresence.history()","channel = "+this.channel.name),e.abrupt("return",this.channel.client.rest.presenceMixin.history(this,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function hn(e){return e.every((function(e){return!e.id}))}var pn=function(){function e(t,n,r){var o,i;b(this,e),L.logAction(t.logger,L.LOG_MINOR,"RestChannel()","started; name = "+n),this.name=n,this.client=t,this.presence=new fn(this),this.channelOptions=Ge(null!=(o=t._Crypto)?o:null,this.logger,r),(null==(i=t.options.plugins)?void 0:i.Push)&&(this._push=new t.options.plugins.Push.PushChannel(this))}var t,n,r,i;return g(e,[{key:"push",get:function(){return this._push||Pe("Push"),this._push}},{key:"logger",get:function(){return this.client.logger}},{key:"setOptions",value:function(e){var t;this.channelOptions=Ge(null!=(t=this.client._Crypto)?t:null,this.logger,e)}},{key:"history",value:(i=a(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return L.logAction(this.logger,L.LOG_MICRO,"RestChannel.history()","channel = "+this.name),e.abrupt("return",this.client.rest.channelMixin.history(this,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"publish",value:(r=a(o().mark((function e(){var t,n,r,i,a,s,c,u,l,f,h,p,d=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d.length<=0?void 0:d[0],n=d.length<=1?void 0:d[1],"string"!=typeof t&&null!==t){e.next=6;break}r=[Vt({name:t,data:n})],i=d.length<=2?void 0:d[2],e.next=17;break;case 6:if(!q(t)){e.next=11;break}r=[Vt(t)],i=d.length<=1?void 0:d[1],e.next=17;break;case 11:if(!Array.isArray(t)){e.next=16;break}r=zt(t),i=d.length<=1?void 0:d[1],e.next=17;break;case 16:throw new N("The single-argument form of publish() expects a message object or an array of message objects",40013,400);case 17:if(i||(i={}),a=this.client,s=a.options,c=s.useBinaryProtocol?"msgpack":"json",u=a.options.idempotentRestPublishing,G(l=qe.defaultPostHeaders(a.options,{format:c}),s.headers),!u||!hn(r)){e.next=25;break}return e.next=23,de(9);case 23:f=e.sent,r.forEach((function(e,t){e.id=f+":"+t.toString()}));case 25:return e.next=27,Dt(r,this.channelOptions);case 27:if(h=Jt(r),p=s.maxMessageSize,!(h>p)){e.next=30;break}throw new N("Maximum size of messages that can be published at once exceeded ( was "+h+" bytes; limit is "+p+" bytes)",40009,400);case 30:return e.next=32,this._publish(Bt(r,a._MsgPack,c),l,i);case 32:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_publish",value:(n=a(o().mark((function e(t,n,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dt.post(this.client,this.client.rest.channelMixin.basePath(this)+"/messages",t,n,r,null,!0);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"status",value:(t=a(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.rest.channelMixin.status(this));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),dn=function(){function e(t){b(this,e),this.entries=t&&t.entries||void 0,this.schema=t&&t.schema||void 0,this.appId=t&&t.appId||void 0,this.inProgress=t&&t.inProgress||void 0,this.unit=t&&t.unit||void 0,this.intervalId=t&&t.intervalId||void 0}return g(e,null,[{key:"fromValues",value:function(t){return new e(t)}}]),e}(),vn=function(){function e(){b(this,e)}var t;return g(e,null,[{key:"basePath",value:function(e){return"/channels/"+encodeURIComponent(e.name)}},{key:"history",value:function(e,t){var n=e.client,r=n.options.useBinaryProtocol?"msgpack":"json",i=e.client.http.supportsLinkHeaders?void 0:r,s=qe.defaultGetHeaders(n.options,{format:r});G(s,n.options.headers);var c=e.channelOptions;return new bt(n,this.basePath(e)+"/messages",s,i,function(){var t=a(o().mark((function t(i,a,s){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ht(i,c,e.logger,n._MsgPack,s?void 0:r);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()).get(t)}},{key:"status",value:(t=a(o().mark((function e(t){var n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client.options.useBinaryProtocol?"msgpack":"json",r=qe.defaultPostHeaders(t.client.options,{format:n}),e.next=4,dt.get(t.client,this.basePath(t),r,{},n,!0);case 4:return i=e.sent,e.abrupt("return",i.body);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),yn=function(){function e(){b(this,e)}var t;return g(e,null,[{key:"basePath",value:function(e){return vn.basePath(e.channel)+"/presence"}},{key:"history",value:(t=a(o().mark((function e(t,n){var r,i,s,c,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.channel.client,i=r.options.useBinaryProtocol?"msgpack":"json",s=t.channel.client.http.supportsLinkHeaders?void 0:i,G(c=qe.defaultGetHeaders(r.options,{format:i}),r.options.headers),u=t.channel.channelOptions,e.abrupt("return",new bt(r,this.basePath(t)+"/history",c,s,function(){var e=a(o().mark((function e(n,a,s){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,on(n,u,t.logger,r._MsgPack,s?void 0:i);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()).get(n));case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),gn=function(){function e(t){b(this,e),this.channelMixin=vn,this.presenceMixin=yn,this.Resource=dt,this.DeviceDetails=ut,this.client=t,this.channels=new mn(this.client),this.push=new xt(this.client)}var t,n,r,i,s,c;return g(e,[{key:"stats",value:(c=a(o().mark((function e(t){var n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=qe.defaultGetHeaders(this.client.options),r=this.client.options.useBinaryProtocol?"msgpack":"json",i=this.client.http.supportsLinkHeaders?void 0:r,G(n,this.client.options.headers),e.abrupt("return",new bt(this.client,"/stats",n,i,(function(e,t,n){for(var r=n?e:JSON.parse(e),o=0;o<r.length;o++)r[o]=dn.fromValues(r[o]);return r})).get(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"time",value:(s=a(o().mark((function e(t){var n,r,i,a,s,c,u,l=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=qe.defaultGetHeaders(this.client.options),this.client.options.headers&&G(n,this.client.options.headers),r=function(e){return l.client.baseUri(e)+"/time"},e.next=5,this.client.http.do(Ve.Get,r,n,null,t);case 5:if(i=e.sent,a=i.error,s=i.body,c=i.unpacked,!a){e.next=11;break}throw a;case 11:if(c||(s=JSON.parse(s)),u=s[0]){e.next=15;break}throw new N("Internal error (unexpected result type from GET /time)",5e4,500);case 15:return this.client.serverTimeOffset=u-Date.now(),e.abrupt("return",u);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"request",value:(i=a(o().mark((function e(t,n,r,i,s,c){var u,l,f,h,p,d,y,g,m,b,w=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=w.client.options.useBinaryProtocol?(w.client._MsgPack||Pe("MsgPack"),[w.client._MsgPack.encode,w.client._MsgPack.decode,"msgpack"]):[JSON.stringify,JSON.parse,"json"],f=v(l,3),h=f[0],p=f[1],d=f[2],y=this.client.http.supportsLinkHeaders?void 0:d,i=i||{},g=t.toLowerCase(),m="get"==g?qe.defaultGetHeaders(this.client.options,{format:d,protocolVersion:r}):qe.defaultPostHeaders(this.client.options,{format:d,protocolVersion:r}),"string"!=typeof s&&(s=null!=(u=h(s))?u:null),G(m,this.client.options.headers),c&&G(m,c),b=new bt(this.client,n,m,y,function(){var e=a(o().mark((function e(t,n,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",F(r?t:p(t)));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),!0),T.Http.methods.includes(g)){e.next=11;break}throw new N("Unsupported method "+g,40500,405);case 11:if(!T.Http.methodsWithBody.includes(g)){e.next=15;break}return e.abrupt("return",b[g](i,s));case 15:return e.abrupt("return",b[g](i));case 16:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o,a){return i.apply(this,arguments)})},{key:"batchPublish",value:(r=a(o().mark((function e(t){var n,r,i,a,s,c,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Array.isArray(t)?(n=t,r=!1):(n=[t],r=!0),i=this.client.options.useBinaryProtocol?"msgpack":"json",a=qe.defaultPostHeaders(this.client.options,{format:i}),this.client.options.headers&&G(a,this.client.options.headers),s=me(n,this.client._MsgPack,i),e.next=6,dt.post(this.client,"/messages",s,a,{},null,!0);case 6:if(c=e.sent,u=c.unpacked?c.body:ge(c.body,this.client._MsgPack,i),!r){e.next=12;break}return e.abrupt("return",u[0]);case 12:return e.abrupt("return",u);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"batchPresence",value:(n=a(o().mark((function e(t){var n,r,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.client.options.useBinaryProtocol?"msgpack":"json",r=qe.defaultPostHeaders(this.client.options,{format:n}),this.client.options.headers&&G(r,this.client.options.headers),i=t.join(","),e.next=5,dt.get(this.client,"/presence",r,{channels:i},null,!0);case 5:return a=e.sent,e.abrupt("return",a.unpacked?a.body:ge(a.body,this.client._MsgPack,n));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"revokeTokens",value:(t=a(o().mark((function e(t,n){var r,i,a,s,c,u,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ze(this.client.options)){e.next=2;break}throw new N("Cannot revoke tokens when using token auth",40162,401);case 2:return r=this.client.options.keyName,i=null!=n?n:{},a=S({targets:t.map((function(e){return"".concat(e.type,":").concat(e.value)}))},i),s=this.client.options.useBinaryProtocol?"msgpack":"json",c=qe.defaultPostHeaders(this.client.options,{format:s}),this.client.options.headers&&G(c,this.client.options.headers),u=me(a,this.client._MsgPack,s),e.next=10,dt.post(this.client,"/keys/".concat(r,"/revokeTokens"),u,c,{},null,!0);case 10:return l=e.sent,e.abrupt("return",l.unpacked?l.body:ge(l.body,this.client._MsgPack,s));case 12:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),mn=function(){function e(t){b(this,e),this.client=t,this.all=Object.create(null)}return g(e,[{key:"get",value:function(e,t){e=String(e);var n=this.all[e];return n?t&&n.setOptions(t):this.all[e]=n=new pn(this.client,e,t),n}},{key:"release",value:function(e){delete this.all[String(e)]}}]),e}(),bn=function(e){function t(e){return b(this,t),s(this,t,[qe.objectifyOptions(e,!1,"BaseRest",L.defaultLogger,{Rest:gn})])}return u(t,e),g(t)}(ct),wn={Rest:gn},kn=function(e){function t(){return b(this,t),s(this,t,arguments)}var n,r,i,c;return u(t,e),g(t,null,[{key:"fromEncoded",value:(c=a(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Pt(L.defaultLogger,T.Crypto,t,n));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return c.apply(this,arguments)})},{key:"fromEncodedArray",value:(i=a(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",jt(L.defaultLogger,T.Crypto,t,n));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"fromValues",value:function(e){return Object.assign(new Qt,e)}},{key:"encode",value:(r=a(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ut(t,n));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"decode",value:(n=a(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ft(t,n));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})}]),t}(Qt),_n=function(e){function t(){return b(this,t),s(this,t,arguments)}var n,r;return u(t,e),g(t,null,[{key:"fromEncoded",value:(r=a(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$t(L.defaultLogger,t,n));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"fromEncodedArray",value:(n=a(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",en(L.defaultLogger,t,n));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"fromValues",value:function(e,t){return nn(e,t)}}]),t}(ln),En=function(e){function t(e){var n,r;if(b(this,t),!t._MsgPack)throw new Error("Expected DefaultRest._MsgPack to have been set");return s(this,t,[qe.objectifyOptions(e,!0,"Rest",L.defaultLogger,x(S({},wn),{Crypto:null!=(n=t.Crypto)?n:void 0,MsgPack:null!=(r=t._MsgPack)?r:void 0}))])}return u(t,e),g(t,null,[{key:"Crypto",get:function(){if(null===this._Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");return this._Crypto},set:function(e){this._Crypto=e}}]),t}(bn);En._Crypto=null,En.Message=kn,En.PresenceMessage=_n,En._MsgPack=null,En._Http=at;var On=En;function Sn(e,t,n,r){try{n.apply(t,r)}catch(t){L.logAction(e,L.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+t+"; stack = "+(t&&t.stack))}}function xn(e,t,n){for(var r,o,i,a=0;a<e.length;a++)if(r=e[a],n&&(r=r[n]),Array.isArray(r)){for(;-1!==(o=r.indexOf(t));)r.splice(o,1);n&&0===r.length&&delete e[a][n]}else if(q(r))for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&Array.isArray(r[i])&&xn([r],t,i)}var Cn=function(){function e(t){b(this,e),this.logger=t,this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}var t;return g(e,[{key:"on",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(1===n.length){var o=n[0];if("function"!=typeof o)throw new Error("EventListener.on(): Invalid arguments: "+T.Config.inspect(n));this.any.push(o)}if(2===n.length){var i=n[0],a=n[1];if("function"!=typeof a)throw new Error("EventListener.on(): Invalid arguments: "+T.Config.inspect(n));if(W(i))this.any.push(a);else if(Array.isArray(i))i.forEach((function(t){e.on(t,a)}));else{if("string"!=typeof i)throw new Error("EventListener.on(): Invalid arguments: "+T.Config.inspect(n));var s=this.events[i]||(this.events[i]=[]);s.push(a)}}}},{key:"off",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(0==n.length||W(n[0])&&W(n[1]))return this.any=[],this.events=Object.create(null),this.anyOnce=[],void(this.eventsOnce=Object.create(null));var o=n[0],i=n[1],a=null,s=null;if(1!==n.length&&i){if("function"!=typeof i)throw new Error("EventEmitter.off(): invalid arguments:"+T.Config.inspect(n));s=o,a=i}else"function"==typeof o?a=o:s=o;if(a&&W(s))xn([this.any,this.events,this.anyOnce,this.eventsOnce],a);else if(Array.isArray(s))s.forEach((function(t){e.off(t,a)}));else{if("string"!=typeof s)throw new Error("EventEmitter.off(): invalid arguments:"+T.Config.inspect(n));a?xn([this.events,this.eventsOnce],a,s):(delete this.events[s],delete this.eventsOnce[s])}}},{key:"listeners",value:function(e){if(e){var t=this.events[e]||[];return this.eventsOnce[e]&&Array.prototype.push.apply(t,this.eventsOnce[e]),t.length?t:null}return this.any.length?this.any:null}},{key:"emit",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i={event:e},a=[];this.anyOnce.length&&(Array.prototype.push.apply(a,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(a,this.any);var s=this.eventsOnce[e];s&&(Array.prototype.push.apply(a,s),delete this.eventsOnce[e]);var c=this.events[e];c&&Array.prototype.push.apply(a,c),a.forEach((function(e){Sn(t.logger,i,e,r)}))}},{key:"once",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n.length;if(0===o||1===o&&"function"!=typeof n[0]){var i=n[0];return new Promise((function(t){e.once(i,t)}))}var a=n[0],s=n[1];if(1===n.length&&"function"==typeof a)this.anyOnce.push(a);else if(W(a)){if("function"!=typeof s)throw new Error("EventEmitter.once(): Invalid arguments:"+T.Config.inspect(n));this.anyOnce.push(s)}else if(Array.isArray(a)){var c=this,u=function e(){var t=Array.prototype.slice.call(arguments);if(a.forEach((function(t){c.off(t,e)})),"function"!=typeof s)throw new Error("EventEmitter.once(): Invalid arguments:"+T.Config.inspect(n));s.apply(this,t)};a.forEach((function(e){c.on(e,u)}))}else{if("string"!=typeof a)throw new Error("EventEmitter.once(): Invalid arguments:"+T.Config.inspect(n));var l=this.eventsOnce[a]||(this.eventsOnce[a]=[]);if(s){if("function"!=typeof s)throw new Error("EventEmitter.once(): Invalid arguments:"+T.Config.inspect(n));l.push(s)}}}},{key:"whenState",value:(t=a(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t&&"string"==typeof n){e.next=2;break}throw new Error("whenState requires a valid state String argument");case 2:if(t!==n){e.next=6;break}return e.abrupt("return",null);case 6:return e.abrupt("return",this.once(t));case 7:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),An={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},Tn=[];Object.keys(An).forEach((function(e){Tn[An[e]]=e}));var Pn={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},In=Object.keys(Pn);function jn(e){var t=[];if(e)for(var n=0;n<e.length;n++)t.push(e[n].toString());return"[ "+t.join(", ")+" ]"}Pn.MODE_ALL=Pn.PRESENCE|Pn.PUBLISH|Pn.SUBSCRIBE|Pn.PRESENCE_SUBSCRIBE;var Rn=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],Ln=me;function Mn(e,t){var n=e.error;n&&(e.error=N.fromValues(n));var r=e.messages;if(r)for(var o=0;o<r.length;o++)r[o]=Vt(r[o]);var i=t?e.presence:void 0;if(t&&i&&t)for(var a=0;a<i.length;a++)i[a]=t.presenceMessageFromValues(i[a],!0);return Object.assign(new Fn,x(S({},e),{presence:i}))}function Un(e){return Mn(e,{presenceMessageFromValues:nn,presenceMessagesFromValuesArray:sn})}function Nn(e){return Object.assign(new Fn,e)}function Dn(e,t){var n="[ProtocolMessage";void 0!==e.action&&(n+="; action="+Tn[e.action]||e.action);for(var r,o=["id","channel","channelSerial","connectionId","count","msgSerial","timestamp"],i=0;i<o.length;i++)void 0!==e[r=o[i]]&&(n+="; "+r+"="+e[r]);if(e.messages&&(n+="; messages="+jn(zt(e.messages))),e.presence&&t&&(n+="; presence="+jn(t.presenceMessagesFromValuesArray(e.presence))),e.error&&(n+="; error="+N.fromValues(e.error).toString()),e.auth&&e.auth.accessToken&&(n+="; token="+e.auth.accessToken),e.flags&&(n+="; flags="+In.filter(e.hasFlag).join(",")),e.params){var a="";re(e.params,(function(t){a.length>0&&(a+="; "),a+=t+"="+e.params[t]})),a.length>0&&(n+="; params=["+a+"]")}return n+="]"}var Gn,Bn,Fn=function(){function e(){var t=this;b(this,e),this.hasFlag=function(e){return(t.flags&Pn[e])>0}}return g(e,[{key:"setFlag",value:function(e){return this.flags=this.flags|Pn[e]}},{key:"getMode",value:function(){return this.flags&&this.flags&Pn.MODE_ALL}},{key:"encodeModesToFlags",value:function(e){var t=this;e.forEach((function(e){return t.setFlag(e)}))}},{key:"decodeModesFromFlags",value:function(){var e=this,t=[];return Rn.forEach((function(n){e.hasFlag(n)&&t.push(n)})),t.length>0?t:void 0}}]),e}(),qn=Fn,Hn=function(e){function t(e){var n;return b(this,t),(n=s(this,t,[e])).messages=[],n}return u(t,e),g(t,[{key:"count",value:function(){return this.messages.length}},{key:"push",value:function(e){this.messages.push(e)}},{key:"shift",value:function(){return this.messages.shift()}},{key:"last",value:function(){return this.messages[this.messages.length-1]}},{key:"copyAll",value:function(){return this.messages.slice()}},{key:"append",value:function(e){this.messages.push.apply(this.messages,e)}},{key:"prepend",value:function(e){this.messages.unshift.apply(this.messages,e)}},{key:"completeMessages",value:function(e,t,n){L.logAction(this.logger,L.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+e+"; count = "+t),n=n||null;var r=this.messages;if(0===r.length)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var o=r[0];if(o){var i=o.message.msgSerial,a=e+t;if(a>i){var s,c=r.splice(0,a-i),u=w(c);try{for(u.s();!(s=u.n()).done;)s.value.callback(n)}catch(n){u.e(n)}finally{u.f()}}0==r.length&&this.emit("idle")}}},{key:"completeAllMessages",value:function(e){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,e)}},{key:"resetSendAttempted",value:function(){var e,t=w(this.messages);try{for(t.s();!(e=t.n()).done;)e.value.sendAttempted=!1}catch(e){t.e(e)}finally{t.f()}}},{key:"clear",value:function(){L.logAction(this.logger,L.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")}}]),t}(Cn),Wn=g((function e(t,n){b(this,e),this.message=t,this.callback=n,this.merged=!1;var r=t.action;this.sendAttempted=!1,this.ackRequired=r==An.MESSAGE||r==An.PRESENCE})),Vn=function(e){function t(e){var n;return b(this,t),(n=s(this,t,[e.logger])).transport=e,n.messageQueue=new Hn(n.logger),e.on("ack",(function(e,t){n.onAck(e,t)})),e.on("nack",(function(e,t,r){n.onNack(e,t,r)})),n}return u(t,e),g(t,[{key:"onAck",value:function(e,t){L.logAction(this.logger,L.LOG_MICRO,"Protocol.onAck()","serial = "+e+"; count = "+t),this.messageQueue.completeMessages(e,t)}},{key:"onNack",value:function(e,t,n){L.logAction(this.logger,L.LOG_ERROR,"Protocol.onNack()","serial = "+e+"; count = "+t+"; err = "+le(n)),n||(n=new N("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(e,t,n)}},{key:"onceIdle",value:function(e){var t=this.messageQueue;0!==t.count()?t.once("idle",e):e()}},{key:"send",value:function(e){e.ackRequired&&this.messageQueue.push(e),this.logger.shouldLog(L.LOG_MICRO)&&L.logActionNoStrip(this.logger,L.LOG_MICRO,"Protocol.send()","sending msg; "+Dn(e.message,this.transport.connectionManager.realtime._RealtimePresence)),e.sendAttempted=!0,this.transport.send(e.message)}},{key:"getTransport",value:function(){return this.transport}},{key:"getPendingMessages",value:function(){return this.messageQueue.copyAll()}},{key:"clearPendingMessages",value:function(){return this.messageQueue.clear()}},{key:"finish",value:function(){var e=this.transport;this.onceIdle((function(){e.disconnect()}))}}]),t}(Cn),zn=g((function e(t,n,r,o){b(this,e),this.previous=t,this.current=n,r&&(this.retryIn=r),o&&(this.reason=o)})),Jn={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},Kn={disconnected:function(){return N.fromValues({statusCode:400,code:Jn.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return N.fromValues({statusCode:400,code:Jn.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return N.fromValues({statusCode:400,code:Jn.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return N.fromValues({statusCode:400,code:Jn.CLOSING,message:"Connection closing"})},closed:function(){return N.fromValues({statusCode:400,code:Jn.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return N.fromValues({statusCode:500,code:Jn.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return N.fromValues({statusCode:500,code:Jn.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}},Qn=Nn({action:An.CLOSE}),Yn=Nn({action:An.DISCONNECT}),Xn=function(e){function t(e,n,r,o){var i;return b(this,t),i=s(this,t,[e.logger]),o&&(r.format=void 0,r.heartbeats=!0),i.connectionManager=e,i.auth=n,i.params=r,i.timeouts=r.options.timeouts,i.format=r.format,i.isConnected=!1,i.isFinished=!1,i.isDisposed=!1,i.maxIdleInterval=null,i.idleTimer=null,i.lastActivity=null,i}return u(t,e),g(t,[{key:"connect",value:function(){}},{key:"close",value:function(){this.isConnected&&this.requestClose(),this.finish("closed",Kn.closed())}},{key:"disconnect",value:function(e){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",e||Kn.disconnected())}},{key:"fail",value:function(e){this.isConnected&&this.requestDisconnect(),this.finish("failed",e||Kn.failed())}},{key:"finish",value:function(e,t){var n;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout(null!=(n=this.idleTimer)?n:void 0),this.idleTimer=null,this.emit(e,t),this.dispose())}},{key:"onProtocolMessage",value:function(e){var t=this;switch(this.logger.shouldLog(L.LOG_MICRO)&&L.logActionNoStrip(this.logger,L.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+Dn(e,this.connectionManager.realtime._RealtimePresence)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),e.action){case An.HEARTBEAT:L.logActionNoStrip(this.logger,L.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",e.id);break;case An.CONNECTED:this.onConnect(e),this.emit("connected",e.error,e.connectionId,e.connectionDetails,e);break;case An.CLOSED:this.onClose(e);break;case An.DISCONNECTED:this.onDisconnect(e);break;case An.ACK:this.emit("ack",e.msgSerial,e.count);break;case An.NACK:this.emit("nack",e.msgSerial,e.count,e.error);break;case An.SYNC:this.connectionManager.onChannelMessage(e,this);break;case An.ACTIVATE:break;case An.AUTH:ye(this.auth.authorize(),(function(e){e&&L.logAction(t.logger,L.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+le(e))}));break;case An.ERROR:if(L.logAction(this.logger,L.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+T.Config.inspect(e.error)+(e.channel?", channel: "+e.channel:"")),void 0===e.channel){this.onFatalError(e);break}this.connectionManager.onChannelMessage(e,this);break;default:this.connectionManager.onChannelMessage(e,this)}}},{key:"onConnect",value:function(e){if(this.isConnected=!0,!e.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var t=e.connectionDetails.maxIdleInterval;t&&(this.maxIdleInterval=t+this.timeouts.realtimeRequestTimeout,this.onActivity())}},{key:"onDisconnect",value:function(e){var t=e&&e.error;L.logAction(this.logger,L.LOG_MINOR,"Transport.onDisconnect()","err = "+le(t)),this.finish("disconnected",t)}},{key:"onFatalError",value:function(e){var t=e&&e.error;L.logAction(this.logger,L.LOG_MINOR,"Transport.onFatalError()","err = "+le(t)),this.finish("failed",t)}},{key:"onClose",value:function(e){var t=e&&e.error;L.logAction(this.logger,L.LOG_MINOR,"Transport.onClose()","err = "+le(t)),this.finish("closed",t)}},{key:"requestClose",value:function(){L.logAction(this.logger,L.LOG_MINOR,"Transport.requestClose()",""),this.send(Qn)}},{key:"requestDisconnect",value:function(){L.logAction(this.logger,L.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(Yn)}},{key:"ping",value:function(e){var t={action:An.HEARTBEAT};e&&(t.id=e),this.send(Nn(t))}},{key:"dispose",value:function(){L.logAction(this.logger,L.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()}},{key:"onActivity",value:function(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=Date.now(),this.setIdleTimer(this.maxIdleInterval+100))}},{key:"setIdleTimer",value:function(e){var t=this;this.idleTimer||(this.idleTimer=setTimeout((function(){t.onIdleTimerExpire()}),e))}},{key:"onIdleTimerExpire",value:function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var e=Date.now()-this.lastActivity,t=this.maxIdleInterval-e;if(t<=0){var n="No activity seen from realtime in "+e+"ms; assuming connection has dropped";L.logAction(this.logger,L.LOG_ERROR,"Transport.onIdleTimerExpire()",n),this.disconnect(new N(n,80003,408))}else this.setIdleTimer(t+100)}}],[{key:"tryConnect",value:function(e,t,n,r,o){var i,a=new e(t,n,r),s=function(e){clearTimeout(i),o({event:this.event,error:e})},c=t.options.timeouts.realtimeRequestTimeout;return i=setTimeout((function(){a.off(["preconnect","disconnected","failed"]),a.dispose(),s.call({event:"disconnected"},new N("Timeout waiting for transport to indicate itself viable",5e4,500))}),c),a.on(["failed","disconnected"],s),a.on("preconnect",(function(){L.logAction(t.logger,L.LOG_MINOR,"Transport.tryConnect()","viable transport "+a),clearTimeout(i),a.off(["failed","disconnected"],s),o(null,a)})),a.connect(),a}},{key:"isAvailable",value:function(){throw new N("isAvailable not implemented for transport",5e4,500)}}]),t}(Cn);(Bn=Gn||(Gn={})).WebSocket="web_socket",Bn.Comet="comet",Bn.XhrPolling="xhr_polling";var $n=void 0!==e?e:"undefined"!=typeof window?window:self,Zn=function(){var e;return void 0!==T.WebStorage&&(null==(e=T.WebStorage)?void 0:e.localSupported)},er=function(){var e;return void 0!==T.WebStorage&&(null==(e=T.WebStorage)?void 0:e.sessionSupported)},tr=function(){};function nr(e){try{return JSON.parse(e)}catch(e){return null}}var rr=function(){function e(t,n,r,o){b(this,e),this.options=t,this.host=n,this.mode=r,this.connectionKey=o,this.format=t.useBinaryProtocol?"msgpack":"json"}return g(e,[{key:"getConnectParams",value:function(e){var t=e?B(e):{},n=this.options;switch(this.mode){case"resume":t.resume=this.connectionKey;break;case"recover":var r=nr(n.recover);r&&(t.recover=r.connectionKey)}return void 0!==n.clientId&&(t.clientId=n.clientId),!1===n.echoMessages&&(t.echo="false"),void 0!==this.format&&(t.format=this.format),void 0!==this.stream&&(t.stream=this.stream),void 0!==this.heartbeats&&(t.heartbeats=this.heartbeats),t.v=qe.protocolVersion,t.agent=De(this.options),void 0!==n.transportParams&&G(t,n.transportParams),t}},{key:"toString",value:function(){var e="[mode="+this.mode;return this.host&&(e+=",host="+this.host),this.connectionKey&&(e+=",connectionKey="+this.connectionKey),this.format&&(e+=",format="+this.format),e+="]"}}]),e}(),or=function(e){function t(e,n){var r;b(this,t),(r=s(this,t,[e.logger])).supportedTransports={},r.disconnectedRetryCount=0,r.pendingChannelMessagesState={isProcessing:!1,queue:[]},r.realtime=e,r.initTransports(),r.options=n;var o=n.timeouts,i=o.webSocketConnectTimeout+o.realtimeRequestTimeout;if(r.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:i,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:o.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:o.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:o.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},r.state=r.states.initialized,r.errorReason=null,r.queuedMessages=new Hn(r.logger),r.msgSerial=0,r.connectionDetails=void 0,r.connectionId=void 0,r.connectionKey=void 0,r.connectionStateTtl=o.connectionStateTtl,r.maxIdleInterval=null,r.transports=Q(n.transports||qe.defaultTransports,r.supportedTransports),r.transportPreference=null,r.transports.includes(Gn.WebSocket)&&(r.webSocketTransportAvailable=!0),r.transports.includes(Gn.XhrPolling)?r.baseTransport=Gn.XhrPolling:r.transports.includes(Gn.Comet)&&(r.baseTransport=Gn.Comet),r.httpHosts=qe.getHosts(n),r.wsHosts=qe.getHosts(n,!0),r.activeProtocol=null,r.host=null,r.lastAutoReconnectAttempt=null,r.lastActivity=null,r.forceFallbackHost=!1,r.connectCounter=0,r.wsCheckResult=null,r.webSocketSlowTimer=null,r.webSocketGiveUpTimer=null,r.abandonedWebSocket=!1,L.logAction(r.logger,L.LOG_MINOR,"Realtime.ConnectionManager()","started"),L.logAction(r.logger,L.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(n.transports||qe.defaultTransports)+"]"),L.logAction(r.logger,L.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+r.transports+"]"),L.logAction(r.logger,L.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+r.httpHosts+"]"),!r.transports.length){var a="no requested transports available";throw L.logAction(r.logger,L.LOG_ERROR,"realtime.ConnectionManager()",a),new Error(a)}var u=T.Config.addEventListener;return u&&(er()&&"function"==typeof n.recover&&u("beforeunload",r.persistConnection.bind(c(r))),!0===n.closeOnUnload&&u("beforeunload",(function(){L.logAction(r.logger,L.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),r.requestState({state:"closing"})})),u("online",(function(){var e;r.state==r.states.disconnected||r.state==r.states.suspended?(L.logAction(r.logger,L.LOG_MINOR,"ConnectionManager caught browser ‘online’ event","reattempting connection"),r.requestState({state:"connecting"})):r.state==r.states.connecting&&(null==(e=r.pendingTransport)||e.off(),r.disconnectAllTransports(),r.startConnect())})),u("offline",(function(){r.state==r.states.connected&&(L.logAction(r.logger,L.LOG_MINOR,"ConnectionManager caught browser ‘offline’ event","disconnecting active transport"),r.disconnectAllTransports())}))),r}var n,i;return u(t,e),g(t,[{key:"initTransports",value:function(){t.initTransports(this.realtime._additionalTransportImplementations,this)}},{key:"createTransportParams",value:function(e,t){return new rr(this.options,e,t,this.connectionKey)}},{key:"getTransportParams",value:function(e){var t=this;!function(e){if(t.connectionKey)e("resume");else if("string"!=typeof t.options.recover){var n=t.options.recover,r=t.getSessionRecoverData(),o=t.sessionRecoveryName();if(r&&"function"==typeof n)return L.logAction(t.logger,L.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data (recovery scope: "+o+")"),void n(r,(function(n){n?(t.options.recover=r.recoveryKey,e("recover")):e("clean")}));e("clean")}else e("recover")}((function(n){var r=t.createTransportParams(null,n);if("recover"===n){L.logAction(t.logger,L.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+t.options.recover);var o=nr(t.options.recover);o&&(t.msgSerial=o.msgSerial)}else L.logAction(t.logger,L.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+r.toString());e(r)}))}},{key:"tryATransport",value:function(e,t,n){var r=this;L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+t),this.proposedTransport=Xn.tryConnect(this.supportedTransports[t],this,this.realtime.auth,e,(function(o,i){var a,s=r.state;return s==r.states.closing||s==r.states.closed||s==r.states.failed?(i&&(L.logAction(r.logger,L.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+s.state+" while we were attempting the transport; closing "+i),i.close()),void n(!0)):o?(L.logAction(r.logger,L.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+t+" "+o.event+", err: "+o.error.toString()),void(!tt.isTokenErr(o.error)||r.errorReason&&tt.isTokenErr(r.errorReason)?"failed"===o.event?(r.notifyState({state:"failed",error:o.error}),n(!0)):"disconnected"===o.event&&(!(a=o.error).statusCode||!a.code||a.statusCode>=500||Object.values(Jn).includes(a.code)?n(!1):(r.notifyState({state:r.states.connecting.failState,error:o.error}),n(!0))):(r.errorReason=o.error,ye(r.realtime.auth._forceNewToken(null,null),(function(o){o?r.actOnErrorFromAuthorize(o):r.tryATransport(e,t,n)}))))):(L.logAction(r.logger,L.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+t+"; setting pending"),r.setTransportPending(i,e),void n(null,i))}))}},{key:"setTransportPending",value:function(e,t){var n=this,r=t.mode;L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+e+"; mode = "+r),this.pendingTransport=e,this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),e.once("connected",(function(t,o,i){n.activateTransport(t,e,o,i),"recover"===r&&n.options.recover&&(delete n.options.recover,n.unpersistConnection())}));var o=this;e.on(["disconnected","closed","failed"],(function(t){o.deactivateTransport(e,this.event,t)})),this.emit("transport.pending",e)}},{key:"activateTransport",value:function(e,t,n,r){var o=this;L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+t),e&&L.logAction(this.logger,L.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+e),n&&L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+n),r&&L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(r)),this.persistTransportPreference(t);var i=this.state,a=this.states.connected.state;if(L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+i.state),i.state==this.states.closing.state||i.state==this.states.closed.state||i.state==this.states.failed.state)return L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),t.disconnect(),!1;if(delete this.pendingTransport,!t.isConnected)return L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+t+" since it appears to no longer be connected"),!1;var s=this.activeProtocol;this.activeProtocol=new Vn(t),this.host=t.params.host;var c=r.connectionKey;if(c&&this.connectionKey!=c&&this.setConnection(n,r,!!e),this.onConnectionDetailsUpdate(r,t),T.Config.nextTick((function(){t.on("connected",(function(e,n,r){o.onConnectionDetailsUpdate(r,t),o.emit("update",new zn(a,a,null,e))}))})),i.state===this.states.connected.state?e&&(this.errorReason=this.realtime.connection.errorReason=e,this.emit("update",new zn(a,a,null,e))):(this.notifyState({state:"connected",error:e}),this.errorReason=this.realtime.connection.errorReason=e||null),this.emit("transport.active",t),s)if(s.messageQueue.count()>0&&L.logAction(this.logger,L.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+s.transport.shortName+", new one is "+t.shortName+") finishing with "+s.messageQueue.count()+" messages still pending"),s.transport===t){var u="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+t.shortName+"; stack = "+(new Error).stack;L.logAction(this.logger,L.LOG_ERROR,"ConnectionManager.activateTransport()",u)}else s.finish();return!0}},{key:"deactivateTransport",value:function(e,t,n){var r=this.activeProtocol,o=r&&r.getTransport()===e,i=e===this.pendingTransport,a=this.noTransportsScheduledForActivation();if(L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+e),L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+t+(o?"; was active":i?"; was pending":"")+(a?"":"; another transport is scheduled for activation")),n&&n.message&&L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+n.message),o&&(L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(r.getPendingMessages()),r.clearPendingMessages(),this.activeProtocol=this.host=null),this.emit("transport.inactive",e),o&&a||o&&"failed"===t||"closed"===t||null===r&&i){if("disconnected"===t&&n&&n.statusCode>500&&this.httpHosts.length>1)return this.unpersistTransportPreference(),this.forceFallbackHost=!0,void this.notifyState({state:t,error:n,retryImmediately:!0});var s="failed"===t&&tt.isTokenErr(n)?"disconnected":t;this.notifyState({state:s,error:n})}}},{key:"noTransportsScheduledForActivation",value:function(){return!this.pendingTransport||!this.pendingTransport.isConnected}},{key:"setConnection",value:function(e,t,n){var r=this.connectionId;(r&&r!==e||!r&&n)&&(L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==e&&L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=e,this.realtime.connection.key=this.connectionKey=t.connectionKey}},{key:"clearConnection",value:function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()}},{key:"createRecoveryKey",value:function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null}},{key:"checkConnectionStateFreshness",value:function(){if(this.lastActivity&&this.connectionId){var e=Date.now()-this.lastActivity;e>this.connectionStateTtl+this.maxIdleInterval&&(L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+e+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}}},{key:"persistConnection",value:function(){if(er()){var e=this.createRecoveryKey();e&&this.setSessionRecoverData({recoveryKey:e,disconnectedAt:Date.now(),location:$n.location,clientId:this.realtime.auth.clientId})}}},{key:"unpersistConnection",value:function(){this.clearSessionRecoverData()}},{key:"getError",value:function(){if(this.errorReason){var e=D.fromValues(this.errorReason);return e.cause=this.errorReason,e}return this.getStateError()}},{key:"getStateError",value:function(){var e,t;return null==(t=(e=Kn)[this.state.state])?void 0:t.call(e)}},{key:"activeState",value:function(){return this.state.queueEvents||this.state.sendEvents}},{key:"enactStateChange",value:function(e){var t=e.current+(e.reason?"; reason: "+e.reason:"");"failed"===e.current?L.logAction(this.logger,L.LOG_ERROR,"Connection state",t):L.logAction(this.logger,L.LOG_MAJOR,"Connection state",t),L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+e.current+"; reason = "+(e.reason&&e.reason.message));var n=this.state=this.states[e.current];e.reason&&(this.errorReason=e.reason,this.realtime.connection.errorReason=e.reason),(n.terminal||"suspended"===n.state)&&this.clearConnection(),this.emit("connectionstate",e)}},{key:"startTransitionTimer",value:function(e){var t=this;L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+e.state),this.transitionTimer&&(L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout((function(){t.transitionTimer&&(t.transitionTimer=null,L.logAction(t.logger,L.LOG_MINOR,"ConnectionManager "+e.state+" timer expired","requesting new state: "+e.failState),t.notifyState({state:e.failState}))}),e.retryDelay)}},{key:"cancelTransitionTimer",value:function(){L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)}},{key:"startSuspendTimer",value:function(){var e=this;this.suspendTimer||(this.suspendTimer=setTimeout((function(){e.suspendTimer&&(e.suspendTimer=null,L.logAction(e.logger,L.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),e.states.connecting.failState="suspended",e.notifyState({state:"suspended"}))}),this.connectionStateTtl))}},{key:"checkSuspendTimer",value:function(e){"disconnected"!==e&&"suspended"!==e&&"connecting"!==e&&this.cancelSuspendTimer()}},{key:"cancelSuspendTimer",value:function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)}},{key:"startRetryTimer",value:function(e){var t=this;this.retryTimer=setTimeout((function(){L.logAction(t.logger,L.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),t.retryTimer=null,t.requestState({state:"connecting"})}),e)}},{key:"cancelRetryTimer",value:function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}},{key:"startWebSocketSlowTimer",value:function(){var e=this;this.webSocketSlowTimer=setTimeout((function(){L.logAction(e.logger,L.LOG_MINOR,"ConnectionManager WebSocket slow timer","checking connectivity"),e.checkWsConnectivity().then((function(){L.logAction(e.logger,L.LOG_MINOR,"ConnectionManager WebSocket slow timer","ws connectivity check succeeded"),e.wsCheckResult=!0})).catch((function(){L.logAction(e.logger,L.LOG_MAJOR,"ConnectionManager WebSocket slow timer","ws connectivity check failed"),e.wsCheckResult=!1})),e.realtime.http.checkConnectivity&&ye(e.realtime.http.checkConnectivity(),(function(t,n){t||!n?(L.logAction(e.logger,L.LOG_MAJOR,"ConnectionManager WebSocket slow timer","http connectivity check failed"),e.cancelWebSocketGiveUpTimer(),e.notifyState({state:"disconnected",error:new N("Unable to connect (network unreachable)",80003,404)})):L.logAction(e.logger,L.LOG_MINOR,"ConnectionManager WebSocket slow timer","http connectivity check succeeded")}))}),this.options.timeouts.webSocketSlowTimeout)}},{key:"cancelWebSocketSlowTimer",value:function(){this.webSocketSlowTimer&&(clearTimeout(this.webSocketSlowTimer),this.webSocketSlowTimer=null)}},{key:"startWebSocketGiveUpTimer",value:function(e){var t=this;this.webSocketGiveUpTimer=setTimeout((function(){var n,r;t.wsCheckResult||(L.logAction(t.logger,L.LOG_MINOR,"ConnectionManager WebSocket give up timer","websocket connection took more than 10s; "+(t.baseTransport?"trying base transport":"")),t.baseTransport?(t.abandonedWebSocket=!0,null==(n=t.proposedTransport)||n.dispose(),null==(r=t.pendingTransport)||r.dispose(),t.connectBase(e,++t.connectCounter)):L.logAction(t.logger,L.LOG_MAJOR,"ConnectionManager WebSocket give up timer","websocket connectivity appears to be unavailable but no other transports to try"))}),this.options.timeouts.webSocketConnectTimeout)}},{key:"cancelWebSocketGiveUpTimer",value:function(){this.webSocketGiveUpTimer&&(clearTimeout(this.webSocketGiveUpTimer),this.webSocketGiveUpTimer=null)}},{key:"notifyState",value:function(e){var t,n,r=this,o=e.state,i="disconnected"===o&&(this.state===this.states.connected||e.retryImmediately||this.state===this.states.connecting&&e.error&&tt.isTokenErr(e.error)&&!(this.errorReason&&tt.isTokenErr(this.errorReason)));if(L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+o+(i?"; will retry connection immediately":"")),o!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),this.checkSuspendTimer(e.state),"suspended"!==o&&"connected"!==o||(this.disconnectedRetryCount=0),!this.state.terminal)){var a=this.states[e.state],s=a.retryDelay;"disconnected"===a.state&&(this.disconnectedRetryCount++,s=Ee(a.retryDelay,this.disconnectedRetryCount));var c=new zn(this.state.state,a.state,s,e.error||(null==(n=(t=Kn)[a.state])?void 0:n.call(t)));if(i){var u=function(){r.state===r.states.disconnected&&(r.lastAutoReconnectAttempt=Date.now(),r.requestState({state:"connecting"}))},l=this.lastAutoReconnectAttempt&&Date.now()-this.lastAutoReconnectAttempt+1;l&&l<1e3?(L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+l+"ms ago, waiting another "+(1e3-l)+"ms before trying again"),setTimeout(u,1e3-l)):T.Config.nextTick(u)}else"disconnected"!==o&&"suspended"!==o||this.startRetryTimer(s);("disconnected"===o&&!i||"suspended"===o||a.terminal)&&T.Config.nextTick((function(){r.disconnectAllTransports()})),"connected"!=o||this.activeProtocol||L.logAction(this.logger,L.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(c),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(o,c.reason),this.failQueuedMessages(c.reason))}}},{key:"requestState",value:function(e){var t,n,r=this,o=e.state;if(L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+o+"; current state: "+this.state.state),o!=this.state.state&&(this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(o),!("connecting"==o&&"connected"==this.state.state||"closing"==o&&"closed"==this.state.state))){var i=this.states[o],a=new zn(this.state.state,i.state,null,e.error||(null==(n=(t=Kn)[i.state])?void 0:n.call(t)));this.enactStateChange(a),"connecting"==o&&T.Config.nextTick((function(){r.startConnect()})),"closing"==o&&this.closeImpl()}}},{key:"startConnect",value:function(){var e=this;if(this.state===this.states.connecting){var t=this.realtime.auth,n=++this.connectCounter,r=function(){e.checkConnectionStateFreshness(),e.getTransportParams((function(t){if("recover"===t.mode&&t.options.recover){var r=nr(t.options.recover);r&&e.realtime.channels.recoverChannels(r.channelSerials)}n===e.connectCounter&&e.connectImpl(t,n)}))};if(L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),"basic"===t.method)r();else{var o=function(t){n===e.connectCounter&&(t?e.actOnErrorFromAuthorize(t):r())};this.errorReason&&tt.isTokenErr(this.errorReason)?ye(t._forceNewToken(null,null),o):ye(t._ensureValidAuthCredentials(!1),o)}}else L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state)}},{key:"connectImpl",value:function(e,t){var n=this,r=this.state.state;if(r===this.states.connecting.state){var o=this.getTransportPreference();o&&o===this.baseTransport&&this.webSocketTransportAvailable&&this.checkWsConnectivity().then((function(){n.unpersistTransportPreference(),n.state===n.states.connecting&&(L.logAction(n.logger,L.LOG_MINOR,"ConnectionManager.connectImpl():","web socket connectivity available, cancelling connection attempt with "+n.baseTransport),n.disconnectAllTransports(),n.connectWs(e,++n.connectCounter))})).catch(tr),o&&o===this.baseTransport||this.baseTransport&&!this.webSocketTransportAvailable?this.connectBase(e,t):this.connectWs(e,t)}else L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect, but was "+r)}},{key:"connectWs",value:function(e,t){var n=this;L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.connectWs()"),this.wsCheckResult=null,this.abandonedWebSocket=!1,this.startWebSocketSlowTimer(),this.startWebSocketGiveUpTimer(e),this.tryTransportWithFallbacks("web_socket",e,!0,t,(function(){return!1!==n.wsCheckResult&&!n.abandonedWebSocket}))}},{key:"connectBase",value:function(e,t){L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.connectBase()"),this.baseTransport?this.tryTransportWithFallbacks(this.baseTransport,e,!1,t,(function(){return!0})):this.notifyState({state:"disconnected",error:new N("No transports left to try",8e4,404)})}},{key:"tryTransportWithFallbacks",value:function(e,t,n,r,o){var i=this;L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.tryTransportWithFallbacks()",e);var a=function(e){i.notifyState({state:i.states.connecting.failState,error:e})},s=n?this.wsHosts.slice():this.httpHosts.slice(),c=function(e,t){r===i.connectCounter&&(o()?t||e||l():t&&t.dispose())},u=s.shift();if(u){t.host=u;var l=function(){s.length?i.realtime.http.checkConnectivity?ye(i.realtime.http.checkConnectivity(),(function(n,u){r===i.connectCounter&&o()&&(n?a(n):u?(t.host=ae(s),i.tryATransport(t,e,c)):a(new N("Unable to connect (network unreachable)",80003,404)))})):a(new D("Internal error: Http.checkConnectivity not set",null,500)):a(new N("Unable to connect (and no more fallback hosts to try)",80003,404))};if(this.forceFallbackHost&&s.length)return this.forceFallbackHost=!1,void l();this.tryATransport(t,e,c)}else a(new N("Unable to connect (no available host)",80003,404))}},{key:"closeImpl",value:function(){L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),this.pendingTransport&&(L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+this.pendingTransport),this.pendingTransport.close()),this.activeProtocol&&(L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})}},{key:"onAuthUpdated",value:function(e,t){var n,r=this;switch(this.state.state){case"connected":L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport");var o=null==(n=this.activeProtocol)?void 0:n.getTransport();o&&o.onAuthUpdated&&o.onAuthUpdated(e);var i=Nn({action:An.AUTH,auth:{accessToken:e.token}});this.send(i);var a=function(){r.off(s),t(null,e)},s=function e(n){"failed"===n.current&&(r.off(a),r.off(e),t(n.reason||r.getStateError()))};this.once("connectiondetails",a),this.on("connectionstate",s);break;case"connecting":L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed"),this.on("connectionstate",(function n(o){switch(o.current){case"connected":r.off(n),t(null,e);break;case"failed":case"closed":case"suspended":r.off(n),t(o.reason||r.getStateError())}})),"connecting"===this.state.state?this.startConnect():this.requestState({state:"connecting"})}}},{key:"disconnectAllTransports",value:function(){L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"),this.connectCounter++,this.pendingTransport&&(L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+this.pendingTransport),this.pendingTransport.disconnect()),delete this.pendingTransport,this.proposedTransport&&(L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting proposed transport: "+this.pendingTransport),this.proposedTransport.disconnect()),delete this.pendingTransport,this.activeProtocol&&(L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())}},{key:"send",value:function(e,t,n){n=n||tr;var r=this.state;if(r.sendEvents)return L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.send()","sending event"),void this.sendImpl(new Wn(e,n));if(!t||!r.queueEvents){var o="rejecting event, queueEvent was "+t+", state was "+r.state;return L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.send()",o),void n(this.errorReason||new N(o,9e4,400))}this.logger.shouldLog(L.LOG_MICRO)&&L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+Dn(e,this.realtime._RealtimePresence)),this.queue(e,n)}},{key:"sendImpl",value:function(e){var t=e.message;e.ackRequired&&!e.sendAttempted&&(t.msgSerial=this.msgSerial++);try{this.activeProtocol.send(e)}catch(e){L.logAction(this.logger,L.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+e.stack)}}},{key:"queue",value:function(e,t){L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.queue()","queueing event");var n=this.queuedMessages.last(),r=this.options.maxMessageSize;n&&!n.sendAttempted&&function(e,t,n){var r;if(e.channel!==t.channel)return!1;if((r=e.action)!==An.PRESENCE&&r!==An.MESSAGE)return!1;if(r!==t.action)return!1;var o=r===An.PRESENCE?"presence":"messages",i=e[o].concat(t[o]);return!(Jt(i)>n||!oe(i,"clientId")||!i.every((function(e){return!e.id}))||(e[o]=i,0))}(n.message,e,r)?(n.merged||(n.callback=He.create(this.logger,[n.callback]),n.merged=!0),n.callback.push(t)):this.queuedMessages.push(new Wn(e,t))}},{key:"sendQueuedMessages",value:function(){var e;for(L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");e=this.queuedMessages.shift();)this.sendImpl(e)}},{key:"queuePendingMessages",value:function(e){e&&e.length&&(L.logAction(this.logger,L.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+e.length+" pending messages"),this.queuedMessages.prepend(e))}},{key:"failQueuedMessages",value:function(e){var t=this.queuedMessages.count();t>0&&(L.logAction(this.logger,L.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+t+" queued messages, err = "+le(e)),this.queuedMessages.completeAllMessages(e))}},{key:"onChannelMessage",value:function(e,t){this.pendingChannelMessagesState.queue.push({message:e,transport:t}),this.pendingChannelMessagesState.isProcessing||this.processNextPendingChannelMessage()}},{key:"processNextPendingChannelMessage",value:function(){var e=this;if(this.pendingChannelMessagesState.queue.length>0){this.pendingChannelMessagesState.isProcessing=!0;var t=this.pendingChannelMessagesState.queue.shift();this.processChannelMessage(t.message).catch((function(t){L.logAction(e.logger,L.LOG_ERROR,"ConnectionManager.processNextPendingChannelMessage() received error ",t)})).finally((function(){e.pendingChannelMessagesState.isProcessing=!1,e.processNextPendingChannelMessage()}))}}},{key:"processChannelMessage",value:(i=a(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.realtime.channels.processChannelMessage(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"ping",value:(n=a(o().mark((function e(){var t,n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("connected"===this.state.state){e.next=2;break}throw new N("Unable to ping service; not connected",4e4,400);case 2:if(n=null==(t=this.activeProtocol)?void 0:t.getTransport()){e.next=5;break}throw this.getStateError();case 5:return L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.ping()","transport = "+n),r=Date.now(),i=pe(),e.abrupt("return",Ie(new Promise((function(e){n.on("heartbeat",(function t(o){o===i&&(n.off("heartbeat",t),e(Date.now()-r))})),n.ping(i)})),this.options.timeouts.realtimeRequestTimeout,"Timeout waiting for heartbeat response"));case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"abort",value:function(e){this.activeProtocol.getTransport().fail(e)}},{key:"getTransportPreference",value:function(){var e,t;return this.transportPreference||Zn()&&(null==(t=null==(e=T.WebStorage)?void 0:e.get)?void 0:t.call(e,"ably-transport-preference"))}},{key:"persistTransportPreference",value:function(e){var t,n;this.transportPreference=e.shortName,Zn()&&(null==(n=null==(t=T.WebStorage)?void 0:t.set)||n.call(t,"ably-transport-preference",e.shortName))}},{key:"unpersistTransportPreference",value:function(){var e,t;this.transportPreference=null,Zn()&&(null==(t=null==(e=T.WebStorage)?void 0:e.remove)||t.call(e,"ably-transport-preference"))}},{key:"actOnErrorFromAuthorize",value:function(e){if(40171===e.code)this.notifyState({state:"failed",error:e});else if(40102===e.code)this.notifyState({state:"failed",error:e});else if(e.statusCode===Je.Forbidden){var t="Client configured authentication provider returned 403; failing the connection";L.logAction(this.logger,L.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",t),this.notifyState({state:"failed",error:new N(t,80019,403,e)})}else{var n="Client configured authentication provider request failed";L.logAction(this.logger,L.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",n),this.notifyState({state:this.state.failState,error:new N(n,80019,401,e)})}}},{key:"onConnectionDetailsUpdate",value:function(e,t){if(e){this.connectionDetails=e,e.maxMessageSize&&(this.options.maxMessageSize=e.maxMessageSize);var n=e.clientId;if(n){var r=this.realtime.auth._uncheckedSetClientId(n);if(r)return L.logAction(this.logger,L.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",r.message),void t.fail(r)}var o=e.connectionStateTtl;o&&(this.connectionStateTtl=o),this.maxIdleInterval=e.maxIdleInterval,this.emit("connectiondetails",e)}}},{key:"checkWsConnectivity",value:function(){var e=this.options.wsConnectivityCheckUrl||qe.wsConnectivityCheckUrl,t=new T.Config.WebSocket(e);return new Promise((function(e,n){var r=!1;t.onopen=function(){r||(r=!0,e(),t.close())},t.onclose=t.onerror=function(){r||(r=!0,n())}}))}},{key:"sessionRecoveryName",value:function(){return this.options.recoveryKeyStorageName||"ably-connection-recovery"}},{key:"getSessionRecoverData",value:function(){var e,t;return er()&&(null==(t=null==(e=T.WebStorage)?void 0:e.getSession)?void 0:t.call(e,this.sessionRecoveryName()))}},{key:"setSessionRecoverData",value:function(e){var t,n;return er()&&(null==(n=null==(t=T.WebStorage)?void 0:t.setSession)?void 0:n.call(t,this.sessionRecoveryName(),e))}},{key:"clearSessionRecoverData",value:function(){var e,t;return er()&&(null==(t=null==(e=T.WebStorage)?void 0:e.removeSession)?void 0:t.call(e,this.sessionRecoveryName()))}}],[{key:"supportedTransports",value:function(e){var t={supportedTransports:{}};return this.initTransports(e,t),t.supportedTransports}},{key:"initTransports",value:function(e,t){var n=S(S({},T.Transports.bundledImplementations),e);[Gn.WebSocket].concat(r(T.Transports.order)).forEach((function(e){var r=n[e];r&&r.isAvailable()&&(t.supportedTransports[e]=r)}))}}]),t}(Cn),ir=function(e){function t(e,n){var r;return b(this,t),(r=s(this,t,[e.logger])).whenState=function(e){return Cn.prototype.whenState.call(c(r),e,r.state)},r.ably=e,r.connectionManager=new or(e,n),r.state=r.connectionManager.state.state,r.key=void 0,r.id=void 0,r.errorReason=null,r.connectionManager.on("connectionstate",(function(e){var t=r.state=e.current;T.Config.nextTick((function(){r.emit(t,e)}))})),r.connectionManager.on("update",(function(e){T.Config.nextTick((function(){r.emit("update",e)}))})),r}var n;return u(t,e),g(t,[{key:"connect",value:function(){L.logAction(this.logger,L.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})}},{key:"ping",value:(n=a(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return L.logAction(this.logger,L.LOG_MINOR,"Connection.ping()",""),e.abrupt("return",this.connectionManager.ping());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:function(){L.logAction(this.logger,L.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})}},{key:"recoveryKey",get:function(){return this.logger.deprecationWarning("The `Connection.recoveryKey` attribute has been replaced by the `Connection.createRecoveryKey()` method. Replace your usage of `recoveryKey` with the return value of `createRecoveryKey()`. `recoveryKey` will be removed in a future version."),this.createRecoveryKey()}},{key:"createRecoveryKey",value:function(){return this.connectionManager.createRecoveryKey()}}]),t}(Cn),ar=g((function e(t,n,r,o,i){b(this,e),this.previous=t,this.current=n,"attached"===n&&(this.resumed=r,this.hasBacklog=o),i&&(this.reason=i)})),sr=function(){};function cr(e){if(e&&"params"in e&&!q(e.params))return new N("options.params must be an object",4e4,400);if(e&&"modes"in e){if(!Array.isArray(e.modes))return new N("options.modes must be an array",4e4,400);for(var t=0;t<e.modes.length;t++){var n=e.modes[t];if(!n||"string"!=typeof n||!Rn.includes(String.prototype.toUpperCase.call(n)))return new N("Invalid channel mode: "+n,4e4,400)}}}function ur(e){var t=e||{};return t.agent,function(e,t){var n={};for(var r in e)k.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&m){var o,i=w(m(e));try{for(i.s();!(o=i.n()).done;)r=o.value,t.indexOf(r)<0&&_.call(e,r)&&(n[r]=e[r])}catch(e){i.e(e)}finally{i.f()}}return n}(t,["agent"])}var lr=function(e){function t(e,n,r){var i,u,l;return b(this,t),(i=s(this,t,[e.logger])).retryCount=0,i.history=function(){var e=a(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L.logAction(this.logger,L.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),n=this.client.rest.channelMixin,!t||!t.untilAttach){e.next=9;break}if("attached"===this.state){e.next=5;break}throw new N("option untilAttach requires the channel to be attached",4e4,400);case 5:if(this.properties.attachSerial){e.next=7;break}throw new N("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400);case 7:delete t.untilAttach,t.from_serial=this.properties.attachSerial;case 9:return e.abrupt("return",n.history(this,t));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),i.whenState=function(e){return Cn.prototype.whenState.call(c(i),e,i.state)},L.logAction(i.logger,L.LOG_MINOR,"RealtimeChannel()","started; name = "+n),i.name=n,i.channelOptions=Ge(null!=(u=e._Crypto)?u:null,i.logger,r),i.client=e,i._presence=e._RealtimePresence?new e._RealtimePresence.RealtimePresence(c(i)):null,i.connectionManager=e.connection.connectionManager,i.state="initialized",i.subscriptions=new Cn(i.logger),i.syncChannelSerial=void 0,i.properties={attachSerial:void 0,channelSerial:void 0},i.setOptions(r),i.errorReason=null,i._requestedFlags=null,i._mode=null,i._attachResume=!1,i._decodingContext={channelOptions:i.channelOptions,plugins:e.options.plugins||{},baseEncodedPreviousPayload:void 0},i._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},i._allChannelChanges=new Cn(i.logger),(null==(l=e.options.plugins)?void 0:l.Push)&&(i._push=new e.options.plugins.Push.PushChannel(c(i))),i}var n,r,i,l,f,h,p;return u(t,e),g(t,[{key:"presence",get:function(){return this._presence||Pe("RealtimePresence"),this._presence}},{key:"push",get:function(){return this._push||Pe("Push"),this._push}},{key:"invalidStateError",value:function(){return new N("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)}},{key:"setOptions",value:(p=a(o().mark((function e(t){var n,r,i,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.channelOptions,!(i=cr(t))){e.next=4;break}throw i;case 4:if(this.channelOptions=Ge(null!=(n=this.client._Crypto)?n:null,this.logger,t),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),!this._shouldReattachToSetOptions(t,r)){e.next=9;break}return this.attachImpl(),e.abrupt("return",new Promise((function(e,t){a._allChannelChanges.once(["attached","update","detached","failed"],(function(n){switch(this.event){case"update":case"attached":e();break;default:t(n.reason)}}))})));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"_shouldReattachToSetOptions",value:function(e,t){if("attached"!==this.state&&"attaching"!==this.state)return!1;if(null==e?void 0:e.params){var n=ur(e.params),r=ur(t.params);if(Object.keys(n).length!==Object.keys(r).length)return!0;if(!Se(r,n))return!0}return!(!(null==e?void 0:e.modes)||t.modes&&Ae(e.modes,t.modes))}},{key:"publish",value:(h=a(o().mark((function e(){var t,n,r,i,a=this,s=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length<=0?void 0:s[0],n=s.length,this.connectionManager.activeState()){e.next=4;break}throw this.connectionManager.getError();case 4:if(1!=n){e.next=16;break}if(!q(t)){e.next=9;break}t=[Vt(t)],e.next=14;break;case 9:if(!Array.isArray(t)){e.next=13;break}t=zt(t),e.next=14;break;case 13:throw new N("The single-argument form of publish() expects a message object or an array of message objects",40013,400);case 14:e.next=17;break;case 16:t=[Vt({name:s.length<=0?void 0:s[0],data:s.length<=1?void 0:s[1]})];case 17:return r=this.client.options.maxMessageSize,e.next=20,Dt(t,this.channelOptions);case 20:if(!((i=Jt(t))>r)){e.next=23;break}throw new N("Maximum size of messages that can be published at once exceeded ( was "+i+" bytes; limit is "+r+" bytes)",40009,400);case 23:return e.abrupt("return",new Promise((function(e,n){a._publish(t,(function(t){return t?n(t):e()}))})));case 24:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"_publish",value:function(e,t){L.logAction(this.logger,L.LOG_MICRO,"RealtimeChannel.publish()","message count = "+e.length);var n=this.state;switch(n){case"failed":case"suspended":t(N.fromValues(this.invalidStateError()));break;default:L.logAction(this.logger,L.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+n);var r=new qn;r.action=An.MESSAGE,r.channel=this.name,r.messages=e,this.sendMessage(r,t)}}},{key:"onEvent",value:function(e){L.logAction(this.logger,L.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var t=this.subscriptions,n=0;n<e.length;n++){var r=e[n];t.emit(r.name,r)}}},{key:"attach",value:(f=a(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("attached"!==this.state){e.next=2;break}return e.abrupt("return",null);case 2:return e.abrupt("return",new Promise((function(e,n){t._attach(!1,null,(function(t,r){return t?n(t):e(r)}))})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"_attach",value:function(e,t,n){var r=this;n||(n=function(e){e&&L.logAction(r.logger,L.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+e.toString())});var o=this.connectionManager;o.activeState()?(("attaching"!==this.state||e)&&this.requestState("attaching",t),this.once((function(e){switch(this.event){case"attached":null==n||n(null,e);break;case"detached":case"suspended":case"failed":null==n||n(e.reason||o.getError()||new N("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":null==n||n(new N("Attach request superseded by a subsequent detach request",9e4,409))}}))):n(o.getError())}},{key:"attachImpl",value:function(){L.logAction(this.logger,L.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var e=Nn({action:An.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?e.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&e.encodeModesToFlags(we(this.channelOptions.modes)),this._attachResume&&e.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(e.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(e,sr)}},{key:"detach",value:(l=a(o().mark((function e(){var t,n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.connectionManager).activeState()){e.next=3;break}throw t.getError();case 3:e.t0=this.state,e.next="suspended"===e.t0?6:"detached"===e.t0?8:"failed"===e.t0?9:"detaching"===e.t0?11:10;break;case 6:return this.notifyState("detached"),e.abrupt("return");case 8:return e.abrupt("return");case 9:throw new N("Unable to detach; channel state = failed",90001,400);case 10:this.requestState("detaching");case 11:return e.abrupt("return",new Promise((function(e,r){n.once((function(n){switch(this.event){case"detached":e();break;case"attached":case"suspended":case"failed":r(n.reason||t.getError()||new N("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":r(new N("Detach request superseded by a subsequent attach request",9e4,409))}}))})));case 12:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"detachImpl",value:function(e){L.logAction(this.logger,L.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var t=Nn({action:An.DETACH,channel:this.name});this.sendMessage(t,e||sr)}},{key:"subscribe",value:(i=a(o().mark((function e(){var n,r,i,a,s,c,u,l=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=l.length,r=new Array(n),i=0;i<n;i++)r[i]=l[i];if(a=t.processListenerArgs(r),s=v(a,2),c=s[0],u=s[1],"failed"!==this.state){e.next=4;break}throw N.fromValues(this.invalidStateError());case 4:return c&&"object"===E(c)&&!Array.isArray(c)?this.client._FilteredSubscriptions.subscribeFilter(this,c,u):this.subscriptions.on(c,u),e.abrupt("return",this.attach());case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"unsubscribe",value:function(){for(var e,n=this,r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];var a=t.processListenerArgs(o),s=v(a,2),c=s[0],u=s[1];"object"===E(c)&&!u||(null==(e=this.filteredSubscriptions)?void 0:e.has(u))?this.client._FilteredSubscriptions.getAndDeleteFilteredSubscriptions(this,c,u).forEach((function(e){return n.subscriptions.off(e)})):this.subscriptions.off(c,u)}},{key:"sync",value:function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new D("Unable to sync to channel; not attached",4e4)}var e=this.connectionManager;if(!e.activeState())throw e.getError();var t=Nn({action:An.SYNC,channel:this.name});this.syncChannelSerial&&(t.channelSerial=this.syncChannelSerial),e.send(t)}},{key:"sendMessage",value:function(e,t){this.connectionManager.send(e,this.client.options.queueMessages,t)}},{key:"sendPresence",value:function(e,t){var n=Nn({action:An.PRESENCE,channel:this.name,presence:Array.isArray(e)?this.client._RealtimePresence.presenceMessagesFromValuesArray(e):[this.client._RealtimePresence.presenceMessageFromValues(e)]});this.sendMessage(n,t)}},{key:"processMessage",value:(r=a(o().mark((function e(t){var n,r,i,a,s,c,u,l,f,h,p,d,v,y,g,m,b,w,k,_,E,O,S,x,C;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.action!==An.ATTACHED&&t.action!==An.MESSAGE&&t.action!==An.PRESENCE||this.setChannelSerial(t.channelSerial),r=!1,e.t0=t.action,e.next=e.t0===An.ATTACHED?5:e.t0===An.DETACHED?15:e.t0===An.SYNC?18:e.t0===An.PRESENCE?22:e.t0===An.MESSAGE?46:e.t0===An.ERROR?83:86;break;case 5:return this.properties.attachSerial=t.channelSerial,this._mode=t.getMode(),this.params=t.params||{},i=t.decodeModesFromFlags(),this.modes=i&&be(i)||void 0,a=t.hasFlag("RESUMED"),s=t.hasFlag("HAS_PRESENCE"),c=t.hasFlag("HAS_BACKLOG"),"attached"===this.state?(a||this._presence&&this._presence.onAttached(s),u=new ar(this.state,this.state,a,c,t.error),this._allChannelChanges.emit("update",u),a&&!this.channelOptions.updateOnAttached||this.emit("update",u)):"detaching"===this.state?this.checkPendingState():this.notifyState("attached",t.error,a,s,c),e.abrupt("break",88);case 15:return l=t.error?N.fromValues(t.error):new N("Channel detached",90001,404),"detaching"===this.state?this.notifyState("detached",l):"attaching"===this.state?this.notifyState("suspended",l):"attached"!==this.state&&"suspended"!==this.state||this.requestState("attaching",l),e.abrupt("break",88);case 18:if(r=!0,n=this.syncChannelSerial=t.channelSerial,t.presence){e.next=22;break}return e.abrupt("break",88);case 22:if(f=t.presence){e.next=25;break}return e.abrupt("break",88);case 25:h=t.id,p=t.connectionId,d=t.timestamp,v=this.channelOptions,g=0;case 28:if(!(g<f.length)){e.next=44;break}return e.prev=29,y=f[g],e.next=33,rn(y,v);case 33:y.connectionId||(y.connectionId=p),y.timestamp||(y.timestamp=d),y.id||(y.id=h+":"+g),e.next=41;break;case 38:e.prev=38,e.t1=e.catch(29),L.logAction(this.logger,L.LOG_ERROR,"RealtimeChannel.processMessage()",e.t1.toString());case 41:g++,e.next=28;break;case 44:return this._presence&&this._presence.setPresence(f,r,n),e.abrupt("break",88);case 46:if("attached"===this.state){e.next=49;break}return L.logAction(this.logger,L.LOG_MAJOR,"RealtimeChannel.processMessage()",'Message "'+t.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").'),e.abrupt("return");case 49:if(m=t.messages,b=m[0],w=m[m.length-1],k=t.id,_=t.connectionId,E=t.timestamp,!b.extras||!b.extras.delta||b.extras.delta.from===this._lastPayload.messageId){e.next=55;break}return O='Delta message decode failure - previous message not available for message "'+t.id+'" on this channel "'+this.name+'".',L.logAction(this.logger,L.LOG_ERROR,"RealtimeChannel.processMessage()",O),this._startDecodeFailureRecovery(new N(O,40018,400)),e.abrupt("break",88);case 55:S=0;case 56:if(!(S<m.length)){e.next=79;break}return x=m[S],e.prev=58,e.next=61,Ft(x,this._decodingContext);case 61:e.next=73;break;case 63:e.prev=63,e.t2=e.catch(58),L.logAction(this.logger,L.LOG_ERROR,"RealtimeChannel.processMessage()",e.t2.toString()),e.t3=e.t2.code,e.next=40018===e.t3?69:40019===e.t3||40021===e.t3?71:73;break;case 69:return this._startDecodeFailureRecovery(e.t2),e.abrupt("return");case 71:return this.notifyState("failed",e.t2),e.abrupt("return");case 73:x.connectionId||(x.connectionId=_),x.timestamp||(x.timestamp=E),x.id||(x.id=k+":"+S);case 76:S++,e.next=56;break;case 79:return this._lastPayload.messageId=w.id,this._lastPayload.protocolMessageChannelSerial=t.channelSerial,this.onEvent(m),e.abrupt("break",88);case 83:return(C=t.error)&&80016==C.code?this.checkPendingState():this.notifyState("failed",N.fromValues(C)),e.abrupt("break",88);case 86:L.logAction(this.logger,L.LOG_ERROR,"RealtimeChannel.processMessage()","Fatal protocol error: unrecognised action ("+t.action+")"),this.connectionManager.abort(Kn.unknownChannelErr());case 88:case"end":return e.stop()}}),e,this,[[29,38],[58,63]])}))),function(e){return r.apply(this,arguments)})},{key:"_startDecodeFailureRecovery",value:function(e){var t=this;this._lastPayload.decodeFailureRecoveryInProgress||(L.logAction(this.logger,L.LOG_MAJOR,"RealtimeChannel.processMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,e,(function(){t._lastPayload.decodeFailureRecoveryInProgress=!1})))}},{key:"onAttached",value:function(){L.logAction(this.logger,L.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)}},{key:"notifyState",value:function(e,t,n,r,o){if(L.logAction(this.logger,L.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+e),this.clearStateTimer(),["detached","suspended","failed"].includes(e)&&(this.properties.channelSerial=null),e!==this.state){this._presence&&this._presence.actOnChannelState(e,r,t),"suspended"===e&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),t&&(this.errorReason=t);var i=new ar(this.state,e,n,o,t),a='Channel state for channel "'+this.name+'"',s=e+(t?"; reason: "+t:"");"failed"===e?L.logAction(this.logger,L.LOG_ERROR,a,s):L.logAction(this.logger,L.LOG_MAJOR,a,s),"attaching"!==e&&"suspended"!==e&&(this.retryCount=0),"attached"===e&&this.onAttached(),"attached"===e?this._attachResume=!0:"detaching"!==e&&"failed"!==e||(this._attachResume=!1),this.state=e,this._allChannelChanges.emit(e,i),this.emit(e,i)}}},{key:"requestState",value:function(e,t){L.logAction(this.logger,L.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+e),this.notifyState(e,t),this.checkPendingState()}},{key:"checkPendingState",value:function(){if(this.connectionManager.state.sendEvents)switch(L.logAction(this.logger,L.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync()}else L.logAction(this.logger,L.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state)}},{key:"timeoutPendingState",value:function(){switch(this.state){case"attaching":var e=new N("Channel attach timed out",90007,408);this.notifyState("suspended",e);break;case"detaching":var t=new N("Channel detach timed out",90007,408);this.notifyState("attached",t);break;default:this.checkPendingState()}}},{key:"startStateTimerIfNotRunning",value:function(){var e=this;this.stateTimer||(this.stateTimer=setTimeout((function(){L.logAction(e.logger,L.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),e.stateTimer=null,e.timeoutPendingState()}),this.client.options.timeouts.realtimeRequestTimeout))}},{key:"clearStateTimer",value:function(){var e=this.stateTimer;e&&(clearTimeout(e),this.stateTimer=null)}},{key:"startRetryTimer",value:function(){var e=this;if(!this.retryTimer){this.retryCount++;var t=Ee(this.client.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout((function(){"suspended"===e.state&&e.connectionManager.state.sendEvents&&(e.retryTimer=null,L.logAction(e.logger,L.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),e.requestState("attaching"))}),t)}}},{key:"cancelRetryTimer",value:function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}},{key:"getReleaseErr",value:function(){var e=this.state;return"initialized"===e||"detached"===e||"failed"===e?null:new N("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+e,90001,400)}},{key:"setChannelSerial",value:function(e){L.logAction(this.logger,L.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+e+"; previous = "+this.properties.channelSerial),e&&(this.properties.channelSerial=e)}},{key:"status",value:(n=a(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.rest.channelMixin.status(this));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}],[{key:"processListenerArgs",value:function(e){return"function"==typeof(e=Array.prototype.slice.call(e))[0]&&e.unshift(null),e}}]),t}(Cn),fr=function(e){function t(e){var n,r,o;if(b(this,t),n=s(this,t,[qe.objectifyOptions(e,!1,"BaseRealtime",L.defaultLogger)]),L.logAction(n.logger,L.LOG_MINOR,"Realtime()",""),"string"==typeof EdgeRuntime)throw new N('Ably.Realtime instance cannot be used in Vercel Edge runtime. If you are running Vercel Edge functions, please replace your "new Ably.Realtime()" with "new Ably.Rest()" and use Ably Rest API instead of the Realtime API. If you are server-rendering your application in the Vercel Edge runtime, please use the condition "if (typeof EdgeRuntime === \'string\')" to prevent instantiating Ably.Realtime instance during SSR in the Vercel Edge runtime.',4e4,400);return n._additionalTransportImplementations=t.transportImplementationsFromPlugins(n.options.plugins),n._RealtimePresence=null!=(o=null==(r=n.options.plugins)?void 0:r.RealtimePresence)?o:null,n.connection=new ir(c(n),n.options),n._channels=new pr(c(n)),!1!==n.options.autoConnect&&n.connect(),n}return u(t,e),g(t,[{key:"channels",get:function(){return this._channels}},{key:"connect",value:function(){L.logAction(this.logger,L.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()}},{key:"close",value:function(){L.logAction(this.logger,L.LOG_MINOR,"Realtime.close()",""),this.connection.close()}}],[{key:"transportImplementationsFromPlugins",value:function(e){var t={};return(null==e?void 0:e.WebSocketTransport)&&(t[Gn.WebSocket]=e.WebSocketTransport),(null==e?void 0:e.XHRPolling)&&(t[Gn.XhrPolling]=e.XHRPolling),t}}]),t}(ct);fr.EventEmitter=Cn;var hr=fr,pr=function(e){function t(e){var n;return b(this,t),(n=s(this,t,[e.logger])).realtime=e,n.all=Object.create(null),e.connection.connectionManager.on("transport.active",(function(){n.onTransportActive()})),n}var n;return u(t,e),g(t,[{key:"channelSerials",value:function(){var e,t={},n=w(te(this.all,!0));try{for(n.s();!(e=n.n()).done;){var r=e.value,o=this.all[r];o.properties.channelSerial&&(t[r]=o.properties.channelSerial)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"recoverChannels",value:function(e){var t,n=w(te(e,!0));try{for(n.s();!(t=n.n()).done;){var r=t.value;this.get(r).properties.channelSerial=e[r]}}catch(e){n.e(e)}finally{n.f()}}},{key:"processChannelMessage",value:(n=a(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(n=t.channel)){e.next=4;break}return L.logAction(this.logger,L.LOG_ERROR,"Channels.processChannelMessage()","received event unspecified channel, action = "+t.action),e.abrupt("return");case 4:if(r=this.all[n]){e.next=8;break}return L.logAction(this.logger,L.LOG_ERROR,"Channels.processChannelMessage()","received event for non-existent channel: "+n),e.abrupt("return");case 8:return e.next=10,r.processMessage(t);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onTransportActive",value:function(){for(var e in this.all){var t=this.all[e];"attaching"===t.state||"detaching"===t.state?t.checkPendingState():"suspended"===t.state?t._attach(!1,null):"attached"===t.state&&t.requestState("attaching")}}},{key:"propogateConnectionInterruption",value:function(e,t){var n=["attaching","attached","detaching","suspended"],r={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"}[e];for(var o in this.all){var i=this.all[o];n.includes(i.state)&&i.notifyState(r,t)}}},{key:"get",value:function(e,t){e=String(e);var n=this.all[e];if(n){if(t){if(n._shouldReattachToSetOptions(t,n.channelOptions))throw new N("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);n.setOptions(t)}}else n=this.all[e]=new lr(this.realtime,e,t);return n}},{key:"getDerived",value:function(e,t,n){if(t.filter){var r=Ce(t.filter),o=xe(e);e="[filter=".concat(r).concat(o.qualifierParam,"]").concat(o.channelName)}return this.get(e,n)}},{key:"release",value:function(e){e=String(e);var t=this.all[e];if(t){var n=t.getReleaseErr();if(n)throw n;delete this.all[e]}}}]),t}(Cn),dr=hr;function vr(e){var t=e.channel.client,n=t.auth.clientId;return(!n||"*"===n)&&"connected"===t.connection.state}function yr(e,t,n){switch(e.state){case"attached":case"suspended":n();break;case"initialized":case"detached":case"detaching":case"attaching":ye(e.attach(),(function(e){e?t(e):n()}));break;default:t(N.fromValues(e.invalidStateError()))}}function gr(e,t){if(e.isSynthesized()||t.isSynthesized())return e.timestamp>=t.timestamp;var n=e.parseId(),r=t.parseId();return n.msgSerial===r.msgSerial?n.index>r.index:n.msgSerial>r.msgSerial}var mr=function(e){function t(e){var n;return b(this,t),(n=s(this,t,[e.logger])).channel=e,n.syncComplete=!1,n.members=new br(c(n),(function(e){return e.clientId+":"+e.connectionId})),n._myMembers=new br(c(n),(function(e){return e.clientId})),n.subscriptions=new Cn(n.logger),n.pendingPresence=[],n}var n,r,i,l,f,h,p,d,v,y;return u(t,e),g(t,[{key:"enter",value:(y=a(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!vr(this)){e.next=2;break}throw new N("clientId must be specified to enter a presence channel",40012,400);case 2:return e.abrupt("return",this._enterOrUpdateClient(void 0,void 0,t,"enter"));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"update",value:(v=a(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!vr(this)){e.next=2;break}throw new N("clientId must be specified to update presence data",40012,400);case 2:return e.abrupt("return",this._enterOrUpdateClient(void 0,void 0,t,"update"));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"enterClient",value:(d=a(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._enterOrUpdateClient(void 0,t,n,"enter"));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"updateClient",value:(p=a(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._enterOrUpdateClient(void 0,t,n,"update"));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"_enterOrUpdateClient",value:(h=a(o().mark((function e(t,n,r,i){var a,s,c,u=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=this.channel).connectionManager.activeState()){e.next=3;break}throw a.connectionManager.getError();case 3:return L.logAction(this.logger,L.LOG_MICRO,"RealtimePresence."+i+"Client()","channel = "+a.name+", id = "+t+", client = "+(n||"(implicit) "+this.channel.client.auth.clientId)),(s=cn(r)).action=i,t&&(s.id=t),n&&(s.clientId=n),e.next=10,Ut(s,a.channelOptions);case 10:e.t0=a.state,e.next="attached"===e.t0?13:"initialized"===e.t0||"detached"===e.t0?14:"attaching"===e.t0?15:16;break;case 13:return e.abrupt("return",new Promise((function(e,t){a.sendPresence(s,(function(n){return n?t(n):e()}))})));case 14:a.attach();case 15:return e.abrupt("return",new Promise((function(e,t){u.pendingPresence.push({presence:s,callback:function(n){return n?t(n):e()}})})));case 16:throw(c=new D("Unable to "+i+" presence channel while in "+a.state+" state",90001)).code=90001,c;case 19:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return h.apply(this,arguments)})},{key:"leave",value:(f=a(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!vr(this)){e.next=2;break}throw new N("clientId must have been specified to enter or leave a presence channel",40012,400);case 2:return e.abrupt("return",this.leaveClient(void 0,t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"leaveClient",value:(l=a(o().mark((function e(t,n){var r,i,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this.channel).connectionManager.activeState()){e.next=3;break}throw r.connectionManager.getError();case 3:return L.logAction(this.logger,L.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+t),(i=cn(n)).action="leave",t&&(i.clientId=t),e.abrupt("return",new Promise((function(e,t){switch(r.state){case"attached":r.sendPresence(i,(function(n){return n?t(n):e()}));break;case"attaching":a.pendingPresence.push({presence:i,callback:function(n){return n?t(n):e()}});break;case"initialized":case"failed":var n=new D("Unable to leave presence channel (incompatible state)",90001);t(n);break;default:t(r.invalidStateError())}})));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"get",value:(i=a(o().mark((function e(t){var n,r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!t||!("waitForSync"in t)||t.waitForSync,e.abrupt("return",new Promise((function(e,o){function i(n){e(t?n.list(t):n.values())}"suspended"!==r.channel.state?yr(r.channel,(function(e){return o(e)}),(function(){var e=r.members;n?e.waitSync((function(){i(e)})):i(e)})):n?o(N.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):i(r.members)})));case 2:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"history",value:(r=a(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L.logAction(this.logger,L.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),n=this.channel.client.rest.presenceMixin,!t||!t.untilAttach){e.next=9;break}if("attached"!==this.channel.state){e.next=8;break}delete t.untilAttach,t.from_serial=this.channel.properties.attachSerial,e.next=9;break;case 8:throw new N("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400);case 9:return e.abrupt("return",n.history(this,t));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setPresence",value:function(e,t,n){var r,o;L.logAction(this.logger,L.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+e.length+" participants; syncChannelSerial = "+n);var i=this.members,a=this._myMembers,s=[],c=this.channel.connectionManager.connectionId;t&&(this.members.startSync(),n&&(o=n.match(/^[\w-]+:(.*)$/))&&(r=o[1]));for(var u=0;u<e.length;u++){var l=nn(e[u]);switch(l.action){case"leave":i.remove(l)&&s.push(l),l.connectionId!==c||l.isSynthesized()||a.remove(l);break;case"enter":case"present":case"update":i.put(l)&&s.push(l),l.connectionId===c&&a.put(l)}}t&&!r&&(i.endSync(),this.channel.syncChannelSerial=null);for(var f=0;f<s.length;f++){var h=s[f];this.subscriptions.emit(h.action,h)}}},{key:"onAttached",value:function(e){L.logAction(this.logger,L.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+e),e?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var t=this.pendingPresence,n=t.length;if(n){this.pendingPresence=[];var r=[],o=He.create(this.logger);L.logAction(this.logger,L.LOG_MICRO,"RealtimePresence.onAttached","sending "+n+" queued presence messages");for(var i=0;i<n;i++){var a=t[i];r.push(a.presence),o.push(a.callback)}this.channel.sendPresence(r,o)}}},{key:"actOnChannelState",value:function(e,t,n){switch(e){case"attached":this.onAttached(t);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(n)}}},{key:"failPendingPresence",value:function(e){if(this.pendingPresence.length){L.logAction(this.logger,L.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+le(e));for(var t=0;t<this.pendingPresence.length;t++)try{this.pendingPresence[t].callback(e)}catch(e){}this.pendingPresence=[]}}},{key:"_clearMyMembers",value:function(){this._myMembers.clear()}},{key:"_ensureMyMembersPresent",value:function(){var e=this,t=this._myMembers,n=function(t){if(t){var n="Presence auto-re-enter failed: "+t.toString(),r=new N(n,91004,400);L.logAction(e.logger,L.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",n);var o=new ar(e.channel.state,e.channel.state,!0,!1,r);e.channel.emit("update",o)}};for(var r in t.map){var o=t.map[r];L.logAction(this.logger,L.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+o.clientId+'" into the presence set'),ye(this._enterOrUpdateClient(o.id,o.clientId,o.data,"enter"),n)}}},{key:"_synthesizeLeaves",value:function(e){var t=this.subscriptions;e.forEach((function(e){var n=nn({action:"leave",connectionId:e.connectionId,clientId:e.clientId,data:e.data,encoding:e.encoding,timestamp:Date.now()});t.emit("leave",n)}))}},{key:"subscribe",value:(n=a(o().mark((function e(){var t,n,r,i,a,s,c,u=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=u.length,n=new Array(t),r=0;r<t;r++)n[r]=u[r];if(i=lr.processListenerArgs(n),a=i[0],s=i[1],"failed"!==(c=this.channel).state){e.next=7;break}throw N.fromValues(c.invalidStateError());case 7:return this.subscriptions.on(a,s),e.next=10,c.attach();case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"unsubscribe",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=lr.processListenerArgs(t),o=r[0],i=r[1];this.subscriptions.off(o,i)}}]),t}(Cn),br=function(e){function t(e,n){var r;return b(this,t),(r=s(this,t,[e.logger])).presence=e,r.map=Object.create(null),r.syncInProgress=!1,r.residualMembers=null,r.memberKey=n,r}return u(t,e),g(t,[{key:"get",value:function(e){return this.map[e]}},{key:"getClient",value:function(e){var t=this.map,n=[];for(var r in t){var o=t[r];o.clientId==e&&"absent"!=o.action&&n.push(o)}return n}},{key:"list",value:function(e){var t=this.map,n=e&&e.clientId,r=e&&e.connectionId,o=[];for(var i in t){var a=t[i];"absent"!==a.action&&(n&&n!=a.clientId||r&&r!=a.connectionId||o.push(a))}return o}},{key:"put",value:function(e){"enter"!==e.action&&"update"!==e.action||((e=nn(e)).action="present");var t=this.map,n=this.memberKey(e);this.residualMembers&&delete this.residualMembers[n];var r=t[n];return!(r&&!gr(e,r)||(t[n]=e,0))}},{key:"values",value:function(){var e=this.map,t=[];for(var n in e){var r=e[n];"absent"!=r.action&&t.push(r)}return t}},{key:"remove",value:function(e){var t=this.map,n=this.memberKey(e),r=t[n];return!(r&&!gr(e,r)||(this.syncInProgress?((e=nn(e)).action="absent",t[n]=e):delete t[n],0))}},{key:"startSync",value:function(){var e=this.map,t=this.syncInProgress;L.logAction(this.logger,L.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+t),this.syncInProgress||(this.residualMembers=B(e),this.setInProgress(!0))}},{key:"endSync",value:function(){var e=this.map,t=this.syncInProgress;if(L.logAction(this.logger,L.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+t),t){for(var n in e)"absent"===e[n].action&&delete e[n];for(var r in this.presence._synthesizeLeaves(ne(this.residualMembers)),this.residualMembers)delete e[r];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")}},{key:"waitSync",value:function(e){var t=this.syncInProgress;L.logAction(this.logger,L.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+t),t?this.once("sync",e):e()}},{key:"clear",value:function(){this.map={},this.setInProgress(!1),this.residualMembers=null}},{key:"setInProgress",value:function(e){L.logAction(this.logger,L.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+e),this.syncInProgress=e,this.presence.syncComplete=!e}}]),t}(Cn),wr=mr,kr=Gn.WebSocket,_r=function(e){function t(e,n,r){var o;return b(this,t),(o=s(this,t,[e,n,r])).shortName=kr,r.heartbeats=T.Config.useProtocolHeartbeats,o.wsHost=r.host,o}return u(t,e),g(t,[{key:"createWebSocket",value:function(e,t){return this.uri=e+se(t),new T.Config.WebSocket(this.uri)}},{key:"toString",value:function(){return"WebSocketTransport; uri="+this.uri}},{key:"connect",value:function(){L.logAction(this.logger,L.LOG_MINOR,"WebSocketTransport.connect()","starting"),Xn.prototype.connect.call(this);var e=this,t=this.params,n=t.options,r=(n.tls?"wss://":"ws://")+this.wsHost+":"+qe.getPort(n)+"/";L.logAction(this.logger,L.LOG_MINOR,"WebSocketTransport.connect()","uri: "+r),ye(this.auth.getAuthParams(),(function(n,o){if(!e.isDisposed){var i="";for(var a in o)i+=" "+a+": "+o[a]+";";if(L.logAction(e.logger,L.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+i+" err: "+n),n)e.disconnect(n);else{var s=t.getConnectParams(o);try{var c=e.wsConnection=e.createWebSocket(r,s);c.binaryType=T.Config.binaryType,c.onopen=function(){e.onWsOpen()},c.onclose=function(t){e.onWsClose(t)},c.onmessage=function(t){e.onWsData(t.data)},c.onerror=function(t){e.onWsError(t)},c.on&&c.on("ping",(function(){e.onActivity()}))}catch(t){L.logAction(e.logger,L.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(t.stack||t.message)),e.disconnect(t)}}}}))}},{key:"send",value:function(e){var t=this.wsConnection;if(t)try{t.send(Ln(e,this.connectionManager.realtime._MsgPack,this.params.format))}catch(e){var n="Exception from ws connection when trying to send: "+le(e);L.logAction(this.logger,L.LOG_ERROR,"WebSocketTransport.send()",n),this.finish("disconnected",new N(n,5e4,500))}else L.logAction(this.logger,L.LOG_ERROR,"WebSocketTransport.send()","No socket connection")}},{key:"onWsData",value:function(e){L.logAction(this.logger,L.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+e.length+"; type = "+E(e));try{this.onProtocolMessage((t=e,n=this.connectionManager.realtime._MsgPack,r=this.connectionManager.realtime._RealtimePresence,o=this.format,Mn(ge(t,n,o),r)))}catch(e){L.logAction(this.logger,L.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+e.stack)}var t,n,r,o}},{key:"onWsOpen",value:function(){L.logAction(this.logger,L.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")}},{key:"onWsClose",value:function(e){var t,n;if("object"==E(e)?(n=e.code,t=e.wasClean||1e3===n):t=1e3==(n=e),delete this.wsConnection,t){L.logAction(this.logger,L.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var r=new N("Websocket closed",80003,400);this.finish("disconnected",r)}else{var o="Unclean disconnection of WebSocket ; code = "+n,i=new N(o,80003,400);L.logAction(this.logger,L.LOG_MINOR,"WebSocketTransport.onWsClose()",o),this.finish("disconnected",i)}this.emit("disposed")}},{key:"onWsError",value:function(e){var t=this;L.logAction(this.logger,L.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+e.message),T.Config.nextTick((function(){t.disconnect(Error(e.message))}))}},{key:"dispose",value:function(){var e=this;L.logAction(this.logger,L.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var t=this.wsConnection;t&&(t.onmessage=function(){},delete this.wsConnection,T.Config.nextTick((function(){if(L.logAction(e.logger,L.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!t)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");t.close()})))}}],[{key:"isAvailable",value:function(){return!!T.Config.WebSocket}}]),t}(Xn),Er=function(){function e(){b(this,e)}return g(e,null,[{key:"subscribeFilter",value:function(e,t,n){var r=function(e){var r,o,i,a,s,c,u={name:e.name,refTimeserial:null==(o=null==(r=e.extras)?void 0:r.ref)?void 0:o.timeserial,refType:null==(a=null==(i=e.extras)?void 0:i.ref)?void 0:a.type,isRef:!!(null==(c=null==(s=e.extras)?void 0:s.ref)?void 0:c.timeserial),clientId:e.clientId};Object.entries(t).find((function(e){var t=v(e,2),n=t[0],r=t[1];return void 0!==r&&u[n]!==r}))||n(e)};this.addFilteredSubscription(e,t,n,r),e.subscriptions.on(r)}},{key:"addFilteredSubscription",value:function(e,t,n,r){var o;if(e.filteredSubscriptions||(e.filteredSubscriptions=new Map),e.filteredSubscriptions.has(n)){var i=e.filteredSubscriptions.get(n);i.set(t,(null==(o=null==i?void 0:i.get(t))?void 0:o.concat(r))||[r])}else e.filteredSubscriptions.set(n,new Map([[t,[r]]]))}},{key:"getAndDeleteFilteredSubscriptions",value:function(e,t,n){if(!e.filteredSubscriptions)return[];if(!n&&t)return Array.from(e.filteredSubscriptions.entries()).map((function(n){var r,o=v(n,2),i=o[0],a=o[1],s=a.get(t);return a.delete(t),0===a.size&&(null==(r=e.filteredSubscriptions)||r.delete(i)),s})).reduce((function(e,t){return t?e.concat.apply(e,r(t)):e}),[]);if(!n||!e.filteredSubscriptions.has(n))return[];var o=e.filteredSubscriptions.get(n);if(!t){var i=Array.from(o.values()).reduce((function(e,t){return e.concat.apply(e,r(t))}),[]);return e.filteredSubscriptions.delete(n),i}var a=o.get(t);return o.delete(t),a||[]}}]),e}(),Or=function(e){function t(e){var n;b(this,t);var r=t._MsgPack;if(!r)throw new Error("Expected DefaultRealtime._MsgPack to have been set");return s(this,t,[qe.objectifyOptions(e,!0,"Realtime",L.defaultLogger,x(S({},wn),{Crypto:null!=(n=t.Crypto)?n:void 0,MsgPack:r,RealtimePresence:{RealtimePresence:wr,presenceMessageFromValues:nn,presenceMessagesFromValuesArray:sn},WebSocketTransport:_r,MessageInteractions:Er}))])}return u(t,e),g(t,null,[{key:"Crypto",get:function(){if(null===this._Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");return this._Crypto},set:function(e){this._Crypto=e}}]),t}(dr);Or.Utils=M,Or.ConnectionManager=or,Or.ProtocolMessage=qn,Or._Crypto=null,Or.Message=kn,Or.PresenceMessage=_n,Or._MsgPack=null,Or._Http=at;var Sr=Or,xr=Uint8Array,Cr=Uint32Array,Ar=Math.pow,Tr=new Cr(8),Pr=[],Ir=new Cr(64);function jr(e){return(e-(0|e))*Ar(2,32)|0}for(var Rr,Lr,Mr=2,Ur=0;Ur<64;){for(Rr=!0,Lr=2;Lr<=Mr/2;Lr++)Mr%Lr==0&&(Rr=!1);Rr&&(Ur<8&&(Tr[Ur]=jr(Ar(Mr,.5))),Pr[Ur]=jr(Ar(Mr,1/3)),Ur++),Mr++}var Nr=!!new xr(new Cr([1]).buffer)[0];function Dr(e){return Nr?e>>>24|(e>>>16&255)<<8|(65280&e)<<8|e<<24:e}function Gr(e,t){return e>>>t|e<<32-t}function Br(e){var t,n=Tr.slice(),r=e.length,o=8*r,i=512-(o+64)%512-1+o+65,a=new xr(i/8),s=new Cr(a.buffer);a.set(e,0),a[r]=128,s[s.length-1]=Dr(o);for(var c=0;c<i/32;c+=16){var u=n.slice();for(t=0;t<64;t++){var l;if(t<16)l=Dr(s[c+t]);else{var f=Ir[t-15],h=Ir[t-2];l=Ir[t-7]+Ir[t-16]+(Gr(f,7)^Gr(f,18)^f>>>3)+(Gr(h,17)^Gr(h,19)^h>>>10)}Ir[t]=l|=0;for(var p=(Gr(u[4],6)^Gr(u[4],11)^Gr(u[4],25))+(u[4]&u[5]^~u[4]&u[6])+u[7]+l+Pr[t],d=(Gr(u[0],2)^Gr(u[0],13)^Gr(u[0],22))+(u[0]&u[1]^u[2]&(u[0]^u[1])),v=7;v>0;v--)u[v]=u[v-1];u[0]=p+d|0,u[4]=u[4]+p|0}for(t=0;t<8;t++)n[t]=n[t]+u[t]|0}return new xr(new Cr(n.map((function(e){return Dr(e)}))).buffer)}var Fr,qr=new(function(){function e(){b(this,e),this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return g(e,[{key:"uint8ViewToBase64",value:function(e){for(var t,n,r,o,i="",a=this.base64CharSet,s=e.byteLength,c=s%3,u=s-c,l=0;l<u;l+=3)t=(258048&(o=e[l]<<16|e[l+1]<<8|e[l+2]))>>12,n=(4032&o)>>6,r=63&o,i+=a[(16515072&o)>>18]+a[t]+a[n]+a[r];return 1==c?(t=(3&(o=e[u]))<<4,i+=a[(252&o)>>2]+a[t]+"=="):2==c&&(t=(1008&(o=e[u]<<8|e[u+1]))>>4,n=(15&o)<<2,i+=a[(64512&o)>>10]+a[t]+a[n]+"="),i}},{key:"base64ToArrayBuffer",value:function(e){for(var t=null==atob?void 0:atob(e),n=t.length,r=new Uint8Array(n),o=0;o<n;o++){var i=t.charCodeAt(o);r[o]=i}return this.toArrayBuffer(r)}},{key:"isBuffer",value:function(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)}},{key:"toBuffer",value:function(e){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(this.toArrayBuffer(e));throw new Error("BufferUtils.toBuffer expected an ArrayBuffer or a view onto one")}},{key:"toArrayBuffer",value:function(e){if(!ArrayBuffer)throw new Error("Can't convert to ArrayBuffer: browser does not support the necessary types");if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);throw new Error("BufferUtils.toArrayBuffer expected an ArrayBuffer or a view onto one")}},{key:"base64Encode",value:function(e){return this.uint8ViewToBase64(this.toBuffer(e))}},{key:"base64Decode",value:function(e){if(ArrayBuffer&&T.Config.atob)return this.base64ToArrayBuffer(e);throw new Error("Expected ArrayBuffer to exist and Platform.Config.atob to be configured")}},{key:"hexEncode",value:function(e){return this.toBuffer(e).reduce((function(e,t){return e+t.toString(16).padStart(2,"0")}),"")}},{key:"hexDecode",value:function(e){if(e.length%2!=0)throw new Error("Can't create a byte array from a hex string of odd length");for(var t=new Uint8Array(e.length/2),n=0;n<t.length;n++)t[n]=parseInt(e.slice(2*n,2*(n+1)),16);return this.toArrayBuffer(t)}},{key:"utf8Encode",value:function(e){if(T.Config.TextEncoder){var t=(new T.Config.TextEncoder).encode(e);return this.toArrayBuffer(t)}throw new Error("Expected TextEncoder to be configured")}},{key:"utf8Decode",value:function(e){if(!this.isBuffer(e))throw new Error("Expected input of utf8decode to be an arraybuffer or typed array");if(TextDecoder)return(new TextDecoder).decode(e);throw new Error("Expected TextDecoder to be configured")}},{key:"areBuffersEqual",value:function(e,t){if(!e||!t)return!1;var n=this.toArrayBuffer(e),r=this.toArrayBuffer(t);if(n.byteLength!=r.byteLength)return!1;for(var o=new Uint8Array(n),i=new Uint8Array(r),a=0;a<o.length;a++)if(o[a]!=i[a])return!1;return!0}},{key:"byteLength",value:function(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}},{key:"arrayBufferViewToBuffer",value:function(e){return this.toArrayBuffer(e)}},{key:"hmacSha256",value:function(e,t){var n=function(e,t){if(e.length>64&&(e=Br(e)),e.length<64){var n=new Uint8Array(64);n.set(e,0),e=n}for(var r=new Uint8Array(64),o=new Uint8Array(64),i=0;i<64;i++)r[i]=54^e[i],o[i]=92^e[i];var a=new Uint8Array(t.length+64);a.set(r,0),a.set(t,64);var s=new Uint8Array(96);return s.set(o,0),s.set(Br(a),64),Br(s)}(this.toBuffer(t),this.toBuffer(e));return this.toArrayBuffer(n)}}]),e}()),Hr=function(e){return e[e.REQ_SEND=0]="REQ_SEND",e[e.REQ_RECV=1]="REQ_RECV",e[e.REQ_RECV_POLL=2]="REQ_RECV_POLL",e[e.REQ_RECV_STREAM=3]="REQ_RECV_STREAM",e}(Hr||{}),Wr=Hr;function Vr(){return new N("No HTTP request plugin provided. Provide at least one of the FetchRequest or XHRRequest plugins.",400,4e4)}var zr=((Fr=function(){function e(t){var n;b(this,e),this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this.client=null!=t?t:null;var r=(null==t?void 0:t.options.connectivityCheckUrl)||qe.connectivityCheckUrl,i=null!=(n=null==t?void 0:t.options.connectivityCheckParams)?n:null,s=!(null==t?void 0:t.options.connectivityCheckUrl),c=S(S({},zr.bundledRequestImplementations),null==t?void 0:t._additionalHTTPRequestImplementations),u=c.XHRRequest,l=c.FetchRequest,f=!(!u&&!l);if(!f)throw Vr();T.Config.xhrSupported&&u?(this.supportsAuthHeaders=!0,this.Request=function(){var e=a(o().mark((function e(n,r,i,a,s){var c=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var o,l=u.createRequest(r,i,a,s,Wr.REQ_SEND,null!=(o=t&&t.options.timeouts)?o:null,c.logger,n);l.once("complete",(function(t,n,r,o,i){return e({error:t,body:n,headers:r,unpacked:o,statusCode:i})})),l.exec()})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),(null==t?void 0:t.options.disableConnectivityCheck)?this.checkConnectivity=a(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)}))):this.checkConnectivity=a(o().mark((function e(){var t,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return L.logAction(this.logger,L.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+r),e.next=3,this.doUri(Ve.Get,r,null,null,i);case 3:return n=e.sent,a=!1,a=s?!n.error&&"yes"==(null==(t=n.body)?void 0:t.replace(/\n/,"")):!n.error&&(o=n.statusCode)>=200&&o<400,L.logAction(this.logger,L.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+a),e.abrupt("return",a);case 8:case"end":return e.stop()}var o}),e,this)})))):T.Config.fetchSupported&&l?(this.supportsAuthHeaders=!0,this.Request=function(){var e=a(o().mark((function e(n,r,i,a,s){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l(n,null!=t?t:null,r,i,a,s));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),this.checkConnectivity=a(o().mark((function e(){var t,n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return L.logAction(this.logger,L.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+r),e.next=3,this.doUri(Ve.Get,r,null,null,null);case 3:return n=e.sent,i=!n.error&&"yes"==(null==(t=n.body)?void 0:t.replace(/\n/,"")),L.logAction(this.logger,L.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+i),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)})))):this.Request=a(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f?new D("no supported HTTP transports available",null,400):Vr(),e.abrupt("return",{error:t});case 2:case"end":return e.stop()}}),e)})))}var t;return g(e,[{key:"logger",get:function(){var e,t;return null!=(t=null==(e=this.client)?void 0:e.logger)?t:L.defaultLogger}},{key:"doUri",value:(t=a(o().mark((function e(t,n,r,i,a){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.Request){e.next=2;break}return e.abrupt("return",{error:new D("Request invoked before assigned to",null,500)});case 2:return e.abrupt("return",this.Request(t,n,r,a,i));case 3:case"end":return e.stop()}}),e,this)}))),function(e,n,r,o,i){return t.apply(this,arguments)})},{key:"shouldFallback",value:function(e){var t=e.statusCode;return 408===t&&!e.code||400===t&&!e.code||t>=500&&t<=504}}]),e}()).methods=[Ve.Get,Ve.Delete,Ve.Post,Ve.Put,Ve.Patch],Fr.methodsWithoutBody=[Ve.Get,Ve.Delete],Fr.methodsWithBody=[Ve.Post,Ve.Put,Ve.Patch],Fr),Jr=zr,Kr="ablyjs-storage-test",Qr=void 0!==e?e:"undefined"!=typeof window?window:self,Yr=new(function(){function e(){b(this,e);try{Qr.sessionStorage.setItem(Kr,Kr),Qr.sessionStorage.removeItem(Kr),this.sessionSupported=!0}catch(e){this.sessionSupported=!1}try{Qr.localStorage.setItem(Kr,Kr),Qr.localStorage.removeItem(Kr),this.localSupported=!0}catch(e){this.localSupported=!1}}return g(e,[{key:"get",value:function(e){return this._get(e,!1)}},{key:"getSession",value:function(e){return this._get(e,!0)}},{key:"remove",value:function(e){return this._remove(e,!1)}},{key:"removeSession",value:function(e){return this._remove(e,!0)}},{key:"set",value:function(e,t,n){return this._set(e,t,n,!1)}},{key:"setSession",value:function(e,t,n){return this._set(e,t,n,!0)}},{key:"_set",value:function(e,t,n,r){var o={value:t};return n&&(o.expires=Date.now()+n),this.storageInterface(r).setItem(e,JSON.stringify(o))}},{key:"_get",value:function(e,t){if(t&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!t&&!this.localSupported)throw new Error("Local Storage not supported");var n=this.storageInterface(t).getItem(e);if(!n)return null;var r=JSON.parse(n);return r.expires&&r.expires<Date.now()?(this.storageInterface(t).removeItem(e),null):r.value}},{key:"_remove",value:function(e,t){return this.storageInterface(t).removeItem(e)}},{key:"storageInterface",value:function(e){return e?Qr.sessionStorage:Qr.localStorage}}]),e}()),Xr=Oe(),$r="string"==typeof EdgeRuntime;"undefined"!=typeof Window||"undefined"!=typeof WorkerGlobalScope||$r||console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");var Zr,eo,to={agent:"browser",logTimestamps:!0,userAgent:Xr.navigator&&Xr.navigator.userAgent.toString(),currentUrl:Xr.location&&Xr.location.href,binaryType:"arraybuffer",WebSocket:Xr.WebSocket,fetchSupported:!!Xr.fetch,xhrSupported:Xr.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,allowComet:(eo=Xr.location,!Xr.WebSocket||!eo||!eo.origin||eo.origin.indexOf("http")>-1),useProtocolHeartbeats:!0,supportsBinary:!!Xr.TextDecoder,preferBinary:!1,ArrayBuffer:Xr.ArrayBuffer,atob:Xr.atob,nextTick:void 0!==Xr.setImmediate?Xr.setImmediate.bind(Xr):function(e){setTimeout(e,0)},addEventListener:Xr.addEventListener,inspect:JSON.stringify,stringByteSize:function(e){return Xr.TextDecoder&&(new Xr.TextEncoder).encode(e).length||e.length},TextEncoder:Xr.TextEncoder,TextDecoder:Xr.TextDecoder,getRandomArrayBuffer:(Zr=a(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Uint8Array(t),Xr.crypto.getRandomValues(n),e.abrupt("return",n.buffer);case 3:case"end":return e.stop()}}),e)}))),function(e){return Zr.apply(this,arguments)}),isWebworker:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,push:{platform:"browser",formFactor:"desktop",storage:Yr}};function no(e){return function(e){return!!e.code&&!tt.isTokenErr(e)&&(!![80015,80017,80030].includes(e.code)||e.code>=4e4&&e.code<5e4)}(e)?[Nn({action:An.ERROR,error:e})]:[Nn({action:An.DISCONNECTED,error:e})]}var ro=function(e){function t(e,n,r){var o;return b(this,t),(o=s(this,t,[e,n,r,!0])).onAuthUpdated=function(e){o.authParams={access_token:e.token}},o.stream=!("stream"in r)||r.stream,o.sendRequest=null,o.recvRequest=null,o.pendingCallback=null,o.pendingItems=null,o}return u(t,e),g(t,[{key:"connect",value:function(){var e=this;L.logAction(this.logger,L.LOG_MINOR,"CometTransport.connect()","starting"),Xn.prototype.connect.call(this);var t=this.params,n=t.options,r=qe.getHost(n,t.host),o=qe.getPort(n),i=n.tls?"https://":"http://";this.baseUri=i+r+":"+o+"/comet/";var a=this.baseUri+"connect";L.logAction(this.logger,L.LOG_MINOR,"CometTransport.connect()","uri: "+a),ye(this.auth.getAuthParams(),(function(t,n){if(t)e.disconnect(t);else if(!e.isDisposed){e.authParams=n;var r=e.params.getConnectParams(n);"stream"in r&&(e.stream=r.stream),L.logAction(e.logger,L.LOG_MINOR,"CometTransport.connect()","connectParams:"+se(r));var o=!1,i=e.recvRequest=e.createRequest(a,null,r,null,e.stream?Wr.REQ_RECV_STREAM:Wr.REQ_RECV);i.on("data",(function(t){e.recvRequest&&(o||(o=!0,e.emit("preconnect")),e.onData(t))})),i.on("complete",(function(t){e.recvRequest||(t=t||new N("Request cancelled",80003,400)),e.recvRequest=null,o||t||(o=!0,e.emit("preconnect")),e.onActivity(),t?t.code?e.onData(no(t)):e.disconnect(t):T.Config.nextTick((function(){e.recv()}))})),i.exec()}}))}},{key:"requestClose",value:function(){L.logAction(this.logger,L.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)}},{key:"requestDisconnect",value:function(){L.logAction(this.logger,L.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)}},{key:"_requestCloseOrDisconnect",value:function(e){var t=this,n=e?this.closeUri:this.disconnectUri;if(n){var r=this.createRequest(n,null,this.authParams,null,Wr.REQ_SEND);r.on("complete",(function(n){n&&(L.logAction(t.logger,L.LOG_ERROR,"CometTransport.request"+(e?"Close()":"Disconnect()"),"request returned err = "+le(n)),t.finish("disconnected",n))})),r.exec()}}},{key:"dispose",value:function(){var e=this;L.logAction(this.logger,L.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(L.logAction(this.logger,L.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",Kn.disconnected()),T.Config.nextTick((function(){e.emit("disposed")})))}},{key:"onConnect",value:function(e){var t;if(!this.isDisposed){var n=null==(t=e.connectionDetails)?void 0:t.connectionKey;Xn.prototype.onConnect.call(this,e);var r=this.baseUri+n;L.logAction(this.logger,L.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+r),this.sendUri=r+"/send",this.recvUri=r+"/recv",this.closeUri=r+"/close",this.disconnectUri=r+"/disconnect"}}},{key:"send",value:function(e){if(this.sendRequest)return this.pendingItems=this.pendingItems||[],void this.pendingItems.push(e);var t=this.pendingItems||[];t.push(e),this.pendingItems=null,this.sendItems(t)}},{key:"sendAnyPending",value:function(){var e=this.pendingItems;e&&(this.pendingItems=null,this.sendItems(e))}},{key:"sendItems",value:function(e){var t=this,n=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(e),Wr.REQ_SEND);n.on("complete",(function(e,n){e&&L.logAction(t.logger,L.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+le(e)),t.sendRequest=null,e?e.code?t.onData(no(e)):t.disconnect(e):(n&&t.onData(n),t.pendingItems&&T.Config.nextTick((function(){t.sendRequest||t.sendAnyPending()})))})),n.exec()}},{key:"recv",value:function(){var e=this;if(!this.recvRequest&&this.isConnected){var t=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?Wr.REQ_RECV_STREAM:Wr.REQ_RECV_POLL);t.on("data",(function(t){e.onData(t)})),t.on("complete",(function(t){e.recvRequest=null,e.onActivity(),t?t.code?e.onData(no(t)):e.disconnect(t):T.Config.nextTick((function(){e.recv()}))})),t.exec()}}},{key:"onData",value:function(e){try{var t=this.decodeResponse(e);if(t&&t.length)for(var n=0;n<t.length;n++)this.onProtocolMessage(Mn(t[n],this.connectionManager.realtime._RealtimePresence))}catch(e){L.logAction(this.logger,L.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+e.stack)}}},{key:"encodeRequest",value:function(e){return JSON.stringify(e)}},{key:"decodeResponse",value:function(e){return"string"==typeof e?JSON.parse(e):e}}]),t}(Xn);function oo(e,t){if(function(e,t){return be(te(t)).includes("x-ably-errorcode")}(0,t))return e.error&&N.fromValues(e.error)}var io=function(){},ao=0,so={},co=function(e){function t(e,n,r,o,i,a,u,l){var f;return b(this,t),f=s(this,t,[u]),(r=r||{}).rnd=pe(),f.uri=e+se(r),f.headers=n||{},f.body=o,f.method=l?l.toUpperCase():W(o)?"GET":"POST",f.requestMode=i,f.timeouts=a,f.timedOut=!1,f.requestComplete=!1,f.id=String(++ao),so[f.id]=c(f),f}return u(t,e),g(t,[{key:"complete",value:function(e,t,n,r,o){this.requestComplete||(this.requestComplete=!0,!e&&t&&this.emit("data",t),this.emit("complete",e,t,n,r,o),this.dispose())}},{key:"abort",value:function(){this.dispose()}},{key:"exec",value:function(){var e=this,t=this.headers,n=this.requestMode==Wr.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,r=this.timer=setTimeout((function(){e.timedOut=!0,i.abort()}),n),o=this.method,i=this.xhr=new XMLHttpRequest,a=t.accept,s=this.body,c="text";for(var u in a?0===a.indexOf("application/x-msgpack")&&(c="arraybuffer"):t.accept="application/json",s&&(t["content-type"]||(t["content-type"]="application/json")).indexOf("application/json")>-1&&"string"!=typeof s&&(s=JSON.stringify(s)),i.open(o,this.uri,!0),i.responseType=c,"authorization"in t&&(i.withCredentials=!0),t)i.setRequestHeader(u,t[u]);var l,f,h,p=function(t,n,r,o){var i,a=n+" (event type: "+t.type+")";(null==(i=null==e?void 0:e.xhr)?void 0:i.statusText)&&(a+=", current statusText is "+e.xhr.statusText),L.logAction(e.logger,L.LOG_ERROR,"Request.on"+t.type+"()",a),e.complete(new D(a,r,o))};i.onerror=function(e){p(e,"XHR error occurred",null,400)},i.onabort=function(t){e.timedOut?p(t,"Request aborted due to request timeout expiring",null,408):p(t,"Request cancelled",null,400)},i.ontimeout=function(e){p(e,"Request timed out",null,408)};var d=0,v=!1;function y(){for(var e,t,n=i.responseText,r=n.length-1;d<r&&(e=n.indexOf("\n",d))>-1;)t=n.slice(d,e),d=e+1,g(t)}var g=function(t){try{t=JSON.parse(t)}catch(t){return void e.complete(new D("Malformed response body from server: "+t.message,null,400))}e.emit("data",t)};i.onreadystatechange=function(){var n=i.readyState;n<3||0!==i.status&&(void 0===f&&(f=i.status,clearTimeout(r),h=f<400,204!=f?l=e.requestMode==Wr.REQ_RECV_STREAM&&h&&function(e){return e.getResponseHeader&&(e.getResponseHeader("transfer-encoding")||!e.getResponseHeader("content-length"))}(i):e.complete(null,null,null,null,f)),3==n&&l?y():4==n&&(l?(y(),e.streamComplete=!0,T.Config.nextTick((function(){e.complete()}))):function(){var n;try{var r=function(e,t){return e.getResponseHeader&&e.getResponseHeader(t)}(i,"content-type");if(r?r.indexOf("application/json")>=0:"text"==i.responseType){var o="arraybuffer"===i.responseType?T.BufferUtils.utf8Decode(i.response):String(i.responseText);n=o.length?JSON.parse(o):o,v=!0}else n=i.response;void 0!==n.response?(f=n.statusCode,h=f<400,t=n.headers,n=n.response):t=function(e){for(var t=e.getAllResponseHeaders().trim().split("\r\n"),n={},r=0;r<t.length;r++){var o=t[r].split(":").map((function(e){return e.trim()}));n[o[0].toLowerCase()]=o[1]}return n}(i)}catch(t){return void e.complete(new D("Malformed response body from server: "+t.message,null,400))}if(h||Array.isArray(n))e.complete(null,n,t,v,f);else{var a=oo(n,t);a||(a=new D("Error response received from server: "+f+" body was: "+T.Config.inspect(n),null,f)),e.complete(a,n,t,v,f)}}()))},i.send(s)}},{key:"dispose",value:function(){var e=this.xhr;if(e){e.onreadystatechange=e.onerror=e.onabort=e.ontimeout=io,this.xhr=null;var t=this.timer;t&&(clearTimeout(t),this.timer=null),this.requestComplete||e.abort()}delete so[this.id]}}],[{key:"createRequest",value:function(e,n,r,o,i,a,s,c){var u=a||qe.TIMEOUTS;return new t(e,n,B(r),o,i,u,s,c)}}]),t}(Cn),uo=Gn.XhrPolling,lo={order:["xhr_polling"],bundledImplementations:{web_socket:_r,xhr_polling:function(e){function t(e,n,r){var o;return b(this,t),(o=s(this,t,[e,n,r])).shortName=uo,r.stream=!1,o.shortName=uo,o}return u(t,e),g(t,[{key:"toString",value:function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected}},{key:"createRequest",value:function(e,t,n,r,o){return co.createRequest(e,t,n,r,o,this.timeouts,this.logger)}}],[{key:"isAvailable",value:function(){return!(!T.Config.xhrSupported||!T.Config.allowComet)}}]),t}(ro)}},fo={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",wsConnectivityCheckUrl:"wss://ws-up.ably-realtime.com",defaultTransports:[Gn.XhrPolling,Gn.WebSocket]};function ho(e,t,n){for(var r=0,o=n.length;r<o;r++){var i=n.charCodeAt(r);if(i<128)e.setUint8(t++,i>>>0&127|0);else if(i<2048)e.setUint8(t++,i>>>6&31|192),e.setUint8(t++,i>>>0&63|128);else if(i<65536)e.setUint8(t++,i>>>12&15|224),e.setUint8(t++,i>>>6&63|128),e.setUint8(t++,i>>>0&63|128);else{if(!(i<1114112))throw new Error("bad codepoint "+i);e.setUint8(t++,i>>>18&7|240),e.setUint8(t++,i>>>12&63|128),e.setUint8(t++,i>>>6&63|128),e.setUint8(t++,i>>>0&63|128)}}}function po(e,t,n){for(var r="",o=t,i=t+n;o<i;o++){var a=e.getUint8(o);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));r+=String.fromCharCode((7&a)<<18|(63&e.getUint8(++o))<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0)}else r+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0);else r+=String.fromCharCode((15&a)<<6|63&e.getUint8(++o));else r+=String.fromCharCode(a)}return r}function vo(e){for(var t=0,n=0,r=e.length;n<r;n++){var o=e.charCodeAt(n);if(o<128)t+=1;else if(o<2048)t+=2;else if(o<65536)t+=3;else{if(!(o<1114112))throw new Error("bad codepoint "+o);t+=4}}return t}var yo=g((function e(t,n){var r=this;b(this,e),this.map=function(e){for(var t={},n=0;n<e;n++)t[r.parse()]=r.parse();return t},this.bin=function(e){var t=new ArrayBuffer(e);return new Uint8Array(t).set(new Uint8Array(r.view.buffer,r.offset,e),0),r.offset+=e,t},this.buf=this.bin,this.str=function(e){var t=po(r.view,r.offset,e);return r.offset+=e,t},this.array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=r.parse();return t},this.ext=function(e){return r.offset+=e,{type:r.view.getInt8(r.offset),data:r.buf(e)}},this.parse=function(){var e,t,n=r.view.getUint8(r.offset);if(0==(128&n))return r.offset++,n;if(128==(240&n))return t=15&n,r.offset++,r.map(t);if(144==(240&n))return t=15&n,r.offset++,r.array(t);if(160==(224&n))return t=31&n,r.offset++,r.str(t);if(224==(224&n))return e=r.view.getInt8(r.offset),r.offset++,e;switch(n){case 192:return r.offset++,null;case 193:return void r.offset++;case 194:return r.offset++,!1;case 195:return r.offset++,!0;case 196:return t=r.view.getUint8(r.offset+1),r.offset+=2,r.bin(t);case 197:return t=r.view.getUint16(r.offset+1),r.offset+=3,r.bin(t);case 198:return t=r.view.getUint32(r.offset+1),r.offset+=5,r.bin(t);case 199:return t=r.view.getUint8(r.offset+1),r.offset+=2,r.ext(t);case 200:return t=r.view.getUint16(r.offset+1),r.offset+=3,r.ext(t);case 201:return t=r.view.getUint32(r.offset+1),r.offset+=5,r.ext(t);case 202:return e=r.view.getFloat32(r.offset+1),r.offset+=5,e;case 203:return e=r.view.getFloat64(r.offset+1),r.offset+=9,e;case 204:return e=r.view.getUint8(r.offset+1),r.offset+=2,e;case 205:return e=r.view.getUint16(r.offset+1),r.offset+=3,e;case 206:return e=r.view.getUint32(r.offset+1),r.offset+=5,e;case 207:return e=function(e,t){return t=t||0,4294967296*e.getUint32(t)+e.getUint32(t+4)}(r.view,r.offset+1),r.offset+=9,e;case 208:return e=r.view.getInt8(r.offset+1),r.offset+=2,e;case 209:return e=r.view.getInt16(r.offset+1),r.offset+=3,e;case 210:return e=r.view.getInt32(r.offset+1),r.offset+=5,e;case 211:return e=function(e,t){return t=t||0,4294967296*e.getInt32(t)+e.getUint32(t+4)}(r.view,r.offset+1),r.offset+=9,e;case 212:return t=1,r.offset++,r.ext(t);case 213:return t=2,r.offset++,r.ext(t);case 214:return t=4,r.offset++,r.ext(t);case 215:return t=8,r.offset++,r.ext(t);case 216:return t=16,r.offset++,r.ext(t);case 217:return t=r.view.getUint8(r.offset+1),r.offset+=2,r.str(t);case 218:return t=r.view.getUint16(r.offset+1),r.offset+=3,r.str(t);case 219:return t=r.view.getUint32(r.offset+1),r.offset+=5,r.str(t);case 220:return t=r.view.getUint16(r.offset+1),r.offset+=3,r.array(t);case 221:return t=r.view.getUint32(r.offset+1),r.offset+=5,r.array(t);case 222:return t=r.view.getUint16(r.offset+1),r.offset+=3,r.map(t);case 223:return t=r.view.getUint32(r.offset+1),r.offset+=5,r.map(t)}throw new Error("Unknown type 0x"+n.toString(16))},this.offset=n||0,this.view=t}));function go(e,t){return Object.keys(e).filter((function(n){var r=e[n],o=E(r);return!(t&&null==r||"function"===o&&!r.toJSON)}))}var mo={encode:function(e,t){var n=function e(t,n){var r=E(t);if("string"===r){var o=vo(t);if(o<32)return 1+o;if(o<256)return 2+o;if(o<65536)return 3+o;if(o<4294967296)return 5+o}if(ArrayBuffer.isView&&ArrayBuffer.isView(t)&&(t=t.buffer),t instanceof ArrayBuffer){var i=t.byteLength;if(i<256)return 2+i;if(i<65536)return 3+i;if(i<4294967296)return 5+i}if("number"==typeof t){if(Math.floor(t)!==t)return 9;if(t>=0){if(t<128)return 1;if(t<256)return 2;if(t<65536)return 3;if(t<4294967296)return 5;if(t<0x10000000000000000)return 9;throw new Error("Number too big 0x"+t.toString(16))}if(t>=-32)return 1;if(t>=-128)return 2;if(t>=-32768)return 3;if(t>=-2147483648)return 5;if(t>=-0x8000000000000000)return 9;throw new Error("Number too small -0x"+t.toString(16).substr(1))}if("boolean"===r)return 1;if(null===t)return n?0:1;if(void 0===t)return n?0:3;if("function"==typeof t.toJSON)return e(t.toJSON(),n);if("object"===r){var a,s=0;if(Array.isArray(t)){a=t.length;for(var c=0;c<a;c++)s+=e(t[c],n)}else{var u=go(t,n);a=u.length;for(var l=0;l<a;l++){var f=u[l];s+=e(f)+e(t[f],n)}}if(a<16)return 1+s;if(a<65536)return 3+s;if(a<4294967296)return 5+s;throw new Error("Array or object too long 0x"+a.toString(16))}if("function"===r)return 0;throw new Error("Unknown type "+r)}(e,t);if(0!==n){var r=new ArrayBuffer(n);return function e(t,n,r,o){var i=E(t);if("string"==typeof t){var a=vo(t);if(a<32)return n.setUint8(r,160|a),ho(n,r+1,t),1+a;if(a<256)return n.setUint8(r,217),n.setUint8(r+1,a),ho(n,r+2,t),2+a;if(a<65536)return n.setUint8(r,218),n.setUint16(r+1,a),ho(n,r+3,t),3+a;if(a<4294967296)return n.setUint8(r,219),n.setUint32(r+1,a),ho(n,r+5,t),5+a}if(ArrayBuffer.isView&&ArrayBuffer.isView(t)&&(t=t.buffer),t instanceof ArrayBuffer){var s=t.byteLength;if(s<256)return n.setUint8(r,196),n.setUint8(r+1,s),new Uint8Array(n.buffer).set(new Uint8Array(t),r+2),2+s;if(s<65536)return n.setUint8(r,197),n.setUint16(r+1,s),new Uint8Array(n.buffer).set(new Uint8Array(t),r+3),3+s;if(s<4294967296)return n.setUint8(r,198),n.setUint32(r+1,s),new Uint8Array(n.buffer).set(new Uint8Array(t),r+5),5+s}if("number"==typeof t){if(Math.floor(t)!==t)return n.setUint8(r,203),n.setFloat64(r+1,t),9;if(t>=0){if(t<128)return n.setUint8(r,t),1;if(t<256)return n.setUint8(r,204),n.setUint8(r+1,t),2;if(t<65536)return n.setUint8(r,205),n.setUint16(r+1,t),3;if(t<4294967296)return n.setUint8(r,206),n.setUint32(r+1,t),5;if(t<0x10000000000000000)return n.setUint8(r,207),function(e,t,n){n<0x10000000000000000?(e.setUint32(t,Math.floor(2.3283064365386963e-10*n)),e.setInt32(t+4,-1&n)):(e.setUint32(t,4294967295),e.setUint32(t+4,4294967295))}(n,r+1,t),9;throw new Error("Number too big 0x"+t.toString(16))}if(t>=-32)return n.setInt8(r,t),1;if(t>=-128)return n.setUint8(r,208),n.setInt8(r+1,t),2;if(t>=-32768)return n.setUint8(r,209),n.setInt16(r+1,t),3;if(t>=-2147483648)return n.setUint8(r,210),n.setInt32(r+1,t),5;if(t>=-0x8000000000000000)return n.setUint8(r,211),function(e,t,n){n<0x8000000000000000?(e.setInt32(t,Math.floor(2.3283064365386963e-10*n)),e.setInt32(t+4,-1&n)):(e.setUint32(t,2147483647),e.setUint32(t+4,2147483647))}(n,r+1,t),9;throw new Error("Number too small -0x"+(-t).toString(16).substr(1))}if("undefined"===i)return o?0:(n.setUint8(r,212),n.setUint8(r+1,0),n.setUint8(r+2,0),3);if(null===t)return o?0:(n.setUint8(r,192),1);if("boolean"===i)return n.setUint8(r,t?195:194),1;if("function"==typeof t.toJSON)return e(t.toJSON(),n,r,o);if("object"===i){var c,u,l=0,f=Array.isArray(t);if(f?c=t.length:(u=go(t,o),c=u.length),c<16?(n.setUint8(r,c|(f?144:128)),l=1):c<65536?(n.setUint8(r,f?220:222),n.setUint16(r+1,c),l=3):c<4294967296&&(n.setUint8(r,f?221:223),n.setUint32(r+1,c),l=5),f)for(var h=0;h<c;h++)l+=e(t[h],n,r+l,o);else if(u)for(var p=0;p<c;p++){var d=u[p];l+=e(d,n,r+l),l+=e(t[d],n,r+l,o)}return l}if("function"===i)return 0;throw new Error("Unknown type "+i)}(e,new DataView(r),0,t),r}},decode:function(e){var t=new DataView(e),n=new yo(t),r=n.parse();if(n.offset!==e.byteLength)throw new Error(e.byteLength-n.offset+" trailing bytes");return r},inspect:function(e){if(void 0===e)return"undefined";var t,n;if(e instanceof ArrayBuffer?(n="ArrayBuffer",t=new DataView(e)):e instanceof DataView&&(n="DataView",t=e),!t)return JSON.stringify(e);for(var r=[],o=0;o<e.byteLength;o++){if(o>20){r.push("...");break}var i=t.getUint8(o).toString(16);1===i.length&&(i="0"+i),r.push(i)}return"<"+n+" "+r.join(" ")+">"},utf8Write:ho,utf8Read:po,utf8ByteCount:vo};function bo(e,t){if(function(e,t){return!!t.get("x-ably-errorcode")}(0,t))return e.error&&N.fromValues(e.error)}function wo(e){var t={};return e.forEach((function(e,n){t[n]=e})),t}function ko(){return(ko=a(o().mark((function e(t,n,r,i,s,c){var u,l,f,h,p,d,v;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=new Headers(i||{}),l=t?t.toUpperCase():W(c)?"GET":"POST",f=new AbortController,p=new Promise((function(e){h=setTimeout((function(){f.abort(),e({error:new D("Request timed out",null,408)})}),n?n.options.timeouts.httpRequestTimeout:qe.TIMEOUTS.httpRequestTimeout)})),d={method:l,headers:u,body:c,signal:f.signal},T.Config.isWebworker||(d.credentials=u.has("authorization")?"include":"same-origin"),v=a(o().mark((function e(){var t,n,i,a,c,u,l,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(t=new URLSearchParams(s||{})).set("rnd",pe()),n=r+"?"+t,e.next=6,Oe().fetch(n,d);case 6:if(i=e.sent,clearTimeout(h),204!=i.status){e.next=10;break}return e.abrupt("return",{error:null,statusCode:i.status});case 10:if(!((a=i.headers.get("Content-Type"))&&a.indexOf("application/x-msgpack")>-1)){e.next=17;break}return e.next=14,i.arrayBuffer();case 14:c=e.sent,e.next=26;break;case 17:if(!(a&&a.indexOf("application/json")>-1)){e.next=23;break}return e.next=20,i.json();case 20:c=e.sent,e.next=26;break;case 23:return e.next=25,i.text();case 25:c=e.sent;case 26:if(u=!!a&&-1===a.indexOf("application/x-msgpack"),l=wo(i.headers),i.ok){e.next=33;break}return f=bo(c,i.headers)||new D("Error response received from server: "+i.status+" body was: "+T.Config.inspect(c),null,i.status),e.abrupt("return",{error:f,body:c,headers:l,unpacked:u,statusCode:i.status});case 33:return e.abrupt("return",{error:null,body:c,headers:l,unpacked:u,statusCode:i.status});case 34:e.next=40;break;case 36:return e.prev=36,e.t0=e.catch(0),clearTimeout(h),e.abrupt("return",{error:e.t0});case 40:case"end":return e.stop()}}),e,null,[[0,36]])})))(),e.abrupt("return",Promise.race([p,v]));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _o,Eo={XHRRequest:co,FetchRequest:function(e,t,n,r,o,i){return ko.apply(this,arguments)}},Oo=function(e,t){var n=g((function e(t,n,r,o){b(this,e),this.algorithm=t,this.keyLength=n,this.mode=r,this.key=o})),r=function(){function r(){b(this,r)}var s;return g(r,null,[{key:"getDefaultParams",value:function(e){var r;if(!e.key)throw new Error("Crypto.getDefaultParams: a key is required");r="string"==typeof e.key?t.toArrayBuffer(t.base64Decode(e.key.replace("_","/").replace("-","+"))):e.key instanceof ArrayBuffer?e.key:t.toArrayBuffer(e.key);var o=e.algorithm||"aes",i=8*r.byteLength,a=e.mode||"cbc",s=new n(o,i,a,r);if(e.keyLength&&e.keyLength!==s.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+e.keyLength+" was specified, but the key actually has length "+s.keyLength);return function(e){if("aes"===e.algorithm&&"cbc"===e.mode){if(128===e.keyLength||256===e.keyLength)return;throw new Error("Unsupported key length "+e.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}(s),s}},{key:"generateRandomKey",value:(s=a(o().mark((function t(n){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.abrupt("return",e.getRandomArrayBuffer((n||256)/8));case 4:throw t.prev=4,t.t0=t.catch(0),new N("Failed to generate random key: "+t.t0.message,400,5e4,t.t0);case 7:case"end":return t.stop()}}),t,null,[[0,4]])}))),function(e){return s.apply(this,arguments)})},{key:"getCipher",value:function(e,t){var r,o=function(e){return e instanceof n}(e)?e:this.getDefaultParams(e);return{cipherParams:o,cipher:new i(o,null!=(r=e.iv)?r:null,t)}}}]),r}();r.CipherParams=n;var i=function(){function n(e,r,o){if(b(this,n),this.logger=o,!crypto.subtle)throw isSecureContext?new Error("Crypto operations are not possible since the browser’s SubtleCrypto class is unavailable (reason unknown)."):new Error("Crypto operations are is not possible since the current environment is a non-secure context and hence the browser’s SubtleCrypto class is not available.");this.algorithm=e.algorithm+"-"+String(e.keyLength)+"-"+e.mode,this.webCryptoAlgorithm=e.algorithm+"-"+e.mode,this.key=t.toArrayBuffer(e.key),this.iv=r?t.toArrayBuffer(r):null}var r,i,s;return g(n,[{key:"concat",value:function(e,n){for(var r=new ArrayBuffer(e.byteLength+n.byteLength),o=new DataView(r),i=new DataView(t.toArrayBuffer(e)),a=0;a<i.byteLength;a++)o.setInt8(a,i.getInt8(a));for(var s=new DataView(t.toArrayBuffer(n)),c=0;c<s.byteLength;c++)o.setInt8(i.byteLength+c,s.getInt8(c));return r}},{key:"encrypt",value:(s=a(o().mark((function e(t){var n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return L.logAction(this.logger,L.LOG_MICRO,"CBCCipher.encrypt()",""),e.next=3,this.getIv();case 3:return n=e.sent,e.next=6,crypto.subtle.importKey("raw",this.key,this.webCryptoAlgorithm,!1,["encrypt"]);case 6:return r=e.sent,e.next=9,crypto.subtle.encrypt({name:this.webCryptoAlgorithm,iv:n},r,t);case 9:return i=e.sent,e.abrupt("return",this.concat(n,i));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"decrypt",value:(i=a(o().mark((function e(n){var r,i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return L.logAction(this.logger,L.LOG_MICRO,"CBCCipher.decrypt()",""),r=t.toArrayBuffer(n),i=r.slice(0,16),a=r.slice(16),e.next=6,crypto.subtle.importKey("raw",this.key,this.webCryptoAlgorithm,!1,["decrypt"]);case 6:return s=e.sent,e.abrupt("return",crypto.subtle.decrypt({name:this.webCryptoAlgorithm,iv:i},s,a));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getIv",value:(r=a(o().mark((function n(){var r,i;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.iv){n.next=4;break}return r=this.iv,this.iv=null,n.abrupt("return",r);case 4:return n.next=6,e.getRandomArrayBuffer(16);case 6:return i=n.sent,n.abrupt("return",t.toArrayBuffer(i));case 8:case"end":return n.stop()}}),n,this)}))),function(){return r.apply(this,arguments)})}]),n}();return r}(to,qr);T.Crypto=Oo,T.BufferUtils=qr,T.Http=Jr,T.Config=to,T.Transports=lo,T.WebStorage=Yr;for(var So=0,xo=[On,Sr];So<xo.length;So++){var Co=xo[So];Co.Crypto=Oo,Co._MsgPack=mo}Jr.bundledRequestImplementations=Eo,L.initLogHandlers(),T.Defaults=(_o=fo,Object.assign(Re,_o)),T.Config.agent&&(T.Defaults.agent+=" "+T.Config.agent);var Ao={ErrorInfo:N,Rest:On,Realtime:Sr,msgpack:mo};return"object"==E(i.exports)&&"object"==E(n)&&(i.exports=function(e,t,n,r){if(t&&"object"===E(t)||"function"==typeof t){var o,i=w(Object.getOwnPropertyNames(t));try{var a=function(){var i=o.value;Object.prototype.hasOwnProperty.call(e,i)||i===n||Object.defineProperty(e,i,{get:function(){return t[i]},enumerable:!(r=Object.getOwnPropertyDescriptor(t,i))||r.enumerable})};for(i.s();!(o=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}return e}(i.exports,n)),i.exports},"object"==(void 0===n?"undefined":E(n))&&"object"==(void 0===t?"undefined":E(t))?t.exports=O():"function"==typeof define&&define.amd?define([],O):"object"==(void 0===n?"undefined":E(n))?n.Ably=O():(void 0).Ably=O()}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.all=n.VERSION=n.HttpStatusCode=n.CanceledError=n.CancelToken=n.Cancel=n.AxiosHeaders=n.AxiosError=n.Axios=void 0,Object.defineProperty(n,"default",{enumerable:!0,get:function(){return o.default}}),n.toFormData=n.spread=n.mergeConfig=n.isCancel=n.isAxiosError=n.getAdapter=n.formToJSON=void 0;var r,o=(r=e("./lib/axios.js"))&&r.__esModule?r:{default:r};n.Axios=o.default.Axios,n.AxiosError=o.default.AxiosError,n.CanceledError=o.default.CanceledError,n.isCancel=o.default.isCancel,n.CancelToken=o.default.CancelToken,n.VERSION=o.default.VERSION,n.all=o.default.all,n.Cancel=o.default.Cancel,n.isAxiosError=o.default.isAxiosError,n.spread=o.default.spread,n.toFormData=o.default.toFormData,n.AxiosHeaders=o.default.AxiosHeaders,n.HttpStatusCode=o.default.HttpStatusCode,n.formToJSON=o.default.formToJSON,n.getAdapter=o.default.getAdapter,n.mergeConfig=o.default.mergeConfig},{"./lib/axios.js":52}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=c(e("../utils.js")),o=c(e("./http.js")),i=c(e("./xhr.js")),a=c(e("./fetch.js")),s=c(e("../core/AxiosError.js"));function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var f={http:o.default,xhr:i.default,fetch:a.default};r.default.forEach(f,(function(e,t){if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));var h=function(e){return"- ".concat(e)},p=function(e){return r.default.isFunction(e)||null===e||!1===e};n.default={getAdapter:function(e){for(var t,n,o=(e=r.default.isArray(e)?e:[e]).length,i={},a=0;a<o;a++){var c=void 0;if(n=t=e[a],!p(t)&&void 0===(n=f[(c=String(t)).toLowerCase()]))throw new s.default("Unknown adapter '".concat(c,"'"));if(n)break;i[c||"#"+a]=n}if(!n){var l=Object.entries(i).map((function(e){var t=u(e,2),n=t[0],r=t[1];return"adapter ".concat(n," ")+(!1===r?"is not supported by the environment":"is not available in the build")})),d=o?l.length>1?"since :\n"+l.map(h).join("\n"):" "+h(l[0]):"as no adapter specified";throw new s.default("There is no suitable adapter to dispatch the request "+d,"ERR_NOT_SUPPORT")}return n},adapters:f}},{"../core/AxiosError.js":57,"../utils.js":97,"./fetch.js":50,"./http.js":79,"./xhr.js":51}],50:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=p(e("../platform/index.js")),i=p(e("../utils.js")),a=p(e("../core/AxiosError.js")),s=p(e("../helpers/composeSignals.js")),c=e("../helpers/trackStream.js"),u=p(e("../core/AxiosHeaders.js")),l=e("../helpers/progressEventReducer.js"),f=p(e("../helpers/resolveConfig.js")),h=p(e("../core/settle.js"));function p(e){return e&&e.__esModule?e:{default:e}}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function b(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */b=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),s=new I(r||[]);return i(a,"_invoke",{value:C(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var p="suspendedStart",d="executing",v="completed",y={};function g(){}function m(){}function w(){}var k={};l(k,s,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==n&&o.call(E,s)&&(k=E);var O=w.prototype=g.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(i,a,s,c){var u=h(e[i],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==r(f)&&o.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}})}function C(t,n,r){var o=p;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=h(t,n,r);if("normal"===u.type){if(o=r.done?v:"suspendedYield",u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=v,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=h(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){for(;++i<t.length;)if(o.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(r(t)+" is not iterable")}return m.prototype=w,i(O,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:m,configurable:!0}),m.displayName=l(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),l(x.prototype,c,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(f(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),l(O,u,"Generator"),l(O,s,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}function w(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function k(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){w(i,r,o,a,s,"next",e)}function s(e){w(i,r,o,a,s,"throw",e)}a(void 0)}))}}var _,E,O="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,S=O&&"function"==typeof ReadableStream,x=O&&("function"==typeof TextEncoder?(_=new TextEncoder,function(e){return _.encode(e)}):function(){var e=k(b().mark((function e(t){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Uint8Array,e.next=3,new Response(t).arrayBuffer();case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),C=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e.apply(void 0,n)}catch(e){return!1}},A=S&&C((function(){var e=!1,t=new Request(o.default.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),T=S&&C((function(){return i.default.isReadableStream(new Response("").body)})),P={stream:T&&function(e){return e.body}};O&&(E=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((function(e){!P[e]&&(P[e]=i.default.isFunction(E[e])?function(t){return t[e]()}:function(t,n){throw new a.default("Response type '".concat(e,"' is not supported"),a.default.ERR_NOT_SUPPORT,n)})})));var I=function(){var e=k(b().mark((function e(t){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return",0);case 2:if(!i.default.isBlob(t)){e.next=4;break}return e.abrupt("return",t.size);case 4:if(!i.default.isSpecCompliantForm(t)){e.next=8;break}return e.next=7,new Request(t).arrayBuffer();case 7:return e.abrupt("return",e.sent.byteLength);case 8:if(!i.default.isArrayBufferView(t)&&!i.default.isArrayBuffer(t)){e.next=10;break}return e.abrupt("return",t.byteLength);case 10:if(i.default.isURLSearchParams(t)&&(t+=""),!i.default.isString(t)){e.next=15;break}return e.next=14,x(t);case 14:return e.abrupt("return",e.sent.byteLength);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=k(b().mark((function e(t,n){var r;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.default.toFiniteNumber(t.getContentLength()),e.abrupt("return",null==r?I(n):r);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();n.default=O&&function(){var e=k(b().mark((function e(t){var n,r,o,p,d,y,m,w,k,_,E,O,S,C,I,R,L,M,U,N,D,G,B,F,q,H,W,V,z,J,K,Q,Y,X,$,Z,ee;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(0,f.default)(t),r=n.url,o=n.method,p=n.data,d=n.signal,y=n.cancelToken,m=n.timeout,w=n.onDownloadProgress,k=n.onUploadProgress,_=n.responseType,E=n.headers,O=n.withCredentials,S=void 0===O?"same-origin":O,C=n.fetchOptions,_=_?(_+"").toLowerCase():"text",I=d||y||m?(0,s.default)([d,y],m):[],R=g(I,2),L=R[0],M=R[1],D=function(){!U&&setTimeout((function(){L&&L.unsubscribe()})),U=!0},e.prev=4,e.t0=k&&A&&"get"!==o&&"head"!==o,!e.t0){e.next=11;break}return e.next=9,j(E,p);case 9:e.t1=G=e.sent,e.t0=0!==e.t1;case 11:if(!e.t0){e.next=15;break}B=new Request(r,{method:"POST",body:p,duplex:"half"}),i.default.isFormData(p)&&(F=B.headers.get("content-type"))&&E.setContentType(F),B.body&&(q=(0,l.progressEventDecorator)(G,(0,l.progressEventReducer)((0,l.asyncDecorator)(k))),H=g(q,2),W=H[0],V=H[1],p=(0,c.trackStream)(B.body,65536,W,V,x));case 15:return i.default.isString(S)||(S=S?"include":"omit"),N=new Request(r,v(v({},C),{},{signal:L,method:o.toUpperCase(),headers:E.normalize().toJSON(),body:p,duplex:"half",credentials:S})),e.next=19,fetch(N);case 19:return z=e.sent,J=T&&("stream"===_||"response"===_),T&&(w||J)&&(K={},["status","statusText","headers"].forEach((function(e){K[e]=z[e]})),Q=i.default.toFiniteNumber(z.headers.get("content-length")),Y=w&&(0,l.progressEventDecorator)(Q,(0,l.progressEventReducer)((0,l.asyncDecorator)(w),!0))||[],X=g(Y,2),$=X[0],Z=X[1],z=new Response((0,c.trackStream)(z.body,65536,$,(function(){Z&&Z(),J&&D()}),x),K)),_=_||"text",e.next=25,P[i.default.findKey(P,_)||"text"](z,t);case 25:return ee=e.sent,!J&&D(),M&&M(),e.next=30,new Promise((function(e,n){(0,h.default)(e,n,{data:ee,headers:u.default.from(z.headers),status:z.status,statusText:z.statusText,config:t,request:N})}));case 30:return e.abrupt("return",e.sent);case 33:if(e.prev=33,e.t2=e.catch(4),D(),!e.t2||"TypeError"!==e.t2.name||!/fetch/i.test(e.t2.message)){e.next=38;break}throw Object.assign(new a.default("Network Error",a.default.ERR_NETWORK,t,N),{cause:e.t2.cause||e.t2});case 38:throw a.default.from(e.t2,e.t2&&e.t2.code,t,N);case 39:case"end":return e.stop()}}),e,null,[[4,33]])})));return function(t){return e.apply(this,arguments)}}()},{"../core/AxiosError.js":57,"../core/AxiosHeaders.js":58,"../core/settle.js":63,"../helpers/composeSignals.js":73,"../helpers/progressEventReducer.js":82,"../helpers/resolveConfig.js":83,"../helpers/trackStream.js":89,"../platform/index.js":96,"../utils.js":97}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=p(e("./../utils.js")),o=p(e("./../core/settle.js")),i=p(e("../defaults/transitional.js")),a=p(e("../core/AxiosError.js")),s=p(e("../cancel/CanceledError.js")),c=p(e("../helpers/parseProtocol.js")),u=p(e("../platform/index.js")),l=p(e("../core/AxiosHeaders.js")),f=e("../helpers/progressEventReducer.js"),h=p(e("../helpers/resolveConfig.js"));function p(e){return e&&e.__esModule?e:{default:e}}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var y="undefined"!=typeof XMLHttpRequest;n.default=y&&function(e){return new Promise((function(t,n){var p,v,y,g,m,b=(0,h.default)(e),w=b.data,k=l.default.from(b.headers).normalize(),_=b.responseType,E=b.onUploadProgress,O=b.onDownloadProgress;function S(){g&&g(),m&&m(),b.cancelToken&&b.cancelToken.unsubscribe(p),b.signal&&b.signal.removeEventListener("abort",p)}var x=new XMLHttpRequest;function C(){if(x){var r=l.default.from("getAllResponseHeaders"in x&&x.getAllResponseHeaders()),i={data:_&&"text"!==_&&"json"!==_?x.response:x.responseText,status:x.status,statusText:x.statusText,headers:r,config:e,request:x};(0,o.default)((function(e){t(e),S()}),(function(e){n(e),S()}),i),x=null}}if(x.open(b.method.toUpperCase(),b.url,!0),x.timeout=b.timeout,"onloadend"in x?x.onloadend=C:x.onreadystatechange=function(){x&&4===x.readyState&&(0!==x.status||x.responseURL&&0===x.responseURL.indexOf("file:"))&&setTimeout(C)},x.onabort=function(){x&&(n(new a.default("Request aborted",a.default.ECONNABORTED,e,x)),x=null)},x.onerror=function(){n(new a.default("Network Error",a.default.ERR_NETWORK,e,x)),x=null},x.ontimeout=function(){var t=b.timeout?"timeout of "+b.timeout+"ms exceeded":"timeout exceeded",r=b.transitional||i.default;b.timeoutErrorMessage&&(t=b.timeoutErrorMessage),n(new a.default(t,r.clarifyTimeoutError?a.default.ETIMEDOUT:a.default.ECONNABORTED,e,x)),x=null},void 0===w&&k.setContentType(null),"setRequestHeader"in x&&r.default.forEach(k.toJSON(),(function(e,t){x.setRequestHeader(t,e)})),r.default.isUndefined(b.withCredentials)||(x.withCredentials=!!b.withCredentials),_&&"json"!==_&&(x.responseType=b.responseType),O){var A=d((0,f.progressEventReducer)(O,!0),2);y=A[0],m=A[1],x.addEventListener("progress",y)}if(E&&x.upload){var T=d((0,f.progressEventReducer)(E),2);v=T[0],g=T[1],x.upload.addEventListener("progress",v),x.upload.addEventListener("loadend",g)}(b.cancelToken||b.signal)&&(p=function(t){x&&(n(!t||t.type?new s.default(null,e,x):t),x.abort(),x=null)},b.cancelToken&&b.cancelToken.subscribe(p),b.signal&&(b.signal.aborted?p():b.signal.addEventListener("abort",p)));var P=(0,c.default)(b.url);P&&-1===u.default.protocols.indexOf(P)?n(new a.default("Unsupported protocol "+P+":",a.default.ERR_BAD_REQUEST,e)):x.send(w||null)}))}},{"../cancel/CanceledError.js":54,"../core/AxiosError.js":57,"../core/AxiosHeaders.js":58,"../defaults/transitional.js":66,"../helpers/parseProtocol.js":81,"../helpers/progressEventReducer.js":82,"../helpers/resolveConfig.js":83,"../platform/index.js":96,"./../core/settle.js":63,"./../utils.js":97}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=w(e("./utils.js")),o=w(e("./helpers/bind.js")),i=w(e("./core/Axios.js")),a=w(e("./core/mergeConfig.js")),s=w(e("./defaults/index.js")),c=w(e("./helpers/formDataToJSON.js")),u=w(e("./cancel/CanceledError.js")),l=w(e("./cancel/CancelToken.js")),f=w(e("./cancel/isCancel.js")),h=e("./env/data.js"),p=w(e("./helpers/toFormData.js")),d=w(e("./core/AxiosError.js")),v=w(e("./helpers/spread.js")),y=w(e("./helpers/isAxiosError.js")),g=w(e("./core/AxiosHeaders.js")),m=w(e("./adapters/adapters.js")),b=w(e("./helpers/HttpStatusCode.js"));function w(e){return e&&e.__esModule?e:{default:e}}var k=function e(t){var n=new i.default(t),s=(0,o.default)(i.default.prototype.request,n);return r.default.extend(s,i.default.prototype,n,{allOwnKeys:!0}),r.default.extend(s,n,null,{allOwnKeys:!0}),s.create=function(n){return e((0,a.default)(t,n))},s}(s.default);k.Axios=i.default,k.CanceledError=u.default,k.CancelToken=l.default,k.isCancel=f.default,k.VERSION=h.VERSION,k.toFormData=p.default,k.AxiosError=d.default,k.Cancel=k.CanceledError,k.all=function(e){return Promise.all(e)},k.spread=v.default,k.isAxiosError=y.default,k.mergeConfig=a.default,k.AxiosHeaders=g.default,k.formToJSON=function(e){return(0,c.default)(r.default.isHTMLForm(e)?new FormData(e):e)},k.getAdapter=m.default.getAdapter,k.HttpStatusCode=b.default,k.default=k;n.default=k},{"./adapters/adapters.js":49,"./cancel/CancelToken.js":53,"./cancel/CanceledError.js":54,"./cancel/isCancel.js":55,"./core/Axios.js":56,"./core/AxiosError.js":57,"./core/AxiosHeaders.js":58,"./core/mergeConfig.js":62,"./defaults/index.js":65,"./env/data.js":67,"./helpers/HttpStatusCode.js":69,"./helpers/bind.js":70,"./helpers/formDataToJSON.js":75,"./helpers/isAxiosError.js":77,"./helpers/spread.js":85,"./helpers/toFormData.js":87,"./utils.js":97}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,o=(r=e("./CanceledError.js"))&&r.__esModule?r:{default:r};function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}var c=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"function"!=typeof t)throw new TypeError("executor must be a function.");var n;this.promise=new Promise((function(e){n=e}));var r=this;this.promise.then((function(e){if(r._listeners){for(var t=r._listeners.length;t-- >0;)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},t((function(e,t,i){r.reason||(r.reason=new o.default(e,t,i),n(r.reason))}))}return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"throwIfRequested",value:function(){if(this.reason)throw this.reason}},{key:"subscribe",value:function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}},{key:"unsubscribe",value:function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}}}],[{key:"source",value:function(){var t;return{token:new e((function(e){t=e})),cancel:t}}}]),e}();n.default=c},{"./CanceledError.js":54}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(e("../core/AxiosError.js"));function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){r.default.call(this,null==e?"canceled":e,r.default.ERR_CANCELED,t,n),this.name="CanceledError"}o(e("../utils.js")).default.inherits(i,r.default,{__CANCEL__:!0});n.default=i},{"../core/AxiosError.js":57,"../utils.js":97}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return!(!e||!e.__CANCEL__)}},{}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=f(e("./../utils.js")),o=f(e("../helpers/buildURL.js")),i=f(e("./InterceptorManager.js")),a=f(e("./dispatchRequest.js")),s=f(e("./mergeConfig.js")),c=f(e("./buildFullPath.js")),u=f(e("../helpers/validator.js")),l=f(e("./AxiosHeaders.js"));function f(e){return e&&e.__esModule?e:{default:e}}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */p=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),s=new I(r||[]);return o(a,"_invoke",{value:C(e,n,s)}),a}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",v="executing",y="completed",g={};function m(){}function b(){}function w(){}var k={};u(k,a,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==n&&r.call(E,a)&&(k=E);var O=w.prototype=m.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,i,a,s){var c=f(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==h(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function C(t,n,r){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var u=f(t,n,r);if("normal"===u.type){if(o=r.done?y:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(h(t)+" is not iterable")}return b.prototype=w,o(O,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:b,configurable:!0}),b.displayName=u(w,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,c,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),u(x.prototype,s,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(l(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),u(O,c,"Generator"),u(O,a,(function(){return this})),u(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function d(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,y(r.key),r)}}function y(e){var t=function(e,t){if("object"!=h(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==h(t)?t:t+""}var g=u.default.validators,m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaults=t,this.interceptors={request:new i.default,response:new i.default}}var t,n;return function(e,t,n){t&&v(e.prototype,t),n&&v(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"request",value:(t=p().mark((function e(t,n){var r,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._request(t,n);case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),e.t0 instanceof Error){Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error,o=r.stack?r.stack.replace(/^.+\n/,""):"";try{e.t0.stack?o&&!String(e.t0.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(e.t0.stack+="\n"+o):e.t0.stack=o}catch(e){}}throw e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])})),n=function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(e){d(i,r,o,a,s,"next",e)}function s(e){d(i,r,o,a,s,"throw",e)}a(void 0)}))},function(e,t){return n.apply(this,arguments)})},{key:"_request",value:function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{};var n=t=(0,s.default)(this.defaults,t),o=n.transitional,i=n.paramsSerializer,c=n.headers;void 0!==o&&u.default.assertOptions(o,{silentJSONParsing:g.transitional(g.boolean),forcedJSONParsing:g.transitional(g.boolean),clarifyTimeoutError:g.transitional(g.boolean)},!1),null!=i&&(r.default.isFunction(i)?t.paramsSerializer={serialize:i}:u.default.assertOptions(i,{encode:g.function,serialize:g.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();var f=c&&r.default.merge(c.common,c[t.method]);c&&r.default.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete c[e]})),t.headers=l.default.concat(f,c);var h=[],p=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(p=p&&e.synchronous,h.unshift(e.fulfilled,e.rejected))}));var d,v=[];this.interceptors.response.forEach((function(e){v.push(e.fulfilled,e.rejected)}));var y,m=0;if(!p){var b=[a.default.bind(this),void 0];for(b.unshift.apply(b,h),b.push.apply(b,v),y=b.length,d=Promise.resolve(t);m<y;)d=d.then(b[m++],b[m++]);return d}y=h.length;var w=t;for(m=0;m<y;){var k=h[m++],_=h[m++];try{w=k(w)}catch(e){_.call(this,e);break}}try{d=a.default.call(this,w)}catch(e){return Promise.reject(e)}for(m=0,y=v.length;m<y;)d=d.then(v[m++],v[m++]);return d}},{key:"getUri",value:function(e){e=(0,s.default)(this.defaults,e);var t=(0,c.default)(e.baseURL,e.url);return(0,o.default)(t,e.params,e.paramsSerializer)}}]),e}();r.default.forEach(["delete","get","head","options"],(function(e){m.prototype[e]=function(t,n){return this.request((0,s.default)(n||{},{method:e,url:t,data:(n||{}).data}))}})),r.default.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,o){return this.request((0,s.default)(o||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}m.prototype[e]=t(),m.prototype[e+"Form"]=t(!0)}));n.default=m},{"../helpers/buildURL.js":71,"../helpers/validator.js":90,"./../utils.js":97,"./AxiosHeaders.js":58,"./InterceptorManager.js":59,"./buildFullPath.js":60,"./dispatchRequest.js":61,"./mergeConfig.js":62}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,o=(r=e("../utils.js"))&&r.__esModule?r:{default:r};function i(e,t,n,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),o&&(this.response=o)}o.default.inherits(i,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:o.default.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var a=i.prototype,s={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((function(e){s[e]={value:e}})),Object.defineProperties(i,s),Object.defineProperty(a,"isAxiosError",{value:!0}),i.from=function(e,t,n,r,s,c){var u=Object.create(a);return o.default.toFlatObject(e,u,(function(e){return e!==Error.prototype}),(function(e){return"isAxiosError"!==e})),i.call(u,e.message,t,n,r,s),u.cause=e,u.name=e.name,c&&Object.assign(u,c),u};n.default=i},{"../utils.js":97}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e("../utils.js")),o=i(e("../helpers/parseHeaders.js"));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||c(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return u(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}function f(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}var h=Symbol("internals");function p(e){return e&&String(e).trim().toLowerCase()}function d(e){return!1===e||null==e?e:r.default.isArray(e)?e.map(d):String(e)}function v(e,t,n,o,i){return r.default.isFunction(o)?o.call(this,t,n):(i&&(t=n),r.default.isString(t)?r.default.isString(o)?-1!==t.indexOf(o):r.default.isRegExp(o)?o.test(t):void 0:void 0)}var y=function(e,t){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),e&&this.set(e)}var i,a,u;return i=n,a=[{key:"set",value:function(e,t,n){var i=this;function a(e,t,n){var o=p(t);if(!o)throw new Error("header name must be a non-empty string");var a=r.default.findKey(i,o);(!a||void 0===i[a]||!0===n||void 0===n&&!1!==i[a])&&(i[a||t]=d(e))}var u=function(e,t){return r.default.forEach(e,(function(e,n){return a(e,n,t)}))};if(r.default.isPlainObject(e)||e instanceof this.constructor)u(e,t);else if(r.default.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))u((0,o.default)(e),t);else if(r.default.isHeaders(e)){var l,f=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=c(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(e.entries());try{for(f.s();!(l=f.n()).done;){var h=s(l.value,2),v=h[0];a(h[1],v,n)}}catch(e){f.e(e)}finally{f.f()}}else null!=e&&a(t,e,n);return this}},{key:"get",value:function(e,t){if(e=p(e)){var n=r.default.findKey(this,e);if(n){var o=this[n];if(!t)return o;if(!0===t)return function(e){for(var t,n=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;t=r.exec(e);)n[t[1]]=t[2];return n}(o);if(r.default.isFunction(t))return t.call(this,o,n);if(r.default.isRegExp(t))return t.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}},{key:"has",value:function(e,t){if(e=p(e)){var n=r.default.findKey(this,e);return!(!n||void 0===this[n]||t&&!v(0,this[n],n,t))}return!1}},{key:"delete",value:function(e,t){var n=this,o=!1;function i(e){if(e=p(e)){var i=r.default.findKey(n,e);!i||t&&!v(0,n[i],i,t)||(delete n[i],o=!0)}}return r.default.isArray(e)?e.forEach(i):i(e),o}},{key:"clear",value:function(e){for(var t=Object.keys(this),n=t.length,r=!1;n--;){var o=t[n];e&&!v(0,this[o],o,e,!0)||(delete this[o],r=!0)}return r}},{key:"normalize",value:function(e){var t=this,n={};return r.default.forEach(this,(function(o,i){var a=r.default.findKey(n,i);if(a)return t[a]=d(o),void delete t[i];var s=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n}))}(i):String(i).trim();s!==i&&delete t[i],t[s]=d(o),n[s]=!0})),this}},{key:"concat",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this.constructor).concat.apply(e,[this].concat(n))}},{key:"toJSON",value:function(e){var t=Object.create(null);return r.default.forEach(this,(function(n,o){null!=n&&!1!==n&&(t[o]=e&&r.default.isArray(n)?n.join(", "):n)})),t}},{key:e,value:function(){return Object.entries(this.toJSON())[Symbol.iterator]()}},{key:"toString",value:function(){return Object.entries(this.toJSON()).map((function(e){var t=s(e,2);return t[0]+": "+t[1]})).join("\n")}},{key:t,get:function(){return"AxiosHeaders"}}],u=[{key:"from",value:function(e){return e instanceof this?e:new this(e)}},{key:"concat",value:function(e){for(var t=new this(e),n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.forEach((function(e){return t.set(e)})),t}},{key:"accessor",value:function(e){var t=(this[h]=this[h]={accessors:{}}).accessors,n=this.prototype;function o(e){var o=p(e);t[o]||(function(e,t){var n=r.default.toCamelCase(" "+t);["get","set","has"].forEach((function(r){Object.defineProperty(e,r+n,{value:function(e,n,o){return this[r].call(this,t,e,n,o)},configurable:!0})}))}(n,e),t[o]=!0)}return r.default.isArray(e)?e.forEach(o):o(e),this}}],a&&l(i.prototype,a),u&&l(i,u),Object.defineProperty(i,"prototype",{writable:!1}),n}(Symbol.iterator,Symbol.toStringTag);y.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),r.default.reduceDescriptors(y.prototype,(function(e,t){var n=e.value,r=t[0].toUpperCase()+t.slice(1);return{get:function(){return n},set:function(e){this[r]=e}}})),r.default.freezeMethods(y);n.default=y},{"../helpers/parseHeaders.js":80,"../utils.js":97}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,o=(r=e("./../utils.js"))&&r.__esModule?r:{default:r};function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.handlers=[]}return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"use",value:function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}},{key:"eject",value:function(e){this.handlers[e]&&(this.handlers[e]=null)}},{key:"clear",value:function(){this.handlers&&(this.handlers=[])}},{key:"forEach",value:function(e){o.default.forEach(this.handlers,(function(t){null!==t&&e(t)}))}}]),e}();n.default=c},{"./../utils.js":97}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){if(e&&!(0,r.default)(t))return(0,o.default)(e,t);return t};var r=i(e("../helpers/isAbsoluteURL.js")),o=i(e("../helpers/combineURLs.js"));function i(e){return e&&e.__esModule?e:{default:e}}},{"../helpers/combineURLs.js":72,"../helpers/isAbsoluteURL.js":76}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){l(e),e.headers=s.default.from(e.headers),e.data=r.default.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return c.default.getAdapter(e.adapter||i.default.adapter)(e).then((function(t){return l(e),t.data=r.default.call(e,e.transformResponse,t),t.headers=s.default.from(t.headers),t}),(function(t){return(0,o.default)(t)||(l(e),t&&t.response&&(t.response.data=r.default.call(e,e.transformResponse,t.response),t.response.headers=s.default.from(t.response.headers))),Promise.reject(t)}))};var r=u(e("./transformData.js")),o=u(e("../cancel/isCancel.js")),i=u(e("../defaults/index.js")),a=u(e("../cancel/CanceledError.js")),s=u(e("../core/AxiosHeaders.js")),c=u(e("../adapters/adapters.js"));function u(e){return e&&e.__esModule?e:{default:e}}function l(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new a.default(null,e)}},{"../adapters/adapters.js":49,"../cancel/CanceledError.js":54,"../cancel/isCancel.js":55,"../core/AxiosHeaders.js":58,"../defaults/index.js":65,"./transformData.js":64}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){t=t||{};var n={};function o(e,t,n){return r.default.isPlainObject(e)&&r.default.isPlainObject(t)?r.default.merge.call({caseless:n},e,t):r.default.isPlainObject(t)?r.default.merge({},t):r.default.isArray(t)?t.slice():t}function i(e,t,n){return r.default.isUndefined(t)?r.default.isUndefined(e)?void 0:o(void 0,e,n):o(e,t,n)}function a(e,t){if(!r.default.isUndefined(t))return o(void 0,t)}function s(e,t){return r.default.isUndefined(t)?r.default.isUndefined(e)?void 0:o(void 0,e):o(void 0,t)}function c(n,r,i){return i in t?o(n,r):i in e?o(void 0,n):void 0}var l={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:c,headers:function(e,t){return i(u(e),u(t),!0)}};return r.default.forEach(Object.keys(Object.assign({},e,t)),(function(o){var a=l[o]||i,s=a(e[o],t[o],o);r.default.isUndefined(s)&&a!==c||(n[o]=s)})),n};var r=i(e("../utils.js")),o=i(e("./AxiosHeaders.js"));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(e){return e instanceof o.default?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e):e}},{"../utils.js":97,"./AxiosHeaders.js":58}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new o.default("Request failed with status code "+n.status,[o.default.ERR_BAD_REQUEST,o.default.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)};var r,o=(r=e("./AxiosError.js"))&&r.__esModule?r:{default:r}},{"./AxiosError.js":57}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){var n=this||o.default,a=t||n,s=i.default.from(a.headers),c=a.data;return r.default.forEach(e,(function(e){c=e.call(n,c,s.normalize(),t?t.status:void 0)})),s.normalize(),c};var r=a(e("./../utils.js")),o=a(e("../defaults/index.js")),i=a(e("../core/AxiosHeaders.js"));function a(e){return e&&e.__esModule?e:{default:e}}},{"../core/AxiosHeaders.js":58,"../defaults/index.js":65,"./../utils.js":97}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=l(e("../utils.js")),o=l(e("../core/AxiosError.js")),i=l(e("./transitional.js")),a=l(e("../helpers/toFormData.js")),s=l(e("../helpers/toURLEncodedForm.js")),c=l(e("../platform/index.js")),u=l(e("../helpers/formDataToJSON.js"));function l(e){return e&&e.__esModule?e:{default:e}}var f={transitional:i.default,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){var n,o=t.getContentType()||"",i=o.indexOf("application/json")>-1,c=r.default.isObject(e);if(c&&r.default.isHTMLForm(e)&&(e=new FormData(e)),r.default.isFormData(e))return i?JSON.stringify((0,u.default)(e)):e;if(r.default.isArrayBuffer(e)||r.default.isBuffer(e)||r.default.isStream(e)||r.default.isFile(e)||r.default.isBlob(e)||r.default.isReadableStream(e))return e;if(r.default.isArrayBufferView(e))return e.buffer;if(r.default.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(c){if(o.indexOf("application/x-www-form-urlencoded")>-1)return(0,s.default)(e,this.formSerializer).toString();if((n=r.default.isFileList(e))||o.indexOf("multipart/form-data")>-1){var l=this.env&&this.env.FormData;return(0,a.default)(n?{"files[]":e}:e,l&&new l,this.formSerializer)}}return c||i?(t.setContentType("application/json",!1),function(e,t,n){if(r.default.isString(e))try{return(t||JSON.parse)(e),r.default.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||f.transitional,n=t&&t.forcedJSONParsing,i="json"===this.responseType;if(r.default.isResponse(e)||r.default.isReadableStream(e))return e;if(e&&r.default.isString(e)&&(n&&!this.responseType||i)){var a=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(e){if(a){if("SyntaxError"===e.name)throw o.default.from(e,o.default.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:c.default.classes.FormData,Blob:c.default.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};r.default.forEach(["delete","get","head","post","put","patch"],(function(e){f.headers[e]={}}));n.default=f},{"../core/AxiosError.js":57,"../helpers/formDataToJSON.js":75,"../helpers/toFormData.js":87,"../helpers/toURLEncodedForm.js":88,"../platform/index.js":96,"../utils.js":97,"./transitional.js":66}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},{}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VERSION=void 0;n.VERSION="1.7.4"},{}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,o=(r=e("./toFormData.js"))&&r.__esModule?r:{default:r};function i(e){var t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function a(e,t){this._pairs=[],e&&(0,o.default)(e,this,t)}var s=a.prototype;s.append=function(e,t){this._pairs.push([e,t])},s.toString=function(e){var t=e?function(t){return e.call(this,t,i)}:i;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};n.default=a},{"./toFormData.js":87}],69:[function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(i).forEach((function(e){var t=r(e,2),n=t[0],o=t[1];i[o]=n}));n.default=i},{}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){return function(){return e.apply(t,arguments)}}},{}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n){if(!t)return e;var i,s=n&&n.encode||a,c=n&&n.serialize;i=c?c(t,n):r.default.isURLSearchParams(t)?t.toString():new o.default(t,n).toString(s);if(i){var u=e.indexOf("#");-1!==u&&(e=e.slice(0,u)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e};var r=i(e("../utils.js")),o=i(e("../helpers/AxiosURLSearchParams.js"));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}},{"../helpers/AxiosURLSearchParams.js":68,"../utils.js":97}],72:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}},{}],73:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e("../cancel/CanceledError.js")),o=i(e("../core/AxiosError.js"));function i(e){return e&&e.__esModule?e:{default:e}}n.default=function(e,t){var n,i=new AbortController,a=function(e){if(!n){n=!0,c();var t=e instanceof Error?e:this.reason;i.abort(t instanceof o.default?t:new r.default(t instanceof Error?t.message:t))}},s=t&&setTimeout((function(){a(new o.default("timeout ".concat(t," of ms exceeded"),o.default.ETIMEDOUT))}),t),c=function(){e&&(s&&clearTimeout(s),s=null,e.forEach((function(e){e&&(e.removeEventListener?e.removeEventListener("abort",a):e.unsubscribe(a))})),e=null)};e.forEach((function(e){return e&&e.addEventListener&&e.addEventListener("abort",a)}));var u=i.signal;return u.unsubscribe=c,[u,function(){s&&clearTimeout(s),s=null}]}},{"../cancel/CanceledError.js":54,"../core/AxiosError.js":57}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e("./../utils.js")),o=i(e("../platform/index.js"));function i(e){return e&&e.__esModule?e:{default:e}}n.default=o.default.hasStandardBrowserEnv?{write:function(e,t,n,o,i,a){var s=[e+"="+encodeURIComponent(t)];r.default.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.default.isString(o)&&s.push("path="+o),r.default.isString(i)&&s.push("domain="+i),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},{"../platform/index.js":96,"./../utils.js":97}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,o=(r=e("../utils.js"))&&r.__esModule?r:{default:r};n.default=function(e){function t(e,n,r,i){var a=e[i++];if("__proto__"===a)return!0;var s=Number.isFinite(+a),c=i>=e.length;return a=!a&&o.default.isArray(r)?r.length:a,c?(o.default.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!s):(r[a]&&o.default.isObject(r[a])||(r[a]=[]),t(e,n,r[a],i)&&o.default.isArray(r[a])&&(r[a]=function(e){var t,n,r={},o=Object.keys(e),i=o.length;for(t=0;t<i;t++)r[n=o[t]]=e[n];return r}(r[a])),!s)}if(o.default.isFormData(e)&&o.default.isFunction(e.entries)){var n={};return o.default.forEachEntry(e,(function(e,r){t(function(e){return o.default.matchAll(/\w+|\[(\w*)]/g,e).map((function(e){return"[]"===e[0]?"":e[1]||e[0]}))}(e),r,n,0)})),n}return null}},{"../utils.js":97}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},{}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return o.default.isObject(e)&&!0===e.isAxiosError};var r,o=(r=e("./../utils.js"))&&r.__esModule?r:{default:r}},{"./../utils.js":97}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e("./../utils.js")),o=i(e("../platform/index.js"));function i(e){return e&&e.__esModule?e:{default:e}}n.default=o.default.hasStandardBrowserEnv?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function o(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=o(window.location.href),function(t){var n=r.default.isString(t)?o(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},{"../platform/index.js":96,"./../utils.js":97}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=null},{}],80:[function(e,t,n){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=((r=e("./../utils.js"))&&r.__esModule?r:{default:r}).default.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);n.default=function(e){var t,n,r,i={};return e&&e.split("\n").forEach((function(e){r=e.indexOf(":"),t=e.substring(0,r).trim().toLowerCase(),n=e.substring(r+1).trim(),!t||i[t]&&o[t]||("set-cookie"===t?i[t]?i[t].push(n):i[t]=[n]:i[t]=i[t]?i[t]+", "+n:n)})),i}},{"./../utils.js":97}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}},{}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.progressEventReducer=n.progressEventDecorator=n.asyncDecorator=void 0;var r=a(e("./speedometer.js")),o=a(e("./throttle.js")),i=a(e("../utils.js"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.progressEventReducer=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i=0,a=(0,r.default)(50,250);return(0,o.default)((function(n){var r=n.loaded,o=n.lengthComputable?n.total:void 0,s=r-i,u=a(s);i=r;var l=c({loaded:r,total:o,progress:o?r/o:void 0,bytes:s,rate:u||void 0,estimated:u&&o&&r<=o?(o-r)/u:void 0,event:n,lengthComputable:null!=o},t?"download":"upload",!0);e(l)}),n)},n.progressEventDecorator=function(e,t){var n=null!=e;return[function(r){return t[0]({lengthComputable:n,total:e,loaded:r})},t[1]]},n.asyncDecorator=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.default.asap((function(){return e.apply(void 0,n)}))}}},{"../utils.js":97,"./speedometer.js":84,"./throttle.js":86}],83:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=f(e("../platform/index.js")),o=f(e("../utils.js")),i=f(e("./isURLSameOrigin.js")),a=f(e("./cookies.js")),s=f(e("../core/buildFullPath.js")),c=f(e("../core/mergeConfig.js")),u=f(e("../core/AxiosHeaders.js")),l=f(e("./buildURL.js"));function f(e){return e&&e.__esModule?e:{default:e}}function h(e){return function(e){if(Array.isArray(e))return v(e)}(e)||y(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){return function(e){if(Array.isArray(e))return e}(e)||y(e)||d(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return v(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function y(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}n.default=function(e){var t,n=(0,c.default)({},e),f=n.data,d=n.withXSRFToken,v=n.xsrfHeaderName,y=n.xsrfCookieName,g=n.headers,m=n.auth;if(n.headers=g=u.default.from(g),n.url=(0,l.default)((0,s.default)(n.baseURL,n.url),e.params,e.paramsSerializer),m&&g.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),o.default.isFormData(f))if(r.default.hasStandardBrowserEnv||r.default.hasStandardBrowserWebWorkerEnv)g.setContentType(void 0);else if(!1!==(t=g.getContentType())){var b=p(t?t.split(";").map((function(e){return e.trim()})).filter(Boolean):[]),w=b[0],k=b.slice(1);g.setContentType([w||"multipart/form-data"].concat(h(k)).join("; "))}if(r.default.hasStandardBrowserEnv&&(d&&o.default.isFunction(d)&&(d=d(n)),d||!1!==d&&(0,i.default)(n.url))){var _=v&&y&&a.default.read(y);_&&g.set(v,_)}return n}},{"../core/AxiosHeaders.js":58,"../core/buildFullPath.js":60,"../core/mergeConfig.js":62,"../platform/index.js":96,"../utils.js":97,"./buildURL.js":71,"./cookies.js":74,"./isURLSameOrigin.js":78}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(e,t){e=e||10;var n,r=new Array(e),o=new Array(e),i=0,a=0;return t=void 0!==t?t:1e3,function(s){var c=Date.now(),u=o[a];n||(n=c),r[i]=s,o[i]=c;for(var l=a,f=0;l!==i;)f+=r[l++],l%=e;if((i=(i+1)%e)===a&&(a=(a+1)%e),!(c-n<t)){var h=u&&c-u;return h?Math.round(1e3*f/h):void 0}}}},{}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t){return e.apply(null,t)}}},{}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=function(e,t){var n,r,o=0,i=1e3/t,a=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();o=i,n=null,r&&(clearTimeout(r),r=null),e.apply(null,t)};return[function(){for(var e=Date.now(),t=e-o,s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];t>=i?a(c,e):(n=c,r||(r=setTimeout((function(){r=null,a(n)}),i-t)))},function(){return n&&a(n)}]}},{}],87:[function(e,t,n){(function(t){(function(){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(e("../utils.js")),o=a(e("../core/AxiosError.js")),i=a(e("../platform/node/classes/FormData.js"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e){return r.default.isPlainObject(e)||r.default.isArray(e)}function u(e){return r.default.endsWith(e,"[]")?e.slice(0,-2):e}function l(e,t,n){return e?e.concat(t).map((function(e,t){return e=u(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}var f=r.default.toFlatObject(r.default,{},null,(function(e){return/^is[A-Z]/.test(e)}));n.default=function(e,n,a){if(!r.default.isObject(e))throw new TypeError("target must be an object");n=n||new(i.default||FormData);var h=(a=r.default.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!r.default.isUndefined(t[e])}))).metaTokens,p=a.visitor||m,d=a.dots,v=a.indexes,y=(a.Blob||"undefined"!=typeof Blob&&Blob)&&r.default.isSpecCompliantForm(n);if(!r.default.isFunction(p))throw new TypeError("visitor must be a function");function g(e){if(null===e)return"";if(r.default.isDate(e))return e.toISOString();if(!y&&r.default.isBlob(e))throw new o.default("Blob is not supported. Use a Buffer instead.");return r.default.isArrayBuffer(e)||r.default.isTypedArray(e)?y&&"function"==typeof Blob?new Blob([e]):t.from(e):e}function m(e,t,o){var i=e;if(e&&!o&&"object"===s(e))if(r.default.endsWith(t,"{}"))t=h?t:t.slice(0,-2),e=JSON.stringify(e);else if(r.default.isArray(e)&&function(e){return r.default.isArray(e)&&!e.some(c)}(e)||(r.default.isFileList(e)||r.default.endsWith(t,"[]"))&&(i=r.default.toArray(e)))return t=u(t),i.forEach((function(e,o){!r.default.isUndefined(e)&&null!==e&&n.append(!0===v?l([t],o,d):null===v?t:t+"[]",g(e))})),!1;return!!c(e)||(n.append(l(o,t,d),g(e)),!1)}var b=[],w=Object.assign(f,{defaultVisitor:m,convertValue:g,isVisitable:c});if(!r.default.isObject(e))throw new TypeError("data must be an object");return function e(t,o){if(!r.default.isUndefined(t)){if(-1!==b.indexOf(t))throw Error("Circular reference detected in "+o.join("."));b.push(t),r.default.forEach(t,(function(t,i){!0===(!(r.default.isUndefined(t)||null===t)&&p.call(n,t,r.default.isString(i)?i.trim():i,o,w))&&e(t,o?o.concat(i):[i])})),b.pop()}}(e),n}}).call(this)}).call(this,e("buffer").Buffer)},{"../core/AxiosError.js":57,"../platform/node/classes/FormData.js":79,"../utils.js":97,buffer:99}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){return(0,o.default)(e,new i.default.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,o){return i.default.isNode&&r.default.isBuffer(e)?(this.append(t,e.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))};var r=a(e("../utils.js")),o=a(e("./toFormData.js")),i=a(e("../platform/index.js"));function a(e){return e&&e.__esModule?e:{default:e}}},{"../platform/index.js":96,"../utils.js":97,"./toFormData.js":87}],89:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function i(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */i=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),s=new I(r||[]);return a(i,"_invoke",{value:C(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",v="executing",y="completed",g={};function m(){}function b(){}function w(){}var k={};f(k,c,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==n&&o.call(E,c)&&(k=E);var O=w.prototype=m.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(i,a,s,c){var u=p(e[i],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==r(f)&&o.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var i;a(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function C(t,n,r){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var u=p(t,n,r);if("normal"===u.type){if(o=r.done?y:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){for(;++i<t.length;)if(o.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(r(t)+" is not iterable")}return b.prototype=w,a(O,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),f(x.prototype,u,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),f(O,l,"Generator"),f(O,c,(function(){return this})),f(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function a(e){var t,n;function r(t,n){try{var i=e[t](n),a=i.value,s=a instanceof u;Promise.resolve(s?a.v:a).then((function(n){if(s){var c="return"===t?"return":"next";if(!a.k||n.done)return r(c,n);n=e[c](n).value}o(i.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){o("throw",e)}}function o(e,o){switch(e){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,o){return new Promise((function(i,a){var s={key:e,arg:o,resolve:i,reject:a,next:null};n?n=n.next=s:(t=n=s,r(e,o))}))},"function"!=typeof e.return&&(this.return=void 0)}function s(e){return new u(e,0)}function c(e){var t={},n=!1;function r(t,r){return n=!0,{done:!1,value:new u(r=new Promise((function(n){n(e[t](r))})),1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}function u(e,t){this.v=e,this.k=t}function l(e){var t,n,r,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);o--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new f(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function f(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(f=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new f(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.trackStream=n.streamChunk=n.readBytes=void 0,a.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},a.prototype.next=function(e){return this._invoke("next",e)},a.prototype.throw=function(e){return this._invoke("throw",e)},a.prototype.return=function(e){return this._invoke("return",e)};var h=n.streamChunk=i().mark((function e(t,n){var r,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.byteLength,n&&!(r<n)){e.next=5;break}return e.next=4,t;case 4:return e.abrupt("return");case 5:o=0;case 6:if(!(o<r)){e.next=13;break}return a=o+n,e.next=10,t.slice(o,a);case 10:o=a,e.next=6;break;case 13:case"end":return e.stop()}}),e)})),p=n.readBytes=function(){var e,t=(e=i().mark((function e(t,n,r){var o,a,u,f,p,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=!1,a=!1,e.prev=2,f=l(t);case 4:return e.next=6,s(f.next());case 6:if(!(o=!(p=e.sent).done)){e.next=27;break}if(d=p.value,e.t0=c,e.t1=l,e.t2=h,!ArrayBuffer.isView(d)){e.next=15;break}e.t3=d,e.next=18;break;case 15:return e.next=17,s(r(String(d)));case 17:e.t3=e.sent;case 18:return e.t4=e.t3,e.t5=n,e.t6=(0,e.t2)(e.t4,e.t5),e.t7=(0,e.t1)(e.t6),e.t8=s,e.delegateYield((0,e.t0)(e.t7,e.t8),"t9",24);case 24:o=!1,e.next=4;break;case 27:e.next=33;break;case 29:e.prev=29,e.t10=e.catch(2),a=!0,u=e.t10;case 33:if(e.prev=33,e.prev=34,!o||null==f.return){e.next=38;break}return e.next=38,s(f.return());case 38:if(e.prev=38,!a){e.next=41;break}throw u;case 41:return e.finish(38);case 42:return e.finish(33);case 43:case"end":return e.stop()}}),e,null,[[2,29,33,43],[34,,38,42]])})),function(){return new a(e.apply(this,arguments))});return function(e,n,r){return t.apply(this,arguments)}}();n.trackStream=function(e,t,n,r,a){var s,c=p(e,t,a),u=0,l=function(e){s||(s=!0,r&&r(e))};return new ReadableStream({pull:function(e){return(t=i().mark((function t(){var r,o,a,s,f;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.next();case 3:if(r=t.sent,o=r.done,a=r.value,!o){t.next=10;break}return l(),e.close(),t.abrupt("return");case 10:s=a.byteLength,n&&(f=u+=s,n(f)),e.enqueue(new Uint8Array(a)),t.next=19;break;case 15:throw t.prev=15,t.t0=t.catch(0),l(t.t0),t.t0;case 19:case"end":return t.stop()}}),t,null,[[0,15]])})),function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function s(e){o(a,r,i,s,c,"next",e)}function c(e){o(a,r,i,s,c,"throw",e)}s(void 0)}))})();var t},cancel:function(e){return l(e),c.return()}},{highWaterMark:2})}},{}],90:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,o=e("../env/data.js"),i=(r=e("../core/AxiosError.js"))&&r.__esModule?r:{default:r};function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var s={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){s[e]=function(n){return a(n)===e||"a"+(t<1?"n ":" ")+e}}));var c={};s.transitional=function(e,t,n){function r(e,t){return"[Axios v"+o.VERSION+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,o,a){if(!1===e)throw new i.default(r(o," has been removed"+(t?" in "+t:"")),i.default.ERR_DEPRECATED);return t&&!c[o]&&(c[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,o,a)}};n.default={assertOptions:function(e,t,n){if("object"!==a(e))throw new i.default("options must be an object",i.default.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),o=r.length;o-- >0;){var s=r[o],c=t[s];if(c){var u=e[s],l=void 0===u||c(u,s,e);if(!0!==l)throw new i.default("option "+s+" must be "+l,i.default.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new i.default("Unknown option "+s,i.default.ERR_BAD_OPTION)}},validators:s}},{"../core/AxiosError.js":57,"../env/data.js":67}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default="undefined"!=typeof Blob?Blob:null},{}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default="undefined"!=typeof FormData?FormData:null},{}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,o=(r=e("../../../helpers/AxiosURLSearchParams.js"))&&r.__esModule?r:{default:r};n.default="undefined"!=typeof URLSearchParams?URLSearchParams:o.default},{"../../../helpers/AxiosURLSearchParams.js":68}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(e("./classes/URLSearchParams.js")),o=a(e("./classes/FormData.js")),i=a(e("./classes/Blob.js"));function a(e){return e&&e.__esModule?e:{default:e}}n.default={isBrowser:!0,classes:{URLSearchParams:r.default,FormData:o.default,Blob:i.default},protocols:["http","https","file","blob","url","data"]}},{"./classes/Blob.js":91,"./classes/FormData.js":92,"./classes/URLSearchParams.js":93}],95:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.origin=n.hasStandardBrowserWebWorkerEnv=n.hasStandardBrowserEnv=n.hasBrowserEnv=void 0;var r,o=n.hasBrowserEnv="undefined"!=typeof window&&"undefined"!=typeof document;n.hasStandardBrowserEnv=(r="undefined"!=typeof navigator&&navigator.product,o&&["ReactNative","NativeScript","NS"].indexOf(r)<0),n.hasStandardBrowserWebWorkerEnv="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,n.origin=o&&window.location.href||"http://localhost"},{}],96:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,o=(r=e("./node/index.js"))&&r.__esModule?r:{default:r},i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=s(e)&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var c=o?Object.getOwnPropertyDescriptor(e,i):null;c&&(c.get||c.set)?Object.defineProperty(r,i,c):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}(e("./common/utils.js"));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.default=u(u({},i),o.default)},{"./common/utils.js":95,"./node/index.js":94}],97:[function(e,t,n){(function(t,r,o){(function(){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,a=(i=e("./helpers/bind.js"))&&i.__esModule?i:{default:i};function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var u,l=Object.prototype.toString,f=Object.getPrototypeOf,h=(u=Object.create(null),function(e){var t=l.call(e);return u[t]||(u[t]=t.slice(8,-1).toLowerCase())}),p=function(e){return e=e.toLowerCase(),function(t){return h(t)===e}},d=function(e){return function(t){return c(t)===e}},v=Array.isArray,y=d("undefined");var g=p("ArrayBuffer");var m=d("string"),b=d("function"),w=d("number"),k=function(e){return null!==e&&"object"===c(e)},_=function(e){if("object"!==h(e))return!1;var t=f(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},E=p("Date"),O=p("File"),S=p("Blob"),x=p("FileList"),C=p("URLSearchParams"),A=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(["ReadableStream","Request","Response","Headers"].map(p),4),T=A[0],P=A[1],I=A[2],j=A[3];function R(e,t){var n,r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=o.allOwnKeys,a=void 0!==i&&i;if(null!=e)if("object"!==c(e)&&(e=[e]),v(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{var s,u=a?Object.getOwnPropertyNames(e):Object.keys(e),l=u.length;for(n=0;n<l;n++)s=u[n],t.call(null,e[s],s,e)}}function L(e,t){t=t.toLowerCase();for(var n,r=Object.keys(e),o=r.length;o-- >0;)if(t===(n=r[o]).toLowerCase())return n;return null}var M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:r,U=function(e){return!y(e)&&e!==M};var N,D=(N="undefined"!=typeof Uint8Array&&f(Uint8Array),function(e){return N&&e instanceof N}),G=p("HTMLFormElement"),B=function(e){var t=Object.prototype.hasOwnProperty;return function(e,n){return t.call(e,n)}}(),F=p("RegExp"),q=function(e,t){var n=Object.getOwnPropertyDescriptors(e),r={};R(n,(function(n,o){var i;!1!==(i=t(n,o,e))&&(r[o]=i||n)})),Object.defineProperties(e,r)},H="abcdefghijklmnopqrstuvwxyz",W={DIGIT:"0123456789",ALPHA:H,ALPHA_DIGIT:H+H.toUpperCase()+"0123456789"};var V,z,J,K,Q=p("AsyncFunction"),Y=(V="function"==typeof o,z=b(M.postMessage),V?o:z?(J="axios@".concat(Math.random()),K=[],M.addEventListener("message",(function(e){var t=e.source,n=e.data;t===M&&n===J&&K.length&&K.shift()()}),!1),function(e){K.push(e),M.postMessage(J,"*")}):function(e){return setTimeout(e)}),X="undefined"!=typeof queueMicrotask?queueMicrotask.bind(M):void 0!==t&&t.nextTick||Y;n.default={isArray:v,isArrayBuffer:g,isBuffer:function(e){return null!==e&&!y(e)&&null!==e.constructor&&!y(e.constructor)&&b(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:function(e){var t;return e&&("function"==typeof FormData&&e instanceof FormData||b(e.append)&&("formdata"===(t=h(e))||"object"===t&&b(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&g(e.buffer)},isString:m,isNumber:w,isBoolean:function(e){return!0===e||!1===e},isObject:k,isPlainObject:_,isReadableStream:T,isRequest:P,isResponse:I,isHeaders:j,isUndefined:y,isDate:E,isFile:O,isBlob:S,isRegExp:F,isFunction:b,isStream:function(e){return k(e)&&b(e.pipe)},isURLSearchParams:C,isTypedArray:D,isFileList:x,forEach:R,merge:function e(){for(var t=U(this)&&this||{},n=t.caseless,r={},o=function(t,o){var i=n&&L(r,o)||o;_(r[i])&&_(t)?r[i]=e(r[i],t):_(t)?r[i]=e({},t):v(t)?r[i]=t.slice():r[i]=t},i=0,a=arguments.length;i<a;i++)arguments[i]&&R(arguments[i],o);return r},extend:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=r.allOwnKeys;return R(t,(function(t,r){n&&b(t)?e[r]=(0,a.default)(t,n):e[r]=t}),{allOwnKeys:o}),e},trim:function(e){return e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n,r){var o,i,a,s={};if(t=t||{},null==e)return t;do{for(i=(o=Object.getOwnPropertyNames(e)).length;i-- >0;)a=o[i],r&&!r(a,e,t)||s[a]||(t[a]=e[a],s[a]=!0);e=!1!==n&&f(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:h,kindOfTest:p,endsWith:function(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return-1!==r&&r===n},toArray:function(e){if(!e)return null;if(v(e))return e;var t=e.length;if(!w(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},forEachEntry:function(e,t){for(var n,r=(e&&e[Symbol.iterator]).call(e);(n=r.next())&&!n.done;){var o=n.value;t.call(e,o[0],o[1])}},matchAll:function(e,t){for(var n,r=[];null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:G,hasOwnProperty:B,hasOwnProp:B,reduceDescriptors:q,freezeMethods:function(e){q(e,(function(t,n){if(b(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;var r=e[n];b(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=function(){throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:function(e,t){var n={},r=function(e){e.forEach((function(e){n[e]=!0}))};return v(e)?r(e):r(String(e).split(t)),n},toCamelCase:function(e){return e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n}))},noop:function(){},toFiniteNumber:function(e,t){return null!=e&&Number.isFinite(e=+e)?e:t},findKey:L,global:M,isContextDefined:U,ALPHABET:W,generateString:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W.ALPHA_DIGIT,n="",r=t.length;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&b(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:function(e){var t=new Array(10);return function e(n,r){if(k(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[r]=n;var o=v(n)?[]:{};return R(n,(function(t,n){var i=e(t,r+1);!y(i)&&(o[n]=i)})),t[r]=void 0,o}}return n}(e,0)},isAsyncFn:Q,isThenable:function(e){return e&&(k(e)||b(e))&&b(e.then)&&b(e.catch)},setImmediate:Y,asap:X}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("timers").setImmediate)},{"./helpers/bind.js":70,_process:108,timers:109}],98:[function(e,t,n){"use strict";!function(e){var t="undefined"!=typeof Uint8Array?Uint8Array:Array,n="+".charCodeAt(0),r="/".charCodeAt(0),o="0".charCodeAt(0),i="a".charCodeAt(0),a="A".charCodeAt(0),s="-".charCodeAt(0),c="_".charCodeAt(0);function u(e){var t=e.charCodeAt(0);return t===n||t===s?62:t===r||t===c?63:t<o?-1:t<o+10?t-o+26+26:t<a+26?t-a:t<i+26?t-i+26:void 0}e.toByteArray=function(e){var n,r,o,i,a,s;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var c=e.length;a="="===e.charAt(c-2)?2:"="===e.charAt(c-1)?1:0,s=new t(3*e.length/4-a),o=a>0?e.length-4:e.length;var l=0;function f(e){s[l++]=e}for(n=0,r=0;n<o;n+=4,r+=3)f((16711680&(i=u(e.charAt(n))<<18|u(e.charAt(n+1))<<12|u(e.charAt(n+2))<<6|u(e.charAt(n+3))))>>16),f((65280&i)>>8),f(255&i);return 2===a?f(255&(i=u(e.charAt(n))<<2|u(e.charAt(n+1))>>4)):1===a&&(f((i=u(e.charAt(n))<<10|u(e.charAt(n+1))<<4|u(e.charAt(n+2))>>2)>>8&255),f(255&i)),s},e.fromByteArray=function(e){var t,n,r,o,i=e.length%3,a="";function s(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)}for(t=0,r=e.length-i;t<r;t+=3)n=(e[t]<<16)+(e[t+1]<<8)+e[t+2],a+=s((o=n)>>18&63)+s(o>>12&63)+s(o>>6&63)+s(63&o);switch(i){case 1:a+=s((n=e[e.length-1])>>2),a+=s(n<<4&63),a+="==";break;case 2:a+=s((n=(e[e.length-2]<<8)+e[e.length-1])>>10),a+=s(n>>4&63),a+=s(n<<2&63),a+="="}return a}}(void 0===n?(void 0).base64js={}:n)},{}],99:[function(e,t,n){(function(t){(function(){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r=e("base64-js"),o=e("ieee754");n.Buffer=a,n.SlowBuffer=function(e){+e!=e&&(e=0);return a.alloc(+e)},n.INSPECT_MAX_BYTES=50;function i(e){if(e>2147483647)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=a.prototype,t}function a(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return s(e,t,n)}function s(e,n,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!a.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|h(e,t),r=i(n),o=r.write(e,t);o!==n&&(r=r.slice(0,o));return r}(e,n);if(ArrayBuffer.isView(e))return l(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+t(e));if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer))return function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n);return r.__proto__=a.prototype,r}(e,n,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var o=e.valueOf&&e.valueOf();if(null!=o&&o!==e)return a.from(o,n,r);var s=function(e){if(a.isBuffer(e)){var t=0|f(e.length),n=i(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||B(e.length)?i(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a.from(e[Symbol.toPrimitive]("string"),n,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+t(e))}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return c(e),i(e<0?0:0|f(e))}function l(e){for(var t=e.length<0?0:0|f(e.length),n=i(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function f(e){if(e>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|e}function h(e,n){if(a.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+t(e));var r=e.length,o=arguments.length>2&&!0===arguments[2];if(!o&&0===r)return 0;for(var i=!1;;)switch(n){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return N(e).length;default:if(i)return o?-1:U(e).length;n=(""+n).toLowerCase(),i=!0}}function p(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,n);case"utf8":case"utf-8":return O(this,t,n);case"ascii":return S(this,t,n);case"latin1":case"binary":return x(this,t,n);case"base64":return E(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function d(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,o){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),B(n=+n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=a.from(t,r)),a.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,o){var i,a=1,s=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(o){var l=-1;for(i=n;i<s;i++)if(u(e,i)===u(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===c)return l*a}else-1!==l&&(i-=i-l),l=-1}else for(n+c>s&&(n=s-c),i=n;i>=0;i--){for(var f=!0,h=0;h<c;h++)if(u(e,i+h)!==u(t,h)){f=!1;break}if(f)return i}return-1}function g(e,t,n,r){n=Number(n)||0;var o=e.length-n;r?(r=Number(r))>o&&(r=o):r=o;var i=t.length;r>i/2&&(r=i/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(B(s))return a;e[n+a]=s}return a}function m(e,t,n,r){return D(U(t,e.length-n),e,n,r)}function b(e,t,n,r){return D(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function w(e,t,n,r){return b(e,t,n,r)}function k(e,t,n,r){return D(N(t),e,n,r)}function _(e,t,n,r){return D(function(e,t){for(var n,r,o,i=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,o=n%256,i.push(o),i.push(r);return i}(t,e.length-n),e,n,r)}function E(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function O(e,t,n){n=Math.min(e.length,n);for(var r=[],o=t;o<n;){var i,a,s,c,u=e[o],l=null,f=u>239?4:u>223?3:u>191?2:1;if(o+f<=n)switch(f){case 1:u<128&&(l=u);break;case 2:128==(192&(i=e[o+1]))&&(c=(31&u)<<6|63&i)>127&&(l=c);break;case 3:i=e[o+1],a=e[o+2],128==(192&i)&&128==(192&a)&&(c=(15&u)<<12|(63&i)<<6|63&a)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:i=e[o+1],a=e[o+2],s=e[o+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&(c=(15&u)<<18|(63&i)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),o+=f}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}n.kMaxLength=2147483647,a.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),a.poolSize=8192,a.from=function(e,t,n){return s(e,t,n)},a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,a.alloc=function(e,t,n){return function(e,t,n){return c(e),e<=0?i(e):void 0!==t?"string"==typeof n?i(e).fill(t,n):i(e).fill(t):i(e)}(e,t,n)},a.allocUnsafe=function(e){return u(e)},a.allocUnsafeSlow=function(e){return u(e)},a.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a.prototype},a.compare=function(e,t){if(G(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=a.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var i=e[n];if(G(i,Uint8Array)&&(i=a.from(i)),!a.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(r,o),o+=i.length}return r},a.byteLength=h,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)d(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)d(this,t,t+3),d(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)d(this,t,t+7),d(this,t+1,t+6),d(this,t+2,t+5),d(this,t+3,t+4);return this},a.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?O(this,0,e):p.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},a.prototype.compare=function(e,n,r,o,i){if(G(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+t(e));if(void 0===n&&(n=0),void 0===r&&(r=e?e.length:0),void 0===o&&(o=0),void 0===i&&(i=this.length),n<0||r>e.length||o<0||i>this.length)throw new RangeError("out of range index");if(o>=i&&n>=r)return 0;if(o>=i)return-1;if(n>=r)return 1;if(this===e)return 0;for(var s=(i>>>=0)-(o>>>=0),c=(r>>>=0)-(n>>>=0),u=Math.min(s,c),l=this.slice(o,i),f=e.slice(n,r),h=0;h<u;++h)if(l[h]!==f[h]){s=l[h],c=f[h];break}return s<c?-1:c<s?1:0},a.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},a.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return g(this,e,t,n);case"utf8":case"utf-8":return m(this,e,t,n);case"ascii":return b(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return k(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function S(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(127&e[o]);return r}function x(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(e[o]);return r}function C(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=t;i<n;++i)o+=M(e[i]);return o}function A(e,t,n){for(var r=e.slice(t,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function T(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,n,r,o,i){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function I(e,t,n,r,o,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function j(e,t,n,r,i){return t=+t,n>>>=0,i||I(e,0,n,4),o.write(e,t,n,r,23,4),n+4}function R(e,t,n,r,i){return t=+t,n>>>=0,i||I(e,0,n,8),o.write(e,t,n,r,52,8),n+8}a.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return r.__proto__=a.prototype,r},a.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||T(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r},a.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||T(e,t,this.length);for(var r=this[e+--t],o=1;t>0&&(o*=256);)r+=this[e+--t]*o;return r},a.prototype.readUInt8=function(e,t){return e>>>=0,t||T(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||T(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||T(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||T(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||T(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||T(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*t)),r},a.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||T(e,t,this.length);for(var r=t,o=1,i=this[e+--r];r>0&&(o*=256);)i+=this[e+--r]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},a.prototype.readInt8=function(e,t){return e>>>=0,t||T(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||T(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){e>>>=0,t||T(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||T(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||T(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return e>>>=0,t||T(e,4,this.length),o.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||T(e,4,this.length),o.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||T(e,8,this.length),o.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||T(e,8,this.length),o.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||P(this,e,t,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[t]=255&e;++i<n&&(o*=256);)this[t+i]=e/o&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||P(this,e,t,n,Math.pow(2,8*n)-1,0);var o=n-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var o=Math.pow(2,8*n-1);P(this,e,t,n,o-1,-o)}var i=0,a=1,s=0;for(this[t]=255&e;++i<n&&(a*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+n},a.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var o=Math.pow(2,8*n-1);P(this,e,t,n,o-1,-o)}var i=n-1,a=1,s=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeFloatLE=function(e,t,n){return j(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return j(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return R(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return R(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,r){if(!a.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var o=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var i=o-1;i>=0;--i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return o},a.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var o=e.charCodeAt(0);("utf8"===r&&o<128||"latin1"===r)&&(e=o)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=a.isBuffer(e)?e:a.from(e,r),c=s.length;if(0===c)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=s[i%c]}return this};var L=/[^+/0-9A-Za-z-_]/g;function M(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var n;t=t||1/0;for(var r=e.length,o=null,i=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function N(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(L,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function D(e,t,n,r){for(var o=0;o<r&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function B(e){return e!=e}}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":98,buffer:99,ieee754:103}],100:[function(e,t,n){(function(r){(function(){"use strict";var o;n.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var r=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(o=r))})),e.splice(o,0,n)},n.save=function(e){try{e?n.storage.setItem("debug",e):n.storage.removeItem("debug")}catch(e){}},n.load=function(){var e;try{e=n.storage.getItem("debug")}catch(e){}!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG);return e},n.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;var e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},n.storage=function(){try{return localStorage}catch(e){}}(),n.destroy=(o=!1,function(){o||(o=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],n.log=console.debug||console.log||function(){},t.exports=e("./common")(n),t.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this)}).call(this,e("_process"))},{"./common":101,_process:108}],101:[function(e,t,n){"use strict";function r(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}function i(e,t){if(e){if("string"==typeof e)return a(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}t.exports=function(t){function n(e){var t,r,o,a=null;function s(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];if(s.enabled){var i=s,a=Number(new Date),c=a-(t||a);i.diff=c,i.prev=t,i.curr=a,t=a,r[0]=n.coerce(r[0]),"string"!=typeof r[0]&&r.unshift("%O");var u=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,(function(e,t){if("%%"===e)return"%";u++;var o=n.formatters[t];if("function"==typeof o){var a=r[u];e=o.call(i,a),r.splice(u,1),u--}return e})),n.formatArgs.call(i,r);var l=i.log||n.log;l.apply(i,r)}}return s.namespace=e,s.useColors=n.useColors(),s.color=n.selectColor(e),s.extend=i,s.destroy=n.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==a?a:(r!==n.namespaces&&(r=n.namespaces,o=n.enabled(e)),o)},set:function(e){a=e}}),"function"==typeof n.init&&n.init(s),s}function i(e,t){var r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function a(e,t){for(var n=0,r=0,o=-1,i=0;n<e.length;)if(r<t.length&&(t[r]===e[n]||"*"===t[r]))"*"===t[r]?(o=r,i=n,r++):(n++,r++);else{if(-1===o)return!1;r=o+1,n=++i}for(;r<t.length&&"*"===t[r];)r++;return r===t.length}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){var e=[].concat(r(n.names),r(n.skips.map((function(e){return"-"+e})))).join(",");return n.enable(""),e},n.enable=function(e){n.save(e),n.namespaces=e,n.names=[],n.skips=[];var t,r=o(("string"==typeof e?e:"").trim().replace(" ",",").split(",").filter(Boolean));try{for(r.s();!(t=r.n()).done;){var i=t.value;"-"===i[0]?n.skips.push(i.slice(1)):n.names.push(i)}}catch(e){r.e(e)}finally{r.f()}},n.enabled=function(e){var t,r=o(n.skips);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(a(e,i))return!1}}catch(e){r.e(e)}finally{r.f()}var s,c=o(n.names);try{for(c.s();!(s=c.n()).done;){var u=s.value;if(a(e,u))return!0}}catch(e){c.e(e)}finally{c.f()}return!1},n.humanize=e("ms"),n.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((function(e){n[e]=t[e]})),n.names=[],n.skips=[],n.formatters={},n.selectColor=function(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return n.colors[Math.abs(t)%n.colors.length]},n.enable(n.load()),n}},{ms:107}],102:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,i="object"===("undefined"==typeof Reflect?"undefined":r(Reflect))?Reflect:null,a=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};o=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function c(){c.init.call(this)}t.exports=c,t.exports.once=function(e,t){return new Promise((function(n,r){function o(n){e.removeListener(t,i),r(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}m(e,t,i,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,n)}(e,o,{once:!0})}))},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var u=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+r(e))}function f(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function h(e,t,n,r){var o,i,a,s;if(l(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),a=i[t]),void 0===a)a=i[t]=n,++e._eventsCount;else if("function"==typeof a?a=i[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(o=f(e))>0&&a.length>o&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,s=c,console&&console.warn&&console.warn(s)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=p.bind(r);return o.listener=n,r.wrapFn=o,o}function v(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):g(o,o.length)}function y(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function m(e,t,n,o){if("function"==typeof e.on)o.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+r(e));e.addEventListener(t,(function r(i){o.once&&e.removeEventListener(t,r),n(i)}))}}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return f(this)},c.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var s=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw s.context=i,s}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)a(c,this,t);else{var u=c.length,l=g(c,u);for(n=0;n<u;++n)a(l[n],this,t)}return!0},c.prototype.addListener=function(e,t){return h(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return h(this,e,t,!0)},c.prototype.once=function(e,t){return l(t),this.on(e,d(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,d(this,e,t)),this},c.prototype.removeListener=function(e,t){var n,r,o,i,a;if(l(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){a=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},c.prototype.listeners=function(e){return v(this,e,!0)},c.prototype.rawListeners=function(e){return v(this,e,!1)},c.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):y.call(e,t)},c.prototype.listenerCount=y,c.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]}},{}],103:[function(e,t,n){"use strict";n.read=function(e,t,n,r,o){var i,a,s=8*o-r-1,c=(1<<s)-1,u=c>>1,l=-7,f=n?o-1:0,h=n?-1:1,p=e[t+f];for(f+=h,i=p&(1<<-l)-1,p>>=-l,l+=s;l>0;i=256*i+e[t+f],f+=h,l-=8);for(a=i&(1<<-l)-1,i>>=-l,l+=r;l>0;a=256*a+e[t+f],f+=h,l-=8);if(0===i)i=1-u;else{if(i===c)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),i-=u}return(p?-1:1)*a*Math.pow(2,i-r)},n.write=function(e,t,n,r,o,i){var a,s,c,u=8*i-o-1,l=(1<<u)-1,f=l>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,d=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+f>=1?h/c:h*Math.pow(2,1-f))*c>=2&&(a++,c/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(t*c-1)*Math.pow(2,o),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,o),a=0));o>=8;e[n+p]=255&s,p+=d,s/=256,o-=8);for(a=a<<o|s,u+=o;u>0;e[n+p]=255&a,p+=d,a/=256,u-=8);e[n+p-d]|=128*v}},{}],104:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),s=new I(r||[]);return a(i,"_invoke",{value:C(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",v="executing",y="completed",g={};function m(){}function b(){}function w(){}var k={};f(k,c,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==n&&i.call(E,c)&&(k=E);var O=w.prototype=m.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,a,s,c){var u=p(e[o],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==r(f)&&i.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var u=p(t,n,r);if("normal"===u.type){if(o=r.done?y:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(i.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(r(t)+" is not iterable")}return b.prototype=w,a(O,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),f(x.prototype,u,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),f(O,l,"Generator"),f(O,c,(function(){return this})),f(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){u(i,r,o,a,s,"next",e)}function s(e){u(i,r,o,a,s,"throw",e)}a(void 0)}))}}var f=e("debug"),h=e("uuid"),p=f("ls-telemetry:config"),d=f("ls-telemetry:report"),v=f("ls-telemetry:main"),y=["filter","alert","classroom","access_scan","location","device_detective","browser_helper","network_agent","meta"],g=["filter","alert","classroom","mdm","generic"],m={};function b(){return(b=l(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t.agent_type){e.next=2;break}throw"[ls-telemetry] agent_type not set";case 2:if(y.includes(t.agent_type)){e.next=4;break}throw"[ls-telemetry] invalid agent_type";case 4:if("string"==typeof t.product){e.next=6;break}throw"[ls-telemetry] product not set";case 6:if(g.includes(t.product)){e.next=8;break}throw"[ls-telemetry] invalid product";case 8:if("string"==typeof t.agent_version){e.next=10;break}throw"[ls-telemetry] agent_version not set";case 10:if("string"==typeof t.ls_telemetry_key){e.next=12;break}throw"[ls-telemetry] ls_telemetry_key not set";case 12:if("string"==typeof t.ls_telemetry_host){e.next=14;break}throw"[ls-telemetry] ls_telemetry_host not set";case 14:if("string"==typeof t.customer_id){e.next=16;break}throw"[ls-telemetry] customer_id not set";case 16:return e.next=18,C();case 18:m=a(a({},m),t),p("[setConfig] ->",JSON.stringify(m).replace(m.ls_telemetry_key,"********************"));case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return k.apply(this,arguments)}function k(){return(k=l(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){chrome.runtime.getPlatformInfo((function(t){p("[getPlatformInfo] ->",t),e(t.os)}))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){return E.apply(this,arguments)}function E(){return(E=l(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!chrome.enterprise.deviceAttributes){e.next=4;break}return e.next=3,new Promise((function(e){chrome.enterprise.deviceAttributes.getDeviceSerialNumber((function(t){p("[getDeviceSerialNumber] ->",t),e(t)}))}));case 3:return e.abrupt("return",e.sent);case 4:p("[getDeviceSerialNumber] missing permissions");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){return S.apply(this,arguments)}function S(){return(S=l(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!chrome.enterprise.networkingAttributes){e.next=4;break}return e.next=3,new Promise((function(e){chrome.enterprise.networkingAttributes.getNetworkDetails((function(t){chrome.runtime.lastError?(p("runtime.lastError ->",chrome.runtime.lastError.message),e("")):t&&(p("[networkingAttributes] ->",t),e(t.ipv4||t.ipv6))}))}));case 3:return e.abrupt("return",e.sent);case 4:p("[networkingAttributes] missing permissions");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){var e,t=navigator.userAgent;(e=t.match(/Edg\/([0-9.]+)/))?m.browser="edge":(e=t.match(/Firefox\/([0-9.]+)/))?m.browser="firefox":(e=t.match(/Chrome\/([0-9.]+)/))?m.browser="chrome":(e=t.match(/Safari\/([0-9.]+)/))&&(m.browser="safari",(s=t.match(/Version\/([0-9.]+)/))&&(m.safari_version=s[1])),"safari"!==m.browser&&e&&(m["".concat(m.browser,"_version")]=e[1]),p("[getBrowserInfo] ->",m.browser,m["".concat(m.browser,"_version")])}function C(){return A.apply(this,arguments)}function A(){return(A=l(o().mark((function e(){var t,n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:if(t=e.sent,m.os=t,m.device_type="mac"===t?"osx":t,x(),"cros"===t&&(m.os_version=m["".concat(m.browser,"_version")]),!chrome.enterprise){e.next=18;break}return e.next=10,_();case 10:return n=e.sent,m.serial_number=n,e.next=14,O();case 14:r=e.sent,m.internal_address=r,e.next=19;break;case 18:p("[ENTERPRISE API DENIED]");case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.exports={getConfig:function(){return m},getUDID:function(){var e=m.serial_number;return e||(e="ls-udid-".concat(h.v4()),p("[getUDID] generating ->",e)),e},setConfig:function(e){return b.apply(this,arguments)},setUser:function(e){p("[setUser] ->",e),m.user_info={email:e.email,username:e.username,domain:e.domain,upn:e.upn},m.username=e.username,m.udid=e.udid},setPublicIp:function(e){p("[setPublicIp] ->",e),m.external_address=e},setCacheInfo:function(e){p("[setCacheInfo] ->",e),m.cache=e},setClassroomEnabled:function(e){p("[setClassroomEnabled] ->",e),m.classroom_enabled=e},setFilterEnabled:function(e){p("[setFilterEnabled] ->",e),m.filter_enabled=e},setWebRTCData:function(e){p("[setWebRTCData] ->",e),m.web_rtc=e},reportLog:d,mainLog:v}},{debug:100,uuid:110}],105:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),s=new I(r||[]);return a(i,"_invoke",{value:C(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",v="executing",y="completed",g={};function m(){}function b(){}function w(){}var k={};f(k,c,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==n&&i.call(E,c)&&(k=E);var O=w.prototype=m.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,a,s,c){var u=p(e[o],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==r(f)&&i.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var u=p(t,n,r);if("normal"===u.type){if(o=r.done?y:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(i.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(r(t)+" is not iterable")}return b.prototype=w,a(O,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),f(x.prototype,u,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),f(O,l,"Generator"),f(O,c,(function(){return this})),f(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function i(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)}))}}var s=e("./config"),c=s.getConfig,u=s.getUDID,l=s.setConfig,f=s.setUser,h=s.setPublicIp,p=s.setCacheInfo,d=s.setClassroomEnabled,v=s.setFilterEnabled,y=s.setWebRTCData,g=s.mainLog,m=e("./report").sendReport;function b(){return(b=a(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g("[Init]"),e.next=3,l(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return(w=a(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.exports={GetConfig:function(){return c()},GetUDID:function(){return u()},Init:function(e){return b.apply(this,arguments)},SetAgentUser:function(e){f(e)},SetPublicIp:function(e){h(e)},SetCacheInfo:function(e){p(e)},SetClassroomEnabled:function(e){d(e)},SetFilterEnabled:function(e){v(e)},SetWebRTCData:function(e){y(e)},SendReport:function(){return w.apply(this,arguments)}}},{"./config":104,"./report":106}],106:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),s=new I(r||[]);return a(i,"_invoke",{value:C(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",v="executing",y="completed",g={};function m(){}function b(){}function w(){}var k={};f(k,c,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(j([])));E&&E!==n&&i.call(E,c)&&(k=E);var O=w.prototype=m.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,a,s,c){var u=p(e[o],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==r(f)&&i.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}})}function C(t,n,r){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=A(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var u=p(t,n,r);if("normal"===u.type){if(o=r.done?y:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function A(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(i.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(r(t)+" is not iterable")}return b.prototype=w,a(O,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(x.prototype),f(x.prototype,u,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(O),f(O,l,"Generator"),f(O,c,(function(){return this})),f(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function i(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)}))}}var s,c=e("./config"),u=c.getConfig,l=c.reportLog,f=["chrome_version","customer_id","device_type","edge_version","external_address","firefox_version","internal_address","os","os_version","product","safari_version","serial_number","udid","username","user_info"],h=["agent_type","agent_version","browser","customer_id","os","os_version","product","serial_number","udid","username","user_info"],p=["classroom_enabled","web_rtc"],d=["cache","filter_enabled"];function v(){return(v=a(o().mark((function e(){var t,n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=u(),t=g(),"string"==typeof s.ls_telemetry_key){e.next=4;break}throw"[ls-telemetry] ls_telemetry_key not set";case 4:if("string"==typeof s.ls_telemetry_host){e.next=6;break}throw"[ls-telemetry] ls_telemetry_host not set";case 6:if("string"==typeof s.customer_id){e.next=8;break}throw"[ls-telemetry] customer_id not set";case 8:return l("[SendReport] report data ->",t),(n=new Headers).append("Content-Type","application/json"),n.append("x-api-key",s.ls_telemetry_key),r={method:"POST",headers:n,body:JSON.stringify(t),redirect:"follow"},e.next=15,fetch("https://"+s.ls_telemetry_host+"/graphql",r).then((function(e){return l("[SendReport] ->",e),e})).catch((function(e){return console.error(e),{ok:!1}}));case 15:return i=e.sent,e.abrupt("return",i);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return"filter"===s.agent_type?h.concat(d):"classroom"===s.agent_type?h.concat(p):h}function g(){var e={query:m(),variables:{agent:w()}};return"cros"===s.os&&(e.variables.meta=function(){var e={agent_type:"meta"};return f.forEach((function(t){e[t]=s[t]})),e}()),e}function m(){var e="cros"===s.os,t="mutation AgentDetails(\n  $agent: PutAgentDetailsInput!\n";return e&&(t+="  $meta: PutAgentDetailsInput!\n"),t+=") {agent:AgentDetails(item: $agent) {"+b("agent"),e&&(t+="  }meta:AgentDetails(item: $meta) {"+b("meta")),t+="  }\n}"}function b(e){var t="\n";return("meta"===e?f:y()).forEach((function(e){t+="user_info"===e?"    user {\n      email\n      username\n      domain\n      upn\n    }\n":"cache"===e?"    cache {\n      hosts\n      videos\n      channels\n      users\n    }\n":"web_rtc"===e?"    web_rtc {\n      turn\n      {\n      sessions\n      bytes\n      }\n      stun\n      {\n      sessions\n      bytes\n      }\n    }\n":"    "+e+"\n"})),t}function w(){var e={};return y().forEach((function(t){e[t]=s[t]})),e}t.exports={sendReport:function(){return v.apply(this,arguments)}}},{"./config":104}],107:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=1e3,i=6e4,a=60*i,s=24*a;function c(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}t.exports=function(e,t){t=t||{};var n=r(e);if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return n*s;case"hours":case"hour":case"hrs":case"hr":case"h":return n*a;case"minutes":case"minute":case"mins":case"min":case"m":return n*i;case"seconds":case"second":case"secs":case"sec":case"s":return n*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=s)return c(e,t,s,"day");if(t>=a)return c(e,t,a,"hour");if(t>=i)return c(e,t,i,"minute");if(t>=o)return c(e,t,o,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=s)return Math.round(e/s)+"d";if(t>=a)return Math.round(e/a)+"h";if(t>=i)return Math.round(e/i)+"m";if(t>=o)return Math.round(e/o)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],108:[function(e,t,n){"use strict";var r,o,i=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}}();var u,l=[],f=!1,h=-1;function p(){f&&u&&(f=!1,u.length?l=u.concat(l):h=-1,l.length&&d())}function d(){if(!f){var e=c(p);f=!0;for(var t=l.length;t;){for(u=l,l=[];++h<t;)u&&u[h].run();h=-1,t=l.length}u=null,f=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function v(e,t){this.fun=e,this.array=t}function y(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new v(e,t)),1!==l.length||f||c(d)},v.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],109:[function(e,t,n){(function(t,r){(function(){"use strict";var o=e("process/browser.js").nextTick,i=Function.prototype.apply,a=Array.prototype.slice,s={},c=0;function u(e,t){this._id=e,this._clearFn=t}n.setTimeout=function(){return new u(i.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new u(i.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(e){e.close()},u.prototype.unref=u.prototype.ref=function(){},u.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},n.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n.setImmediate="function"==typeof t?t:function(e){var t=c++,r=!(arguments.length<2)&&a.call(arguments,1);return s[t]=!0,o((function(){s[t]&&(r?e.apply(null,r):e.call(null),n.clearImmediate(t))})),t},n.clearImmediate="function"==typeof r?r:function(e){delete s[e]}}).call(this)}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":108,timers:109}],110:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"NIL",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(n,"parse",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(n,"stringify",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(n,"v1",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(n,"v3",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(n,"v4",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(n,"v5",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(n,"validate",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(n,"version",{enumerable:!0,get:function(){return c.default}});var r=h(e("./v1.js")),o=h(e("./v3.js")),i=h(e("./v4.js")),a=h(e("./v5.js")),s=h(e("./nil.js")),c=h(e("./version.js")),u=h(e("./validate.js")),l=h(e("./stringify.js")),f=h(e("./parse.js"));function h(e){return e&&e.__esModule?e:{default:e}}},{"./nil.js":113,"./parse.js":114,"./stringify.js":118,"./v1.js":119,"./v3.js":120,"./v4.js":122,"./v5.js":123,"./validate.js":124,"./version.js":125}],111:[function(e,t,n){"use strict";function r(e){return 14+(e+64>>>9<<4)+1}function o(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,r,i,a){return o((s=o(o(t,e),o(r,a)))<<(c=i)|s>>>32-c,n);var s,c}function a(e,t,n,r,o,a,s){return i(t&n|~t&r,e,t,o,a,s)}function s(e,t,n,r,o,a,s){return i(t&r|n&~r,e,t,o,a,s)}function c(e,t,n,r,o,a,s){return i(t^n^r,e,t,o,a,s)}function u(e,t,n,r,o,a,s){return i(n^(t|~r),e,t,o,a,s)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var l=function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r=0;r<n;r+=8){var o=e[r>>5]>>>r%32&255,i=parseInt("0123456789abcdef".charAt(o>>>4&15)+"0123456789abcdef".charAt(15&o),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[r(t)-1]=t;for(var n=1732584193,i=-271733879,l=-1732584194,f=271733878,h=0;h<e.length;h+=16){var p=n,d=i,v=l,y=f;n=a(n,i,l,f,e[h],7,-680876936),f=a(f,n,i,l,e[h+1],12,-389564586),l=a(l,f,n,i,e[h+2],17,606105819),i=a(i,l,f,n,e[h+3],22,-1044525330),n=a(n,i,l,f,e[h+4],7,-176418897),f=a(f,n,i,l,e[h+5],12,1200080426),l=a(l,f,n,i,e[h+6],17,-1473231341),i=a(i,l,f,n,e[h+7],22,-45705983),n=a(n,i,l,f,e[h+8],7,1770035416),f=a(f,n,i,l,e[h+9],12,-1958414417),l=a(l,f,n,i,e[h+10],17,-42063),i=a(i,l,f,n,e[h+11],22,-1990404162),n=a(n,i,l,f,e[h+12],7,1804603682),f=a(f,n,i,l,e[h+13],12,-40341101),l=a(l,f,n,i,e[h+14],17,-1502002290),i=a(i,l,f,n,e[h+15],22,1236535329),n=s(n,i,l,f,e[h+1],5,-165796510),f=s(f,n,i,l,e[h+6],9,-1069501632),l=s(l,f,n,i,e[h+11],14,643717713),i=s(i,l,f,n,e[h],20,-373897302),n=s(n,i,l,f,e[h+5],5,-701558691),f=s(f,n,i,l,e[h+10],9,38016083),l=s(l,f,n,i,e[h+15],14,-660478335),i=s(i,l,f,n,e[h+4],20,-405537848),n=s(n,i,l,f,e[h+9],5,568446438),f=s(f,n,i,l,e[h+14],9,-1019803690),l=s(l,f,n,i,e[h+3],14,-187363961),i=s(i,l,f,n,e[h+8],20,1163531501),n=s(n,i,l,f,e[h+13],5,-1444681467),f=s(f,n,i,l,e[h+2],9,-51403784),l=s(l,f,n,i,e[h+7],14,1735328473),i=s(i,l,f,n,e[h+12],20,-1926607734),n=c(n,i,l,f,e[h+5],4,-378558),f=c(f,n,i,l,e[h+8],11,-2022574463),l=c(l,f,n,i,e[h+11],16,1839030562),i=c(i,l,f,n,e[h+14],23,-35309556),n=c(n,i,l,f,e[h+1],4,-1530992060),f=c(f,n,i,l,e[h+4],11,1272893353),l=c(l,f,n,i,e[h+7],16,-155497632),i=c(i,l,f,n,e[h+10],23,-1094730640),n=c(n,i,l,f,e[h+13],4,681279174),f=c(f,n,i,l,e[h],11,-358537222),l=c(l,f,n,i,e[h+3],16,-722521979),i=c(i,l,f,n,e[h+6],23,76029189),n=c(n,i,l,f,e[h+9],4,-640364487),f=c(f,n,i,l,e[h+12],11,-421815835),l=c(l,f,n,i,e[h+15],16,530742520),i=c(i,l,f,n,e[h+2],23,-995338651),n=u(n,i,l,f,e[h],6,-198630844),f=u(f,n,i,l,e[h+7],10,1126891415),l=u(l,f,n,i,e[h+14],15,-1416354905),i=u(i,l,f,n,e[h+5],21,-57434055),n=u(n,i,l,f,e[h+12],6,1700485571),f=u(f,n,i,l,e[h+3],10,-1894986606),l=u(l,f,n,i,e[h+10],15,-1051523),i=u(i,l,f,n,e[h+1],21,-2054922799),n=u(n,i,l,f,e[h+8],6,1873313359),f=u(f,n,i,l,e[h+15],10,-30611744),l=u(l,f,n,i,e[h+6],15,-1560198380),i=u(i,l,f,n,e[h+13],21,1309151649),n=u(n,i,l,f,e[h+4],6,-145523070),f=u(f,n,i,l,e[h+11],10,-1120210379),l=u(l,f,n,i,e[h+2],15,718787259),i=u(i,l,f,n,e[h+9],21,-343485551),n=o(n,p),i=o(i,d),l=o(l,v),f=o(f,y)}return[n,i,l,f]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(r(t)),o=0;o<t;o+=8)n[o>>5]|=(255&e[o/8])<<o%32;return n}(e),8*e.length))};n.default=l},{}],112:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};n.default=r},{}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default="00000000-0000-0000-0000-000000000000"},{}],114:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,o=(r=e("./validate.js"))&&r.__esModule?r:{default:r};var i=function(e){if(!(0,o.default)(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};n.default=i},{"./validate.js":124}],115:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},{}],116:[function(e,t,n){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)};var o=new Uint8Array(16)},{}],117:[function(e,t,n){"use strict";function r(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function o(e,t){return e<<t|e>>>32-t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var i=unescape(encodeURIComponent(e));e=[];for(var a=0;a<i.length;++a)e.push(i.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var s=e.length/4+2,c=Math.ceil(s/16),u=new Array(c),l=0;l<c;++l){for(var f=new Uint32Array(16),h=0;h<16;++h)f[h]=e[64*l+4*h]<<24|e[64*l+4*h+1]<<16|e[64*l+4*h+2]<<8|e[64*l+4*h+3];u[l]=f}u[c-1][14]=8*(e.length-1)/Math.pow(2,32),u[c-1][14]=Math.floor(u[c-1][14]),u[c-1][15]=8*(e.length-1)&4294967295;for(var p=0;p<c;++p){for(var d=new Uint32Array(80),v=0;v<16;++v)d[v]=u[p][v];for(var y=16;y<80;++y)d[y]=o(d[y-3]^d[y-8]^d[y-14]^d[y-16],1);for(var g=n[0],m=n[1],b=n[2],w=n[3],k=n[4],_=0;_<80;++_){var E=Math.floor(_/20),O=o(g,5)+r(E,m,b,w)+k+t[E]+d[_]>>>0;k=w,w=b,b=o(m,30)>>>0,m=g,g=O}n[0]=n[0]+g>>>0,n[1]=n[1]+m>>>0,n[2]=n[2]+b>>>0,n[3]=n[3]+w>>>0,n[4]=n[4]+k>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]};n.default=i},{}],118:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,n.unsafeStringify=s;var r,o=(r=e("./validate.js"))&&r.__esModule?r:{default:r};for(var i=[],a=0;a<256;++a)i.push((a+256).toString(16).slice(1));function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]}var c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=s(e,t);if(!(0,o.default)(n))throw TypeError("Stringified UUID is invalid");return n};n.default=c},{"./validate.js":124}],119:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,o,i,a=(r=e("./rng.js"))&&r.__esModule?r:{default:r},s=e("./stringify.js");var c=0,u=0;var l=function(e,t,n){var r=t&&n||0,l=t||new Array(16),f=(e=e||{}).node||o,h=void 0!==e.clockseq?e.clockseq:i;if(null==f||null==h){var p=e.random||(e.rng||a.default)();null==f&&(f=o=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==h&&(h=i=16383&(p[6]<<8|p[7]))}var d=void 0!==e.msecs?e.msecs:Date.now(),v=void 0!==e.nsecs?e.nsecs:u+1,y=d-c+(v-u)/1e4;if(y<0&&void 0===e.clockseq&&(h=h+1&16383),(y<0||d>c)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=d,u=v,i=h;var g=(1e4*(268435455&(d+=122192928e5))+v)%4294967296;l[r++]=g>>>24&255,l[r++]=g>>>16&255,l[r++]=g>>>8&255,l[r++]=255&g;var m=d/4294967296*1e4&268435455;l[r++]=m>>>8&255,l[r++]=255&m,l[r++]=m>>>24&15|16,l[r++]=m>>>16&255,l[r++]=h>>>8|128,l[r++]=255&h;for(var b=0;b<6;++b)l[r+b]=f[b];return t||(0,s.unsafeStringify)(l)};n.default=l},{"./rng.js":116,"./stringify.js":118}],120:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e("./v35.js")),o=i(e("./md5.js"));function i(e){return e&&e.__esModule?e:{default:e}}var a=(0,r.default)("v3",48,o.default);n.default=a},{"./md5.js":111,"./v35.js":121}],121:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.URL=n.DNS=void 0,n.default=function(e,t,n){function r(e,r,a,s){var c;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=(0,i.default)(r)),16!==(null===(c=r)||void 0===c?void 0:c.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var u=new Uint8Array(16+e.length);if(u.set(r),u.set(e,r.length),(u=n(u))[6]=15&u[6]|t,u[8]=63&u[8]|128,a){s=s||0;for(var l=0;l<16;++l)a[s+l]=u[l];return a}return(0,o.unsafeStringify)(u)}try{r.name=e}catch(e){}return r.DNS=a,r.URL=s,r};var r,o=e("./stringify.js"),i=(r=e("./parse.js"))&&r.__esModule?r:{default:r};var a="6ba7b810-9dad-11d1-80b4-00c04fd430c8";n.DNS=a;var s="6ba7b811-9dad-11d1-80b4-00c04fd430c8";n.URL=s},{"./parse.js":114,"./stringify.js":118}],122:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=a(e("./native.js")),o=a(e("./rng.js")),i=e("./stringify.js");function a(e){return e&&e.__esModule?e:{default:e}}var s=function(e,t,n){if(r.default.randomUUID&&!t&&!e)return r.default.randomUUID();var a=(e=e||{}).random||(e.rng||o.default)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){n=n||0;for(var s=0;s<16;++s)t[n+s]=a[s];return t}return(0,i.unsafeStringify)(a)};n.default=s},{"./native.js":112,"./rng.js":116,"./stringify.js":118}],123:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e("./v35.js")),o=i(e("./sha1.js"));function i(e){return e&&e.__esModule?e:{default:e}}var a=(0,r.default)("v5",80,o.default);n.default=a},{"./sha1.js":117,"./v35.js":121}],124:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,o=(r=e("./regex.js"))&&r.__esModule?r:{default:r};var i=function(e){return"string"==typeof e&&o.default.test(e)};n.default=i},{"./regex.js":115}],125:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,o=(r=e("./validate.js"))&&r.__esModule?r:{default:r};var i=function(e){if(!(0,o.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)};n.default=i},{"./validate.js":124}]},{},[5]);